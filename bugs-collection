=================================================
This is an automated collection of open reports in
the R-bugs repository.
=================================================

Directory:  Accuracy

* PR# 751 *
Subject: BUG: polyroot()
From: "Li Dongfeng" <mavip1@inet.polyu.edu.hk>
Date: Tue, 28 Nov 2000 13:24:33 +0800
--Numerical instability. We may want a better algorithm!
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 751 <==
From mavip1@inet.polyu.edu.hk  Tue Nov 28 06:25:25 2000
Received: from hkpa04.polyu.edu.hk (hkpa04.PolyU.edu.hk [158.132.14.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id GAA06942
	for <r-bugs@biostat.ku.dk>; Tue, 28 Nov 2000 06:25:20 +0100 (MET)
Received: from hkpu01 ([158.132.174.240]) by hkpa04.polyu.edu.hk
          (Netscape Messaging Server 4.15) with SMTP id G4PZ0X01.43N for
          <r-bugs@biostat.ku.dk>; Tue, 28 Nov 2000 13:24:33 +0800 
Message-ID: <001b01c058fb$7db19700$f0ae849e@polyu.edu.hk>
From: "Li Dongfeng" <mavip1@inet.polyu.edu.hk>
To: <r-bugs@biostat.ku.dk>
Subject: BUG: polyroot()
Date: Tue, 28 Nov 2000 13:24:33 +0800
MIME-Version: 1.0
Content-Type: text/plain;
	charset="gb2312"
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.50.4133.2400
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4133.2400
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from base64 to 8bit by pubhealth.ku.dk id GAA06942

I have found that the polyroot()
function in R-1.1.1(both solaris
and Win32 version) gives totally
incorrect result. Here is the offending
code:

# Polyroot bug report:
# from R-1.1.1
> sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
 [1] 0.8758259 0.9486499 0.9731015 1.5419189 1.7466214 1.7535362 1.7589484
 [8] 2.0216317 2.4421509 2.5098488 2.6615572 2.7717724 2.8444048 2.9147685
[15] 2.9302278 2.9757159 3.2037151 3.2052962 3.2498510 3.2815881 3.3250881
[22] 4.6593700 4.7048556 5.2738258 5.7369920 5.9017094
# from Splus 2000
> sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
 [1] 0.8038812 0.8038812 0.8758259 0.8758259 0.9235722
 [6] 0.9235722 0.9439788 0.9439788 0.9536692 0.9536692
[11] 0.9582403 0.9582403 0.9596028 1.0420978 1.0435796
[16] 1.0435796 1.0485816 1.0485816 1.0593458 1.0593458
[21] 1.0827524 1.0827524 1.1417794 1.1417794 1.2439649
[26] 1.2439649

From mathematical theory I know that the Splus result
is correct while the R result is wrong. I would have
checked the source if I had the time.



==> 751.reply.1 <==
From pd@biostat.ku.dk  Thu Dec  7 00:53:06 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA04390;
	Thu, 7 Dec 2000 00:53:05 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id AAA28616;
	Thu, 7 Dec 2000 00:58:28 +0100
Sender: pd@blueberry.kubism.ku.dk
To: mavip1@inet.polyu.edu.hk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] BUG: polyroot() (PR#751)
References: <200011280525.GAA06952@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 07 Dec 2000 00:58:27 +0100
In-Reply-To: mavip1@inet.polyu.edu.hk's message of "Tue, 28 Nov 2000 06:25:26 +0100 (MET)"
Message-ID: <x2k89dxfto.fsf@blueberry.kubism.ku.dk>
Lines: 96
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mavip1@inet.polyu.edu.hk writes:

> I have found that the polyroot()
> function in R-1.1.1(both solaris
> and Win32 version) gives totally
> incorrect result. Here is the offending
> code:
> 
> # Polyroot bug report:
> # from R-1.1.1
> > sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
>  [1] 0.8758259 0.9486499 0.9731015 1.5419189 1.7466214 1.7535362 1.7589484
>  [8] 2.0216317 2.4421509 2.5098488 2.6615572 2.7717724 2.8444048 2.9147685
> [15] 2.9302278 2.9757159 3.2037151 3.2052962 3.2498510 3.2815881 3.3250881
> [22] 4.6593700 4.7048556 5.2738258 5.7369920 5.9017094
> # from Splus 2000
> > sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
>  [1] 0.8038812 0.8038812 0.8758259 0.8758259 0.9235722
>  [6] 0.9235722 0.9439788 0.9439788 0.9536692 0.9536692
> [11] 0.9582403 0.9582403 0.9596028 1.0420978 1.0435796
> [16] 1.0435796 1.0485816 1.0485816 1.0593458 1.0593458
> [21] 1.0827524 1.0827524 1.1417794 1.1417794 1.2439649
> [26] 1.2439649
> 
> >From mathematical theory I know that the Splus result
> is correct while the R result is wrong. I would have
> checked the source if I had the time.

There seems to be a rather bad numerical instability with the R code.
If we define

 polyeval<-function(coef,x){v<-0;for (i in rev(coef)) v<-v*x+i; v}

(Horner's scheme), we get 

> polyeval(1:5,polyroot(1:5))
[1] -2.220446e-16-2.664833e-16i -2.220446e-16-1.554475e-16i
[3] -2.220446e-16+1.436839e-16i -2.220446e-16-5.076235e-16i

which is kind of OK except that it looks odd that the real part is the
same for all 4 roots. Increasing the degree gives

> polyeval(10:1,polyroot(10:1))
[1] 9.230968e-08+5.257143e-08i 9.230977e-08+5.257158e-08i
[3] 9.230961e-08+5.257162e-08i 9.230956e-08+5.257151e-08i
[5] 9.230974e-08+5.257145e-08i 9.230975e-08+5.257161e-08i
[7] 9.230949e-08+5.257178e-08i 9.230974e-08+5.257161e-08i
[9] 9.230969e-08+5.257184e-08i

which is fairly OK, but it does look odd that we can't get closer to
zero than that since there are no multiple roots, and again it is
peculiar that the values are so similar. The next items in the
sequence are -ahem- interesting:

> polyeval(11:1,polyroot(11:1))
 [1] 2.305607e-06+1.791577e-05i 2.309550e-06+1.791714e-05i
 [3] 2.307622e-06+1.792101e-05i 2.304150e-06+1.791869e-05i
 [5] 2.307087e-06+1.791537e-05i 2.309716e-06+1.791873e-05i
 [7] 2.306030e-06+1.792098e-05i 2.304727e-06+1.792011e-05i
 [9] 2.308569e-06+1.791588e-05i 2.308994e-06+1.792018e-05i
> polyeval(12:1,polyroot(12:1))
 [1] 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i
 [5] 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i
 [9] 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i
> polyeval(13:1,polyroot(13:1))
 [1] -9.076647e-05-0.0003440688i -1.253803e-04-0.0003691299i
 [3] -8.894859e-05-0.0003941022i -7.310528e-05-0.0003638818i
 [5] -1.144849e-04-0.0003471283i -1.221901e-04-0.0003814892i
 [7] -7.857251e-05-0.0003869614i -7.284137e-05-0.0003760067i
 [9] -1.029218e-04-0.0003424790i -1.136443e-04-0.0003910680i
[11] -1.016283e-04-0.0003956270i -1.225930e-04-0.0003567609i
> polyeval(14:1,polyroot(14:1))
 [1]     11.28833+   28.72917i     11.28833+   28.72917i
 [3]   5809.74030-  427.90119i -19407.81458+ 3462.91985i
 [5]  -2823.47547-  494.63498i -40909.65435-10789.57874i
 [7]  -8336.95783+ 5241.26935i    344.71455- 1520.94876i
 [9]   5357.44530-24665.94094i  57313.79892-43530.37668i
[11]  11464.67537+29484.08287i  30010.79343+24624.25551i
[13]  25799.32156+53755.92101i
> polyeval(15:1,polyroot(15:1))
 [1]  4.110828e+01+5.028631e+01i  4.123746e+01+5.033469e+01i
 [3]  4.113423e+01+5.043357e+01i  4.106175e+01+5.031924e+01i
 [5]  2.130747e+06+7.226414e+05i -1.088699e+08+1.096129e+09i
 [7]  1.785940e+09+1.407187e+09i  9.750674e+10-5.059480e+10i
 [9] -3.102572e+09-9.212065e+10i  7.213065e+09-1.023845e+10i
[11]  1.682049e+10+2.202050e+10i  1.889123e+10-1.046838e+11i
[13] -6.220741e+10-4.563469e+10i -1.477005e+10-3.393510e+10i

Root finding in high-degree polynomials is known to be nasty business,
but this looks more than ordinarily bad.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 751.audit <==
Sun Dec 10 14:32:11 2000	pd	changed notes
Sun Dec 10 14:32:11 2000	pd	foobar
Sun Dec 10 14:32:11 2000	pd	moved from incoming to Accuracy
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Add-ons

* PR# 781 *
Subject: syskern fails Rcmd check on Windows, gives incorrect information
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Wed, 20 Dec 2000 11:12:47 +0000 (GMT)
--Partially fixed by dse_2000.12, but still uses "ls" and gives
--incorrect information
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 781 <==
From postmaster@franz.stat.wisc.edu  Wed Dec 20 12:12:36 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA15275
	for <r-bugs@biostat.ku.dk>; Wed, 20 Dec 2000 12:12:35 +0100 (MET)
Received: from toucan.stats.ox.ac.uk (really [163.1.20.20]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m148hAv-000IYUC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Wed, 20 Dec 2000 05:12:49 -0600 (CST) 
Received: from localhost (ripley@localhost)
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id LAA02938;
	Wed, 20 Dec 2000 11:12:48 GMT
X-Authentication-Warning: toucan.stats: ripley owned process doing -bs
Date: Wed, 20 Dec 2000 11:12:47 +0000 (GMT)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
X-Sender: ripley@toucan.stats
To: r-bugs@r-project.org
cc: Paul Gilbert <pgilbert@bank-banque-canada.ca>
Subject: syskern fails Rcmd check on Windows, gives incorrect information
Message-ID: <Pine.GSO.4.05.10012201059520.2885-100000@toucan.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

syskern (`Functions for writing code that is OS and R/S independent', an
amazing description given the reality) fails Rcmd check on Windows, and
also gives incorrect information where it does work.

There are already correct OS-independent functions for these purposes in
R.  It appears not to be needed to run the other three packages in the dse
bundle, but to be the only R package that deliberately does not work on
one of the major platforms.  I doubt if it works on Macs, either.  It
should not be in the main section of CRAN unless it does what it claims.
 
> example(global.assign)

glbl.s> date.parsed()
Error in eval.with.vis(expr, envir, enclos) : 
        couldn't find function "date.parsed"

It has not been implemented!

> example(system.call)

systm.> system.call("ls")
Error in system.call("ls") : system calls must be implemented for this operating system.

But they are:

> shell("ls -C")
#R.bug.report#       cvs-co               test1
DF.R                 jpegsrc.v6b.tar.gz   test2.emf
GSD2.EMF             libpng-1.0.8.tar.gz  test3.emf
R-1.2.0.tgz          library              test4.emf
R.bug.report         mri.dat              test5.emf
Rconsole             mydata               texinfo-4.0.tar.bz2
Rdist                packages             tools
TB                   rw1020               tools.zip
VR3sc                rw1021               winold.zip
addlibs              rw1030               zlib113.zip

> system("ls", intern=TRUE)
 [1] "#R.bug.report#"      "DF.R"                "GSD2.EMF"           
 [4] "R-1.2.0.tgz"         "R.bug.report"        "Rconsole"           
 [7] "Rdist"               "TB"                  "VR3sc"              
[10] "addlibs"             "cvs-co"              "jpegsrc.v6b.tar.gz" 
[13] "libpng-1.0.8.tar.gz" "library"             "mri.dat"            
[16] "mydata"              "packages"            "rw1020"             
[19] "rw1021"              "rw1030"              "test1"              
[22] "test2.emf"           "test3.emf"           "test4.emf"          
[25] "test5.emf"           "texinfo-4.0.tar.bz2" "tools"              
[28] "tools.zip"           "winold.zip"          "zlib113.zip"        

Of course, `ls' is OS-dependent, so should not be used as an example
in a purportedly OS-independent package.

> example(system.info)

systm.> system.info()
          _              
platform  i386-pc-mingw32
arch      x86            
os        Win32          
system    x86, Win32     
status                   
major     1              
minor     2              
year      2000           
month     12             
day       15             
language  R              
OSversion MS Windows 95  
OStype    MS Windows     

That is incorrect: see what bug.report gives below.  The heading looks
strange too.

> example(whoami)

whoami> whoami()
Error in whoami() : system calls must be implemented for this operating system.

They are:

> system("whoami", intern=T)
[1] "ripley"
> Sys.info()["user"]
    user 
"ripley" 


--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = x86
 os = Win32
 system = x86, Win32
 status = 
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 15
 language = R

Windows NT 4.0 (build 1381) Service Pack 4

Search Path:
 .GlobalEnv, package:syskern, package:ctest, Autoloads, package:base

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 781.audit <==
Tue Dec 26 10:18:52 2000	ripley	changed notes
Tue Dec 26 10:18:52 2000	ripley	foobar
Tue Dec 26 10:18:52 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 567 *
Subject: ctest not works
From: George Diniz <george@cpqam.fiocruz.br>
Date: Sun, 12 Mar 2000 12:03:45 -0200
--possibly the RH6.2 Fortran bug
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 567 <==
From george@cpqam.fiocruz.br  Mon Jun 12 13:10:28 2000
Received: from nicc.cpqam.fiocruz.br ([200.133.26.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA15969
	for <r-bugs@biostat.ku.dk>; Mon, 12 Jun 2000 13:09:18 +0200 (MET DST)
Received: from cpqam.fiocruz.br (george@[200.199.8.147] (may be forged))
	by nicc.cpqam.fiocruz.br (8.8.6/8.8.6) with ESMTP id MAA20120
	for <r-bugs@biostat.ku.dk>; Sun, 11 Jun 2000 12:19:28 -0300 (EST)
Sender: george@cpqam.fiocruz.br
Message-ID: <38CBA3C1.136B513D@cpqam.fiocruz.br>
Date: Sun, 12 Mar 2000 12:03:45 -0200
From: George Diniz <george@cpqam.fiocruz.br>
X-Mailer: Mozilla 4.72 [en] (X11; U; Linux 2.2.14-5.0 i586)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@biostat.ku.dk
Subject: ctest not works
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

I try load ctest, and don't have sucess

> library(ctest)
Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to
load shared library "/usr/local/lib/R/library/ctest/libs/ctest.so":
  /usr/local/lib/R/library/ctest/libs/ctest.so: undefined symbol: ÝfÔ

What I must to do

I will waiting  your answer

George Diniz


==> 567.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon Jun 12 13:49:16 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA16056
	for <R-bugs@biostat.ku.dk>; Mon, 12 Jun 2000 13:49:15 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id NAA23885;
	Mon, 12 Jun 2000 13:53:14 +0200
Sender: pd@blueberry.kubism.ku.dk
To: george@cpqam.fiocruz.br
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] ctest not works (PR#567)
References: <200006121110.NAA15979@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 12 Jun 2000 13:53:14 +0200
In-Reply-To: george@cpqam.fiocruz.br's message of "Mon, 12 Jun 2000 13:10:29 +0200 (MET DST)"
Message-ID: <x24s6z6rpx.fsf@blueberry.kubism.ku.dk>
Lines: 21
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit

george@cpqam.fiocruz.br writes:

> I try load ctest, and don't have sucess
> 
> > library(ctest)
> Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to
> load shared library "/usr/local/lib/R/library/ctest/libs/ctest.so":
>   /usr/local/lib/R/library/ctest/libs/ctest.so: undefined symbol: ÝfÔ
> 
> What I must to do
> 
> I will waiting  your answer

First of all tell us what system you are on. With that information,
all we can say is that that is not what is supposed to happen...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 567.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Jun 12 13:58:40 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA16101;
	Mon, 12 Jun 2000 13:58:40 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id MAA00504;
	Mon, 12 Jun 2000 12:57:35 +0100 (BST)
Message-Id: <200006121157.MAA00504@toucan.stats.ox.ac.uk>
Date: Mon, 12 Jun 2000 12:57:35 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] ctest not works (PR#567)
To: george@cpqam.fiocruz.br, p.dalgaard@biostat.ku.dk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=ISO-8859-1
Content-MD5: B/7rml5xc3D4PsEG7Znu0A==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from QUOTED-PRINTABLE to 8bit by pubhealth.ku.dk id NAA16101


> To: george@cpqam.fiocruz.br
> From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
> Date: 12 Jun 2000 13:53:14 +0200
> 
> george@cpqam.fiocruz.br writes:
> 
> > I try load ctest, and don't have sucess
> > 
> > > library(ctest)
> > Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to
> > load shared library "/usr/local/lib/R/library/ctest/libs/ctest.so":
> >   /usr/local/lib/R/library/ctest/libs/ctest.so: undefined symbol: ÝfÔ
> > 
> > What I must to do
> > 
> > I will waiting  your answer
> 
> First of all tell us what system you are on. With that information,
> all we can say is that that is not what is supposed to happen...

True, but we can tell you:

This is Linux/Unix not Windows (and not HP either).

That silly symbol name suggests that this is the Fortran bug in RH6.2
we have met before.  If so, the solution is to compile with gcc-2.95.2.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 567.audit <==
Wed Jun 21 12:02:24 2000	ripley	changed notes
Wed Jun 21 12:02:24 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 496 *
From: bonneau@epi.roazhon.inra.fr (en148)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
--base R has no est.variogram function.
--This appears to be a bug report on sgeostat.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 496 <==
From bonneau@epi.roazhon.inra.fr  Tue Mar 21 11:40:23 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA24613
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 11:40:21 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA00472
	for <r-bugs@hypatia.math.ethz.ch>; Tue, 21 Mar 2000 11:40:33 +0100 (MET)
Received: from epi.roazhon.inra.fr(194.167.76.1)
 via SMTP by hypatia, id smtpdAAAa0007L; Tue Mar 21 11:40:28 2000
Received: from (bonneau@localhost)
          by epi.roazhon.inra.fr (8.8.8/jtpda-5.3) id KAA09010
          for r-bugs@lists.r-project.org; Tue, 21 Mar 2000 10:57:13 +0100 (MET)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
From: bonneau@epi.roazhon.inra.fr (en148)
Message-Id: <200003210957.KAA09010@epi.roazhon.inra.fr>

I am using R 0.65.1 under linux (Redhat 6.0),
and I have a problem with the est.variogram function when the first lag is empty (I am trying to estimate anisotropic varios)

fittedpnt<-point(fitted, x="X2", y="X3")
fittedpair<-pair(fittedpnt, num.lags=15, type="anisotropic", theta=60, dtheta=20, maxdist=maxfittedist)
fittedvario<-est.variogram(fittedpnt, fittedpair, "fit")

With my datas I have no pair in lags 1 to 3 and the error message is :
Error in psort(x, partial) : index 0 outside bounds

What can I do, in order to fix the bug ?

==> 496.audit <==
Sat Apr 01 07:32:27 2000	ripley	changed notes
Sat Apr 01 07:32:27 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Analyses

* PR# 653 *
Subject: bug in spline()?
From: Ian White <imsw@holyrood.ed.ac.uk>
Date: Mon, 4 Sep 2000 12:29:26 +0100 (BST)
--bug in spline: replace by interSpline in package spline?
--address problems are fixed
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 653 <==
From imsw@holyrood.ed.ac.uk  Mon Sep  4 13:29:07 2000
Received: from holyrood.ed.ac.uk (holyrood.ed.ac.uk [129.215.16.14])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA28104
	for <r-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 13:29:07 +0200 (MET DST)
Received: (from imsw@localhost)
	by holyrood.ed.ac.uk (8.8.7/8.8.7) id MAA07844
	for r-bugs@biostat.ku.dk; Mon, 4 Sep 2000 12:29:26 +0100 (BST)
Date: Mon, 4 Sep 2000 12:29:26 +0100 (BST)
From: Ian White <imsw@holyrood.ed.ac.uk>
Message-Id: <200009041129.MAA07844@holyrood.ed.ac.uk>
To: r-bugs@biostat.ku.dk
Subject: bug in spline()?

BUG IN SPLINE()?

Version R-1.0.1, system i486,linux

If the spline(x,y,method="natural") function is given values outside the
range of the data, it does not give a warning. Moreover, the extrapolated
value reported is not the ordinate of the natural spline defined by (x,y).

Example.  Let x <- c(2,5,8,10) and y <- c(1.2266,-1.7606,-0.5051,1.0390).
Then interpolate/extrapolate with a natural cubic spline at 1:10 using
either

spline(x,y,n=10,method="natural",xmin=1,xmax=10)

or

fn <- splinefun(x,y,method="natural")
fn(1:10)

This gives c(2.5366,1.2266,-0.0834,...,1.0390). I agree with all values
except that at x=1. The interpolation formula in Green and Silverman's
book on splines gives the derivative of a natural spline at the first
knot as f'(x1)=(f2-f1)/(x2-x1) -(1/6)(x2-x1)d, where d=second derivative
at the second knot. For the above example, d=0.7071, f'(x1)=-1.3493,
and the natural spline interpolant has value 1.2266-(-1.3493)=2.5759
at x=1, not 2.5366.

PS There are different e-mail addresses for bug reports given in the
FAQ file and in the help information for bug.report.

************************************************
*    I.White                                   *
*    ICAPB, University of Edinburgh            *
*    Ashworth Laboratories, West Mains Road    *
*    Edinburgh EH9 3JT                         *
*    Fax: 0131 667 3210   Tel: 0131 650 5490   *
*    E-mail: i.m.s.white@ed.ac.uk              *
************************************************

==> 653.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon Sep  4 14:25:15 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA29112
	for <R-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 14:25:15 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id OAA02525;
	Mon, 4 Sep 2000 14:28:38 +0200
Sender: pd@blueberry.kubism.ku.dk
To: imsw@holyrood.ed.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] bug in spline()? (PR#653)
References: <200009041129.NAA28115@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 Sep 2000 14:28:37 +0200
In-Reply-To: imsw@holyrood.ed.ac.uk's message of "Mon, 4 Sep 2000 13:29:08 +0200 (MET DST)"
Message-ID: <x2n1homjd6.fsf@blueberry.kubism.ku.dk>
Lines: 48
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

imsw@holyrood.ed.ac.uk writes:

> This gives c(2.5366,1.2266,-0.0834,...,1.0390). I agree with all values
> except that at x=1. The interpolation formula in Green and Silverman's
> book on splines gives the derivative of a natural spline at the first
> knot as f'(x1)=(f2-f1)/(x2-x1) -(1/6)(x2-x1)d, where d=second derivative
> at the second knot. For the above example, d=0.7071, f'(x1)=-1.3493,
> and the natural spline interpolant has value 1.2266-(-1.3493)=2.5759
> at x=1, not 2.5366.

Also, 

plot(diff(fn(seq(1,3,.01))))

reveals that something is wrong

At the other end, 

 plot(diff(fn(seq(8,11,.01))))

looks even weirder, especially if one modifies 
to y <- c(1.2266,-1.7606,-0.5051,1.01)


> PS There are different e-mail addresses for bug reports given in the
> FAQ file and in the help information for bug.report.

Hmm, and neither looks quite right! One would probably want the
address to be in the r-project.org domain (in case we move it away
from Copenhagen). "r-bugs@list.r-project.org", however, is none too
logical and assumes that there's an r-bugs user or an alias in Zurich
which forwards to biostat.dk (there is, it seems). Same thing with
r-bugs@r-project.org, since the Wisconsin machine aliases r-bugs to
r-bugs@lists.r-project.org. 

More logical would be to use r-bugs@r-project.org and have the
forwarding there go to biostat.dk.

Alternatively, it ought to work as r-bugs@bugs.r-project.org, but that
doesn't work whenever a RedHat upgrade blows away the resending rules
in my sendmail.cf... (the program in r-bugs' .forward needs to execute
on a machine that matches the architecture of the binary!)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 653.reply.2 <==
From bates@stat.wisc.edu  Mon Sep  4 23:50:57 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA02696
	for <R-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 23:50:57 +0200 (MET DST)
Received: by franz.stat.wisc.edu
	via sendmail from stdin
	id <m13W4B0-000IYXC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for R-bugs@biostat.ku.dk; Mon, 4 Sep 2000 16:53:14 -0500 (CDT) 
Sender: bates@franz.stat.wisc.edu
To: imsw@holyrood.ed.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] bug in spline()? (PR#653)
References: <200009041129.NAA28115@pubhealth.ku.dk>
From: Douglas Bates <bates@stat.wisc.edu>
Date: 04 Sep 2000 16:53:14 -0500
In-Reply-To: imsw@holyrood.ed.ac.uk's message of "Mon, 4 Sep 2000 13:29:08 +0200 (MET DST)"
Message-ID: <6ritsb7rjp.fsf@franz.stat.wisc.edu>
Lines: 49
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

imsw@holyrood.ed.ac.uk writes:

> BUG IN SPLINE()?
> 
> Version R-1.0.1, system i486,linux
> 
> If the spline(x,y,method="natural") function is given values outside the
> range of the data, it does not give a warning. Moreover, the extrapolated
> value reported is not the ordinate of the natural spline defined by (x,y).
> 
> Example.  Let x <- c(2,5,8,10) and y <- c(1.2266,-1.7606,-0.5051,1.0390).
> Then interpolate/extrapolate with a natural cubic spline at 1:10 using
> either
> 
> spline(x,y,n=10,method="natural",xmin=1,xmax=10)
> 
> or
> 
> fn <- splinefun(x,y,method="natural")
> fn(1:10)
> 
> This gives c(2.5366,1.2266,-0.0834,...,1.0390). I agree with all values
> except that at x=1. The interpolation formula in Green and Silverman's
> book on splines gives the derivative of a natural spline at the first
> knot as f'(x1)=(f2-f1)/(x2-x1) -(1/6)(x2-x1)d, where d=second derivative
> at the second knot. For the above example, d=0.7071, f'(x1)=-1.3493,
> and the natural spline interpolant has value 1.2266-(-1.3493)=2.5759
> at x=1, not 2.5366.

I think the `interpSpline' function in the splines package gives the
desired natural interpolation spline.  Perhaps we should change the
underlying code for the spline function.

 > library(splines)
 > x <- c(2,5,8,10)
 > y <- c(1.2266,-1.7606,-0.5051,1.0390)
 > ns1 <- interpSpline(y ~ x)
 > plot(ns1)   # gives a plot that looks reasonable
 > points(x,y)
 > predict(ns1, 1:10)
 $x
  [1]  1  2  3  4  5  6  7  8  9 10

 $y
  [1]  2.5758923  1.2266000 -0.0834080 -1.1577100 -1.7606000 -1.7349409
  [7] -1.2378717 -0.5051000  0.2669514  1.0390000

 attr(,"class")
 [1] "xyVector"

==> 653.audit <==
Wed Oct 25 06:56:51 2000	ripley	changed notes
Wed Oct 25 06:56:51 2000	ripley	moved from incoming to Analyses
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Documentation

none

Directory:  Graphics

* PR# 791 *
Subject:  par(lab= *) / axis(*) bug 
From: maechler@stat.math.ethz.ch
Date: Fri, 22 Dec 2000 10:59:26 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 791 <==
From postmaster@franz.stat.wisc.edu  Fri Dec 22 10:59:23 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA08619
	for <r-bugs@biostat.ku.dk>; Fri, 22 Dec 2000 10:59:23 +0100 (MET)
Received: from stat.math.ethz.ch (really [129.132.58.23]) by franz.stat.wisc.edu
	via in.smtpd with esmtp (ident daemon using rfc1413)
	id <m149OzA-000IXMC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Fri, 22 Dec 2000 03:59:36 -0600 (CST) 
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA02617;
	Fri, 22 Dec 2000 10:59:34 +0100 (MET)
Received: from UNKNOWN(129.132.58.33), claiming to be "florence.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa000cp; Fri Dec 22 10:59:26 2000
Received: (maechler@localhost) by florence.ethz.ch (8.9.3/D-MATH-client) id KAA23075; Fri, 22 Dec 2000 10:59:26 +0100
Date: Fri, 22 Dec 2000 10:59:26 +0100
From: maechler@stat.math.ethz.ch
Message-Id: <200012220959.KAA23075@florence.ethz.ch>
To: r-bugs@r-project.org
Subject:  par(lab= *) / axis(*) bug 
Cc: maechler@stat.math.ethz.ch

As the subject says,
here is example code (with comments) showing the problem:

p1 <- function(lab = c(8,12,7))
{
    ## This `fails' (on a virgin device)
    clab <- paste(lab,collapse=",")
    plot(1,1, xlim = c(0,15), ylim = c(-.8,1), type ="n", axes = FALSE,
         main=paste("plot(*,axes=F); par(lab= c(",clab,"));  axis(*) x 2",sep=""))
    box(col="gray80")
    op <- par(lab = lab) ; on.exit(par(op))
    axis(1, pos = 0)
    axis(2, pos = 0, las = 1)
    par(op)
    op
}

p2 <- function(lab = c(8,12,7))
{
    ## This works  [par()  *BEFORE*  plot() ]
    clab <- paste(lab,collapse=",")
    op <- par(lab = lab) ; on.exit(par(op))

    plot(1,1, xlim = c(0,15), ylim = c(-.8,1), type ="n", axes = FALSE,
         main=paste("par(lab= c(",clab,")); plot(*,axes=F); axis(*) x 2",sep=""))
    box(col="gray80")
    axis(1, pos = 0)
    axis(2, pos = 0, las = 1)
    op ## lab 5 5 7
}

dev.off()
par(mfrow=c(2,1), mar=c(2,2,3,1))
p1()
p2()




--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Patched
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 19
 language = R

Search Path:
 .GlobalEnv, package:nls, package:splines, package:lqs, package:modreg, package:stepfun, package:mva, package:eda, package:ts, package:VLMC, package:ctest, package:SfS, Autoloads, package:base

==> 791.audit <==
Tue Dec 26 10:31:10 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 660 *
Subject: identify.default ignores any setting of cex.
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Fri, 15 Sep 2000 10:23:39 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 660 <==
From postmaster@franz.stat.wisc.edu  Fri Sep 15 11:23:32 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA13327
	for <R-bugs@biostat.ku.dk>; Fri, 15 Sep 2000 11:23:32 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA17846
	for <r-bugs@hypatia.math.ethz.ch>; Fri, 15 Sep 2000 11:23:49 +0200 (MET DST)
Received: from franz.stat.wisc.edu(128.105.174.95)
 via SMTP by hypatia, id smtpdAAAa004Mn; Fri Sep 15 11:23:42 2000
Received: from toucan.stats.ox.ac.uk (really [163.1.20.20]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m13Zrkl-000IW0C@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <R-bugs@r-project.org>; Fri, 15 Sep 2000 04:25:51 -0500 (CDT) 
Received: from localhost (ripley@localhost)
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id KAA14892
	for <R-bugs@r-project.org>; Fri, 15 Sep 2000 10:23:39 +0100 (BST)
X-Authentication-Warning: toucan.stats: ripley owned process doing -bs
Date: Fri, 15 Sep 2000 10:23:39 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
X-Sender: ripley@toucan.stats
To: R-bugs@r-project.org
Subject: identify.default ignores any setting of cex.
Message-ID: <Pine.GSO.4.05.10009151011510.14885-100000@toucan.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

R 1.1.1 on Windows, but I think this is widespread.

Using either

par(cex=0.5)
plot(1:10)
identify(1:10)

or

plot(1:10)
identify(1:10, cex=0.5)

ignores the cex setting.  The root cause is that par(cex=0.5)
alters cexbase for the device but sets cex=1.0, and the internal
text plotting routines use cex and not cexbase.

The obvious fix is to set cex to cexbase in do_identify. However,
if this is fixed, there is another problem, The offset of the label
is related to the cex in use for the label, and not for the symbol.
So

plot(1:10, type="n")
points(1:10, cex=5)
identify(1:10)

is not sensible in placing the labels.  That may be hard to anticipate,
but 

plot(1:10)
identify(1:10, cex=0.5)

needs to use cex=1 not cex=0.5 for the adjustment.  Perhaps identify is
trying too hard, and should give the user more control over the precise
position of the label (as S-PLUS does).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 660.audit <==
Wed Oct 25 06:57:35 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 202 *
Subject: persp box occlusion bug
From: wsi@gcal.ac.uk
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
--The persp algorithm does not apply the occlusion rules to the frame, 
--which is always plotted first. 
--A bug, but not very simple to fix.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 202 <==
From wsi@gcal.ac.uk  Wed Jun  2 15:02:10 1999
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA27126
	for <R-bugs@biostat.ku.dk>; Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
From: wsi@gcal.ac.uk
Message-Id: <199906021302.PAA27126@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: persp box occlusion bug

Full_Name: Bill Simpson
Version: 64.1
OS: linux
Submission from: (NULL) (193.62.250.209)


Bug in persp() bounding box:
If the surface being plotted extends below the lower z-axis boundary, the box
is
drawn with the wrong occlusion. The box is shown as being occluded by the
surface
even though it should be in front of the surface.

The box is correct for surface extending above the box. Problem is only for
surface extending below the box.

This exhibits the bug:

std<-rep(seq(-32,32,8),9)/1000 * 60
cf<-rep(seq(-32,32,8),rep(9,9))/1000 *60 
dp<-(cf-std)/.6
std<-unique(std)
cf<-unique(cf)
dp<-t(matrix(dp,length(cf),length(std)))
persp(std,cf,dp, xlim=c(-2,2), ylim=c(-2,2), zlim=c(0,5),theta=-40,    
phi=45,
box=TRUE,ltheta=-120, lphi=120,
d=1.5, shade=.7)


==> 202.audit <==
Wed Jun 30 19:31:18 1999	pd	moved from incoming to Graphics
Thu Jul 01 18:19:48 1999	pd	changed notes
Sun Feb 20 10:07:11 2000	ripley	changed notes
Mon Feb 28 17:17:51 2000	pd	changed notes
Mon Feb 28 17:18:28 2000	pd	changed notes
Mon Feb 28 17:19:35 2000	pd	changed notes
Mon Feb 28 17:20:17 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 726 *
Subject: par(las=.)  gives wrong "adj" for mtext()
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Tue, 7 Nov 2000 13:03:58 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 726 <==
From maechler@stat.math.ethz.ch  Tue Nov  7 13:03:47 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA19936
	for <R-bugs@biostat.ku.dk>; Tue, 7 Nov 2000 13:03:46 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id NAA27952
	for <R-bugs@stat.math.ethz.ch>; Tue, 7 Nov 2000 13:04:04 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa006od; Tue Nov  7 13:04:00 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id NAA03777; Tue, 7 Nov 2000 13:03:59 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14855.61358.974454.417553@gargle.gargle.HOWL>
Date: Tue, 7 Nov 2000 13:03:58 +0100
To: R-bugs@stat.math.ethz.ch
Subject: par(las=.)  gives wrong "adj" for mtext()
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

For R Version 1.1.1 and R-devel (Linux)...

Sorry, there's no time to fix myself now
{e.g., after starting a new device} :

    par(las=3); plot(1:10); par(las=1) ; mtext("mtext")

Gives a left-adjusted (as for  adj = 0)  mtext,
even if  par("adj") is still 0.5

Note that I'm also not convinced that  mtext() should follow  par("las")
as it does in the following {2nd bug ?} :


    par(las=3); plot(1:10); mtext("mtext")

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 726.followup.1 <==
From ligges@statistik.uni-dortmund.de  Tue Nov  7 14:43:55 2000
Received: from nx5.HRZ.Uni-Dortmund.DE (nx5.HRZ.Uni-Dortmund.DE [129.217.131.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA21669
	for <R-bugs@biostat.ku.dk>; Tue, 7 Nov 2000 14:43:55 +0100 (MET)
Received: from amadeus.statistik.uni-dortmund.de by nx5.HRZ.Uni-Dortmund.DE
          via smtp-local with ESMTP; Tue, 7 Nov 2000 14:44:09 +0100
Received: from statistik.uni-dortmund.de (dial-142031.HRZ.Uni-Dortmund.DE [129.217.142.31])
	by amadeus.statistik.uni-dortmund.de (8.9.3+Sun/8.9.3) with ESMTP id OAA20383;
	Tue, 7 Nov 2000 14:44:08 +0100 (MET)
Message-ID: <3A08073D.F6C15CAA@statistik.uni-dortmund.de>
Date: Tue, 07 Nov 2000 14:44:29 +0100
From: Uwe Ligges <ligges@statistik.uni-dortmund.de>
X-Mailer: Mozilla 4.76 [en] (WinNT; U)
X-Accept-Language: de-DE,en
MIME-Version: 1.0
To: maechler@stat.math.ethz.ch
CC: R-bugs <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] par(las=.)  gives wrong "adj" for mtext() (PR#726)
References: <200011071203.NAA19946@pubhealth.ku.dk>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

maechler@stat.math.ethz.ch wrote:
> 
> For R Version 1.1.1 and R-devel (Linux)...
> 
> Sorry, there's no time to fix myself now
> {e.g., after starting a new device} :
> 
>     par(las=3); plot(1:10); par(las=1) ; mtext("mtext")
>
> Gives a left-adjusted (as for  adj = 0)  mtext,
> even if  par("adj") is still 0.5


That's not a bug, I suppose. From help of mtext():

adj  adjustment for each string. [......]
     If adj is not a finite value (the default), 
                                       ^^^^^^^ = NA, not from par("adj")
     the value par("las") determines the adjustment. 
     For strings plotted parallel to the axis the default is to centre
the string. 
 

> Note that I'm also not convinced that  mtext() should follow  par("las")
> as it does in the following {2nd bug ?} :
> 
>     par(las=3); plot(1:10); mtext("mtext")


Everything is vertical, here (R-1.1.1, WinNT4.0). I don't see a second
bug ...



But I think most users don't expect the behavior of mtext(). Maybe some
changes are useful:

1. The above described "bug", maybe centre all strings as the default
(and not only those strings plotted parallel to the axis), so there are
not so much dependencies between the settings of "adj" and "las".

2. Have a look at:

      par("las"=3)
      plot(1:10)
      mtext("text1", adj=0.2)
      mtext("text2", adj=0.8)

This is intended (from the help), but I would expect (without reading
the help at first) the following result:
 
      par("las"=3)
      plot(1:10)
      mtext("text1", adj=0.2, at=5.5)
      mtext("text2", adj=0.8, at=5.5)


Additionally: The argument "adj" in mtext() does not support adj=c(x, y)
as described in ?par.



Regards,
Uwe Ligges

==> 726.reply.1 <==
From maechler@stat.math.ethz.ch  Wed Nov  8 12:27:35 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA02270
	for <R-bugs@biostat.ku.dk>; Wed, 8 Nov 2000 12:27:35 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id MAA23933;
	Wed, 8 Nov 2000 12:27:47 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005pv; Wed Nov  8 12:27:45 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id MAA05036; Wed, 8 Nov 2000 12:27:44 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14857.14512.195716.697631@gargle.gargle.HOWL>
Date: Wed, 8 Nov 2000 12:27:44 +0100
To: Uwe Ligges <ligges@statistik.uni-dortmund.de>
Cc: R-bugs <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] par(las=.)  gives wrong "adj" for mtext() (PR#726)
In-Reply-To: <3A08073D.F6C15CAA@statistik.uni-dortmund.de>
References: <200011071203.NAA19946@pubhealth.ku.dk>
	<3A08073D.F6C15CAA@statistik.uni-dortmund.de>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "Uwe" == Uwe Ligges <ligges@statistik.uni-dortmund.de> writes:

    Uwe> maechler@stat.math.ethz.ch wrote:
    >>  For R Version 1.1.1 and R-devel (Linux)...
    >> 
    >> Sorry, there's no time to fix myself now {e.g., after starting a new
    >> device} :
    >> 
    >> par(las=3); plot(1:10); par(las=1) ; mtext("mtext")
    >> 
    >> Gives a left-adjusted (as for adj = 0) mtext, even if par("adj") is
    >> still 0.5


    Uwe> That's not a bug, I suppose. From help of mtext():

    Uwe> adj adjustment for each string. [......]  If adj is not a finite
    Uwe> value (the default), ^^^^^^^ = NA, not from par("adj") the value
    Uwe> par("las") determines the adjustment.  For strings plotted
    Uwe> parallel to the axis the default is to centre the string.
 
Yes, it *is* one!

Note that above, I had already reset  "par(las = 1)"
*before* doing  mtext(.) !

--------

    >> Note that I'm also not convinced that mtext() should follow
    >> par("las") as it does in the following {2nd bug ?} :
    >> 
    >> par(las=3); plot(1:10); mtext("mtext")


    Uwe> Everything is vertical, here (R-1.1.1, WinNT4.0). I don't see a
    Uwe> second bug ...

yes, and I didn't say so, I said
"not convinced that mtext() should ..."

I think you have good  points below :

    Uwe> But I think most users don't expect the behavior of mtext(). Maybe
    Uwe> some changes are useful:

    Uwe> 1. The above described "bug", maybe centre all strings as the
    Uwe> default (and not only those strings plotted parallel to the axis),
    Uwe> so there are not so much dependencies between the settings of
    Uwe> "adj" and "las".

    Uwe> 2. Have a look at:

    Uwe> par("las"=3)
    Uwe> plot(1:10)
    Uwe> mtext("text1", adj=0.2)
    Uwe> mtext("text2", adj=0.8)

    Uwe> This is intended (from the help), but I would expect (without reading
    Uwe> the help at first) the following result:
 
    Uwe> par("las"=3)
    Uwe> plot(1:10)
    Uwe> mtext("text1", adj=0.2, at=5.5)
    Uwe> mtext("text2", adj=0.8, at=5.5)

Request for comments :  
Shouldn't we change the behavior() of mtext() here?

----


    Uwe> Additionally: The argument "adj" in mtext() does not support
    Uwe> adj=c(x, y) as described in ?par.

yes, but the `adj' argument of mtext()  *is*  documented explicitly,
(partly for that reason!).


==> 726.audit <==
Thu Nov  9 08:22:23 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 693 *
Subject:  Bug report
From: "Amaratunga, Rohith" <Rohith.Amaratunga@dsto.defence.gov.au>
Date: Thu, 12 Oct 2000 14:08:31 +1100
--grid problem: note a report on 0.90.1 and nothing to reproduce this
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 693 <==
From Rohith.Amaratunga@dsto.defence.gov.au  Thu Oct 12 05:11:35 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id FAA26284
	for <R-bugs@biostat.ku.dk>; Thu, 12 Oct 2000 05:11:30 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id FAA16167
	for <r-bugs@hypatia.math.ethz.ch>; Thu, 12 Oct 2000 05:11:47 +0200 (MET DST)
Received: from digger1.defence.gov.au(203.5.217.4)
 via SMTP by hypatia, id smtpdAAAa003w.; Thu Oct 12 05:11:42 2000
Received: from dsto-ms2.dsto.defence.gov.au (dsto-ms2.dsto.defence.gov.au [131.185.2.150])
	by digger1.defence.gov.au (8.10.1/8.10.1) with ESMTP id e9C3CE813598
	for <r-bugs@hypatia.math.ethz.ch>; Thu, 12 Oct 2000 12:42:14 +0930 (CST)
Received: from muttley.dsto.defence.gov.au (unverified) by dsto-ms2.dsto.defence.gov.au
 (Content Technologies SMTPRS 4.1.5) with ESMTP id <T83b902964f35a6c607@dsto-ms2.dsto.defence.gov.au> for <r-bugs@hypatia.math.ethz.ch>;
 Thu, 12 Oct 2000 12:42:18 +0930
Received: from fmbex001.dsto.defence.gov.au (fmbex001.dsto.defence.gov.au [146.221.39.73])
	by muttley.dsto.defence.gov.au (8.9.3/8.9.3/8.9.3.LMD.990513) with ESMTP id MAA09164
	for <r-bugs@lists.r-project.org>; Thu, 12 Oct 2000 12:38:31 +0930 (CST)
Received: by fmbex001.dsto.defence.gov.au with Internet Mail Service (5.5.2650.21)
	id <4HDLKHHB>; Thu, 12 Oct 2000 14:08:35 +1100
Message-ID: <751E281AA9DED31194FA0090274DFFBC51414D@FMBEX003>
From: "Amaratunga, Rohith" <Rohith.Amaratunga@dsto.defence.gov.au>
To: "'r-bugs@lists.r-project.org'" <r-bugs@stat.math.ethz.ch>
Subject:  Bug report
Date: Thu, 12 Oct 2000 14:08:31 +1100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2650.21)
Content-Type: text/plain

I am operating R on a linux platform and the version info is given below

platform 	i686-unknown-linux
arch	i686
os	linux
system	i686, linux
status
major	0
minor	90.1
year	1999
month	December
day	15
languag  R

I cannot get the correct grid lines when I use the command grid() on a log
scale.  I have also tried using grid(1) and a variety of numbers but with no
luck

Thanks

Rohith


Rohith Amaratunga
Aeronautical and Maritime Research Laboratory
506 Lorimer Street,
Fishermans Bend, Victoria 3207.
Tel: (03) 9626 7154 (B), 0417 317 445, (03) 9818 5776 (H)
E-mail: rohith.amaratunga@dsto.defence.gov.au


==> 693.audit <==
Wed Oct 25 06:44:12 2000	ripley	changed notes
Wed Oct 25 06:44:12 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 776 *
Subject: strwidth does not take font into account
From: Martyn Plummer <plummer@iarc.fr>
Date: Tue, 19 Dec 2000 14:56:01 +0100 (CET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 776 <==
From postmaster@franz.stat.wisc.edu  Tue Dec 19 14:53:40 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA05819
	for <r-bugs@biostat.ku.dk>; Tue, 19 Dec 2000 14:53:39 +0100 (MET)
Received: from smtp02.iarc.fr (really [212.157.236.234]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m148NHG-000IYiC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 07:58:02 -0600 (CST) 
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id OAA21720
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 14:53:55 +0100
Message-ID: <XFMail.001219145601.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
Date: Tue, 19 Dec 2000 14:56:01 +0100 (CET)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: r-bugs@r-project.org
Subject: strwidth does not take font into account

One for the wishlist.

The text() function permits the use of different fonts with the arguments
"font" or "vfont".  These create text strings of the same height as the
default font, but of different widths: bold face is slightly wider; vector
fonts are usually much wider.  I think the strwidth() function needs to
take the font into account by also having "font" and "vfont" arguments.
Currently it reports the string width using the default font, which can
be quite different.

Here is a little test function you can use to see how far off the
reported string width is.

test.strwidth <-
function(text, vfont=NULL, cex=NULL, ...)
{
 plot(0,0,xlim=c(-1,1),ylim=c(-1,1), type="n")
 text(0,0, text, adj=c(0,0), offset=0, cex=cex, vfont=vfont, ...)
 abline(h=c(0, strheight(text, cex=cex)), lty=2)
 abline(v=c(0, strwidth(text, cex=cex)), lty=2)
}

e.g.

test.strwidth("This is some text", cex=2)
test.strwidth("This is some text", cex=2, font=2)
test.strwidth("This is some text", vfont=c("sans serif", "plain"))

Martyn

Please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status =
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base




==> 776.audit <==
Tue Dec 26 10:31:10 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 764 *
Subject: qqline
From: Setzer.Woodrow@epamail.epa.gov
Date: Mon, 11 Dec 2000 18:06:27 -0500
--changed for 1.2.0 already, perhaps not what was desired
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 764 <==
From Setzer.Woodrow@epamail.epa.gov  Tue Dec 12 00:15:35 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA19527
	for <R-bugs@biostat.ku.dk>; Tue, 12 Dec 2000 00:15:33 +0100 (MET)
From: Setzer.Woodrow@epamail.epa.gov
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id AAA13736
	for <r-bugs@lists.r-project.org>; Tue, 12 Dec 2000 00:15:48 +0100 (MET)
Received: from UNKNOWN(134.67.208.33), claiming to be "myrtle.rtpnc.epa.gov"
 via SMTP by hypatia, id smtpdAAAa003M.; Tue Dec 12 00:15:46 2000
Received: from epahub11.rtp.epa.gov (epahub11.rtp.epa.gov [134.67.213.52])
 by epamail.epa.gov (PMDF V5.2-32 #42055)
 with ESMTP id <0G5F004IMEYH26@epamail.epa.gov> for r-bugs@lists.r-project.org;
 Mon, 11 Dec 2000 18:08:41 -0500 (EST)
Date: Mon, 11 Dec 2000 18:06:27 -0500
Subject: qqline
To: r-bugs@hypatia.math.ethz.ch
Message-id: <OF1764EFE0.E7EECDA2-ON852569B2.007B33DF@rtp.epa.gov>
MIME-version: 1.0
X-Mailer: Lotus Notes Release 5.0.3  March 21, 2000
Content-type: text/plain; charset=us-ascii
X-MIMETrack: Serialize by Router on EPAHUB11/USEPA/US(Release 5.0.5 |September
 22, 2000) at 12/11/2000 06:08:41 PM

I think qqline does not do exactly what it is advertised to do ("`qqline'
adds a line to a normal quantile-quantile plot which passes through the
first and third quartiles.").  Consider the graph:

tmp <- qnorm(ppoints(10))
qqnorm(tmp)
qqline(tmp)

The line (which I expected go through all the points), has a slightly
shallower slope than does the points plotted by qqnorm.  I think the
problem is that qqline bases its line on the relationship between the
quartiles in the data and the large sample expected quartiles for a normal
distribution; qqnorm bases its plot on the relationship between the
quantiles in the data and an approximation to the (finite-sample) expected
quantiles for a normal distribution.  In qqnorm, the x-coordinates of the
first and third quartiles of the data vector ('tmp' in this case) are not
qnorm(c(0.25,0.75)) (as qqline does), but rather something like
quantile(qnorm(ppoints(length(tmp))),c(0.25,0.75)).  I say "something like"
because it is exactly right when the quartiles fall on data points, and an
approximation otherwise.

The following definition for qqline reflects this point:

function (y, ...)
{
  y <- y[!is.na(y)]
  n <- length(y)
    y <- quantile(y, c(0.25, 0.75))
    x <- quantile(qnorm(ppoints(n)),c(0.25, 0.75))
    slope <- diff(y)/diff(x)
    int <- y[1] - slope * x[1]
    abline(int, slope, ...)
}

I'm not sure it makes very much of a difference, though, for looking at
real data, instead of something like expected quantiles.

--please do not edit the information below--

Version:
 platform = Windows
 arch = x86
 os = Win32
 system = x86, Win32
 status =
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Windows 9x 4.10 (build 1998)

Search Path:
 .GlobalEnv, package:MASS, package:logspline, Autoloads, package:base

R. Woodrow Setzer, Jr.                                            Phone:
(919) 541-0128
Experimental Toxicology Division                       Fax:  (919) 541-5394
Pharmacokinetics Branch
NHEERL MD-74; US EPA; RTP, NC 27711


==> 764.reply.1 <==
From maechler@stat.math.ethz.ch  Tue Dec 12 15:28:56 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA27678
	for <R-bugs@biostat.ku.dk>; Tue, 12 Dec 2000 15:27:25 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id PAA21686;
	Tue, 12 Dec 2000 15:25:02 +0100 (MET)
Received: from UNKNOWN(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005Ig; Tue Dec 12 15:24:58 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id PAA06714; Tue, 12 Dec 2000 15:24:56 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14902.13624.652864.269495@gargle.gargle.HOWL>
Date: Tue, 12 Dec 2000 15:24:56 +0100
To: Setzer.Woodrow@epamail.epa.gov
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] qqline (PR#764)
In-Reply-To: <200012112315.AAA19537@pubhealth.ku.dk>
References: <200012112315.AAA19537@pubhealth.ku.dk>
X-Mailer: VM 6.86 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "Setzer" == Setzer Woodrow <Setzer.Woodrow@epamail.epa.gov> writes:

    Setzer> I think qqline does not do exactly what it is advertised to do
    Setzer> ("`qqline' adds a line to a normal quantile-quantile plot which
    Setzer> passes through the first and third quartiles.").  

yes, the above may not be clear enough.

    Setzer> Consider the graph:

    Setzer> tmp <- qnorm(ppoints(10))
    Setzer> qqnorm(tmp)
    Setzer> qqline(tmp)

    Setzer> The line (which I expected go through all the points), has a
    Setzer> slightly shallower slope than does the points plotted by
    Setzer> qqnorm.  I think the problem is that qqline bases its line on
    Setzer> the relationship between the quartiles in the data and the
    Setzer> large sample expected quartiles for a normal distribution;
    Setzer> qqnorm bases its plot on the relationship between the quantiles
    Setzer> in the data and an approximation to the (finite-sample)
    Setzer> expected quantiles for a normal distribution.  In qqnorm, the
    Setzer> x-coordinates of the first and third quartiles of the data
    Setzer> vector ('tmp' in this case) are not qnorm(c(0.25,0.75)) (as
    Setzer> qqline does), but rather something like
    Setzer> quantile(qnorm(ppoints(length(tmp))),c(0.25,0.75)).  I say
    Setzer> "something like" because it is exactly right when the quartiles
    Setzer> fall on data points, and an approximation otherwise.

good analysis!

    Setzer> The following definition for qqline reflects this point:

    Setzer> function (y, ...)
    Setzer> {
    Setzer> y <- y[!is.na(y)]
    Setzer> n <- length(y)
    Setzer> y <- quantile(y, c(0.25, 0.75))
    Setzer> x <- quantile(qnorm(ppoints(n)),c(0.25, 0.75))
    Setzer> slope <- diff(y)/diff(x)
    Setzer> int <- y[1] - slope * x[1]
    Setzer> abline(int, slope, ...)
    Setzer> }

    Setzer> I'm not sure it makes very much of a difference, though, for
    Setzer> looking at real data, instead of something like expected
    Setzer> quantiles.

The Development Version of R (R 1.2 in a few days) has

 function (y, ...) 
 {
     y <- quantile(y[!is.na(y)], c(0.25, 0.75))
     x <- qnorm(c(0.25, 0.75))
     slope <- diff(y)/diff(x)
     int <- y[1] - slope * x[1]
     abline(int, slope, ...)
 }

which I think *does* what you suggest it should do.

HOWEVER I was quite a bit astonished to see 
that the slope is still too small (for small sample sizes only).

 par(mfrow=c(2,2))
 for(n in 9:12){ x <- qnorm(ppoints(n));qqnorm(x,main=paste("n=",n));qqline(x) }

But I think we are now doing what Tukey defined in his EDA book(s)
and what the other S engines do as well.
 {as a matter of fact, R should also return the (int, slope) vector !}

Note that you can also play with the " a = " argument of ppoints,
it's not directly clear to me which value is "optimal" for the above purpose...

---------

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 764.audit <==
Wed Dec 13 10:40:50 2000	ripley	moved from incoming to Graphics
Wed Dec 13 10:41:45 2000	ripley	changed notes
Wed Dec 13 10:41:45 2000	ripley	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 750 *
Subject: abline() does not obey "xpd" (clipping rules)
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 27 Nov 2000 18:27:11 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 750 <==
From maechler@stat.math.ethz.ch  Mon Nov 27 18:27:05 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA04861
	for <R-bugs@biostat.ku.dk>; Mon, 27 Nov 2000 18:27:04 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA21229
	for <R-bugs@stat.math.ethz.ch>; Mon, 27 Nov 2000 18:27:14 +0100 (MET)
Received: from UNKNOWN(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005Bf; Mon Nov 27 18:27:12 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id SAA01940; Mon, 27 Nov 2000 18:27:11 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14882.39279.553452.20503@gargle.gargle.HOWL>
Date: Mon, 27 Nov 2000 18:27:11 +0100
To: R-bugs@stat.math.ethz.ch
Subject: abline() does not obey "xpd" (clipping rules)
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

This is not a bug in the very strict sense,
but for consistency,  
I feel that
    abline() 
should obey  par("xpd") setting, even by ...-argument.
The following code shows how  lines() ``works'' and abline() does not :

  par(mfrow=c(2,1))
  plot(1:4)
  plot(1:10)
  par(xpd=NA); abline(v=1:10); par(xpd=FALSE)
  ## or even
  abline(v=1:10, xpd = NA, col = "purple")
  ## lines() *does* work with xpd arg:
  lines(4:5,c(1,40), col = 2, xpd = FALSE)# clip to plot
  lines(5:6,c(1,40), col = 3, xpd = TRUE)# clip to figure
  lines(6:7,c(1,20), col = 4, xpd = NA)# clip to device 
  text(4:6, 10.5, "xpd =", xpd = TRUE, col = 2:4)
  text(4:6, 10, c("FALSE","TRUE","NA"), col = 2:4, adj = 0)


Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 750.reply.1 <==
From maechler@stat.math.ethz.ch  Wed Nov 29 14:02:47 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA24751
	for <R-bugs@biostat.ku.dk>; Wed, 29 Nov 2000 14:02:46 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id OAA15367
	for <R-bugs@biostat.ku.dk>; Wed, 29 Nov 2000 14:03:01 +0100 (MET)
Received: from UNKNOWN(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa003k0; Wed Nov 29 14:02:57 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id OAA05829; Wed, 29 Nov 2000 14:02:56 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14884.65152.785676.980519@gargle.gargle.HOWL>
Date: Wed, 29 Nov 2000 14:02:56 +0100
To: R-bugs@biostat.ku.dk
Subject: abline() AND rect() do not obey "xpd" (clipping) (PR#750)
In-Reply-To: <200011271727.SAA04871@pubhealth.ku.dk>
References: <200011271727.SAA04871@pubhealth.ku.dk>
X-Mailer: VM 6.86 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:

    MM> This is not a bug in the very strict sense,
    MM> but for consistency,  
    MM> I feel that
    MM> abline() 
    MM> should obey  par("xpd") setting, even by ...-argument.
    MM> The following code shows how  lines() ``works'' and abline() does not :

    MM> par(mfrow=c(2,1))
    MM> plot(1:4)
    MM> plot(1:10)
    MM> par(xpd=NA); abline(v=1:10); par(xpd=FALSE)
    MM> ## or even
    MM> abline(v=1:10, xpd = NA, col = "purple")
    MM> ## lines() *does* work with xpd arg:
    MM> lines(4:5,c(1,40), col = 2, xpd = FALSE)# clip to plot
    MM> lines(5:6,c(1,40), col = 3, xpd = TRUE)# clip to figure
    MM> lines(6:7,c(1,20), col = 4, xpd = NA)# clip to device 
    MM> text(4:6, 10.5, "xpd =", xpd = TRUE, col = 2:4)
    MM> text(4:6, 10, c("FALSE","TRUE","NA"), col = 2:4, adj = 0)

Also, 
      rect() 
fails similarly.
This gives funny legend()s :

 plot(1:10)
 legend(1,7.5,  c("1st", "2nd", "third"), col = 1:3, lwd = 1:3, pch = 1:3)
 op <- par(xpd = NA)
 legend(1,11.5, c("1st", "2nd", "third"), col = 1:3, lwd = 1:3, pch = 1:3)
 ## pch = 1 also doesn't ?!?? ?? why??  It does here :
 points(2+ 1:8, rep(11, 8), pch = 1:8, col = "purple")
 ## and other pch's do here
 legend(4,11.9, c("1st", "2nd", "third"), col = 1:3, lwd = 1:3, pch = 6:4)
 par(op)

## Note that there seems another peculiar clipping bug 
##       with pch = 1 in legend

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 750.audit <==
Wed Nov 29 14:17:37 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  In-Out

* PR# 746 *
Subject: printing of lists
From: David Firth <david.firth@nuffield.oxford.ac.uk>
Date: Fri, 24 Nov 2000 12:31:33 +0000
--Still with us Dec 10 2000
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 746 <==
From david.firth@nuffield.oxford.ac.uk  Fri Nov 24 13:31:24 2000
Received: from oxmail.ox.ac.uk (oxmail2.ox.ac.uk [163.1.2.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA14416
	for <r-bugs@biostat.ku.dk>; Fri, 24 Nov 2000 13:31:23 +0100 (MET)
Received: from heraldgate1.oucs.ox.ac.uk
	([163.1.2.49] helo=frontend1.herald.ox.ac.uk ident=exim)
	by oxmail.ox.ac.uk with esmtp (Exim 3.12 #1)
	id 13zI0w-0005fw-00
	for r-bugs@biostat.ku.dk; Fri, 24 Nov 2000 12:31:38 +0000
Received: from pinga.nuff.ox.ac.uk ([163.1.146.10])
	by frontend1.herald.ox.ac.uk with esmtp (Exim 2.02 #1)
	id 13zI0v-0007aP-00
	for r-bugs@biostat.ku.dk; Fri, 24 Nov 2000 12:31:37 +0000
Mime-Version: 1.0
X-Sender: dfirth@dfirth.herald.ox.ac.uk (Unverified)
Message-Id: <v04210101b6440defd7c9@[163.1.146.10]>
Date: Fri, 24 Nov 2000 12:31:33 +0000
To: r-bugs@biostat.ku.dk
From: David Firth <david.firth@nuffield.oxford.ac.uk>
Subject: printing of lists
Content-Type: text/plain; charset="us-ascii"

This looks to me like a bug in the print method for lists.  In printing 
"test.list" below, the labels $A$subset and $B$subset fail to appear.

I find the same behaviour under linux and Windows (using R 1.1.1 -- 
for version info see below) with R --vanilla.

Regards -- David
David Firth                        Phone +44 1865 278544
Nuffield College                   Fax   +44 1865 278621
Oxford OX1 1NF                     Secretary +44 1865 278612
United Kingdom                     Email david.firth@nuffield.oxford.ac.uk


> test.list<-list(A=list(formula=Y~X,subset=TRUE), B=list(formula=Y~X,subset=TRUE))
> test.list$A
$formula
Y ~ X

$subset
[1] TRUE

> test.list
$A
$A$formula
Y ~ X


[1] TRUE


$B
$B$formula
Y ~ X


[1] TRUE


> version
         _                
platform i686-pc-linux-gnu
arch     i686             
os       linux-gnu        
system   i686, linux-gnu  
status                    
major    1                
minor    1.1              
year     2000             
month    August           
day      15               
language R    

==> 746.reply.1 <==
From maechler@stat.math.ethz.ch  Fri Nov 24 14:06:04 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA15465
	for <R-bugs@biostat.ku.dk>; Fri, 24 Nov 2000 14:06:03 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id OAA18245;
	Fri, 24 Nov 2000 14:06:19 +0100 (MET)
Received: from UNKNOWN(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa004T3; Fri Nov 24 14:06:12 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id OAA18159; Fri, 24 Nov 2000 14:06:12 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14878.26563.622840.626647@gargle.gargle.HOWL>
Date: Fri, 24 Nov 2000 14:06:11 +0100
To: david.firth@nuffield.oxford.ac.uk
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] printing of lists (PR#746)
In-Reply-To: <200011241231.NAA14426@pubhealth.ku.dk>
References: <200011241231.NAA14426@pubhealth.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "david" == david firth <david.firth@nuffield.oxford.ac.uk> writes:

    david> This looks to me like a bug in the print method for lists.
(which is hidden in C)

    david> In printing "test.list" below, the labels $A$subset and $B$subset
    david> fail to appear.

    david> I find the same behaviour under linux and Windows (using R 1.1.1 -- 
    david> for version info see below) with R --vanilla.

    >> test.list<-list(A=list(formula=Y~X,subset=TRUE), B=list(formula=Y~X,subset=TRUE))
    >> test.list$A
    david> $formula
    david> Y ~ X

    david> $subset
    david> [1] TRUE

    >> test.list
    david> $A
    david> $A$formula
    david> Y ~ X


    david> [1] TRUE


    david> $B
    david> $B$formula
    david> Y ~ X


    david> [1] TRUE


    >> version
    david> _                
    david> platform i686-pc-linux-gnu
    david> arch     i686             
    david> os       linux-gnu        
    david> system   i686, linux-gnu  
    david> status                    
    david> major    1                
    david> minor    1.1              
    david> year     2000             
    david> month    August           
    david> day      15               
    david> language R    

Bug confirmed, with the current "R-devel"opment version.
Another slight variation on the theme:

> list(A=list(bla="Y~X",no2=TRUE), B=list(blu=Y~X,no2=TRUE))
$A
$A$bla
[1] "Y~X"

$A$no2
[1] TRUE


$B
$B$blu
Y ~ X


[1] TRUE


Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 746.audit <==
Sun Dec 10 14:19:33 2000	pd	changed notes
Sun Dec 10 14:19:33 2000	pd	foobar
Sun Dec 10 14:19:33 2000	pd	moved from incoming to In-Out
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 649 *
Subject: Unable to read.table with > 256? columns
From: r@marksmucker.com
Date: Thu, 31 Aug 2000 07:28:02 +0200 (MET DST)
--Unable to reproduce from information supplied 
--(and there is no 256 col limit)
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 649 <==
From r@marksmucker.com  Thu Aug 31 07:28:02 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id HAA25028
	for <R-bugs@biostat.ku.dk>; Thu, 31 Aug 2000 07:28:02 +0200 (MET DST)
Date: Thu, 31 Aug 2000 07:28:02 +0200 (MET DST)
From: r@marksmucker.com
Message-Id: <200008310528.HAA25028@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Unable to read.table with > 256? columns

Full_Name: Mark Smucker
Version: 1.0.1
OS: Windows NT 4 sp 6
Submission from: (NULL) (216.122.46.200)



I'm trying to read in a large matrix (800 x 800 or bigger)
and R prints an error telling me that my rows are not
all the same length.  I've double checked the text file
using gawk and it tells me that they are all the same.

When I pair it down to 247 x 247, then it works, but not
when I have 289 x 289.  I'm guesing that there is some
hardcoded 256 column limit, but I could be wrong.

Otherwise, I'm loving R.  Thank you so much!

Mark



==> 649.followup.1 <==
From ripley@stats.ox.ac.uk  Thu Aug 31 08:24:39 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA25249
	for <R-bugs@biostat.ku.dk>; Thu, 31 Aug 2000 08:24:38 +0200 (MET DST)
Received: from max179.public.ox.ac.uk (max179.public.ox.ac.uk [192.76.27.179])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id HAA04651;
	Thu, 31 Aug 2000 07:24:52 +0100 (BST)
Date: Thu, 31 Aug 2000 07:23:53 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: r@marksmucker.com
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Unable to read.table with > 256? columns (PR#649)
In-Reply-To: <200008310528.HAA25038@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10008310708570.12521-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 31 Aug 2000 r@marksmucker.com wrote:

> Full_Name: Mark Smucker
> Version: 1.0.1
> OS: Windows NT 4 sp 6
> Submission from: (NULL) (216.122.46.200)
> 
> 
> 
> I'm trying to read in a large matrix (800 x 800 or bigger)
> and R prints an error telling me that my rows are not
> all the same length.  I've double checked the text file
> using gawk and it tells me that they are all the same.
> 
> When I pair it down to 247 x 247, then it works, but not
> when I have 289 x 289.  I'm guesing that there is some
> hardcoded 256 column limit, but I could be wrong.

Not that I know of.  But as you want to read a matrix, you will
do much better to use scan to read it as than has less overhead
and allows you to use much shorter lines in the file.  It will
just read consecutive numbers.  As in

A <- matrix(scan("file", what=0), 800, 800, byrow=TRUE)

> Otherwise, I'm loving R.  Thank you so much!

Yours is two versions old now, so please update to 1.1.1.

Here is my test (on 1.1.1 on Windows)

> x <- rnorm(300*300)
> write(x, "file", 300)
> A <- matrix(scan("file", what=0), 300, 300, byrow=TRUE)
> B <- as.matrix(read.table("file"))
> range(A-B)
[1] 0 0

So no limit and no problem. I no longer have a copy of 1.0.1 installed, so
if this is still a problem after you upgrade, can you please re-submit the
bug report with an example that actually fails for you.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 649.audit <==
Thu Sep 07 06:29:33 2000	ripley	changed notes
Thu Sep 07 06:29:33 2000	ripley	moved from incoming to In-Out
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Installation

* PR# 777 *
Subject: Minor "make check" bug.
From: Martyn Plummer <plummer@iarc.fr>
Date: Tue, 19 Dec 2000 15:11:24 +0100 (CET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 777 <==
From postmaster@franz.stat.wisc.edu  Tue Dec 19 15:09:03 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA06260
	for <r-bugs@biostat.ku.dk>; Tue, 19 Dec 2000 15:09:02 +0100 (MET)
Received: from smtp02.iarc.fr (really [212.157.236.234]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m148NW8-000IYiC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 08:13:24 -0600 (CST) 
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id PAA21877
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 15:09:18 +0100
Message-ID: <XFMail.001219151124.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
Date: Tue, 19 Dec 2000 15:11:24 +0100 (CET)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: r-bugs@r-project.org
Subject: Minor "make check" bug.

If you build R with the following sequence

./configure
make R
make check

Then "make check" fails at the following point (in examples for help()
itself)

> try(help("bs", try.all.packages=FALSE)) # reports not found (an error)
Error in help("bs", try.all.packages = FALSE) :
        No documentation for `bs' in specified packages and libraries
> help("bs", try.all.packages=TRUE) # reports can be found in package `splines'
Error in help("bs", try.all.packages = TRUE) :
        No documentation for `bs' in specified packages and libraries
Execution halted

Evidently this is because the help pages for the package `splines'
have not been built.  The simplest solution would be to wrap the
second call to help in a call to try.

Martyn

==> 777.audit <==
Tue Dec 26 10:31:49 2000	ripley	moved from incoming to Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 733 *
Subject: gnome-support problems
From: olav@melvin.jordforsk.no
Date: Fri, 10 Nov 2000 10:55:31 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 733 <==
From olav@melvin.jordforsk.no  Fri Nov 10 10:56:52 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA27144
	for <R-bugs@biostat.ku.dk>; Fri, 10 Nov 2000 10:56:51 +0100 (MET)
From: olav@melvin.jordforsk.no
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA20493
	for <r-bugs@hypatia.math.ethz.ch>; Fri, 10 Nov 2000 10:57:08 +0100 (MET)
Received: from nlh10.nlh.no(128.39.191.100)
 via SMTP by hypatia, id smtpdAAAa0050B; Fri Nov 10 10:57:05 2000
Received: from melvin.jordforsk.no (melvin.jordforsk.nlh.no [128.39.182.7])
	by nlh10.nlh.no (8.9.1/8.9.1) with ESMTP id KAA13057
	for <r-bugs@hypatia.math.ethz.ch>; Fri, 10 Nov 2000 10:57:06 +0100 (MET)
Received: (from olav@localhost)
	by melvin.jordforsk.no (8.9.3+Sun/8.9.3) id KAA12845
	for r-bugs@lists.r-project.org; Fri, 10 Nov 2000 10:55:31 +0100 (MET)
Date: Fri, 10 Nov 2000 10:55:31 +0100 (MET)
Message-Id: <200011100955.KAA12845@melvin.jordforsk.no>
To: r-bugs@stat.math.ethz.ch
Subject: gnome-support problems

The compilation fails in <libintl.h>, because some function definitions was
changed in <libgnome/gnome-i18n.h>.
I inserted
#define ENABLE_NLS
before '#include "gnome.h" in devGNOME.c and devGTK.c, and then the 
compilation went ok.

There was also an error in configure, it couldn't find libglade-config.

Version:
 platform = sparc-sun-solaris2.8
 arch = sparc
 os = solaris2.8
 system = sparc, solaris2.8
 status =
 major = 1
 minor = 1.1

by the way: the function "bug.report(...)" failed with the message:
Error in paste("-s '", subject, "' -c", ccaddress, address, "<", file,  : 
	Object "support" not found


==> 733.audit <==
Wed Nov 29 14:12:20 2000	ripley	foobar
Wed Nov 29 14:12:20 2000	ripley	moved from incoming to Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 597 *
Subject: multiply defined symbols
From: plucas@csd.abdn.ac.uk
Date: Fri, 7 Jul 2000 12:23:44 +0200 (MET DST)
--Probably system-specific due to use of fort77
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 597 <==
From plucas@csd.abdn.ac.uk  Fri Jul  7 12:23:44 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA07677
	for <R-bugs@biostat.ku.dk>; Fri, 7 Jul 2000 12:23:44 +0200 (MET DST)
Date: Fri, 7 Jul 2000 12:23:44 +0200 (MET DST)
From: plucas@csd.abdn.ac.uk
Message-Id: <200007071023.MAA07677@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: multiply defined symbols

Full_Name: Peter Lucas
Version: 1.1.0
OS: redHat 6.2 Linux
Submission from: (NULL) (139.133.200.15)


I tried to install R 1.1.0 on my i686 PC with Redhat 6.2 Linux on it.
I am using fort77 with f2c. I am not able to build R, as libc.a contains
regex.o, causing a conflict with src/main/regex.o. the ONEWS mentions
that this problem was solved, but it obviously was not. I am not a real
Unix hacker, so I wonder how to proceed.

Peter

==> 597.reply.1 <==
From pd@blueberry.kubism.ku.dk  Fri Jul  7 16:43:29 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA10694
	for <R-bugs@biostat.ku.dk>; Fri, 7 Jul 2000 16:43:28 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id QAA15185;
	Fri, 7 Jul 2000 16:46:02 +0200
Sender: pd@blueberry.kubism.ku.dk
To: plucas@csd.abdn.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] multiply defined symbols (PR#597)
References: <200007071023.MAA07687@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 07 Jul 2000 16:46:02 +0200
In-Reply-To: plucas@csd.abdn.ac.uk's message of "Fri, 7 Jul 2000 12:23:45 +0200 (MET DST)"
Message-ID: <x2wviyrob9.fsf@blueberry.kubism.ku.dk>
Lines: 21
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

plucas@csd.abdn.ac.uk writes:

> I tried to install R 1.1.0 on my i686 PC with Redhat 6.2 Linux on it.
> I am using fort77 with f2c. I am not able to build R, as libc.a contains
> regex.o, causing a conflict with src/main/regex.o. the ONEWS mentions
> that this problem was solved, but it obviously was not. I am not a real
> Unix hacker, so I wonder how to proceed.

One possibility would be to use f2c directly. Pseudo Fortran compilers
like fort77 (which is just a script around f2c) do strange things
occasionally. Use the --with-f2c flag to configure.

The egcs-g77 package that comes with RH6.2 should work for compiling R
itself, but seems to be having trouble with some add-on packages.
gcc-2.95.1 and later seems to be OK.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 597.audit <==
Mon Jul 10 12:30:34 2000	ripley	changed notes
Mon Jul 10 12:30:34 2000	ripley	moved from incoming to Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Language

* PR# 747 *
Subject: Bug in args with no defaults
From: dmurdoch@pair.com (Duncan Murdoch)
Date: Sun, 26 Nov 2000 20:14:30 GMT
--Probably not a bug, but a logical consequence of "missing" semantics.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 747 <==
From dmurdoch@pair.com  Sun Nov 26 21:12:12 2000
Received: from tomts7-srv.bellnexxia.net (tomts7.bellnexxia.net [209.226.175.40])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA23834
	for <r-bugs@biostat.ku.dk>; Sun, 26 Nov 2000 21:12:11 +0100 (MET)
Received: from unknown ([64.229.18.72]) by tomts7-srv.bellnexxia.net
          (InterMail vM.4.01.03.00 201-229-121) with SMTP
          id <20001126201157.UAXI12366.tomts7-srv.bellnexxia.net@unknown>
          for <r-bugs@biostat.ku.dk>; Sun, 26 Nov 2000 15:11:57 -0500
From: dmurdoch@pair.com (Duncan Murdoch)
To: r-bugs@biostat.ku.dk
Subject: Bug in args with no defaults
Date: Sun, 26 Nov 2000 20:14:30 GMT
Message-ID: <3a216c91.640522@smtp1.sympatico.ca>
X-Mailer: Forte Agent 1.5/32.451
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

This turned up in the same context as #743, i.e. writing data.restore.

Two bugs, I think:

The way arguments with no defaults are stored appears to be as a
zero-length name:

 > test <- function(x) 1
 > as.list(test)$x

 > mode(as.list(test)$x)
 [1] "name"
 > as.character(as.list(test)$x)
 [1] ""

However, I'm not allowed to create one of those:

 > as.name("")
 Error in as.name("") : attempt to use zero-length variable name

If I'm sneaky, I can create one, but I can't do anything with it:

 > badvar <- as.list(test)$x
 > badvar
 Error: Argument "badvar" is missing, with no default
 > junk <- badvar
 Error: Argument "badvar" is missing, with no default
 > junk
 Error: Object "junk" not found

For now, the workaround I'm using when building up functions like
"test" above is to create them as

 function(x = stop("argument x is missing")) 1

but this is ugly.

Duncan Murdoch

Version:
 platform = Windows
 arch = x86
 os = Win32
 system = x86, Win32
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Windows 9x 4.0 (build 1111)  B

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 747.audit <==
Sun Dec 10 14:24:39 2000	pd	changed notes
Sun Dec 10 14:24:39 2000	pd	foobar
Sun Dec 10 14:24:39 2000	pd	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 408 *
Subject: convolution bug
From: wsimpson@gcal.ac.uk
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 408 <==
From wsimpson@gcal.ac.uk  Fri Jan 28 11:17:36 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA11325
	for <R-bugs@biostat.ku.dk>; Fri, 28 Jan 2000 11:17:36 +0100 (MET)
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
From: wsimpson@gcal.ac.uk
Message-Id: <200001281017.LAA11325@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: convolution bug

Full_Name: Bill Simpson
Version: 65.1 , 0.90.1
OS: Linux
Submission from: (NULL) (193.62.250.209)


I reported this on r-help, but here is official bug report.

The present convolve() does not do convolution by default. Its default behaviour
is
correlation. This is a bug.

The default argument conj should be set to FALSE.

The zero-padding should be on the right for linear convolution (don't ask me
why you call this type="open"; I suggest type="linear").

Here is what I expect linear convolution to do:
myconvolve<-function (x,h) 
{
    nx <- length(x)
    nh <- length(h)
    #zero pad
    if(nx>nh)
       {
       x <- c(x,rep(0, nh-1))
       h<-c(h,rep(0,nx-1))
       }
    else
       {
       h <- c(h,rep(0, nx-1))
       x<-c(x,rep(0,nh-1))
       }
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/length(x)
#I am not sure about this, the R IFFT is weird
}

What "circular" convolution should do is just
eliminate the zero-padding:

myconvolve2<-function (x,h)
{
#no padding, circular convolution
    nx <- length(x)
    nh <- length(h)
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/(nx)
}


I suggest that you create two functions, convolve() and correlate(), and get
rid
of the conj argument in convolve().

==> 408.audit <==
Wed Feb 16 19:28:42 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 645 *
Subject: unlisting a list with names components
From: Peter Perkins <pperkins@ucsd.edu>
Date: Fri, 25 Aug 2000 23:07:47 -0700
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 645 <==
From pperkins@ucsd.edu  Sat Aug 26 09:41:52 2000
Received: from femail1.sdc1.sfba.home.com (femail1.sdc1.sfba.home.com [24.0.95.81])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA00323
	for <r-bugs@biostat.ku.dk>; Sat, 26 Aug 2000 09:41:51 +0200 (MET DST)
Received: from ucsd.edu ([24.4.89.36]) by femail4.sdc1.sfba.home.com
          (InterMail vM.4.01.03.00 201-229-121) with ESMTP
          id <20000826060700.ZXWB8556.femail4.sdc1.sfba.home.com@ucsd.edu>
          for <r-bugs@biostat.ku.dk>; Fri, 25 Aug 2000 23:07:00 -0700
Sender: peter
Message-ID: <39A75EB3.33F4DA55@ucsd.edu>
Date: Fri, 25 Aug 2000 23:07:47 -0700
From: Peter Perkins <pperkins@ucsd.edu>
Reply-To: pperkins@ucsd.edu
X-Mailer: Mozilla 4.7 [en] (X11; I; Linux 2.2.15pre3 ppc)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@biostat.ku.dk
Subject: unlisting a list with names components
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

hi -

i apologize if this is a duplicate.

i think the lines below demonstrate a problem with unlist when the list
contains components that are names.  _anything_ can go in a list,
right?  this came up in the context of trying to
unlist(list(attr(terms(formula), "variables")).

perhaps unrelated but i thought i'd mention: unlist() complains about a
call/formula object, but sapply() does not (a call certainly "looks"
like a list, but includes names at some level).

- peter perkins


$ R --vanilla

> find(list)
[1] "package:base"
> find(unlist)
[1] "package:base"
> list1 <- list(a="a", b="b")
> unlist(list1)
  a   b
"a" "b"
> list2 <- list(a="a", b=as.name("b"))
> unlist(list2)
$a
[1] "a"

$b
b

> mode(list2)
[1] "list"
> mode(unlist(list2))
[1] "list"


--please do not edit the information below--

Version:
 platform = powerpc-unknown-linux-gnu
 arch = powerpc
 os = linux-gnu
 system = powerpc, linux-gnu
 status =
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base



==> 645.audit <==
Thu Sep 07 06:26:36 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 587 *
Subject: dim(a <- ...) sets invisible flag erronously
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Fri, 30 Jun 2000 20:15:59 +0200 (MET DST)
--Not specific to dim: R differs from S for most functions here.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 587 <==
From maechler@stat.math.ethz.ch  Fri Jun 30 20:15:50 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA02851
	for <R-bugs@biostat.ku.dk>; Fri, 30 Jun 2000 20:15:50 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id UAA18670
	for <R-bugs@stat.math.ethz.ch>; Fri, 30 Jun 2000 20:16:09 +0200 (MET DST)
Received: from jessica(129.132.58.24), claiming to be "homes.stat.math.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa004Zd; Fri Jun 30 20:16:00 2000
Received: (maechler@localhost) by homes.stat.math.ethz.ch (8.8.8+Sun/D-MATH-client) id UAA17303; Fri, 30 Jun 2000 20:15:59 +0200 (MET DST)
X-Authentication-Warning: homes.stat.math.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14684.58335.571324.541557@homes.stat.math.ethz.ch>
Date: Fri, 30 Jun 2000 20:15:59 +0200 (MET DST)
To: R-bugs@stat.math.ethz.ch
Subject: dim(a <- ...) sets invisible flag erronously
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

{Nothing really harmful;  R 1.1.0}

dim(.) sets (or doesn't clear) the  ``invisible flag'' for printing in
certain circumstances:

  > dim(a <- cbind(1))
  >

does *not* print as it should :

  > dim(a)
  [1] 1 1

---

Question to the real "hackers" :

How can I check this using R code alone (not using files),
i.e. (how) can I ask an R expression if its ``invisible flag'' is set or not ?

{help(invisible) doesn't help here}.

Maybe one would want an

      is.invisible(.)

function?

-- 
Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 587.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Jul 10 15:36:34 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA20903
	for <R-bugs@biostat.ku.dk>; Mon, 10 Jul 2000 15:36:34 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id OAA12626;
	Mon, 10 Jul 2000 14:36:51 +0100 (BST)
Message-Id: <200007101336.OAA12626@toucan.stats.ox.ac.uk>
Date: Mon, 10 Jul 2000 14:36:51 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] dim(a <- ...) sets invisible flag erronously (PR#587)
To: r-devel@stat.math.ethz.ch, maechler@stat.math.ethz.ch
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: vCXar+2yNs/52Q2nsVCl1Q==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 


> Date: Fri, 30 Jun 2000 20:15:51 +0200 (MET DST)
> From: maechler@stat.math.ethz.ch
> To: r-devel@stat.math.ethz.ch
> Subject: [Rd] dim(a <- ...) sets invisible flag erronously (PR#587)
> CC: R-bugs@biostat.ku.dk
> X-Loop: R-bugs@biostat.ku.dk
> 
> {Nothing really harmful;  R 1.1.0}
> 
> dim(.) sets (or doesn't clear) the  ``invisible flag'' for printing in
> certain circumstances:
> 
>   > dim(a <- cbind(1))
>   >
> 
> does *not* print as it should :
> 
>   > dim(a)
>   [1] 1 1

This is nothing to do with dim: any function will do this.

> foo <- function(x) x
> foo(a <- cbind(1))

It happens because the way invisible is implemented is different in R and S:
in S there is a .Auto.print var in frame 1, and in R there is a global
variable R_visible, so anything during the evaluation that unsets the
flag will ensure that the result is invisible.

I don't see how to avoid this without checking the `depth' in the evaluation
pretty carefully (and R's semantics differ from those of S in that
braced expressions do not generate a frame).

Is this worth fixing?  print(.Last.value) works all the time, and perhaps
you might be persuaded not to write code that uses assignments as arguments?

> ---
> 
> Question to the real "hackers" :
> 
> How can I check this using R code alone (not using files),
> i.e. (how) can I ask an R expression if its ``invisible flag'' is set or not ?
> 
> {help(invisible) doesn't help here}.
> 
> Maybe one would want an
> 
>       is.invisible(.)
> 
> function?

There seems to be an unused internal function do_visibleflag in print.c.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 587.audit <==
Mon Jul 10 12:42:47 2000	ripley	moved from incoming to Language
Mon Jul 10 13:40:28 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 412 *
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 412 <==
From postmaster@franz.stat.wisc.edu  Sun Feb  6 01:16:33 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26868
	for <R-bugs@biostat.ku.dk>; Sun, 6 Feb 2000 01:16:31 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id BAA18080
	for <r-bugs@hypatia.math.ethz.ch>; Sun, 6 Feb 2000 01:16:38 +0100 (MET)
Received: from franz.stat.wisc.edu(128.105.174.95)
 via SMTP by hypatia, id smtpdAAAa004QS; Sun Feb  6 01:16:33 2000
Received: from pubhealth.ku.dk (really [130.225.108.10]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m12HFNP-000ZSxC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Sat, 5 Feb 2000 18:16:31 -0600 (CST) 
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26864
	for <r-bugs@r-project.org>; Sun, 6 Feb 2000 01:16:18 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA12311;
	Sun, 6 Feb 2000 01:18:51 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-bugs@r-project.org
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
Message-ID: <x2900zyyhh.fsf@blueberry.kubism.ku.dk>
Lines: 51
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit


Call objects don't always behave as you'd expect. They're mostly
list-like, but with exceptions:

> f<-function(x,y,...)match.call(expand.dots=FALSE)
> xx <- f(y=1,2,z=3,4)
> dd <- xx$...
> xx$... <- NULL
> c(xx,dd)
[[1]]
f(x = 2, y = 1)

$z
[1] 3

[[3]]
[1] 4

> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, z = 3, 4)

(Splus has this rather differently, since dd becomes a call to list()
rather than a list of promises:

S> c(xx,dd)
f(x = 2, y = 1, list, z = 3, 4)
S> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, list, z = 3, 4)

...but at least gives the same in both cases)

Also, the names of arguments added with [[<- is getting dropped if a
new element is required:

> xx[["abc"]]<-123
> xx
f(x = 2, y = 1, 123)

S has what I'd expect there:

S> xx[["abc"]]<-123
S> xx
f(x = 2, y = 1, abc = 123)

[R-0.99.0 prerelease on RedHat6.1, but this is likely not a new thing.]

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 412.audit <==
Wed Feb 16 19:26:57 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 694 *
Subject:  syntax confusion with function/non-function objects 
From: J.C.Rougier@durham.ac.uk
Date: Fri, 13 Oct 2000 12:07:41 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 694 <==
From J.C.Rougier@durham.ac.uk  Fri Oct 13 13:07:25 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA15315
	for <r-bugs@biostat.ku.dk>; Fri, 13 Oct 2000 13:07:23 +0200 (MET DST)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e9DB7fd26702
	for <r-bugs@biostat.ku.dk>; Fri, 13 Oct 2000 12:07:41 +0100 (BST)
Received: from laplace by euclid id <MAA02824@euclid>; Fri, 13 Oct 2000 12:07:40 +0100 (BST)
Date: Fri, 13 Oct 2000 12:07:41 +0100 (BST)
Message-Id: <2406.200010131107@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  syntax confusion with function/non-function objects 

I'm just back from a computer practical where we ran into

> "f" <- function(x) 2(x^2) # for 2 * x^2

This definition was taken as legitimate, although using the
function generated the error message

> f(3)
Error in f(3) : attempt to apply non-function

Am I right in thinking that in prevous versions of R this
definition would have been declared as a syntax error?  Surely a
number before an opening parenthesis is always a syntax error?
The other mistake does this:

> "f" <- function(x) 2x^2 # another attempt at 2 * x^2
Error: syntax error

Cheers, Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 694.reply.1 <==
From pd@biostat.ku.dk  Fri Oct 13 14:59:09 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA17125;
	Fri, 13 Oct 2000 14:59:09 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id PAA25930;
	Fri, 13 Oct 2000 15:08:20 +0200
Sender: pd@blueberry.kubism.ku.dk
To: J.C.Rougier@durham.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] syntax confusion with function/non-function objects (PR#694)
References: <200010131107.NAA15331@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 13 Oct 2000 15:08:19 +0200
In-Reply-To: J.C.Rougier@durham.ac.uk's message of "Fri, 13 Oct 2000 13:07:26 +0200 (MET DST)"
Message-ID: <x2u2ag7ut8.fsf@blueberry.kubism.ku.dk>
Lines: 62
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

J.C.Rougier@durham.ac.uk writes:

> I'm just back from a computer practical where we ran into
> 
> > "f" <- function(x) 2(x^2) # for 2 * x^2
> 
> This definition was taken as legitimate, although using the
> function generated the error message
> 
> > f(3)
> Error in f(3) : attempt to apply non-function
> 
> Am I right in thinking that in prevous versions of R this
> definition would have been declared as a syntax error? 

I don't think so... Splus 3.4 does likewise:

> 2(3)
Error: "2" is not a function
>  "f" <- function(x) 2(x^2)
> f(3)                    
Error in f(3): "2" is not a function
Dumped


> Surely a
> number before an opening parenthesis is always a syntax error?

Sounds like it might be so (although sometimes there are surprises).
However, it may not be all that easy or worth it to fix the parser to
recognise this case.

In general you can have any expression evaluating to the function
to be called. If you do f(x)(3), f(x) may or may not be a function
and you can only detect whether it is one at runtime.

From the parsers point of view there are only a few cases where it is
manifestly obvious that an expression cannot lead to a valid function.
Consider for instance the following silly stunt:

> g<-function(x){"+"<-function(x,y)log;(2+2)(x)}
> g(3)
[1] 1.098612

The operative bit is in src/main/gram.y

expr	: 
      ...

        |       expr '(' sublist ')'            { $$ = xxfuncall($1,$3); }

in which the expr is unrestricted and can be any R expression. One
could, I suppose, define a (say) "funexpr" syntactic entity which is just
like an "expr", except that if it is non-complex, then it has to be an
identifier or a character string. I think it would get quite kludgy,
though. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 694.followup.1 <==
From luke@goose.stat.umn.edu  Fri Oct 13 15:32:46 2000
Received: from mhub0.tc.umn.edu (IDENT:0@mhub0.tc.umn.edu [128.101.131.40])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA17583;
	Fri, 13 Oct 2000 15:32:45 +0200 (MET DST)
Received: from goose.stat.umn.edu by mhub0.tc.umn.edu with ESMTP; Fri, 13 Oct 2000 08:33:01 -0500
Received: (from luke@localhost)
	by goose.stat.umn.edu (8.9.1/8.9.1) id IAA23307;
	Fri, 13 Oct 2000 08:33:58 -0500 (CDT)
Message-Id: <200010131333.IAA23307@goose.stat.umn.edu>
Subject: Re: [Rd] syntax confusion with function/non-function objects (PR#694)
In-Reply-To: <x2u2ag7ut8.fsf@blueberry.kubism.ku.dk> from Peter Dalgaard BSA at "Oct 13, 2000 03:08:19 pm"
To: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: Fri, 13 Oct 2000 08:33:57 -0500 (CDT)
From: Luke Tierney <luke@goose.stat.umn.edu>
Cc: J.C.Rougier@durham.ac.uk, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
X-Mailer: ELM [version 2.4ME+ PL54 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Peter Dalgaard BSA wrote:
> J.C.Rougier@durham.ac.uk writes:
> 
> > I'm just back from a computer practical where we ran into
> > 
> > > "f" <- function(x) 2(x^2) # for 2 * x^2
> > 
> > This definition was taken as legitimate, although using the
> > function generated the error message
> > 
> > > f(3)
> > Error in f(3) : attempt to apply non-function
> > 
> > Am I right in thinking that in prevous versions of R this
> > definition would have been declared as a syntax error? 
> 
> I don't think so... Splus 3.4 does likewise:
> 
> > 2(3)
> Error: "2" is not a function
> >  "f" <- function(x) 2(x^2)
> > f(3)                    
> Error in f(3): "2" is not a function
> Dumped
> 
> 
> > Surely a
> > number before an opening parenthesis is always a syntax error?
> 
> Sounds like it might be so (although sometimes there are surprises).
> However, it may not be all that easy or worth it to fix the parser to
> recognise this case.
> 
> In general you can have any expression evaluating to the function
> to be called. If you do f(x)(3), f(x) may or may not be a function
> and you can only detect whether it is one at runtime.
> 
> >From the parsers point of view there are only a few cases where it is
> manifestly obvious that an expression cannot lead to a valid function.
> Consider for instance the following silly stunt:
> 
> > g<-function(x){"+"<-function(x,y)log;(2+2)(x)}
> > g(3)
> [1] 1.098612
> 

I agree--I'd call this a type error in evaluation, not a syntax error.

One thing to keep in mind is that R expressions can be used for things
other that evaluation, for example in representing aspects of models.
Someone might want at some point to attach meaning to something like

	y ~ 2(x)+z

That would be impossible (or at least very dificult) if the expression
were made syntactically invalid.

It would be possible to have a semantic checking tool for R that walks
over the code and warns when it sees such an expression, but it should
not be considered an error since it could be legitimate.

luke

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
313 Ford Hall, 224 Church St. S.E.           email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu

==> 694.followup.2 <==
From J.C.Rougier@durham.ac.uk  Fri Oct 13 16:50:29 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA18369;
	Fri, 13 Oct 2000 16:50:28 +0200 (MET DST)
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e9DEoed05344;
	Fri, 13 Oct 2000 15:50:41 +0100 (BST)
Received: from laplace by euclid id <PAA00093@euclid>; Fri, 13 Oct 2000 15:50:40 +0100 (BST)
Date: Fri, 13 Oct 2000 15:50:40 +0100 (BST)
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
X-Sender: dma0jcr@laplace
To: Luke Tierney <luke@goose.stat.umn.edu>
cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, J.C.Rougier@durham.ac.uk,
        r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] syntax confusion with function/non-function objects (PR#694)
In-Reply-To: <200010131333.IAA23307@goose.stat.umn.edu>
Message-ID: <Pine.GSO.4.20.0010131543551.28177-100000@laplace>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 13 Oct 2000, Luke Tierney wrote:

> > In general you can have any expression evaluating to the function
> > to be called. If you do f(x)(3), f(x) may or may not be a function
> > and you can only detect whether it is one at runtime.

> I agree--I'd call this a type error in evaluation, not a syntax error.
> 
> One thing to keep in mind is that R expressions can be used for things
> other that evaluation, for example in representing aspects of models.
> Someone might want at some point to attach meaning to something like
> 
> 	y ~ 2(x)+z
> 
> That would be impossible (or at least very dificult) if the expression
> were made syntactically invalid.
> 
> It would be possible to have a semantic checking tool for R that walks
> over the code and warns when it sees such an expression, but it should
> not be considered an error since it could be legitimate.

I see the point.  It might be helpful to change the R error message in
line with Splus so that the source of the error is easy to identify.

Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE
http://www.maths.dur.ac.uk/stats/people/jcr/jcr.html


==> 694.audit <==
Wed Oct 25 06:41:44 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 674 *
Subject: all.equal.list() sometimes fails with unnamed and named components
From: "Charles C. Berry" <cberry@tajo.ucsd.edu>
Date: Fri, 29 Sep 2000 14:20:47 -0700 (PDT)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 674 <==
From cberry@tajo.ucsd.edu  Fri Sep 29 23:18:09 2000
Received: from smtp.ucsd.edu (smtp.ucsd.edu [132.239.1.49])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA02882
	for <r-bugs@biostat.ku.dk>; Fri, 29 Sep 2000 23:18:07 +0200 (MET DST)
Received: from tajo.ucsd.edu (tajo.ucsd.edu [132.239.99.2])
	by smtp.ucsd.edu (8.9.3/8.9.3) with ESMTP id OAA15578
	for <r-bugs@biostat.ku.dk>; Fri, 29 Sep 2000 14:18:25 -0700 (PDT)
Received: by tajo.ucsd.edu (8.9.3+Sun/SMI-SVR4-UCSD.1)
	id OAA13106; Fri, 29 Sep 2000 14:20:47 -0700 (PDT)
Date: Fri, 29 Sep 2000 14:20:47 -0700 (PDT)
Message-Id: <200009292120.OAA13106@tajo.ucsd.edu>
From: "Charles C. Berry" <cberry@tajo.ucsd.edu>
To: r-bugs@biostat.ku.dk
Subject: all.equal.list() sometimes fails with unnamed and named components


examples:

1) Fails to report that components 2 and 3 differ

all.equal(list(1,2,3,zap=1),list(1,3,4,zap=2))
[1] "Component zap: Mean relative  difference: 1


2) Incorrectly asserts all are equal when components 2 and 3 differ

> all.equal(list(1,2,3,zap=1),list(1,3,4,zap=1))
[1] TRUE

3) Removing named component reveals differences:

> all.equal(list(1,2,3,1),list(1,3,4,1))
[1] "Component 2: Mean relative  difference: 0.5"      
[2] "Component 3: Mean relative  difference: 0.3333333"

4) Unequal first component reveals differences

> all.equal(list(2,2,3,zap=1),list(1,3,4,zap=1))
[1] "Component : Mean relative  difference: 0.5"
[2] "Component : Mean relative  difference: 0.5"
[3] "Component : Mean relative  difference: 0.5"
> all.equal(list(2,2,3,zap=1),list(1,3,4,zap=2))
[1] "Component : Mean relative  difference: 0.5" 
[2] "Component : Mean relative  difference: 0.5" 
[3] "Component : Mean relative  difference: 0.5" 
[4] "Component zap: Mean relative  difference: 1"
> 

5) Second component IS equal, but:

> all.equal(list(2,2,3,zap=1),list(1,2,4,zap=2))
[1] "Component : Mean relative  difference: 0.5" 
[2] "Component : Mean relative  difference: 0.5" 
[3] "Component : Mean relative  difference: 0.5" 
[4] "Component zap: Mean relative  difference: 1"

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.0
 year = 2000
 month = June
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

Chuck Berry

-- 
Charles C. Berry                        (858) 534-2098 
                                         Dept of Family/Preventive Medicine
E mailto:cberry@tajo.ucsd.edu	         UC San Diego
http://hacuna.ucsd.edu/members/ccb.html  La Jolla, San Diego 92093-0645

 

==> 674.audit <==
Wed Oct 25 07:11:24 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 669 *
Subject: Bug(s) w/ rbind.data.frame(); fix also read.table(*, as.is = TRUE) ?
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 25 Sep 2000 10:17:15 +0200
--status of AsIs columns
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 669 <==
From maechler@stat.math.ethz.ch  Mon Sep 25 10:17:01 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA01907
	for <R-bugs@biostat.ku.dk>; Mon, 25 Sep 2000 10:17:01 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA07627
	for <R-bugs@stat.math.ethz.ch>; Mon, 25 Sep 2000 10:17:19 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa001r9; Mon Sep 25 10:17:15 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA01475; Mon, 25 Sep 2000 10:17:15 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14799.2571.494467.836722@gargle.gargle.HOWL>
Date: Mon, 25 Sep 2000 10:17:15 +0200
To: R-bugs@stat.math.ethz.ch
Subject: Bug(s) w/ rbind.data.frame(); fix also read.table(*, as.is = TRUE) ?
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

This is not only bug report, but also a RFC (request for comments):

The basic problem is that there are (at least) two ways of easily getting
non-factor character columns in data.frames.
The first is  
    read.table(*, as.is = TRUE) 
and the second is
    data.frame(.., I(...), ..)	      

which differ in their result. Whereas the first produces `pure' character
columns in the data.frame, the second approach gives `AsIs' classed
columns (character, or, e.g. logical).

Now, as the following shows,  rbind.data.frame()  *is* buggy anyway,
I wonder if we shouldn't change read.table(*, as.is = TRUE)
such that the non-numeric columns of its result become "AsIs" classed as
well:

-----------

str(d1 <- data.frame(a=1:3, b = I(letters[1:3])))
## d1 is `alright'
## d0: The same but a `character' *not* protected by AsIs:
d0 <- d1
d0$b <- unclass(d0$b)
str(d0)
## Note that this is *really* the same as a what you get from
##  read.table(*, as.is = TRUE)
##  ----------
##  R's read.table() is S+ compatible; however I wonder if
##  we shouldn't add  "AsIs" classes to all non-numeric components...
##  the classes, shouldn't harm, but ensure consistency of treatment..

str(d11 <- rbind(d1, new = c(7, "N"))) ## alright
str(d01 <- rbind(d0, new = c(7, "N"))) ## all wrong :
## Both columns were coerced to factors !!
##-- S-PLUS 5 coerces both to "character" -- which is better,
##  since the new row *is* all character

## R makes nonsense with 'b' [factor w/ 1 level "N": NA NA NA 1]
## S+ 5.1 does exactly the right thing [both a & b still look like in d0,d1 :
str(d12 <- rbind(d1, new = data.frame(a= 7, b="N")))##
str(d02 <- rbind(d0, new = data.frame(a= 7, b="N")))##

---------

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 669.audit <==
Wed Oct 25 20:31:21 2000	ripley	changed notes
Wed Oct 25 20:31:21 2000	ripley	foobar
Wed Oct 25 20:31:21 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 715 *
Subject: Printing list elements w/attributes
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 31 Oct 2000 12:15:09 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 715 <==
From postmaster@franz.stat.wisc.edu  Tue Oct 31 12:16:51 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA11710
	for <r-bugs@biostat.ku.dk>; Tue, 31 Oct 2000 12:16:50 +0100 (MET)
Received: from pubhealth.ku.dk (really [130.225.108.10]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m13qZSc-000IWmC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Tue, 31 Oct 2000 05:20:10 -0600 (CST) 
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA11691
	for <r-bugs@r-project.org>; Tue, 31 Oct 2000 12:15:08 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id MAA25642;
	Tue, 31 Oct 2000 12:15:10 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-bugs@r-project.org
Subject: Printing list elements w/attributes
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 31 Oct 2000 12:15:09 +0100
Message-ID: <x2em0xs1mq.fsf@blueberry.kubism.ku.dk>
Lines: 28
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

This looks wrong {spotted when looking at the confidence interval in 
unclass(t.test(...))}:

l<-list(a=10)
attr(l$a,"xx")<-23
l

R gets

$a
[1] 10
$aattr(,"xx")
[1] 23

Splus has

$a:
[1] 10
attr($a, "xx"):
[1] 23

(Linux/RedHat6.2/ix86, R1.1.1 and current R-devel)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 715.audit <==
Thu Nov  9 08:22:23 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 698 *
Subject:  print problem with data frames 
From: J.C.Rougier@durham.ac.uk
Date: Mon, 16 Oct 2000 14:01:43 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 698 <==
From J.C.Rougier@durham.ac.uk  Mon Oct 16 15:01:27 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA02675
	for <r-bugs@biostat.ku.dk>; Mon, 16 Oct 2000 15:01:26 +0200 (MET DST)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e9GD1id26439
	for <r-bugs@biostat.ku.dk>; Mon, 16 Oct 2000 14:01:44 +0100 (BST)
Received: from laplace by euclid id <OAA09788@euclid>; Mon, 16 Oct 2000 14:01:43 +0100 (BST)
Date: Mon, 16 Oct 2000 14:01:43 +0100 (BST)
Message-Id: <2745.200010161301@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  print problem with data frames 

Another one from the student computer practicals: it is possible
to create a dataframe that cannot be printed.  Thus

> fred <- data.frame(happy=c(TRUE, FALSE, TRUE), sad=7:9)
> tmp <- fred[c(FALSE, FALSE, TRUE, TRUE)] # no error message!
> tmp
Error in as.matrix.data.frame(x) : dim<- length of dims do not match the length of object
> print.default(tmp)
$"NA"
NULL

$"NA"
NULL

attr(,"class")
[1] "data.frame"

This obviously relates to my previous posting to r-devel about
subscripting objects with logical vectors that are not the right
length.

Cheers, Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 698.audit <==
Wed Oct 25 20:31:46 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 734 *
Subject:  Assigning into a dataframe 
From: J.C.Rougier@durham.ac.uk
Date: Fri, 10 Nov 2000 16:00:31 GMT
--$<- and [<- are not the same for data frames. Not a bug, I think, or at least
--a compatible one.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 734 <==
From J.C.Rougier@durham.ac.uk  Fri Nov 10 17:00:17 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA03880
	for <r-bugs@biostat.ku.dk>; Fri, 10 Nov 2000 17:00:16 +0100 (MET)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.1/8.11.1) with ESMTP id eAAG0V118413
	for <r-bugs@biostat.ku.dk>; Fri, 10 Nov 2000 16:00:31 GMT
Received: from laplace by euclid id <QAA19010@euclid>; Fri, 10 Nov 2000 16:00:25 GMT
Date: Fri, 10 Nov 2000 16:00:31 GMT
Message-Id: <10502.200011101600@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  Assigning into a dataframe 

I am not sure whether this is a bug or a feature, but I thought
that these two would have identical effects ...

> data(iris)
> iris[, 5] <- as.character(iris[, 5])
> is.factor(iris[, 5])
[1] TRUE
> is.factor(iris$Species)
[1] TRUE
> data(iris)
> iris$Species <- as.character(iris$Species)
> is.factor(iris[, 5])
[1] FALSE
> is.factor(iris$Species)
[1] FALSE

Cheers, Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:patches, Autoloads, package:base

==> 734.audit <==
Sun Dec 10 14:21:49 2000	pd	changed notes
Sun Dec 10 14:21:49 2000	pd	foobar
Sun Dec 10 14:21:49 2000	pd	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 731 *
Subject: substitute(x$y)) corrupts 'y' component
From: "Charles C. Berry" <cberry@tajo.ucsd.edu>
Date: Wed, 08 Nov 2000 11:01:48 -0800
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 731 <==
From postmaster@franz.stat.wisc.edu  Wed Nov  8 19:59:05 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA09084
	for <r-bugs@biostat.ku.dk>; Wed, 8 Nov 2000 19:59:04 +0100 (MET)
Received: from mailbox4.ucsd.edu (really [132.239.1.56]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m13taUY-000IWkC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Wed, 8 Nov 2000 13:02:38 -0600 (CST) 
Received: from smtp.ucsd.edu (smtp.ucsd.edu [132.239.1.49])
	by mailbox4.ucsd.edu (8.11.0/8.11.0) with ESMTP id eA8Ix0x00685
	for <r-bugs@r-project.org>; Wed, 8 Nov 2000 10:59:00 -0800 (PST)
Received: from tajo.ucsd.edu (tajo.ucsd.edu [132.239.99.2])
	by smtp.ucsd.edu (8.9.3/8.9.3) with ESMTP id KAA09477
	for <r-bugs@r-project.org>; Wed, 8 Nov 2000 10:59:18 -0800 (PST)
Received: from tajo.ucsd.edu by tajo.ucsd.edu (8.9.3+Sun/SMI-SVR4-UCSD.1)
	id LAA15955; Wed, 8 Nov 2000 11:01:48 -0800 (PST)
Sender: cberry@tajo.ucsd.edu
Message-ID: <3A09A31C.494D21FF@tajo.ucsd.edu>
Date: Wed, 08 Nov 2000 11:01:48 -0800
From: "Charles C. Berry" <cberry@tajo.ucsd.edu>
X-Mailer: Mozilla 4.51 [en] (X11; I; SunOS 5.7 sun4u)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@r-project.org
Subject: substitute(x$y)) corrupts 'y' component
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

viz.


> (function(x,y=a) substitute(x$y))(x)
x$a
> (function(x,y=a) substitute(x$y))(list(y=1:3))
list(y = 1:3)$a
> (function(x,y) eval(substitute(substitute(y))))(x=list(y=1:3),y=x$y)
list(y = 1:3)$x$y


The behavior I expect and want is like that in Splus 3.4:

> (function(x,y=a) substitute(x$y))(x)
x$y
> (function(x,y=a) substitute(x$y))(list(y=1:3))
list(y = 1:3)$y
> (function(x,y) eval(substitute(substitute(y))))(x=list(y=1:3),y=x$y)
list(y = 1:3)$y

Is there a workaround to achieve this behavior under fairly general
circumstances, i.e. when one does not know whether to expect an object
with a component, but encounters one?

Chuck Berry
--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.0
 year = 2000
 month = June
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:bqtl, Autoloads, package:base
> 

-- 
Charles C. Berry                        (858) 534-2098 
                                         Dept of Family/Preventive
Medicine
E mailto:cberry@tajo.ucsd.edu	         UC San Diego
http://hacuna.ucsd.edu/members/ccb.html  La Jolla, San Diego 92093-0645

==> 731.reply.1 <==
From thomas@biostat.washington.edu  Wed Nov  8 20:37:03 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA09219
	for <R-bugs@biostat.ku.dk>; Wed, 8 Nov 2000 20:37:02 +0100 (MET)
Received: from atlas (atlas [128.95.201.63])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-2000-05-16a) with ESMTP id LAA07475;
	Wed, 8 Nov 2000 11:33:24 -0800 (PST)
Date: Wed, 8 Nov 2000 11:33:23 -0800 (PST)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: cberry@tajo.ucsd.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] substitute(x$y)) corrupts 'y' component (PR#731)
In-Reply-To: <200011081859.TAA09094@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0011081128020.3414-100000@atlas.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 8 Nov 2000 cberry@tajo.ucsd.edu wrote:

> viz.
> 
> 
> > (function(x,y=a) substitute(x$y))(x)
> x$a
> > (function(x,y=a) substitute(x$y))(list(y=1:3))
> list(y = 1:3)$a
> > (function(x,y) eval(substitute(substitute(y))))(x=list(y=1:3),y=x$y)
> list(y = 1:3)$x$y
> 
> 
> The behavior I expect and want is like that in Splus 3.4:
> 
> > (function(x,y=a) substitute(x$y))(x)
> x$y
> > (function(x,y=a) substitute(x$y))(list(y=1:3))
> list(y = 1:3)$y
> > (function(x,y) eval(substitute(substitute(y))))(x=list(y=1:3),y=x$y)
> list(y = 1:3)$y


I don't think this is a bug - substitute is performing as intended and as
documented -- but it is an incompatibility.  There are two issues here,
one easy and one difficult.

In your first two examples the problem is that you want to substitute only
for x (though in the second example I don't see why you expect this to
happen).  If you want to substitute only for x you can do
	substitute(x$y,list(x=x))


In the third example you want to perform substitution on the value of a
variable.  This is a useful thing to want to do, and I don't know how to
do it.

eg
     z<-quote(x$y)
     x<-list(y=1:3)
and you want to produce
     list(y=1:3)$y

Suggestions?

	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


==> 731.reply.2 <==
From pd@biostat.ku.dk  Wed Nov  8 20:54:49 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA09301;
	Wed, 8 Nov 2000 20:54:49 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id UAA03103;
	Wed, 8 Nov 2000 20:55:20 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Thomas Lumley <thomas@biostat.washington.edu>
Cc: cberry@tajo.ucsd.edu, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] substitute(x$y)) corrupts 'y' component (PR#731)
References: <Pine.GSO.4.21.0011081128020.3414-100000@atlas.biostat.washington.edu>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 Nov 2000 20:55:20 +0100
In-Reply-To: Thomas Lumley's message of "Wed, 8 Nov 2000 11:33:23 -0800 (PST)"
Message-ID: <x2hf5itf13.fsf@blueberry.kubism.ku.dk>
Lines: 31
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Thomas Lumley <thomas@biostat.washington.edu> writes:

>      z<-quote(x$y)
>      x<-list(y=1:3)
> and you want to produce
>      list(y=1:3)$y
> 
> Suggestions?

Double substitute and eval, but there's a hitch:

> eval(substitute(substitute(z,list(x=x)),list(z=z)))
structure(list(y = c(1, 2, 3)), .Names = "y")$y

which is hardly avoidable since

> dput(x)   
structure(list(y = c(1, 2, 3)), .Names = "y")

However, 

> x<-quote(list(y=1:3))
> eval(substitute(substitute(z,list(x=x)),list(z=z)))
list(y = 1:3)$y


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 731.audit <==
Thu Nov  9 08:22:23 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Low-level

* PR# 551 *
Subject: Bus Error crash
From: kjetikj@astro.uio.no
Date: Mon, 22 May 2000 13:06:48 +0200 (MET DST)
--- ??? -- not (yet) reproducible with small examples
--- after load()ing large objects
--- on two different DEC alpha versions
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 551 <==
From kjetikj@astro.uio.no  Mon May 22 13:06:49 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA20951
	for <R-bugs@biostat.ku.dk>; Mon, 22 May 2000 13:06:48 +0200 (MET DST)
Date: Mon, 22 May 2000 13:06:48 +0200 (MET DST)
From: kjetikj@astro.uio.no
Message-Id: <200005221106.NAA20951@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Bus Error crash

Full_Name: Kjetil Kjernsmo
Version: 1.0.1
OS: osf1
Submission from: (NULL) (129.240.28.227)


Ouch, another obscure bug...
I just had a bus error crash, with a core dump, a small one this time.
Usual <URL:http://www.astro.uio.no/~kjetikj/tmp/core>.
I had done a few simulations, and done a chisq.test() on them.
These simulations also write about 190MB's to file, but
I have no idea whether that is relevant, and those data are not
used. The calls I do look like this:
> ch1 <- chisq.test(t(apply(cbind(rep(5000000, 4)), 1, lineprofile, 1, 100,
"point")))
> ch1

	 Pearson's Chi-square test 

data:  t(apply(cbind(rep(5e+06, 4)), 1, lineprofile, 1, 100, "point")) 
X-squared = 463.8359, df = 300, p-value = 3.726e-09 

> ch1$observed

Process R bus error (core dumped) at Mon May 22 12:38:49 2000


....so it doesn't crash when I print the whole object, but when I 
a vector of the object, it crashes... And, restarting R, it doesn't
happen.

I heard the sysadm who did the installation had some problems,
I don't know what it was about, but if I understood him correctly,
it only happened when he tuned for EV6, so it shouldn't be a problem now, 
I guess....

Kjetil


==> 551.followup.1 <==
From mcneney@cs.sfu.ca  Thu May 25 00:21:11 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA21037
	for <R-bugs@biostat.ku.dk>; Thu, 25 May 2000 00:21:10 +0200 (MET DST)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id PAA15921;
	Wed, 24 May 2000 15:21:29 -0700 (PDT)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id PAA0000118354; Wed, 24 May 2000 15:21:29 -0700 (PDT)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Wed, 24 May 2000 15:21:29 -0700 (PDT)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: kjetikj@astro.uio.no
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Bus Error crash (PR#551)
In-Reply-To: <200005221106.NAA20961@pubhealth.ku.dk>
Message-ID: <Pine.OSF.4.21.0005241508010.116565-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 22 May 2000 kjetikj@astro.uio.no wrote:

> Full_Name: Kjetil Kjernsmo
> Version: 1.0.1
> OS: osf1
> Submission from: (NULL) (129.240.28.227)
> 
> 
> Ouch, another obscure bug...
> I just had a bus error crash, with a core dump, a small one this time.
> Usual <URL:http://www.astro.uio.no/~kjetikj/tmp/core>.
> I had done a few simulations, and done a chisq.test() on them.
> These simulations also write about 190MB's to file, but
> I have no idea whether that is relevant, and those data are not
> used. The calls I do look like this:
> > ch1 <- chisq.test(t(apply(cbind(rep(5000000, 4)), 1, lineprofile, 1, 100,
> "point")))
> > ch1
> 
> 	 Pearson's Chi-square test 
> 
> data:  t(apply(cbind(rep(5e+06, 4)), 1, lineprofile, 1, 100, "point")) 
> X-squared = 463.8359, df = 300, p-value = 3.726e-09 
> 
> > ch1$observed
> 
> Process R bus error (core dumped) at Mon May 22 12:38:49 2000
> 
> 
> ....so it doesn't crash when I print the whole object, but when I 
> a vector of the object, it crashes... And, restarting R, it doesn't
> happen.
> 
> I heard the sysadm who did the installation had some problems,
> I don't know what it was about, but if I understood him correctly,
> it only happened when he tuned for EV6, so it shouldn't be a problem now, 
> I guess....
> 
> Kjetil

I can't reproduce the problem on my system (R Version: 1.0.0, OS: osf1
V5.0). Compiled with gcc/g77 using optimisation level -O2 (determined by
configure script).

> ch1 <- chisq.test(t(apply(cbind(rep(5000000, 4)), 1, lineprofile, 1,
100,"point")))


> ch1

         Pearson's Chi-square test 

data:  t(apply(cbind(rep(5e+06, 4)), 1, lineprofile, 1, 100, "point")) 
X-squared = 404.6772, df = 300, p-value = 5.125e-05 

> ch1$observed
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14]
[1,]  160  144  205  244  273  314  395  454  521   592   713   864   905 1043
[2,]  139  175  210  232  276  369  372  459  525   566   687   781   886  981

... etc ...


Brad


==> 551.followup.2 <==
From kjetikj@astro.uio.no  Thu May 25 11:51:59 2000
Received: from mons.uio.no (7411@mons.uio.no [129.240.130.14])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA25230
	for <R-bugs@biostat.ku.dk>; Thu, 25 May 2000 11:51:59 +0200 (MET DST)
Received: from alnair.uio.no ([129.240.28.227])
	by mons.uio.no with esmtp (Exim 2.12 #7)
	id 12uuJM-0000Xk-00; Thu, 25 May 2000 11:52:16 +0200
Received: from localhost ([127.0.0.1])
	by alnair.uio.no with esmtp (Exim 2.12 #1)
	id 12uuJE-0003bJ-00; Thu, 25 May 2000 11:52:08 +0200
Date: Thu, 25 May 2000 11:52:08 +0200 (MET DST)
From: Kjetil Kjernsmo <kjetil.kjernsmo@astro.uio.no>
X-Sender: kjetikj@alnair.uio.no
To: Brad McNeney <mcneney@cs.sfu.ca>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Bus Error crash (PR#551)
In-Reply-To: <Pine.OSF.4.21.0005241508010.116565-100000@smahlt.math.sfu.ca>
Message-ID: <Pine.OSF.4.21.0005251145100.13610-100000@alnair.uio.no>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 24 May 2000, Brad McNeney wrote:

>I can't reproduce the problem on my system (R Version: 1.0.0, OS: osf1
>V5.0).

OK. I had a similar crash yesterday on a different machine but I think
with rather identical hardware, it was a batch job that was running
so I don't know exactly what caused the crash (after about 48 CPU hours,
arrgh), but I have a (small) core dump at
<URL:http://www.astro.uio.no/~kjetikj/tmp/core3>

Anyway, Uwe suggested it might be a RAM hardware problem, which is not
impossible. I think these machines were bought while still in beta-test,
and hopefully, Compaq will drop by tomorrow to have a look. 

Best,

Kjetil
-- 
Kjetil Kjernsmo
Graduate astronomy-student                    Problems worthy of attack
University of Oslo, Norway            Prove their worth by hitting back
E-mail: kjetikj@astro.uio.no                                - Piet Hein
Homepage <URL:http://www.astro.uio.no/~kjetikj/>
Webmaster@skepsis.no 


==> 551.followup.3 <==
From kjetikj@astro.uio.no  Fri Jun  9 16:33:08 2000
Received: from mons.uio.no (7411@mons.uio.no [129.240.130.14])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA05935
	for <r-bugs@biostat.ku.dk>; Fri, 9 Jun 2000 16:33:07 +0200 (MET DST)
Received: from alnair.uio.no ([129.240.28.227])
	by mons.uio.no with esmtp (Exim 2.12 #7)
	id 130Pqg-0004Lh-00
	for r-bugs@biostat.ku.dk; Fri, 9 Jun 2000 16:33:26 +0200
Received: from localhost ([127.0.0.1])
	by alnair.uio.no with esmtp (Exim 2.12 #1)
	id 130Pqf-0000aE-00
	for r-bugs@biostat.ku.dk; Fri, 9 Jun 2000 16:33:25 +0200
Date: Fri, 9 Jun 2000 16:33:24 +0200 (MET DST)
From: Kjetil Kjernsmo <kjetil.kjernsmo@astro.uio.no>
X-Sender: kjetikj@alnair.uio.no
To: r-bugs@biostat.ku.dk
Subject: Disappearing values (PR#551)
Message-ID: <Pine.OSF.4.05.10006091627560.847-100000@alnair.uio.no>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Dear all,

Uwe e-mailed me yesterday about the problems some time ago. I had hoped
someone would have a look at our computers, but due to some unfortunate
circumstances, it hasn't happened. However, it seems unlikely that it is
connected to a specific piece of hardware. It could be an
architecture-dependent problem though. I also had a word with those who
did the installation of R, and they had some problems when tuning it for
alphaev6, but it all went smoothly when tuning for alphaev56, and that is
the build I'm running. This is basically the stuff I sent to Uwe
yesterday. 

I have been testing it on three different machines:
alnair, a XP1000 with a 500MHz alphaev6 processor and 619 MB RAM
rukbat, a PWS500au with a 500MHz alphaev56 processor with 238 MB RAM
mirfak, a DEC255/233 with a 233MHz (?) alphaev4 (?) processor with 245MB
(RAM is according to top). All show the same problems consistently. 
I'm not using the match.arg()-approach anymore, BTW, I have moved on to
some object-oriented stuff. 

However, some apparently related (?) problem occurs. Yesterday, I started
working on some simulations I have done (with R of course! :-) ). I did
exactly the same operations on rukbat and mirfak (using ESS-elsewhere
while sitting on alnair), starting with the same calls, vsize=80M,
nsize=800k, no-restore. I loaded a 58MB file with load, and there are a
few variables with arrays of htest-objects. Then, I did 
as.vector(sapply(chisq5M11000, function(x) x$statistic))
to get a vector of the test statistics. Now, occasionally, it prints a
nice vector with all the values intact. Occasionally, one of the entries
are NULL, and then it prints a list, e.g.
[[892]]
X-squared 
 1933.637 

[[893]]
NULL

[[894]]
X-squared 
 1741.416 

The funny thing is that when I did this sapply thing on mirfak and rukbat,
it happened on at exactly the same place on the two machines. First,
mirfak would produce a vector then rukbat would produce a vector, mirfak
would give a list where element # 238 (if I remember correctly) was NULL,
rukbat would produce a list with element #238 NULL, both would produce a
vector again, both would produce a list with element #602 NULL, etc... 

This is pretty much what I've got now... :-)

Best,

Kjetil
-- 
Kjetil Kjernsmo
Graduate astronomy-student                    Problems worthy of attack
University of Oslo, Norway            Prove their worth by hitting back
E-mail: kjetikj@astro.uio.no                                - Piet Hein
Homepage <URL:http://www.astro.uio.no/~kjetikj/>
Webmaster@skepsis.no 





==> 551.audit <==
Fri Jul 07 06:44:08 2000	maechler	changed notes
Fri Jul 07 06:44:08 2000	maechler	moved from incoming to Low-level

==> 551.followup.4 <==
From kjetikj@astro.uio.no  Fri Jul 14 19:18:42 2000
Received: from pat.uio.no (pat.uio.no [129.240.130.16])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA16705
	for <r-bugs@biostat.ku.dk>; Fri, 14 Jul 2000 19:18:42 +0200 (MET DST)
Received: from alnair.uio.no ([129.240.28.227])
	by pat.uio.no with esmtp (Exim 2.12 #7)
	id 13D977-0000KT-00
	for r-bugs@biostat.ku.dk; Fri, 14 Jul 2000 19:19:01 +0200
Received: from localhost ([127.0.0.1])
	by alnair.uio.no with esmtp (Exim 2.12 #1)
	id 13D976-0004qm-00
	for r-bugs@biostat.ku.dk; Fri, 14 Jul 2000 19:19:00 +0200
Date: Fri, 14 Jul 2000 19:19:00 +0200 (MET DST)
From: Kjetil Kjernsmo <kjetil.kjernsmo@astro.uio.no>
X-Sender: kjetikj@alnair.uio.no
To: r-bugs@biostat.ku.dk
Subject: Re: Disappearing values (PR#551)
In-Reply-To: <Pine.OSF.4.05.10006091627560.847-100000@alnair.uio.no>
Message-ID: <Pine.OSF.4.05.10007141906260.3963-100000@alnair.uio.no>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 9 Jun 2000, I wrote:
[...]
> Now, occasionally, it prints a
>nice vector with all the values intact. Occasionally, one of the entries
>are NULL, and then it prints a list, e.g.
[lots of things along these lines]

Now, it seems like this problem has been solved. Reading some old
r-help e-mail I had missed, I came across a message from Brad McNeney
(<URL:http://www.ens.gu.edu.au/robertk/R/help/00a/2068.html>), and it was
apparent that he has had the same problems as I, but solved it by using
gcc instead of cc. Recent communication between Ray Brownrigg and Prof
Brian D Ripley enabled me to compile and get R running myself, and indeed,
the problem has not occured in a number of runs after I did this, I look
upon it as solved.

So, it seems like it may be problematic to use the standard cc compiler on
the alpha platform with Digital UNIX to compile R. Just a minor status
report... :-)

Best,

Kjetil
-- 
Kjetil Kjernsmo
Graduate astronomy-student                    Problems worthy of attack
University of Oslo, Norway            Prove their worth by hitting back
E-mail: kjetikj@astro.uio.no                                - Piet Hein
Homepage <URL:http://www.astro.uio.no/~kjetikj/>
Webmaster@skepsis.no 




~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 545 *
Subject: Segmentation Fault of unknown cause
From: kjetikj@astro.uio.no
Date: Mon, 15 May 2000 16:29:29 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 545 <==
From kjetikj@astro.uio.no  Mon May 15 16:29:29 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA13643
	for <R-bugs@biostat.ku.dk>; Mon, 15 May 2000 16:29:29 +0200 (MET DST)
Date: Mon, 15 May 2000 16:29:29 +0200 (MET DST)
From: kjetikj@astro.uio.no
Message-Id: <200005151429.QAA13643@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Segmentation Fault of unknown cause

Full_Name: Kjetil Kjernsmo
Version: 1.0.0
OS: osf1
Submission from: (NULL) (129.240.28.227)


Hello!

I'm afraid I have another obscure bug. 
R has just crashed with a segmentation fault. 
This time, I have even failed to reproduce it, but fortunately, 
I have a core dump. It's at 
<URL:http://www.astro.uio.no/~kjetikj/tmp/core>

The call I did was 
log10(quantile(chisqtests5M11001, c(0.05, 0.95)))
where chisqtests5M11001 is an array of length 1500 
(it's an array of p-values produced by the chisq.test, but I 
doubt that it is relevant). 

I did lots of strange things prior to the crash, some even 
involving for-loops, but I can't tell what is relevant. Anyway,
a transcript of the session is at 
<URL:http://www.astro.uio.no/~kjetikj/tmp/crash.Rt>

That's all I've got.... 

Kjetil

==> 545.audit <==
Wed Jun 07 06:49:39 2000	maechler	moved from incoming to Low-level
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 505 *
Subject: interrupted save 
From: Thomas Lumley <thomas@biostat.washington.edu>
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 505 <==
From thomas@biostat.washington.edu  Sat Mar 25 21:16:39 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA08785
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 21:16:38 +0100 (MET)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id MAA24561
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 12:16:50 -0800 (PST)
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: R-bugs@biostat.ku.dk
Subject: interrupted save 
In-Reply-To: <Pine.GSO.4.21.0003251204350.22429-100000@mail.biostat.washington.edu>
Message-ID: <Pine.GSO.4.21.0003251207350.22429-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


If an error occurs during a save the file does not appear to be
closed and buffers flushed.  This can lead to corruption if the same
filename is used later and then the buffer is flushed on program exit.

For example, tn the context of PR #504

 f<-function(x,...){ function(y) list(x=x,y=y,...)}
 a<-f(1,2,3)
 save(list="a",file="a.rdata")  ## -- error --
 b<-1:10
 save(list="b",file="a.rdata")
 load("a.rdata")  ## works
 q("no")
 
 R

 load("a.rdata")  ## error



This is R1.0 on Linux

	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


==> 505.audit <==
Thu Apr 13 06:21:36 2000	ripley	moved from incoming to Low-level
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Misc

* PR# 772 *
Subject: demo(is.things) fails
From: B.Rowlingson@lancaster.ac.uk
Date: Mon, 18 Dec 2000 13:46:02 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 772 <==
From B.Rowlingson@lancaster.ac.uk  Mon Dec 18 13:46:03 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA21193
	for <R-bugs@biostat.ku.dk>; Mon, 18 Dec 2000 13:46:02 +0100 (MET)
Date: Mon, 18 Dec 2000 13:46:02 +0100 (MET)
From: B.Rowlingson@lancaster.ac.uk
Message-Id: <200012181246.NAA21193@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: demo(is.things) fails

Full_Name: Barry Rowlingson
Version: R-1.2.0
OS: RH7/i386
Submission from: (NULL) (148.88.0.11)


demo(is.things) fails with:

> is.ALL(NULL)
Error in as.POSIXct.default(x) : Don't know how to convert `x' to class
"POSIXct"
In addition: Warning message: 
is.nan() applied to non-(list or vector) in: fn(obj) 

 - this seems to be because it is calling:

> is.na.POSIXlt(NULL)
Error in as.POSIXct.default(x) : Don't know how to convert `x' to class
"POSIXct"

 is.na.POSIXlt(NA) gives the same error, and there's nothing on NA's or
NULL's in the documentation for the POSIX{l,c}t functions. It seems that
errors in these functions cause 'stop()' calls rather than returning NA's.

Barry



==> 772.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Dec 18 14:37:52 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA22386
	for <R-bugs@biostat.ku.dk>; Mon, 18 Dec 2000 14:37:51 +0100 (MET)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id NAA13654;
	Mon, 18 Dec 2000 13:38:04 GMT
Message-Id: <200012181338.NAA13654@toucan.stats.ox.ac.uk>
Date: Mon, 18 Dec 2000 13:38:04 +0000 (GMT)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] demo(is.things) fails (PR#772)
To: r-devel@stat.math.ethz.ch, B.Rowlingson@lancaster.ac.uk
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: m6gdyko4YuWskhuNljhQoQ==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 


> From: B.Rowlingson@lancaster.ac.uk
> Date: Mon, 18 Dec 2000 13:46:04 +0100 (MET)
> To: r-devel@stat.math.ethz.ch
> Subject: [Rd] demo(is.things) fails (PR#772)
> CC: R-bugs@biostat.ku.dk
> X-Loop: R-bugs@biostat.ku.dk
> 
> Full_Name: Barry Rowlingson
> Version: R-1.2.0
> OS: RH7/i386
> Submission from: (NULL) (148.88.0.11)
> 
> 
> demo(is.things) fails with:
> 
> > is.ALL(NULL)
> Error in as.POSIXct.default(x) : Don't know how to convert `x' to class
> "POSIXct"
> In addition: Warning message: 
> is.nan() applied to non-(list or vector) in: fn(obj) 
> 
>  - this seems to be because it is calling:
> 
> > is.na.POSIXlt(NULL)
> Error in as.POSIXct.default(x) : Don't know how to convert `x' to class
> "POSIXct"
> 
>  is.na.POSIXlt(NA) gives the same error, and there's nothing on NA's or
> NULL's in the documentation for the POSIX{l,c}t functions. It seems that
> errors in these functions cause 'stop()' calls rather than returning NA's.

That's a *method* for is.na which should not be called directly by users.
It should only be called with an argument inheriting from class POSIXlt.

I have no idea why anyone wrote a demo to call methods directly, but after
four years it looks like it needs updating.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 772.audit <==
Tue Dec 26 10:31:48 2000	ripley	moved from incoming to Misc
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Models

* PR# 778 *
Subject: Bug in glm.fit() or plot.lm()
From: murdoch@stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Dec 2000 14:57:59 -0500
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 778 <==
From postmaster@franz.stat.wisc.edu  Tue Dec 19 20:56:10 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA09013
	for <r-bugs@biostat.ku.dk>; Tue, 19 Dec 2000 20:56:09 +0100 (MET)
Received: from pony.its.uwo.ca (really [129.100.2.63]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m148Ss1-000IYUC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 13:56:21 -0600 (CST) 
Received: from fisher.stats.uwo.ca (fisher.stats.uwo.ca [129.100.45.201])
	by pony.its.uwo.ca (8.10.0/8.10.0) with ESMTP id eBJJuLZ24553
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 14:56:21 -0500 (EST)
Received: from djm.stats.uwo.ca (djm.stats.uwo.ca [129.100.45.113])
	by fisher.stats.uwo.ca (8.9.3/8.8.7) with SMTP id OAA31127;
	Tue, 19 Dec 2000 14:56:15 -0500
From: murdoch@stats.uwo.ca (Duncan Murdoch)
To: r-bugs@r-project.org
Cc: jfang@stats.uwo.ca
Subject: Bug in glm.fit() or plot.lm()
Date: Tue, 19 Dec 2000 14:57:59 -0500
Message-ID: <3a40bc4c.90188747@fisher.stats.uwo.ca>
X-Mailer: Forte Agent 1.5/32.451
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Here's a bug one of my students noticed.

When you call plot() on a glm object, plot.lm gets called.  The second
plot it shows is supposed to give a normal QQ plot of the standard
deviance residuals, but it doesn't.  The glm object created by glm.fit
returns something (the IRLS weights?) in fit$weights which plot.lm
takes as observation weights, so  you get strange residuals in the QQ
plot.

For example, here I fit a simulated Poisson model where the model
perfectly fine, but the plot.lm QQ plot makes the residuals look huge,
ranging between -45 and 40.

>set.seed(1)
>x <- seq(4,5,len=1000)
>y <- rpois(1000,exp(x))
>fit <- glm(y ~ x, family=poisson)
>plot(fit, which=2)

If I extract the residuals myself and plot them, I see that the model
is fine:

>qqnorm(residuals(fit))

The problem is that the weights are big; plot.lm should be using
prior.weights, or glm should be returning the big weights under a
different name:

> summary(fit$weights)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  54.35   69.90   89.90   93.76  115.60  148.70 

> summary(fit$prior.weights)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      1       1       1       1       1       1 

Duncan Murdoch

--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = x86
 os = Win32
 system = x86, Win32
 status = 
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 15
 language = R

Windows 9x 4.10 (build 1998)  

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base

==> 778.audit <==
Tue Dec 26 10:31:10 2000	ripley	moved from incoming to Models

==> 778.followup.1 <==
From ripley@stats.ox.ac.uk  Thu Dec 28 22:54:45 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA29270
	for <R-bugs@biostat.ku.dk>; Thu, 28 Dec 2000 22:54:45 +0100 (MET)
Received: from max176.public.ox.ac.uk (max176.public.ox.ac.uk [192.76.27.176])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id VAA14449;
	Thu, 28 Dec 2000 21:54:57 GMT
Date: Thu, 28 Dec 2000 21:54:23 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: murdoch@stats.uwo.ca
cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] Bug in glm.fit() or plot.lm() (PR#778)
In-Reply-To: <200012191956.UAA09023@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10012282140570.7000-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Here's what I think is going on.  

plot.lm() and everything I could see like it calls weights(object) and
resid(object).  The problem is that there is a resid.glm so one gets
deviance residuals, but there is not a weights.glm so weights.lm is used.  
The solution is to add weights.glm:

weights.glm <- function(object, type = c("prior", "working"), ...)
{
    type <- match.arg(type)
    if(type == "prior") object$prior.weights else object$weights
}

As far as I can see one either wants the default weights here and deviance
or Pearson residuals, or object$weights and the working residuals.  The
fitted object has the latter pair, which is sensible for inheriting from lm
(and compatible with S), but both plot.lm and your example use residuals()
which is not the same thing.

It seems reasonably clear from the labels that plot.lm is intended to use
standardized deviance residuals, but I am not at all sure that is the best
alternative. Davison & Snell (1991 Cox Festschrift) seem to suggest that
standardized Pearson residuals would be better, and offer other
alternatives.

I've added weights.glm.  We badly need to document the "glm" class
and subtle points like this.



On Tue, 19 Dec 2000 murdoch@stats.uwo.ca wrote:

> Here's a bug one of my students noticed.
> 
> When you call plot() on a glm object, plot.lm gets called.  The second
> plot it shows is supposed to give a normal QQ plot of the standard
> deviance residuals, but it doesn't.  The glm object created by glm.fit
> returns something (the IRLS weights?) in fit$weights which plot.lm
> takes as observation weights, so  you get strange residuals in the QQ
> plot.
> 
> For example, here I fit a simulated Poisson model where the model
> perfectly fine, but the plot.lm QQ plot makes the residuals look huge,
> ranging between -45 and 40.
> 
> >set.seed(1)
> >x <- seq(4,5,len=1000)
> >y <- rpois(1000,exp(x))
> >fit <- glm(y ~ x, family=poisson)
> >plot(fit, which=2)
> 
> If I extract the residuals myself and plot them, I see that the model
> is fine:
> 
> >qqnorm(residuals(fit))
> 
> The problem is that the weights are big; plot.lm should be using
> prior.weights, or glm should be returning the big weights under a
> different name:
> 
> > summary(fit$weights)
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
>   54.35   69.90   89.90   93.76  115.60  148.70 
> 
> > summary(fit$prior.weights)
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
>       1       1       1       1       1       1 

Match the residuals and weights is the story.

> 
> Duncan Murdoch
> 
> --please do not edit the information below--
> 
> Version:
>  platform = i386-pc-mingw32
>  arch = x86
>  os = Win32
>  system = x86, Win32
>  status = 
>  major = 1
>  minor = 2.0
>  year = 2000
>  month = 12
>  day = 15
>  language = R
> 
> Windows 9x 4.10 (build 1998)  
> 
> Search Path:
>  .GlobalEnv, package:ctest, Autoloads, package:base
> 
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 771 *
Subject: problems with glm
From: Jim Lindsey <james.lindsey@luc.ac.be>
Date: Mon, 18 Dec 2000 09:28:01 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 771 <==
From james.lindsey@luc.ac.be  Mon Dec 18 09:27:57 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA16547
	for <R-bugs@biostat.ku.dk>; Mon, 18 Dec 2000 09:27:57 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id JAA05954
	for <r-bugs@stat.math.ethz.ch>; Mon, 18 Dec 2000 09:28:11 +0100 (MET)
Received: from UNKNOWN(193.190.2.30), claiming to be "alpha.luc.ac.be"
 via SMTP by hypatia, id smtpdAAAa001Sy; Mon Dec 18 09:28:03 2000
Received: (from jlindsey@localhost)
	by alpha.luc.ac.be (8.9.3/8.9.3) id JAA02268
	for r-bugs@stat.math.ethz.ch; Mon, 18 Dec 2000 09:28:02 +0100 (MET)
From: Jim Lindsey <james.lindsey@luc.ac.be>
Message-Id: <200012180828.JAA02268@alpha.luc.ac.be>
Subject: problems with glm
To: r-bugs@stat.math.ethz.ch (rbugs)
Date: Mon, 18 Dec 2000 09:28:01 +0100 (MET)
X-Mailer: ELM [version 2.5 PL1]
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

R1.2.0 with Linux RH5.2

I do not believe that the problems below are new to 1.2 but I only
cover this sort of thing once a year in my course and some of that
happened to be last Friday so too late to report for 1.2. I see that
one or two things that I was going to report have been corrected.
I like the fact that interactions now show : instead of .

Here is some output with comments inserted.


R : Copyright 2000, The R Development Core Team
Version 1.2.0  (2000-12-15)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type `license()' or `licence()' for distribution details.

R is a collaborative project with many contributors.
Type `contributors()' for more information.

Type `demo()' for some demos, `help()' for on-line help, or
`help.start()' for a HTML browser interface to help.
Type `q()' to quit R.

Notice contrasts for below:

> options(contrasts=c("contr.treatment","contr.poly"))
> data <- read.table("tmp.dat",skip=6,head=T)
> data
   Freq Reg66 Reg71
1   118    CC    CC
2    14    LY    CC
3     8    WM    CC
4    12    GL    CC
5    12    CC    LY
6  2127    LY    LY
7    69    WM    LY
8   110    GL    LY
9     7    CC    WM
10   86    LY    WM
11 2548    WM    WM
12   88    GL    WM
13   23    CC    GL
14  130    LY    GL
15  107    WM    GL
16 7712    GL    GL
> attach(data)
> wt <- codes(Reg66)!=codes(Reg71)
> print(z <- glm(Freq~Reg66+Reg71,family=poisson))

Call:  glm(formula = Freq ~ Reg66 + Reg71, family = poisson) 

Coefficients:
(Intercept)      Reg66GL      Reg66LY      Reg66WM      Reg71GL      Reg71LY  
     0.6134       3.9022       2.6900       2.8376       3.9597       2.7245  
    Reg71WM  
     2.8877  

Degrees of Freedom: 15 Total (i.e. Null);  9 Residual
Null Deviance:	    40740 
Residual Deviance: 19880 	AIC: 20000 
> print(z2 <- glm(Freq~Reg66+Reg71,family=poisson,weight=wt))

Call:  glm(formula = Freq ~ Reg66 + Reg71, family = poisson, weights = wt) 

Coefficients:
(Intercept)      Reg66GL      Reg66LY      Reg66WM      Reg71GL      Reg71LY  
     0.4615       2.1242       2.0096       1.7236       2.4555       2.0847  
    Reg71WM  
     1.9140  

Degrees of Freedom: 11 Total (i.e. Null);  5 Residual
Null Deviance:	    486.2 
Residual Deviance: 4.367 	AIC: 82.7 
> z2$fit
          1           2           3           4           5           6 
 118.100000   11.836037    8.891541   13.272421   12.758205 2127.100000 
          7           8           9          10          11          12 
  71.505458  106.736339   10.756661   80.252100 2548.100000   89.991240 
         13          14          15          16 
  18.485138  137.911862  103.603001 7712.100000 

First problem: with diagonal values weighted out in a transition
matrix (mover-stayer model), glm wrongly estimates the diagonals to be
the observed plus 0.1. This was correct in 90.1 a year ago but already
wrong in 1.0.1. I don't have any versions in between installed.

> # correct values from GLIM4
> #   unit   observed    fitted   residual
> #     (1)       118     1.586      0.000
> #      2         14    11.836      0.629
> #      3          8     8.892     -0.299
> #      4         12    13.272     -0.349
> #      5         12    12.758     -0.212
> #     (6)      2127    95.185      0.000
> #      7         69    71.505     -0.296
> #      8        110   106.736      0.316
> #      9          7    10.757     -1.145
> #     10         86    80.252      0.642
> #    (11)      2548    60.287      0.000
> #     12         88    89.991     -0.210
> #     13         23    18.485      1.050
> #     14        130   137.912     -0.674
> #     15        107   103.603      0.334
> #    (16)      7712   154.648      0.000
> # and from R90.1 (wrong in R1.0.1)
> #> z2$fit
> #         1          2          3          4          5          6          7 
> #  1.586454  11.836037   8.891541  13.272421  12.758205  95.184992  71.505458 
> #         8          9         10         11         12         13         14 
> #106.736339  10.756661  80.252100  60.287479  89.991240  18.485138 137.911862 
> #        15         16 
> #103.603001 154.648406 
> 

Second problem: the man page for factors states that the levels are
sorted, but gl does not do this. It keeps them in the order of the
labels. This is inconsistent with everything else, confusing for
students, and liable to induce errors in data analysis. In the example
below, it is not too important because the baseline category is the
same in the two cases but that will not generally be the case.

As an addition comment, I would strongly recommend that, if labels can
be coerced to numeric, they be ordered, not sorted. This is because
the order is very confusing if there are more than 9: for example, the
sorted 10 comes near the beginning and not at the end.

> reg66 <- gl(4,1,16,labels=c("CC","LY","WM","GL"))
> z

Call:  glm(formula = Freq ~ Reg66 + Reg71, family = poisson) 

Coefficients:
(Intercept)      Reg66GL      Reg66LY      Reg66WM      Reg71GL      Reg71LY  
     0.6134       3.9022       2.6900       2.8376       3.9597       2.7245  
    Reg71WM  
     2.8877  

Degrees of Freedom: 15 Total (i.e. Null);  9 Residual
Null Deviance:	    40740 
Residual Deviance: 19880 	AIC: 20000 
> print(za <- glm(Freq~reg66+Reg71,family=poisson))

Call:  glm(formula = Freq ~ reg66 + Reg71, family = poisson) 

Coefficients:
(Intercept)      reg66LY      reg66WM      reg66GL      Reg71GL      Reg71LY  
     0.6134       2.6900       2.8376       3.9022       3.9597       2.7245  
    Reg71WM  
     2.8877  

Degrees of Freedom: 15 Total (i.e. Null);  9 Residual
Null Deviance:	    40740 
Residual Deviance: 19880 	AIC: 20000 

Third problem: if mean value contrasts are used, the level names are
not attached to the variable name, but simply the number of the
category. This rightly drives students mad and is simply
uninterpretable if the levels have been sorted. It takes a great deal
of extreme care to try to find out to what the numbers refer.

> options(contrasts=c("contr.sum","contr.poly"))
> 
> z

Call:  glm(formula = Freq ~ Reg66 + Reg71, family = poisson) 

Coefficients:
(Intercept)      Reg66GL      Reg66LY      Reg66WM      Reg71GL      Reg71LY  
     0.6134       3.9022       2.6900       2.8376       3.9597       2.7245  
    Reg71WM  
     2.8877  

Degrees of Freedom: 15 Total (i.e. Null);  9 Residual
Null Deviance:	    40740 
Residual Deviance: 19880 	AIC: 20000 
> print(zb <- glm(Freq~Reg66+Reg71,family=poisson))

Call:  glm(formula = Freq ~ Reg66 + Reg71, family = poisson) 

Coefficients:
(Intercept)       Reg661       Reg662       Reg663       Reg711       Reg712  
     5.3638      -2.3575       1.5448       0.3325      -2.3930       1.5667  
     Reg713  
     0.3315  

Degrees of Freedom: 15 Total (i.e. Null);  9 Residual
Null Deviance:	    40740 
Residual Deviance: 19880 	AIC: 20000 
> 

Additional comment: I recommend that the aic functions for poisson and
binomial have the explicit calculation of the log density replaced by
the corresponding d function with the log option. This will avoid the
production of NAs in certain cases of zeroes in tables.
  Jim

==> 771.audit <==
Tue Dec 26 10:30:46 2000	ripley	foobar
Tue Dec 26 10:30:46 2000	ripley	moved from incoming to Models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 758 *
Subject: Inconsistency, possibly a bug?
From: Brett Presnell <presnell@stat.ufl.edu>
Date: Mon, 4 Dec 2000 19:26:32 -0500 (EST)
--Fixed for 1.2.0 in the sense that lm/glm are now consistent, but would one want
--it the other way around?
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 758 <==
From presnell@stat.ufl.edu  Tue Dec  5 01:26:50 2000
Received: from stat.ufl.edu (minke.stat.ufl.edu [128.227.141.32])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA10691
	for <r-bugs@biostat.ku.dk>; Tue, 5 Dec 2000 01:26:49 +0100 (MET)
Received: from flounder.stat.ufl.edu (flounder [128.227.141.180])
	by stat.ufl.edu (8.9.1/8.9.1/daw) with ESMTP id TAA08868
	for <r-bugs@biostat.ku.dk>; Mon, 4 Dec 2000 19:27:01 -0500 (EST)
Received: (from presnell@localhost)
	by flounder.stat.ufl.edu (8.9.1/8.9.1) id TAA01751;
	Mon, 4 Dec 2000 19:26:33 -0500 (EST)
X-Authentication-Warning: flounder.stat.ufl.edu: presnell set sender to presnell@stat.ufl.edu using -f
From: Brett Presnell <presnell@stat.ufl.edu>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14892.13880.581365.266323@flounder.stat.ufl.edu>
Date: Mon, 4 Dec 2000 19:26:32 -0500 (EST)
To: r-bugs@biostat.ku.dk
Subject: Inconsistency, possibly a bug?
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: presnell@stat.ufl.edu


Seems to be a day for finding peculiar little things.  There is an
inconsistency in the behavior of lm vis a vis glm:

 > x <- rnorm(15)
 > y <- 1 + 10*x + rnorm(15)
 > z <- as.factor(rep(c("A","B","C"),rep(5,3)))
 > xyz <- data.frame(x,y,z)
 > fit.lm <- lm(y ~ x + z, data=xyz, subset=(z != "C"))
 > fit.glm <- glm(y ~ x + z, family=gaussian, data=xyz, subset=(z != "C"))
 > zz <- z[1:10]
 > xx <- rnorm(10)
 > predict(fit.lm,data.frame(x=xx,z=zz))
 Error in model.frame.default(formula, data, xlev = xlev) : 
 	  factor z has new level(s) C
 > predict(fit.glm,data.frame(x=xx,z=zz))
 	   1          2          3          4          5          6 
   2.570970 -18.007372  18.108771  12.498562   9.566029  10.518460 
 	   7          8          9         10 
  -9.132206  11.440242 -16.054621  -3.017842 


This happens because of the line

  mf$drop.unused.levels <- TRUE

in lm and the lack of same in glm.  I'm reporting this as a bug, but
perhaps the difference is intentional?

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.6
 arch = sparc
 os = solaris2.6
 system = sparc, solaris2.6
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-- 
Brett Presnell
Department of Statistics
University of Florida


==> 758.followup.1 <==
From ripley@stats.ox.ac.uk  Tue Dec  5 08:51:05 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA11854
	for <R-bugs@biostat.ku.dk>; Tue, 5 Dec 2000 08:51:05 +0100 (MET)
Received: from max115.public.ox.ac.uk (max115.public.ox.ac.uk [192.76.27.115])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id HAA19381;
	Tue, 5 Dec 2000 07:51:14 GMT
Date: Tue, 5 Dec 2000 07:51:16 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: presnell@stat.ufl.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Inconsistency, possibly a bug? (PR#758)
In-Reply-To: <200012050026.BAA10701@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10012050747500.21711-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Tue, 5 Dec 2000 presnell@stat.ufl.edu wrote:

> 
> Seems to be a day for finding peculiar little things.  There is an
> inconsistency in the behavior of lm vis a vis glm:
> 
>  > x <- rnorm(15)
>  > y <- 1 + 10*x + rnorm(15)
>  > z <- as.factor(rep(c("A","B","C"),rep(5,3)))
>  > xyz <- data.frame(x,y,z)
>  > fit.lm <- lm(y ~ x + z, data=xyz, subset=(z != "C"))
>  > fit.glm <- glm(y ~ x + z, family=gaussian, data=xyz, subset=(z != "C"))
>  > zz <- z[1:10]
>  > xx <- rnorm(10)
>  > predict(fit.lm,data.frame(x=xx,z=zz))
>  Error in model.frame.default(formula, data, xlev = xlev) : 
>  	  factor z has new level(s) C
>  > predict(fit.glm,data.frame(x=xx,z=zz))
>  	   1          2          3          4          5          6 
>    2.570970 -18.007372  18.108771  12.498562   9.566029  10.518460 
>  	   7          8          9         10 
>   -9.132206  11.440242 -16.054621  -3.017842 
> 
> 
> This happens because of the line
> 
>   mf$drop.unused.levels <- TRUE
> 
> in lm and the lack of same in glm.  I'm reporting this as a bug, but
> perhaps the difference is intentional?

No, as the glm code is not protected from user error as the lm code is. I
am not sure it is bug (it's not documented to happen) and probably there
are several related occurrences in other modelling functions, but it would
be a desirable addition and I will change it for glm (at least).


> 
> --please do not edit the information below--
> 
> Version:
>  platform = sparc-sun-solaris2.6
>  arch = sparc
>  os = solaris2.6
>  system = sparc, solaris2.6
>  status = 
>  major = 1
>  minor = 1.1
>  year = 2000
>  month = August
>  day = 15
>  language = R
> 
> Search Path:
>  .GlobalEnv, Autoloads, package:base
> 
> -- 
> Brett Presnell
> Department of Statistics
> University of Florida
> 
> 
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 758.followup.2 <==
From presnell@stat.ufl.edu  Thu Dec  7 00:57:22 2000
Received: from stat.ufl.edu (minke.stat.ufl.edu [128.227.141.32])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA04427
	for <R-bugs@biostat.ku.dk>; Thu, 7 Dec 2000 00:57:21 +0100 (MET)
Received: from flounder.stat.ufl.edu (flounder [128.227.141.180])
	by stat.ufl.edu (8.9.1/8.9.1/daw) with ESMTP id SAA28130;
	Wed, 6 Dec 2000 18:57:33 -0500 (EST)
Received: (from presnell@localhost)
	by flounder.stat.ufl.edu (8.9.1/8.9.1) id SAA04147;
	Wed, 6 Dec 2000 18:57:05 -0500 (EST)
X-Authentication-Warning: flounder.stat.ufl.edu: presnell set sender to presnell@stat.ufl.edu using -f
From: Brett Presnell <presnell@stat.ufl.edu>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14894.53832.544699.253589@flounder.stat.ufl.edu>
Date: Wed, 6 Dec 2000 18:56:56 -0500 (EST)
To: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Inconsistency, possibly a bug? (PR#758)
In-Reply-To: <Pine.GSO.4.05.10012050747500.21711-100000@auk.stats>
References: <200012050026.BAA10701@pubhealth.ku.dk>
	<Pine.GSO.4.05.10012050747500.21711-100000@auk.stats>
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: presnell@stat.ufl.edu


In message <Pine.GSO.4.05.10012050747500.21711-100000@auk.stats> you write:
> On Tue, 5 Dec 2000 presnell@stat.ufl.edu wrote:
> > 
> > This happens because of the line
> > 
> >   mf$drop.unused.levels <- TRUE
> > 
> > in lm and the lack of same in glm.  I'm reporting this as a bug, but
> > perhaps the difference is intentional?
> 
> No, as the glm code is not protected from user error as the lm code is. I
> am not sure it is bug (it's not documented to happen) and probably there
> are several related occurrences in other modelling functions, but it would
> be a desirable addition and I will change it for glm (at least).

Seeing the same topic come up on the Snews list prompted me to revisit
this. I will preface by admitting that it is not an big issue one way
or the other, since the "problem" is easy enough to work around
(although the poster on the Snews list apparently felt otherwise).

It is handy to fit a model to a data subset selected by the levels of
a factor z, and then to use the fit for prediction with new data which
of course does not include levels of z other than those used in the
fit (that's exactly what I was doing when I noticed the inconsistency
between lm and glm).

However, this is not always quite as easy as it might otherwise be
because:

1. lm (and now glm) removes the unused levels from the factor, and

2. predict.lm and predict.glm (or more precisely model.frame.default)
   check levels() for factors in newdata against those used in the
   fit,

3. as opposed to checking the levels ACTUALLY USED in the newdata.

Of course it is not difficult to remove the unused levels from the
factors in newdata, but it would be convenient if predict would do
this automatically, or at least if there was an option to do so.

So, am I missing something obvious, or would this be a good thing to
do?

-- 
Brett Presnell
Department of Statistics
University of Florida

==> 758.audit <==
Sun Dec 10 14:36:08 2000	pd	changed notes
Sun Dec 10 14:36:08 2000	pd	foobar
Sun Dec 10 14:36:08 2000	pd	moved from incoming to Models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 628 *
Subject: Re: [Rd] predict.lm is broken in 1.1.0-patched (2000-August-7)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Mon, 7 Aug 2000 22:41:50 +0100 (BST)
--We've fixed the predict() problem, but need to make coef.lm and coef.aov
--consistent
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 628 <==
From ripley@stats.ox.ac.uk  Mon Aug  7 23:41:48 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA03873;
	Mon, 7 Aug 2000 23:41:47 +0200 (MET DST)
Received: from max118.public.ox.ac.uk (max118.public.ox.ac.uk [192.76.27.118])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id WAA13377;
	Mon, 7 Aug 2000 22:42:04 +0100 (BST)
Date: Mon, 7 Aug 2000 22:41:50 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: thomas@biostat.washington.edu, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] predict.lm is broken in 1.1.0-patched (2000-August-7)
 (PR#627)
In-Reply-To: <x2og34232n.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.10008072237330.18074-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On 7 Aug 2000, Peter Dalgaard BSA wrote:

> thomas@biostat.washington.edu writes:
> 
> > > > coef.aov
> > > function (object, ...) 
> > > {
> > >     z <- object$coef
> > >     z[!is.na(z)]
> > > }
> > > > coef.lm 
> > > function (object, ...) 
> > > object$coefficients
> > 
> > Ok, this explains it.  I *did* test it with a singular fit, but only with
> > lm(), not with aov().
> > 
> > coef.lm seems a more sensible convention, since it's a lot easy to remove
> > the NAs than to add them.
> 
> I've committed a fix for predict.lm to use object$coefficients
> directly, but I haven't done anything with the coef() methods.

As far as I recall coef.aov is different for easier compatibility with S
output: coef.lm is definitely not compatible.  I think there should
probably be a distinction between the raw information in the object and the
information given by the coef accessor function, and each has its place.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 628.audit <==
Mon Aug 14 14:26:15 2000	pd	changed notes
Mon Aug 14 14:26:15 2000	pd	moved from incoming to Models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Startup

* PR# 486 *
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
--workaround to the origin problem in 1.0.1
--New report: try does not work from the profile.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 486 <==
From maechler@stat.math.ethz.ch  Tue Mar 14 10:32:36 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA17249
	for <R-bugs@biostat.ku.dk>; Tue, 14 Mar 2000 10:32:35 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA21252;
	Tue, 14 Mar 2000 10:32:48 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005C1; Tue Mar 14 10:32:44 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA03934; Tue, 14 Mar 2000 10:32:44 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14542.1851.731086.380@lynne.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
To: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Cc: R-bugs@stat.math.ethz.ch
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
 (PR#470)
In-Reply-To: <Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
References: <14532.56910.278837.379365@lynne.ethz.ch>
	<Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

    BDR> On Tue, 7 Mar 2000, Martin Maechler wrote:
    >> >>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
    >> 
    BDR> On Tue, 7 Mar 2000, Trenkler, Dietrich wrote:
    >> >> I think I've discovered what went wrong.
    >> >> 
    >> >> My workspace included a function wilcox.test formerly copied from
    >> >> ctest. Now ctest ist part of the distribution and because of that I
    >> >> always got the message:
    >> >> 
    >> >> [Previously saved workspace restored]
    >> >> 
    >> >> Error in autoload("wilcox.test", "ctest") :
    >> >> Object already exists
    >> >> 
    >> >> I didn't take care of this message. Now I removed wilcox.test, saved
    >> >> the WS, restarted R without the vanilla-option and alas, anova
    >> >> now works.
    >> >> 
    >> >> It seems that R stops initializing after encountering the error
    >> >> mentioned above. Is this correct?   
    >> 
    BDR> Yes, in that the rest of the system Rprofile file is skipped
    BDR> and hence options show.signif.stars and show.coef.Pvalues are not set.
    >> but other options as well..
    >> I think this shouldn't happen and *is* a bug.

    BDR> It looks to me as if a bit more protection is needed in print.coefmat,
    BDR> at least.

	 which Brian has implemented in the mean time.

	 ....

    >> For the 1.0.x patches, at least, I'll move the autoload()'s to the end of
    >> profile/Common.R

    BDR> I _think_ they should have try() around them, which is what S-PLUS 
    BDR> now does with all startup code.

I tried this, but it does not work :

try(autoload(..)) works okay when used after startup, but not *during*
startup.  However, I'll put a workaround into Common.R

Should this {try(.) not working during startup} be another bug report ?

Martin

==> 486.audit <==
Sat Mar 25 09:44:47 2000	maechler	moved from incoming to Startup
Sat Apr 08 07:41:36 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  System-specific

* PR# 762 *
Subject: nmath bug
From: spoon <spoon@hilbert.maths.utas.edu.au>
Date: Fri, 8 Dec 2000 18:29:22 +1100 (EST)
--RedHat 7 has known compiler trouble, probably not bug
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 762 <==
From spoon@hilbert.maths.utas.edu.au  Fri Dec  8 08:29:50 2000
Received: from hilbert.maths.utas.edu.au (hilbert.maths.utas.edu.au [131.217.60.3])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA20134
	for <r-bugs@biostat.ku.dk>; Fri, 8 Dec 2000 08:29:47 +0100 (MET)
Received: (from spoon@localhost) by hilbert.maths.utas.edu.au (8.7.6/8.7.3) id SAA14968 for r-bugs@biostat.ku.dk; Fri, 8 Dec 2000 18:29:22 +1100 (EST)
From: spoon <spoon@hilbert.maths.utas.edu.au>
Message-Id: <200012080729.SAA14968@hilbert.maths.utas.edu.au>
Subject: nmath bug
To: r-bugs@biostat.ku.dk
Date: Fri, 8 Dec 2000 18:29:22 +1100 (EST)
X-Mailer: ELM [version 2.5 PL3]
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Hi,
	I've been playing with the standalone math library (R.1.1.1,
Redhat 7 i386), and have detected a problem with rpois.


Basically, the rejection step in rpois can result in an infinite loop.
The simplest thing I can come up with that reproduces the problem is
the following.


#include <stdio.h>
#include <math.h>
#include <time.h>

#define MATHLIB_STANDALONE
#include "Mathlib.h"

int main() {
  double d;

  set_seed(976259805U,2968367341U);

  for(long k=0; k<10; k++) {
    for(long k=0; k<10000; k++) d = rpois(4500);
    for(long k=0; k<250000; k++) d = rpois(100);
    printf(".");
    fflush(stdout);
  }
}

Fro me this prints 3 dots and then hangs.

I realize calling rpois with means this large is probably not the
wisest thing to do, nevertheless, I still consider the infinite loop
to be a bug, hence this report.

Sorry that I cannot give a simpler example than this, its taken me
quite a while to get this far, and as my debugging efforts were going
nowhere, I thought it better to throw it out to the wider community.

Simon




-- 
*****************************************************************
*  Simon Wotherspoon                               _--_|\       *
*  Maths Dept, University of Tasmania             /  Aus \      *
*  Tasmania, Australia                            \_.--._/      *
*  spoon@hilbert.maths.utas.edu.au                      v       *
*****************************************************************


==> 762.reply.1 <==
From pd@biostat.ku.dk  Fri Dec  8 11:32:54 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA23487;
	Fri, 8 Dec 2000 11:32:53 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id LAA02114;
	Fri, 8 Dec 2000 11:38:30 +0100
Sender: pd@blueberry.kubism.ku.dk
To: spoon@hilbert.maths.utas.edu.au
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] nmath bug (PR#762)
References: <200012080729.IAA20144@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 Dec 2000 11:38:29 +0100
In-Reply-To: spoon@hilbert.maths.utas.edu.au's message of "Fri, 8 Dec 2000 08:29:51 +0100 (MET)"
Message-ID: <x23dfzp596.fsf@blueberry.kubism.ku.dk>
Lines: 23
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

spoon@hilbert.maths.utas.edu.au writes:

> Hi,
> 	I've been playing with the standalone math library (R.1.1.1,
> Redhat 7 i386), and have detected a problem with rpois.
> 
> 
> Basically, the rejection step in rpois can result in an infinite loop.
> The simplest thing I can come up with that reproduces the problem is
> the following.

Hmm. There are bugs in rpois from 1.1.1 *and* compiler bugs in redhat7
that are known to affect rpois...

In order to get something that has a decent chance of working you
should probably use a *very* recent gcc from the rawhide distribution,
and try a snapshot of 1.2.0. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 762.followup.1 <==
From plummer@iarc.fr  Fri Dec  8 14:20:30 2000
Received: from smtp02.iarc.fr (IDENT:root@[212.157.236.236])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA26659;
	Fri, 8 Dec 2000 14:20:27 +0100 (MET)
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id OAA11017;
	Fri, 8 Dec 2000 14:20:46 +0100
Message-ID: <XFMail.001208142217.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
In-Reply-To: <x23dfzp596.fsf@blueberry.kubism.ku.dk>
Date: Fri, 08 Dec 2000 14:22:17 +0100 (CET)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Subject: Re: [Rd] nmath bug (PR#762)
Cc: R-bugs@biostat.ku.dk, r-devel@stat.math.ethz.ch,
        spoon@hilbert.maths.utas.edu.au

On 08-Dec-00 Peter Dalgaard BSA wrote:
> spoon@hilbert.maths.utas.edu.au writes:
> 
>> Hi,
>>      I've been playing with the standalone math library (R.1.1.1,
>> Redhat 7 i386), and have detected a problem with rpois.
>> 
>> 
>> Basically, the rejection step in rpois can result in an infinite loop.
>> The simplest thing I can come up with that reproduces the problem is
>> the following.
> 
> Hmm. There are bugs in rpois from 1.1.1 *and* compiler bugs in redhat7
> that are known to affect rpois...
> 
> In order to get something that has a decent chance of working you
> should probably use a *very* recent gcc from the rawhide distribution,
> and try a snapshot of 1.2.0.

To be precise, you will need gcc-2.96-65 from the rawhide distribution.
However, this does not seem to have been released yet: I just checked on
ftp.redhat.com and the latest release is -64.

For details see
http://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=21423

Alternatively you can install gcc-2.95 (the latest *stable* compiler from
the gcc development team), which does not suffer from this bug.  If you want
to do this, look in the directory bin/linux/redhat/7.x/DIY/ on CRAN for
some tips.

Martyn

==> 762.audit <==
Sun Dec 10 14:50:08 2000	pd	changed notes
Sun Dec 10 14:50:08 2000	pd	foobar
Sun Dec 10 14:50:08 2000	pd	moved from incoming to Low-level
Thu Dec 28 10:44:51 2000	ripley	changed notes
Thu Dec 28 10:44:51 2000	ripley	foobar
Thu Dec 28 10:44:51 2000	ripley	moved from Low-level to System-specific
Thu Dec 28 10:45:19 2000	ripley	changed notes
Thu Dec 28 10:45:19 2000	ripley	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 521 *
Subject: akima core dumps on loading
From: santini@dsi.unimi.it
Date: Mon, 17 Apr 2000 11:30:41 +0200 (MET DST)
--Probably compiler-specific
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 521 <==
From santini@dsi.unimi.it  Mon Apr 17 11:30:42 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA01559
	for <R-bugs@biostat.ku.dk>; Mon, 17 Apr 2000 11:30:41 +0200 (MET DST)
Date: Mon, 17 Apr 2000 11:30:41 +0200 (MET DST)
From: santini@dsi.unimi.it
Message-Id: <200004170930.LAA01559@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: akima core dumps on loading

Full_Name: Massimo santini
Version: 1.0.1
OS: Linux
Submission from: (NULL) (159.149.147.89)


I've just dl the .rpm of R 1.0.1, installed it and then launched 

	insatll.packages("akima")

after re-launching R [--vanilla], the command

	library(akima)

has the only effect to coredump the program. Here is the output of gdb and
strace...

--- GDB (commands given can be seen from the except)

$ R -d gdb
GNU gdb 19991004
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...
(gdb) run --vanilla
Starting program: /usr/lib/R/bin/R.X11 --vanilla

R : Copyright 2000, The R Development Core Team
Version 1.0.1  (April 14, 2000)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type	"?license" or "?licence" for distribution details.

R is a collaborative project with many contributors.
Type	"?contributors" for a list.

Type	"demo()" for some demos, "help()" for on-line help, or
    	"help.start()" for a HTML browser interface to help.
Type	"q()" to quit R.

> library(akima)

Program received signal SIGSEGV, Segmentation fault.
_dl_lookup_symbol (undef_name=0x2d2e3b3 <Address 0x2d2e3b3 out of bounds>,
ref=0xbfffabb4, 
    symbol_scope=0x81ec65c, reference_name=0x81e8b20
"/usr/lib/R/library/akima/libs/akima.so", reloc_type=208)
    at ../sysdeps/generic/dl-hash.h:31
31	../sysdeps/generic/dl-hash.h: No such file or directory.
(gdb) 

--- STRACE (echo "library(akima)" | strace R --vanilla)

[...]
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
stat("/usr/lib/R/library/akima/libs/akima.so", {st_mode=S_IFREG|0755,
st_size=289367, ...}) = 0
stat("/usr/lib/R/library/base/libs/akima.so", 0xbfffdb60) = -1 ENOENT (No such
file or directory)
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
open("/usr/lib/R/library/akima/libs/akima.so", O_RDONLY) = 4
fstat(4, {st_mode=S_IFREG|0755, st_size=289367, ...}) = 0
read(4, "\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0000F\0\000"..., 4096) =
4096
old_mmap(NULL, 115364, PROT_READ|PROT_EXEC, MAP_PRIVATE, 4, 0) = 0x40f3d000
mprotect(0x40f55000, 17060, PROT_NONE)  = 0
old_mmap(0x40f55000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 4,
0x17000) = 0x40f55000
old_mmap(0x40f57000, 8868, PROT_READ|PROT_WRITE,
MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x40f57000
close(4)                                = 0
mprotect(0x40f3d000, 98304, PROT_READ|PROT_WRITE) = 0
--- SIGSEGV (Segmentation fault) ---
+++ killed by SIGSEGV +++

==> 521.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon Apr 17 12:00:35 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA01944
	for <R-bugs@biostat.ku.dk>; Mon, 17 Apr 2000 12:00:35 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id MAA31083;
	Mon, 17 Apr 2000 12:03:19 +0200
Sender: pd@blueberry.kubism.ku.dk
To: santini@dsi.unimi.it
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] akima core dumps on loading (PR#521)
References: <200004170930.LAA01569@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 17 Apr 2000 12:03:19 +0200
In-Reply-To: santini@dsi.unimi.it's message of "Mon, 17 Apr 2000 11:30:43 +0200 (MET DST)"
Message-ID: <x2zoqtkpso.fsf@blueberry.kubism.ku.dk>
Lines: 52
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

santini@dsi.unimi.it writes:

> Full_Name: Massimo santini
> Version: 1.0.1
> OS: Linux
> Submission from: (NULL) (159.149.147.89)
> 
> 
> I've just dl the .rpm of R 1.0.1, installed it and then launched 
> 
> 	insatll.packages("akima")
> 
> after re-launching R [--vanilla], the command
> 
> 	library(akima)
> 
> has the only effect to coredump the program. Here is the output of gdb and
> strace...

Hmm. Doesn't happen here. (BTW: Remember to include as much
information about your system as you can think of. It's not obvious
whether you're running RedHat or SuSE for instance and in what
version.) 

> Program received signal SIGSEGV, Segmentation fault.
> _dl_lookup_symbol (undef_name=0x2d2e3b3 <Address 0x2d2e3b3 out of bounds>,
> ref=0xbfffabb4, 
>     symbol_scope=0x81ec65c, reference_name=0x81e8b20
> "/usr/lib/R/library/akima/libs/akima.so", reloc_type=208)
>     at ../sysdeps/generic/dl-hash.h:31
> 31	../sysdeps/generic/dl-hash.h: No such file or directory.
> (gdb) 
> 
> --- STRACE (echo "library(akima)" | strace R --vanilla)
> 
> [...]
> rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
> stat("/usr/lib/R/library/akima/libs/akima.so", {st_mode=S_IFREG|0755,
> st_size=289367, ...}) = 0
> stat("/usr/lib/R/library/base/libs/akima.so", 0xbfffdb60) = -1 ENOENT (No such
> file or directory)

This would seem to be the problem: the dynamic library isn't there.
Did you get any error messages while compiling the package? (Except
for "...might be used uninitialized..." of which there are quite a few
here too).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 521.reply.2 <==
From pd@blueberry.kubism.ku.dk  Mon Apr 17 15:47:37 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA05177
	for <r-bugs@biostat.ku.dk>; Mon, 17 Apr 2000 15:47:36 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id PAA31429;
	Mon, 17 Apr 2000 15:50:37 +0200
Sender: pd@blueberry.kubism.ku.dk
To: Massimo Santini <santini@dsi.unimi.it>
Subject: Re: [Rd] akima core dumps on loading (PR#521)
Cc: r-bugs@biostat.ku.dk
References: <Pine.LNX.4.21.0004171357340.30022-100000@zorn.usr.dsi.unimi.it>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 17 Apr 2000 15:50:36 +0200
In-Reply-To: Massimo Santini's message of "Mon, 17 Apr 2000 14:00:28 +0200 (CEST)"
Message-ID: <x2snwkalar.fsf@blueberry.kubism.ku.dk>
Lines: 80
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Massimo Santini <santini@dsi.unimi.it> writes:

> > Hmm. Doesn't happen here. (BTW: Remember to include as much
> > information about your system as you can think of. It's not obvious
> > whether you're running RedHat or SuSE for instance and in what
> > version.) 
> 
> You are perfectly right. My system is an updated RedHat 6.2.

Same here...

> > > stat("/usr/lib/R/library/akima/libs/akima.so", {st_mode=S_IFREG|0755,
> > > st_size=289367, ...}) = 0
> > > stat("/usr/lib/R/library/base/libs/akima.so", 0xbfffdb60) = -1 ENOENT (No such
> > > file or directory)
> > 
> > This would seem to be the problem: the dynamic library isn't there.
> > Did you get any error messages while compiling the package? (Except
> > for "...might be used uninitialized..." of which there are quite a few
> > here too).
> 
> Non errors during the installation phase. The akima.so library is in 
> 
> 	/usr/lib/R/library/akima/libs/akima.so
> 
> where it should be (with correct premissions), but is not in
> 
> 	/usr/lib/R/library/base/libs/akima.so
> 
> (the dir /usr/lib/R/library/base/libs is missing, to be precise).

Oh. Didn't see that. Then that part is OK. Sorry.

> Have you some hint about what to do now?

Hmmm. Interesting: I can provoke the crash on *my other* RedHat6.2
computer (the one still running the egcs compiler). My stack trace says

#0  _dl_lookup_symbol (
    undef_name=0xcbf203b4 <Address 0xcbf203b4 out of bounds>,
    ref=0xbfffb234, 
    symbol_scope=0x81d3cac, 
    reference_name=0x81d3a60
    "/usr/local/src/misc/r-release/BUILD/library/akima/libs/akima.so",
    reloc_type=64) at ../sysdeps/generic/dl-hash.h:31
#1  0x400096ad in _dl_relocate_object (l=0x81d3aa8, scope=0x81d3cac, lazy=0, 
    consider_profiling=0) at ../sysdeps/i386/dl-machine.h:326
#2  0x40255be4 in dl_open_worker (a=0xbfffb3a0) at dl-open.c:182
#3  0x4000ac3b in _dl_catch_error (errstring=0xbfffb39c, 
    operate=0x40255990 <dl_open_worker>, args=0xbfffb3a0) at dl-error.c:141
#4  0x40255d3d in _dl_open (
    file=0xbfffc51c 
"/usr/local/src/misc/r-release/BUILD/library/akima/libs/akima.so",
mode=2, caller=0xbfffb39c) at dl-open.c:232
#5  0x401323d3 in dlopen_doit (a=0xbfffb4b0) at dlopen.c:41
#6  0x4000ac3b in _dl_catch_error (errstring=0x40134080, 
    operate=0x401323a8 <dlopen_doit>, args=0xbfffb4b0) at
dl-error.c:141
#7  0x401328b9 in _dlerror_run (operate=0x401323a8 <dlopen_doit>, 
    args=0xbfffb4b0) at dlerror.c:125
#8  0x40132393 in __dlopen_check (
    file=0xbfffc51c
"/usr/local/src/misc/r-release/BUILD/library/akima/libs/akima.so",
mode=2) at dlopen.c:53
#9  0x80d9cc3 in AddDLL (
    path=0xbfffc51c
"/usr/local/src/misc/r-release/BUILD/library/akima/libs/akim
a.so", asLocal=1, now=1) at ../../../R/src/unix/dynload.c:207


Looks like it is happening during the dynamic linking itself. Doesn't
look nice. (But installing gcc 2.95.2 might fix your problem.)

[diverted back to r-bugs]

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 521.audit <==
Tue Apr 25 07:04:44 2000	ripley	changed notes
Tue Apr 25 07:04:44 2000	ripley	moved from incoming to Add-ons
Wed Jun 07 15:09:34 2000	pd	moved from Add-ons to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 452 *
Subject: problem with glm
From: Brad McNeney <mcneney@cs.sfu.ca>
Date: Fri, 18 Feb 2000 17:51:54 -0800 (PST)
--Problems on Alpha's with glm. Status unclear
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 452 <==
From mcneney@cs.sfu.ca  Sat Feb 19 02:51:57 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id CAA15326
	for <R-bugs@biostat.ku.dk>; Sat, 19 Feb 2000 02:51:56 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id CAA05839
	for <r-bugs@stat.math.ethz.ch>; Sat, 19 Feb 2000 02:52:05 +0100 (MET)
Received: from cs.sfu.ca(142.58.111.1)
 via SMTP by hypatia, id smtpdAAAa001RB; Sat Feb 19 02:51:57 2000
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id RAA10291
	for <r-bugs@stat.math.ethz.ch>; Fri, 18 Feb 2000 17:51:55 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id RAA0000400367; Fri, 18 Feb 2000 17:51:54 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Fri, 18 Feb 2000 17:51:54 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: r-bugs@stat.math.ethz.ch
Subject: problem with glm
Message-ID: <Pine.OSF.4.21.0002181750080.400767-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

I'm having sporadic problems with glm on my alpha workstation running
Compaq Tru64 UNIX V5.0 (I can't replicate the problem on my Linux PC). I
have the same problem whether I use a version of R built with the native
C-compiler or a version compiled with gcc. In both cases I've built with
g77.

I want to do some simulations with a call to glm in each rep. A simplified
version would be something like:

N_100; NREPS_100; lam.e_5; logit.inv_function(x){ exp(x)/(1+exp(x)) }
for(i in (1:NREPS)) {
   cat(paste("REP",i,"\n"))
   T_rexp(N,(lam.e))
   Delta_rbinom(N,1,logit.inv(1+T))
   ff_glm(Delta ~ T,family=binomial(logit))
}
 
It often completes all reps, but I occasionally get errors related to
lengths of various objects, etc.:

REP 1 
REP 2
<snip>
REP 9 
Error in model.matrix(t, data) : variable lengths differ


REP 1 
<snip>
REP 53 
Error: subscript out of bounds

REP 1 
<snip>
REP 41 
Error in model.matrix(t, data) : invalid variable type

Different error messages, different numbers of reps. When I call glm again
using the values of T and Delta just before the error, it runs error-free.
When I put the data in a data frame before calling glm I can also get
messages like:

REP 1 
<snip>
REP 64 
Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  : 
        invalid variable type


--please do not edit the information below--

Version:
 platform = alpha-dec-osf5.0
 arch = alpha
 os = osf5.0
 system = alpha, osf5.0
 status = Patched
 major = 0
 minor = 99.0
 year = 2000
 month = February
 day = 9
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-------------------------------------------------------------------------
Brad McNeney                               email: mcneney@stat.sfu.ca
Department of Mathematics and Statistics   web: www.math.sfu.ca/~mcneney/
Simon Fraser University                    phone: 604.291.4815
8888 University Drive                      fax: 604.291.4947
Burnaby, British Columbia
Canada V5A 1S6


==> 452.reply.1 <==
From pd@biostat.ku.dk  Sat Feb 19 13:57:47 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA16134;
	Sat, 19 Feb 2000 13:57:46 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id NAA30569;
	Sat, 19 Feb 2000 13:59:28 +0100
Sender: pd@blueberry.kubism.ku.dk
To: mcneney@cs.sfu.ca
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <200002190151.CAA15336@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 19 Feb 2000 13:59:27 +0100
In-Reply-To: mcneney@cs.sfu.ca's message of "Sat, 19 Feb 2000 02:51:58 +0100 (MET)"
Message-ID: <x24sb5l55c.fsf@blueberry.kubism.ku.dk>
Lines: 47
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mcneney@cs.sfu.ca writes:

> N_100; NREPS_100; lam.e_5; logit.inv_function(x){ exp(x)/(1+exp(x)) }
> for(i in (1:NREPS)) {
>    cat(paste("REP",i,"\n"))
>    T_rexp(N,(lam.e))
>    Delta_rbinom(N,1,logit.inv(1+T))
>    ff_glm(Delta ~ T,family=binomial(logit))
> }
>  
> It often completes all reps, but I occasionally get errors related to
> lengths of various objects, etc.:
...
> --please do not edit the information below--
> 
> Version:
>  platform = alpha-dec-osf5.0
>  arch = alpha
>  os = osf5.0
>  system = alpha, osf5.0
>  status = Patched
>  major = 0
>  minor = 99.0
>  year = 2000
>  month = February
>  day = 9
>  language = R
> 
> Search Path:
>  .GlobalEnv, Autoloads, package:base

I just did the above ~10 times on i386 and nothing happened. We've had
previous reports on trouble in the lm/glm/model.matrix etc. region on
Alpha. 

If you compile with all warnings on, are you getting warnings on
pointer/integer comparisons or assignments?

Can you create a reproducible case (with set.seed to keep the random
generator sequence constant) and would you know how run a debugger on
your version so that we can figure out what is going wrong?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.followup.1 <==
From mcneney@cs.sfu.ca  Sun Feb 20 05:11:05 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id FAA17753;
	Sun, 20 Feb 2000 05:11:03 +0100 (MET)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id UAA15662;
	Sat, 19 Feb 2000 20:11:12 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id UAA0000433332; Sat, 19 Feb 2000 20:11:12 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sat, 19 Feb 2000 20:11:12 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <x24sb5l55c.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


> If you compile with all warnings on, are you getting warnings on
> pointer/integer comparisons or assignments?
> 

Yes, all the ones in regex.c that Doug mentioned. Here's a sample
of these and others (warnings related to graphics/X stuff have been
omitted):

uncmin.c: In function `lltslv':
uncmin.c:281: warning: type mismatch in implicit declaration for built-in
function `memcpy'
character.c: In function `stripchars':
character.c:269: warning: subscript has type `char'
character.c:281: warning: subscript has type `char'
character.c:296: warning: subscript has type `char'
character.c:296: warning: subscript has type `char'
character.c:304: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:320: warning: subscript has type `char'
character.c:320: warning: subscript has type `char'
character.c:330: warning: subscript has type `char'
character.c:330: warning: subscript has type `char'
character.c:341: warning: subscript has type `char'
character.c: In function `do_makenames':
character.c:384: warning: subscript has type `char'
character.c:395: warning: subscript has type `char'
/usr/share/misc/bison.simple: In function `Rf_yyparse':
/usr/share/misc/bison.simple:254: warning: `yyval' might be used
uninitialized in this function
regex.c: In function `re_match_2':
regex.c:3770: warning: cast from pointer to integer of different size
regex.c:3770: warning: cast from pointer to integer of different size
regex.c:3776: warning: cast to pointer from integer of different size
regex.c:3776: warning: cast to pointer from integer of different size
regex.c:3923: warning: cast to pointer from integer of different size
regex.c:3923: warning: cast to pointer from integer of different size
regex.c:3976: warning: cast to pointer from integer of different size
regex.c:3976: warning: cast to pointer from integer of different size
regex.c:4082: warning: cast from pointer to integer of different size
regex.c:4083: warning: cast from pointer to integer of different size
regex.c:4115: warning: cast to pointer from integer of different size
regex.c:4115: warning: cast to pointer from integer of different size
regex.c:4128: warning: cast to pointer from integer of different size
regex.c:4128: warning: cast to pointer from integer of different size
regex.c:4296: warning: cast from pointer to integer of different size
regex.c:4297: warning: cast from pointer to integer of different size
saveload.c:495: warning: `BinarySave' defined but not used
saveload.c:1775: warning: `NewBinarySave' defined but not used


I'll see what I can do about getting a more reproducible error. 

Any tips on what to look for if I'm running R within GDB? I don't have
much experience with the debugger. I mostly just use it to see where my
programs are dying. But R is not -- it just gives strange error messages.

TIA,
Brad


==> 452.followup.2 <==
From ripley@stats.ox.ac.uk  Sun Feb 20 09:33:06 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA17966;
	Sun, 20 Feb 2000 09:33:05 +0100 (MET)
Received: from max168.public.ox.ac.uk (max168.public.ox.ac.uk [192.76.27.168])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id IAA20341;
	Sun, 20 Feb 2000 08:33:06 GMT
Date: Sun, 20 Feb 2000 08:32:05 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: Brad McNeney <mcneney@cs.sfu.ca>
cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
Message-ID: <Pine.GSO.4.05.10002200807420.5046-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Sat, 19 Feb 2000, Brad McNeney wrote:

> 
> > If you compile with all warnings on, are you getting warnings on
> > pointer/integer comparisons or assignments?
> > 
> 
> Yes, all the ones in regex.c that Doug mentioned. Here's a sample
> of these and others (warnings related to graphics/X stuff have been
> omitted):

(Two suggestions which are in the current snapshot follow. Looks like
what is which header varies a bit.)

> uncmin.c: In function `lltslv':
> uncmin.c:281: warning: type mismatch in implicit declaration for built-in
> function `memcpy'

Add a line (third one here) to src/include/R_ext/RS.h:

#ifndef R_RS_H
#define R_RS_H

#include <string.h> /* for memcpy */
#include "Rconfig.h" /* for F77_SYMBOL */


> character.c: In function `stripchars':
> character.c:269: warning: subscript has type `char'
> character.c:281: warning: subscript has type `char'
> character.c:296: warning: subscript has type `char'
> character.c:296: warning: subscript has type `char'
> character.c:304: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:320: warning: subscript has type `char'
> character.c:320: warning: subscript has type `char'
> character.c:330: warning: subscript has type `char'
> character.c:330: warning: subscript has type `char'
> character.c:341: warning: subscript has type `char'
> character.c: In function `do_makenames':
> character.c:384: warning: subscript has type `char'
> character.c:395: warning: subscript has type `char'
> /usr/share/misc/bison.simple: In function `Rf_yyparse':
> /usr/share/misc/bison.simple:254: warning: `yyval' might be used
> uninitialized in this function

Those are all normal.

> regex.c: In function `re_match_2':
> regex.c:3770: warning: cast from pointer to integer of different size
> regex.c:3770: warning: cast from pointer to integer of different size

That looks like a regex bug, with a why? comment in the code. Change
(int) to (long), twice.

> regex.c:3776: warning: cast to pointer from integer of different size
> regex.c:3776: warning: cast to pointer from integer of different size
> regex.c:3923: warning: cast to pointer from integer of different size
> regex.c:3923: warning: cast to pointer from integer of different size
> regex.c:3976: warning: cast to pointer from integer of different size
> regex.c:3976: warning: cast to pointer from integer of different size
> regex.c:4082: warning: cast from pointer to integer of different size
> regex.c:4083: warning: cast from pointer to integer of different size
> regex.c:4115: warning: cast to pointer from integer of different size
> regex.c:4115: warning: cast to pointer from integer of different size
> regex.c:4128: warning: cast to pointer from integer of different size
> regex.c:4128: warning: cast to pointer from integer of different size
> regex.c:4296: warning: cast from pointer to integer of different size
> regex.c:4297: warning: cast from pointer to integer of different size

I've never seen those, but try adding

#define STDC_HEADERS 1

at the top of regex.c.  (I am not convinced that is the cause here.)

> saveload.c:495: warning: `BinarySave' defined but not used
> saveload.c:1775: warning: `NewBinarySave' defined but not used

Normal, on a platform with xdr.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 452.reply.2 <==
From pd@biostat.ku.dk  Sun Feb 20 13:28:12 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA18510;
	Sun, 20 Feb 2000 13:28:12 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id NAA31926;
	Sun, 20 Feb 2000 13:30:08 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Brad McNeney <mcneney@cs.sfu.ca>
Cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 20 Feb 2000 13:30:07 +0100
In-Reply-To: Brad McNeney's message of "Sat, 19 Feb 2000 20:11:12 -0800 (PST)"
Message-ID: <x2snyogipc.fsf@blueberry.kubism.ku.dk>
Lines: 34
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Brad McNeney <mcneney@cs.sfu.ca> writes:

> I'll see what I can do about getting a more reproducible error. 
> 
> Any tips on what to look for if I'm running R within GDB? I don't have
> much experience with the debugger. I mostly just use it to see where my
> programs are dying. But R is not -- it just gives strange error messages.

One technique is to set a breakpoint at the line that displays the
error, then you can inspect the condition that caused it (you may have
to go "up" a couple of times to get into an interesting environment.)

Sometimes, it turns out that a variable contains something that it
shouldn't due to memory corruption and then you may have to set a
breakpoint earlier in the code and then maybe a watchpoint on the
memory location.

Another thing that is useful even without gdb is to investigate the
output of traceback() and maybe set 

options(error=quote(DUMP <<- sys.status()))

which allows you to subsequently investigate any active environment at
the time of the error, e.g. using ls(envir=DUMP$sys.frames[[3]]), and
get("x",envir=DUMP$sys.frames[[3]]).

(Newer snapshots have a more elaborate dump.frames function, but the
above should do). 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.audit <==
Sun Feb 20 21:27:15 2000	ripley	moved from incoming to System-specific
Mon Feb 28 17:30:41 2000	pd	changed notes

==> 452.followup.3 <==
From mcneney@cs.sfu.ca  Sat Mar  4 19:23:48 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA25981;
	Sat, 4 Mar 2000 19:23:42 +0100 (MET)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id KAA07172;
	Sat, 4 Mar 2000 10:23:52 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id KAA0000263254; Sat, 4 Mar 2000 10:23:52 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sat, 4 Mar 2000 10:23:52 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <x2snyogipc.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0003041022320.263210-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

I looked into the glm problem some more. Seems to be a memory problem that
occurs just after garbage collection. The easiest way for me to
reproduce  the error is in lapply. I take a list and ask lapply to provide
the descriptive stat summary. I do this several times with the same list.
Most often it gives the correct summary, but just after allocSExp calls
R_gc, one of the summaries for a list element will be NULL. 

E.g for a data frame dat with five columns I get the following (having added
print statements in summary.default and in allocSExp just after the test
for whether gc is necessary):

> lapply(as.list(dat), summary, maxsum = maxsum)
[1] "exiting summary.default"
R_FreeSEXP == NULL  
[1] "exiting summary.default"
[1] "exiting summary.default"
[1] "exiting summary.default"
[1] "exiting summary.default"
$Delta
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    1.00    1.19    2.00    2.00 

$D
NULL

$R
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    1.00    0.86    1.00    1.00 

$V
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.004552 0.740700 1.575000 1.754000 3.205000 3.390000 

$X
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0     0.0     0.5     0.5     1.0     1.0 


I don't know if the following is relevant, but for some reason I've found 
I can avoid this particular problem if I make a small change in lapply in 
its main loop.  Around line 50 of apply.c:

    PROTECT(ans = allocVector(VECSXP, n));
    for(i = 0; i < n; i++) {
        INTEGER(ind)[0] = i + 1;
        VECTOR(ans)[i] = eval(R_fcall, rho);
    }

if I change it to make an assignment to a
temporary variable first everything seems to work fine:

    PROTECT(ans = allocVector(VECSXP, n));
    for(i = 0; i < n; i++) {
        INTEGER(ind)[0] = i + 1;
        tem = eval(R_fcall, rho);
        VECTOR(ans)[i] = tem;
    }

hasn't given me any NULLs yet. 



On 20 Feb 2000, Peter Dalgaard BSA wrote:

> Brad McNeney <mcneney@cs.sfu.ca> writes:
> 
> > I'll see what I can do about getting a more reproducible error. 
> > 


==> 452.reply.3 <==
From pd@biostat.ku.dk  Sun Mar  5 01:02:38 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26687;
	Sun, 5 Mar 2000 01:02:37 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA17617;
	Sun, 5 Mar 2000 01:03:15 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Brad McNeney <mcneney@cs.sfu.ca>
Cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <Pine.OSF.4.21.0003041022320.263210-100000@smahlt.math.sfu.ca>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 05 Mar 2000 01:03:15 +0100
In-Reply-To: Brad McNeney's message of "Sat, 4 Mar 2000 10:23:52 -0800 (PST)"
Message-ID: <x2putauvuk.fsf@blueberry.kubism.ku.dk>
Lines: 47
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Brad McNeney <mcneney@cs.sfu.ca> writes:

> I don't know if the following is relevant, but for some reason I've found 
> I can avoid this particular problem if I make a small change in lapply in 
> its main loop.  Around line 50 of apply.c:
> 
>     PROTECT(ans = allocVector(VECSXP, n));
>     for(i = 0; i < n; i++) {
>         INTEGER(ind)[0] = i + 1;
>         VECTOR(ans)[i] = eval(R_fcall, rho);
>     }
> 
> if I change it to make an assignment to a
> temporary variable first everything seems to work fine:
> 
>     PROTECT(ans = allocVector(VECSXP, n));
>     for(i = 0; i < n; i++) {
>         INTEGER(ind)[0] = i + 1;
>         tem = eval(R_fcall, rho);
>         VECTOR(ans)[i] = tem;
>     }
> 
> hasn't given me any NULLs yet. 

Now that is pretty darn odd... Looks quite a bit like a compiler bug.
Those two pieces of code should be equivalent as far as I can see.

One thing that you might do: objdump -dS apply.o allows you to see
what code the compiler generates for the two cases. Also, of course,
you can try reducing the level of optimization.


Alternatively, the mere addition of "tem" changes the local memory use
of that function so that something that got clobbered before doesn't
get clobbered now.

The effect doesn't seem to be present on Intels:

> dfr<-do.call("data.frame",lapply(1:100,function(i)rnorm(100)))
> any(sapply(lapply(dfr,summary),is.null))
[1] FALSE

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.followup.4 <==
From mcneney@cs.sfu.ca  Mon May 22 03:22:00 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id DAA14134;
	Mon, 22 May 2000 03:21:55 +0200 (MET DST)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id SAA09685;
	Sun, 21 May 2000 18:22:13 -0700 (PDT)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id SAA0000086979; Sun, 21 May 2000 18:22:12 -0700 (PDT)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sun, 21 May 2000 18:22:12 -0700 (PDT)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] memory problem with DEC C (was: problem with glm (PR#452))
In-Reply-To: <x2putauvuk.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0005211817440.86959-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Just to update: What I originally thought was a glm problem appears to be
a memory problem that occurs only when R is compiled with the DEC C
compiler. Some variables that are still in use get clobbered during
garbage collection. No problems if I compile with gcc though. I've made
some attempts to see if I can identify a specific compiler optimization
that is responsible, but so far no luck.

Brad

On 5 Mar 2000, Peter Dalgaard BSA wrote:

> Brad McNeney <mcneney@cs.sfu.ca> writes:
> 
> > I don't know if the following is relevant, but for some reason I've found 
> > I can avoid this particular problem if I make a small change in lapply in 
> > its main loop.  Around line 50 of apply.c:
> > 
> >     PROTECT(ans = allocVector(VECSXP, n));
> >     for(i = 0; i < n; i++) {
> >         INTEGER(ind)[0] = i + 1;
> >         VECTOR(ans)[i] = eval(R_fcall, rho);
> >     }
> > 
> > if I change it to make an assignment to a
> > temporary variable first everything seems to work fine:
> > 
> >     PROTECT(ans = allocVector(VECSXP, n));
> >     for(i = 0; i < n; i++) {
> >         INTEGER(ind)[0] = i + 1;
> >         tem = eval(R_fcall, rho);
> >         VECTOR(ans)[i] = tem;
> >     }
> > 
> > hasn't given me any NULLs yet. 
> 
> Now that is pretty darn odd... Looks quite a bit like a compiler bug.
> Those two pieces of code should be equivalent as far as I can see.
> 
> One thing that you might do: objdump -dS apply.o allows you to see
> what code the compiler generates for the two cases. Also, of course,
> you can try reducing the level of optimization.
> 
> 
> Alternatively, the mere addition of "tem" changes the local memory use
> of that function so that something that got clobbered before doesn't
> get clobbered now.
> 
> The effect doesn't seem to be present on Intels:
> 
> > dfr<-do.call("data.frame",lapply(1:100,function(i)rnorm(100)))
> > any(sapply(lapply(dfr,summary),is.null))
> [1] FALSE
> 
> -- 
>    O__  ---- Peter Dalgaard             Blegdamsvej 3  
>   c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
>  (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
> 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 534 *
Subject: wsfe bug report just made
From: mallen@tntech.edu
Date: Thu, 4 May 2000 19:20:35 +0200 (MET DST)
--follow up to PR#533
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 534 <==
From mallen@tntech.edu  Thu May  4 19:20:35 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11074
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:20:35 +0200 (MET DST)
Date: Thu, 4 May 2000 19:20:35 +0200 (MET DST)
From: mallen@tntech.edu
Message-Id: <200005041720.TAA11074@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: wsfe bug report just made

Full_Name: Michael R. Allen
Version: 1.01
OS: linux redhat 6.2
Submission from: (NULL) (149.149.32.46)


Sorry, I forgot to tell you.  I am running version 6.2 of redhat.  Also, I have
loaded the latest version of R as well.

Mike

==> 534.audit <==
Thu May 18 18:06:31 2000	ripley	changed notes
Thu May 18 18:06:31 2000	ripley	moved from incoming to Add-ons
Wed Jun 07 15:09:34 2000	pd	moved from Add-ons to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 533 *
Subject: acepack, akima and tripack will not load 
From: mallen@tntech.edu
Date: Thu, 4 May 2000 19:18:59 +0200 (MET DST)
--related to PR#521: probably compiler-specific
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 533 <==
From mallen@tntech.edu  Thu May  4 19:19:00 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11041
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:18:59 +0200 (MET DST)
Date: Thu, 4 May 2000 19:18:59 +0200 (MET DST)
From: mallen@tntech.edu
Message-Id: <200005041718.TAA11041@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: acepack, akima and tripack will not load 

Full_Name: Michael R. Allen
Version: 1.01
OS: linux redhat
Submission from: (NULL) (149.149.32.46)


Hello,

	Thought you might be interested.  I tried to load the package tripack
needed by the sgeostat package.  After some careful searching,  three packages
were 
found which had the same error.  Here is the output.

Mike
  
> library(acepack) Error in dyn.load(x, as.logical(local),
as.logical(now)) :
        unable to load shared library
"/usr/lib/R/library/acepack/libs/acepack.so":
  /usr/lib/R/library/acepack/libs/acepack.so: undefined symbol: e_wsfe 
>library(tripack) Error in dyn.load(x, as.logical(local), as.logical(now))
:
        unable to load shared library
"/usr/lib/R/library/tripack/libs/tripack.so":
  /usr/lib/R/library/tripack/libs/tripack.so: undefined symbol: e_wsfe 
>library(akima) Error in dyn.load(x, as.logical(local), as.logical(now)) :
        unable to load shared library
"/usr/lib/R/library/akima/libs/akima.so":
  /usr/lib/R/library/akima/libs/akima.so: undefined symbol: e_wsfe      

==> 533.followup.1 <==
From ripley@stats.ox.ac.uk  Thu May  4 19:41:38 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11202
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:41:35 +0200 (MET DST)
Received: from max126.public.ox.ac.uk (max126.public.ox.ac.uk [192.76.27.126])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id SAA09846;
	Thu, 4 May 2000 18:41:45 +0100 (BST)
Date: Thu, 4 May 2000 18:40:42 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: mallen@tntech.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] acepack, akima and tripack will not load (PR#533)
In-Reply-To: <200005041719.TAA11051@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10005041827230.26380-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 4 May 2000 mallen@tntech.edu wrote:

> Full_Name: Michael R. Allen
> Version: 1.01
> OS: linux redhat
> Submission from: (NULL) (149.149.32.46)
> 
> 
> Hello,
> 
> 	Thought you might be interested.  I tried to load the package tripack
> needed by the sgeostat package.  After some careful searching,  three packages
> were 
> found which had the same error.  Here is the output.

> Mike
>   
> > library(acepack) Error in dyn.load(x, as.logical(local),
> as.logical(now)) :
>         unable to load shared library
> "/usr/lib/R/library/acepack/libs/acepack.so":
>   /usr/lib/R/library/acepack/libs/acepack.so: undefined symbol: e_wsfe 
> >library(tripack) Error in dyn.load(x, as.logical(local), as.logical(now))
> :
>         unable to load shared library
> "/usr/lib/R/library/tripack/libs/tripack.so":
>   /usr/lib/R/library/tripack/libs/tripack.so: undefined symbol: e_wsfe 
> >library(akima) Error in dyn.load(x, as.logical(local), as.logical(now)) :
>         unable to load shared library
> "/usr/lib/R/library/akima/libs/akima.so":
>   /usr/lib/R/library/akima/libs/akima.so: undefined symbol: e_wsfe      

That's a symbol from the Fortran I/O code.  There is no problem on RH6.0
on R 1.0.1, where the symbol is resolved from libg2c.a.

(1) Does FLIBS in etc/Makeconf include -lg2c?

(2) If so, do those packages have Makefiles in src? If so delete them
and reinstall.  (The latest version of akima does not, but earlier versions
did.)

(3) Does lg2c include e_wsfe?  (nm -g on it).  Is it finding the right
libg2c.a?

(4) I get nm -g ..../akima.so  giving

00013c5c T e_wsfe

and so I think it should be resolved in the *.so.

Which version of RedHat?  I suspect a RedHat inconsistency here, and other
people have reported that upgrading to the gcc-2.95.2 compiler set
solved the problem.  But it might just be old package versions.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 533.reply.1 <==
From bates@franz.stat.wisc.edu  Thu May  4 19:44:14 2000
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11222
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:44:13 +0200 (MET DST)
Received: by franz.stat.wisc.edu
	via sendmail from stdin
	id <m12nPhM-000ZTOC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for R-bugs@biostat.ku.dk; Thu, 4 May 2000 12:46:04 -0500 (CDT) 
Sender: bates@franz.stat.wisc.edu
To: mallen@tntech.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] acepack, akima and tripack will not load (PR#533)
References: <200005041719.TAA11051@pubhealth.ku.dk>
From: Douglas Bates <bates@stat.wisc.edu>
Date: 04 May 2000 12:46:04 -0500
In-Reply-To: mallen@tntech.edu's message of "Thu, 4 May 2000 19:19:01 +0200 (MET DST)"
Message-ID: <6rog6m2opv.fsf@franz.stat.wisc.edu>
Lines: 12
X-Mailer: Gnus v5.7/Emacs 20.6

mallen@tntech.edu writes:

> > library(acepack) Error in dyn.load(x, as.logical(local),
> as.logical(now)) :
>         unable to load shared library
> "/usr/lib/R/library/acepack/libs/acepack.so":
>   /usr/lib/R/library/acepack/libs/acepack.so: undefined symbol: e_wsfe 

That name e_wsfe probably comes from Fortran input/output routines.
Check if some Fortran code is trying to use a WRITE statement.  I
think there was another message this morning about this.


==> 533.reply.2 <==
From pd@blueberry.kubism.ku.dk  Thu May  4 22:04:44 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA11927
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 22:04:44 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id WAA04273;
	Thu, 4 May 2000 22:10:21 +0200
Sender: pd@blueberry.kubism.ku.dk
To: mallen@tntech.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] wsfe bug report just made (PR#533)
References: <200005041720.TAA11084@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 May 2000 22:10:21 +0200
In-Reply-To: mallen@tntech.edu's message of "Thu, 4 May 2000 19:20:36 +0200 (MET DST)"
Message-ID: <x2bt2m13gy.fsf@blueberry.kubism.ku.dk>
Lines: 29
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mallen@tntech.edu writes:

> Full_Name: Michael R. Allen
> Version: 1.01
> OS: linux redhat 6.2
> Submission from: (NULL) (149.149.32.46)
> 
> 
> Sorry, I forgot to tell you.  I am running version 6.2 of redhat.  Also, I have
> loaded the latest version of R as well.
> 
> Mike
> 

But did you build the packages yourself and if so, how? (using which
compilers).

BTW: when you follow up on an earlier report via the web interface,
please do it as a follow-up. If you do it by mail, say for PR#533,
please include (PR#533) in the Subject line. That way things get filed
together. (I've fixed the number on this mail)



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 533.audit <==
Thu May 18 18:06:13 2000	ripley	changed notes
Thu May 18 18:06:13 2000	ripley	moved from incoming to Add-ons
Wed Jun 07 15:09:34 2000	pd	moved from Add-ons to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 547 *
Subject: system(.., ignore.stderr = TRUE)  problem on Solaris
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Fri, 19 May 2000 21:12:02 +0200 (CEST)
--redirection of stderr to /dev/null in system occurs before the command
--is tried on some systems and after on others.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 547 <==
From maechler@stat.math.ethz.ch  Fri May 19 21:11:52 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA02032
	for <R-bugs@biostat.ku.dk>; Fri, 19 May 2000 21:11:51 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id VAA08262
	for <R-bugs@stat.math.ethz.ch>; Fri, 19 May 2000 21:12:10 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa00214; Fri May 19 21:12:03 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id VAA02922; Fri, 19 May 2000 21:12:02 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14629.37378.591438.574955@lynne.ethz.ch>
Date: Fri, 19 May 2000 21:12:02 +0200 (CEST)
To: R-bugs@stat.math.ethz.ch
Subject: system(.., ignore.stderr = TRUE)  problem on Solaris
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

(i.e. my version Solaris, see below...)

Note that system() is not only implemented quite system-dependently
(which you'd very much expect!) but also Unix and Windows have quite
different arguments apart from the first two.

Hence all the following is ``Unix-only'' :


A user stumbled across this when using read.table.url(.) on a platform
where no "wget" is installed: 

The data is read ok, but an ugly message appears *before* the command is
completed :
	  -------------------
	  sh: wget: not found
	  -------------------
which made the user believe that the data wasn't read properly.

The problem is easily tracked to the system(..) call in download.file()
{which does not (yet) have the "ignore.stderr = TRUE" setting, btw}
and found that on our Solaris environment, 
the ignore.stderr argument does not seem to have any effect, i.e.

  > system("bla", ignore.stderr = TRUE)

gives the same as  system("bla"), namely
  
  sh: bla: not found
 
On my Linux environment,  ignore.stderr works as advertized.

Further note that  help(system)  should probably also say something about which
shell may or may not be used (I think we decided that we want it to be `sh'
on Unix).


--please do not edit the information below-- {did anyway ;=)}

Version:
 platform = sparc-sun-solaris2.5.1
 arch = sparc
 os = solaris2.5.1
 system = sparc, solaris2.5.1

 --- either R-devel of today, or also 1.0.1 ---

 year = 2000
 month = May
 day = 18
 language = R

Search Path:
 .GlobalEnv, package:SfS, Autoloads, package:base



==> 547.followup.1 <==
From ripley@stats.ox.ac.uk  Fri May 19 23:47:26 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA02579
	for <R-bugs@biostat.ku.dk>; Fri, 19 May 2000 23:47:25 +0200 (MET DST)
Received: from max163.public.ox.ac.uk (max163.public.ox.ac.uk [192.76.27.163])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id WAA06872;
	Fri, 19 May 2000 22:47:38 +0100 (BST)
Date: Fri, 19 May 2000 22:46:09 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: maechler@stat.math.ethz.ch
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] system(.., ignore.stderr = TRUE)  problem on Solaris (PR#547)
In-Reply-To: <200005191911.VAA02042@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10005192223470.4118-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 19 May 2000 maechler@stat.math.ethz.ch wrote:

> (i.e. my version Solaris, see below...)
> 
> Note that system() is not only implemented quite system-dependently
> (which you'd very much expect!) but also Unix and Windows have quite
> different arguments apart from the first two.
> 
> Hence all the following is ``Unix-only'' :
> 
> 
> A user stumbled across this when using read.table.url(.) on a platform
> where no "wget" is installed: 
> 
> The data is read ok, but an ugly message appears *before* the command is
> completed :
> 	  -------------------
> 	  sh: wget: not found
> 	  -------------------
> which made the user believe that the data wasn't read properly.
> 
> The problem is easily tracked to the system(..) call in download.file()
> {which does not (yet) have the "ignore.stderr = TRUE" setting, btw}
> and found that on our Solaris environment, 
> the ignore.stderr argument does not seem to have any effect, i.e.
> 
>   > system("bla", ignore.stderr = TRUE)
> 
> gives the same as  system("bla"), namely
>   
>   sh: bla: not found

Under sh you cannot redirect the output from a command until the command
is running.  That is, you are not redirecting the error messages from sh,
only from the command.  Unless the command runs, ignore.stderr has no
effect.

> On my Linux environment,  ignore.stderr works as advertized.

Depends how you read the advertising.

> Further note that  help(system)  should probably also say something about which
> shell may or may not be used (I think we decided that we want it to be `sh'
> on Unix).

Yes, and you almost certainly got bash *not* sh on your Linux, and that
behaves differently.  I think you will find that a closer sh clone (such as
ash) does show the error message.  That some Linux systems claim to have sh
and do not is a major compatibility problem in writing shell scripts and
Makefiles, as we keep finding.

BTW, Solaris will use ksh not sh for the shell if it needs to be POSIX
compatible. And ksh behaves like bash in this respect.


I believe that to define this portably we are going to have to do something
a lot more complicated than accept what the system() call gives us. Are you
volunteering, Martin?


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 547.audit <==
Sun May 21 07:18:08 2000	ripley	changed notes
Sun May 21 07:18:08 2000	ripley	moved from incoming to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 537 *
Subject: eigen broken on AIX with R-devel?
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 08 May 2000 12:01:04 -0400
--AIX, probably compiler-specific
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 537 <==
From tov@ece.cmu.edu  Mon May  8 18:00:51 2000
Received: from ece.cmu.edu (ECE.CMU.EDU [128.2.236.200])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA10501
	for <r-bugs@biostat.ku.dk>; Mon, 8 May 2000 18:00:51 +0200 (MET DST)
Received: from bavaria.ece.cmu.edu (root@BAVARIA.ECE.CMU.EDU [128.2.216.38])
	by ece.cmu.edu (8.9.2/8.8.8) with ESMTP id MAA09223;
	Mon, 8 May 2000 12:01:04 -0400 (EDT)
Received: (from tov@localhost)
	by bavaria.ece.cmu.edu (8.9.3/8.9.3/Debian 8.9.3-21) id MAA00641;
	Mon, 8 May 2000 12:01:04 -0400
Sender: tov@bavaria.ece.cmu.edu
To: r-bugs@biostat.ku.dk
Cc: Thomas Vogels <tov@ece.cmu.edu>
Subject: eigen broken on AIX with R-devel?
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 08 May 2000 12:01:04 -0400
Message-ID: <87ln1ldoan.fsf@bavaria.ece.cmu.edu>
Lines: 61
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.5
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.

Here are the results:

R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
R> m
     [,1] [,2]
[1,]  6.8  2.4
[2,]  2.4  8.2
R> eigen(m)
$values
[1] 19.281403  6.337993

$vectors
          [,1]       [,2]
[1,] 0.1918866  0.9967987
[2,] 0.9967987 -0.1918866


And for comparison, here is what I get on a Sun (with r-stable):

R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
R> eigen (m)
$values
[1] 10  5

$vectors
     [,1] [,2]
[1,]  0.6  0.8
[2,]  0.8 -0.6


I found this by running "make check" which also stumbles over svd.
Please let me know how I can help to investigate this.

  -tom


--please do not edit the information below--

Version:
 platform = powerpc-ibm-aix4.3.2.0
 arch = powerpc
 os = aix4.3.2.0
 system = powerpc, aix4.3.2.0
 status = Under development (unstable)
 major = 1
 minor = 1.0
 year = 2000
 month = May
 day = 3
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base


-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204


==> 537.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon May  8 20:41:00 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA11280
	for <R-bugs@biostat.ku.dk>; Mon, 8 May 2000 20:40:59 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id UAA29246;
	Mon, 8 May 2000 20:47:12 +0200
Sender: pd@blueberry.kubism.ku.dk
To: tov@ece.cmu.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] eigen broken on AIX with R-devel? (PR#537)
References: <200005081600.SAA10511@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 May 2000 20:47:12 +0200
In-Reply-To: tov@ece.cmu.edu's message of "Mon, 8 May 2000 18:00:52 +0200 (MET DST)"
Message-ID: <x2hfc86frj.fsf@blueberry.kubism.ku.dk>
Lines: 25
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

tov@ece.cmu.edu writes:

> Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.

Hmm. We had a similar report a while back and it turned out to be
system specific. I believe the report was from Chong Gu.

> Version:
>  platform = powerpc-ibm-aix4.3.2.0
>  arch = powerpc
>  os = aix4.3.2.0
>  system = powerpc, aix4.3.2.0
>  status = Under development (unstable)
>  major = 1
>  minor = 1.0
>  year = 2000
>  month = May
>  day = 3
>  language = R

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 537.reply.2 <==
From thomas@biostat.washington.edu  Tue May  9 17:38:55 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA21900
	for <R-bugs@biostat.ku.dk>; Tue, 9 May 2000 17:38:54 +0200 (MET DST)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id IAA05789;
	Tue, 9 May 2000 08:39:05 -0700 (PDT)
Date: Tue, 9 May 2000 08:39:05 -0700 (PDT)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: tov@ece.cmu.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] eigen broken on AIX with R-devel? (PR#537)
In-Reply-To: <200005081600.SAA10511@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0005090837420.4639-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 8 May 2000 tov@ece.cmu.edu wrote:

> 
> Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.
> 

When we last saw this bug it was compiler-specific.  gcc/g77 worked but
cc/f77 didn't (and I think gcc/f77 wouldn't even configure). 

I don't think we understand the bug, though.

	-thomas


==> 537.audit <==
Thu May 18 18:07:40 2000	ripley	changed notes
Thu May 18 18:07:40 2000	ripley	moved from incoming to System-specific

==> 537.followup.1 <==
From tov@ece.cmu.edu  Thu Jun 15 19:57:37 2000
Received: from ece.cmu.edu (ECE.CMU.EDU [128.2.236.200])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA25634
	for <R-bugs@biostat.ku.dk>; Thu, 15 Jun 2000 19:57:36 +0200 (MET DST)
Received: from bavaria.ece.cmu.edu (root@BAVARIA.ECE.CMU.EDU [128.2.216.38])
	by ece.cmu.edu (8.9.2/8.8.8) with ESMTP id NAA24895;
	Thu, 15 Jun 2000 13:57:55 -0400 (EDT)
Received: (from tov@localhost)
	by bavaria.ece.cmu.edu (8.9.3/8.9.3/Debian 8.9.3-21) id NAA03271;
	Thu, 15 Jun 2000 13:57:55 -0400
Sender: tov@bavaria.ece.cmu.edu
To: r-devel@stat.math.ethz.ch
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] eigen broken on AIX with R-devel? (PR#537)
References: <200005081600.SAA10511@pubhealth.ku.dk>
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 15 Jun 2000 13:57:55 -0400
In-Reply-To: tov@ece.cmu.edu's message of "Mon, 8 May 2000 18:00:52 +0200 (MET DST)"
Message-ID: <87vgzax1wc.fsf@bavaria.ece.cmu.edu>
Lines: 50
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.6
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi, I ran the test again with the newly released version of R (1.1) and I
now get the correct eigen values.  ("make check" succeeds.)

The scary part is that I think that I also used gcc+f77 last time and
the libs weren't changed.  Maybe the scary part is that I think...

So the comments that this is compiler specific probably hold.

Thanks,
  -tom


tov@ece.cmu.edu writes:

> Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.
> 
> Here are the results:
> 
> R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
> R> m
>      [,1] [,2]
> [1,]  6.8  2.4
> [2,]  2.4  8.2
> R> eigen(m)
> $values
> [1] 19.281403  6.337993
> 
> $vectors
>           [,1]       [,2]
> [1,] 0.1918866  0.9967987
> [2,] 0.9967987 -0.1918866
> 
> 
> And for comparison, here is what I get on a Sun (with r-stable):

(same results now on AIX 4.3 with R 1.1.0 

> R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
> R> eigen (m)
> $values
> [1] 10  5
> 
> $vectors
>      [,1] [,2]
> [1,]  0.6  0.8
> [2,]  0.8 -0.6

-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 732 *
Subject: R with redhat 7
From: hyu@stats.uwo.ca
Date: Wed, 8 Nov 2000 22:32:48 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 732 <==
From hyu@stats.uwo.ca  Wed Nov  8 22:32:49 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA09834
	for <R-bugs@biostat.ku.dk>; Wed, 8 Nov 2000 22:32:48 +0100 (MET)
Date: Wed, 8 Nov 2000 22:32:48 +0100 (MET)
From: hyu@stats.uwo.ca
Message-Id: <200011082132.WAA09834@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: R with redhat 7

Full_Name: Hao Yu
Version: 1.1.0 and 1.1.1
OS: Redhat 7 Linux (intel)
Submission from: (NULL) (129.100.45.161)


Hi, I am not sure this is well know problem but I could not find anyone mention
it. 
The problem is related to build R on redhat 7. After got src.rpm and tried to
rebuild it, it failed on testing accuracy. Further it shows that under R,
.Machine gives some numbers that maybe are not correct. I also tried the most
recent one (November 6) and failed. The strange thing is that the R (1.1.0) that
comes with powertools of redhat 7 has exactly the same problem. All three R
gives the same results for .Machine. See the following outputs. 

Thanks
Hao Yu

PS. One system has Pentium III 600Mhz and 256RDRAM, Intel CC820 motherboard;
    Another has Pentium III 800Mhz and 256 SDRAM, ASUS BX motherboard.

***************************************************************************** 
R : Copyright 2000, The R Development Core Team
Version 1.1.1 Patched (November 6, 2000)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type    "?license" or "?licence" for distribution details.

R is a collaborative project with many contributors.
Type    "?contributors" for a list.

Type    "demo()" for some demos, "help()" for on-line help, or
        "help.start()" for a HTML browser interface to help.
Type    "q()" to quit R.

> .Machine
$double.eps
[1] 1.084202e-19

$double.neg.eps
[1] 5.421011e-20

$double.xmin
[1] 0.25

$double.xmax
[1] 0.5

$double.base
[1] 2

$double.digits
[1] 64

$double.rounding
[1] 5

$double.guard
[1] 0

$double.ulp.digits
[1] -63

$double.neg.ulp.digits
[1] -64

$double.exponent
[1] 1

$double.min.exp
[1] -2

$double.max.exp
[1] -2

$integer.max
[1] 2147483647

==> 732.reply.1 <==
From pd@biostat.ku.dk  Wed Nov  8 23:43:49 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA10152;
	Wed, 8 Nov 2000 23:43:48 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id XAA03332;
	Wed, 8 Nov 2000 23:45:06 +0100
Sender: pd@blueberry.kubism.ku.dk
To: hyu@stats.uwo.ca
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] R with redhat 7 (PR#732)
References: <200011082132.WAA09844@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 Nov 2000 23:45:06 +0100
In-Reply-To: hyu@stats.uwo.ca's message of "Wed, 8 Nov 2000 22:32:49 +0100 (MET)"
Message-ID: <x2vgtyytfx.fsf@blueberry.kubism.ku.dk>
Lines: 44
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

hyu@stats.uwo.ca writes:

> Full_Name: Hao Yu
> Version: 1.1.0 and 1.1.1
> OS: Redhat 7 Linux (intel)
> Submission from: (NULL) (129.100.45.161)
> 
> 
> Hi, I am not sure this is well know problem but I could not find anyone mention
> it. 
> The problem is related to build R on redhat 7. After got src.rpm and tried to
> rebuild it, it failed on testing accuracy. Further it shows that under R,
> .Machine gives some numbers that maybe are not correct. I also tried the most
> recent one (November 6) and failed. The strange thing is that the R (1.1.0) that
> comes with powertools of redhat 7 has exactly the same problem. All three R
> gives the same results for .Machine. See the following outputs. 

We (R-core + Martyn Plummer who builds the RPM files on CRAN)
discussed this earlier today. It is a problem with the RedHat
"unofficical 2.96" gcc compiler which seems to be overly zealous on
some optimizations. The build is said to work if you build R
unoptimized.

We're strongly considering to say that R *requires* another gcc
compiler rather than trying to work around bugs in a compiler that
should never have been released.

The powertools version appears to have been built by disabling the
regression test (make check)! It might be worth filing a formal bug
report with RedHat on that matter. (It is not merely a matter of
cosmetics, those machine constants actually get used for determining
convergence criteria and the like. Having them set too low could send
algorithms into infinite loops.)

I think Martyn Plummer is about to produce a working RPM based on a
better compiler. However, if you want to compile add-on packages, it
might still be a good idea to install an alternative compiler for
yourself. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 732.audit <==
Thu Nov  9 08:21:27 2000	ripley	moved from incoming to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 592 *
Subject: tseries bug
From: przemat@itti.com.pl
Date: Tue, 4 Jul 2000 14:52:17 +0200 (MET DST)
--Still broken?
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 592 <==
From przemat@itti.com.pl  Tue Jul  4 14:54:06 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA14962
	for <R-bugs@biostat.ku.dk>; Tue, 4 Jul 2000 14:52:17 +0200 (MET DST)
Date: Tue, 4 Jul 2000 14:52:17 +0200 (MET DST)
From: przemat@itti.com.pl
Message-Id: <200007041252.OAA14962@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: tseries bug
MIME-Version: 1.0
Content-Type: text/plain; charset=unknown-8bit
Content-Transfer-Encoding: 8bit

Full_Name: Przemys³aw Matuszewski
Version: R-1.1.0
OS: Linux RH 6.2
Submission from: (NULL) (195.117.211.244)


I have a problem with the package tseries_0.5-2.
The source of tseries_0.5-2 was compiled by command R INSTALL /path/to/package.

There was build the tseries library. Now when I try to load the package I get
the message:
...........................
    
    Type	"demo()" for some demos, "help()" for on-line help, or
    	"help.start()" for a HTML browser interface to help.
    Type	"q()" to quit R.

    > library(tseries)

    Segmentation fault (core dumped)

............................
                        
I would be appreciated if you could give me any suggestion what to do with it.

Best regards

Przemys³aw Matuszewski

przemat@itti.com.pl


==> 592.followup.1 <==
From plummer@iarc.fr  Tue Jul  4 15:19:12 2000
Received: from smtp02.iarc.fr (IDENT:root@uu194-7-167-221.unknown.uunet.be [194.7.167.221])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA15580
	for <R-bugs@biostat.ku.dk>; Tue, 4 Jul 2000 15:19:11 +0200 (MET DST)
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id PAA06989;
	Tue, 4 Jul 2000 15:19:02 +0200
Message-ID: <XFMail.000704152137.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
In-Reply-To: <200007041254.OAA15000@pubhealth.ku.dk>
Date: Tue, 04 Jul 2000 15:21:37 +0200 (CEST)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: przemat@itti.com.pl
Subject: RE: [Rd] tseries bug (PR#592)
Cc: R-bugs@biostat.ku.dk, r-devel@stat.math.ethz.ch

Not a problem with the tseries package, I think, but with Red Hat 6.2,
which has some serious problems dynamically loading Fortran.

Peter Dalgaard has reported that upgrading the C/fortran compilers to 
gcc 2.95.1 or later cures the problem.

I'll see if I can find an RPM of gcc-2.95.1 for RH 6.2 and put it in
the RedHat directory of CRAN.

Martyn

On 04-Jul-00 przemat@itti.com.pl wrote:
> Full_Name: Przemys³aw Matuszewski
> Version: R-1.1.0
> OS: Linux RH 6.2
> Submission from: (NULL) (195.117.211.244)
> 
> 
> I have a problem with the package tseries_0.5-2.
> The source of tseries_0.5-2 was compiled by command R INSTALL
> /path/to/package.
> 
> There was build the tseries library. Now when I try to load the package I get
> the message:
> ...........................
>     
>     Type      "demo()" for some demos, "help()" for on-line help, or
>       "help.start()" for a HTML browser interface to help.
>     Type      "q()" to quit R.
> 
>     > library(tseries)
> 
>     Segmentation fault (core dumped)
> 
> ............................
>                         
> I would be appreciated if you could give me any suggestion what to do with
> it.

==> 592.followup.2 <==
From plummer@iarc.fr  Tue Jul  4 17:01:47 2000
Received: from smtp02.iarc.fr (IDENT:root@uu194-7-167-221.unknown.uunet.be [194.7.167.221])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA16295
	for <R-bugs@biostat.ku.dk>; Tue, 4 Jul 2000 17:01:46 +0200 (MET DST)
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id QAA07615;
	Tue, 4 Jul 2000 16:59:12 +0200
Message-ID: <XFMail.000704170148.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
In-Reply-To: <XFMail.000704152137.plummer@iarc.fr>
Date: Tue, 04 Jul 2000 17:01:48 +0200 (CEST)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: przemat@itti.com.pl
Subject: RE: [Rd] tseries bug (PR#592)
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk

On 04-Jul-00 Martyn Plummer wrote:
> Not a problem with the tseries package, I think, but with Red Hat 6.2,
> which has some serious problems dynamically loading Fortran.
> 
> Peter Dalgaard has reported that upgrading the C/fortran compilers to 
> gcc 2.95.1 or later cures the problem.

I'm sorry to say that I still get the segfault with gcc-2.95.1 on 
RedHat 6.2.

Martyn

==> 592.audit <==
Fri Jul 07 06:52:28 2000	maechler	moved from incoming to System-specific
Mon Aug 14 14:21:03 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  TooMuchAtOnce

none

Directory:  Windows

none

Directory:  incoming

* PR# 795 *
Subject: Re: [Rd] some (may be related) problems with windows(rescale=)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Thu, 28 Dec 2000 20:22:51 +0000 (GMT)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 795 <==
From ripley@stats.ox.ac.uk  Thu Dec 28 21:23:17 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA29094
	for <R-bugs@biostat.ku.dk>; Thu, 28 Dec 2000 21:23:17 +0100 (MET)
Received: from max91.public.ox.ac.uk (max91.public.ox.ac.uk [192.76.27.91])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id UAA14349;
	Thu, 28 Dec 2000 20:23:29 GMT
Date: Thu, 28 Dec 2000 20:22:51 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: joehl@web.de
cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] some (may be related) problems with windows(rescale=)
 (PR#794)
In-Reply-To: <200012281904.UAA28913@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10012282003560.3776-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

If these things bother you, could you please supply fixes?  For some reason
you omitted the part of the help page dealing with one of these (which is
as documented), and I also think you are confusing `plot' and `device'
sizes. The latter will be the displayed device surface, I believe.

Nothing on the help page suggested that the fine details of the R read-only
parameters will be as you expected after re-scaling the plot, and it never
occurred to me that anyone would expect so.  As they are reported by the R
graphics engine (which is used unchanged), I expect they are correct in one
of the multiple interpretations.

On Thu, 28 Dec 2000 joehl@web.de wrote:

> ###############################################################################
> 
> Before reporting 4 problems with windows(rescale=) I want to congrat on R1.2 and to thank r-developers for quickly adding the rescale workaround to the windows version.
> 
> Happy New Year
> 
> 
> Jens Oehlschlaegel
> 
> 
> ###############################################################################
> 
> 
> 
> ###############################################################################
> ## windows(rescale="fixed") does not keep original device size 
> ## (probably device initialization error)
> ###############################################################################
> 
> dev.show <- function(){
> 	din <- par("din")
> 	c(width=din[1], height=din[2], aspectratio=din[1]/din[2])
> }
> width <- 42/2.54
> height <- 29.7/2.54
> 
> > width
> [1] 16.53543
> > height
> [1] 11.69291
> > width/height
> [1] 1.414141
> 
> 
> > windows(width=width, height=height, rescale="R")
> > dev.show()
>       width      height aspectratio 
>    9.229167    6.385417    1.445351 
> > dev.off()
> null device 
>           1 
> > windows(width=width, height=height, rescale="fixed")
> > dev.show()
>       width      height aspectratio 
>    9.229167    6.385417    1.445351 
> > dev.off()
> null device 
>           1 
> > windows(width=width, height=height, rescale="fit")
> > dev.show()
>       width      height aspectratio 
>    9.229167    6.385417    1.445351 
> 
> 
> ## Shouldn't at least rescale="fixed" give the desired device size and aspect ratio?
> ## The Help to windows() says:
> ## Using `"fixed"' will leave
> ##     the plot size unchanged, adding scrollbars if part of the plot is
> ##     obscured. This setting also affects the initial re-scaling if the
> ##     specified window size is too big.   

I don't think so.  It says the `plot' size, not the `device' size which is
what par("din") reports.

> ###############################################################################
> ## windows(rescale="fit") gives strange character sizes 
> ## (looks like device initialization error)
> ###############################################################################
> 
> 
> ## In the following examples the created devices seem to be equally initialized with respect to par(din)
> ## However, with windows(rescale="fit") I observe different par(pin) and 
different character sizes in text() and strwidth()
> 
> width <- 16.53543
> height <- 11.69291
> 
> windows(width=width, height=height, rescale="fixed")
> par("cex")
> plot(0:2,0:2, type="n")
> text(1,1,"abc\ndef", cex=2)
> text(1,0.5,"fixed", cex=2)
> temp <- t(sapply(par(c("din", "fin", "pin")),c))
> colnames(temp) <- c("x", "y")
> temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
> fixed <- temp
> 
> windows(width=width, height=height, rescale="fit")
> par("cex")
> plot(0:2,0:2, type="n")
> text(1,1,"abc\ndef", cex=2)
> text(1,0.5,"fit", cex=2)
> temp <- t(sapply(par(c("din", "fin", "pin")),c))
> colnames(temp) <- c("x", "y")
> temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
> fit <- temp
> 
> windows(width=width, height=height, rescale="R")
> par("cex")
> plot(0:2,0:2, type="n")
> text(1,1,"abc\ndef", cex=2)
> text(1,0.5,"R", cex=2)
> temp <- t(sapply(par(c("din", "fin", "pin")),c))
> colnames(temp) <- c("x", "y")
> temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
> R <- temp
> 
> # now compare
> fixed
> fit
> R
> 
> > fixed
>              x         y
> din  9.2291667 6.3854167
> fin  9.2291667 6.3854167
> pin  8.0666667 4.6604167
> text 0.1394628 0.2896737
> > fit
>               x         y
> din  9.22916667 6.3854167
> fin  9.22916667 6.3854167
> pin  8.79000000 5.7337500
> text 0.07935154 0.1122302
> > R
>              x         y
> din  9.2291667 6.3854167
> fin  9.2291667 6.3854167
> pin  8.0666667 4.6604167
> text 0.1394628 0.2896737
> 
> 
> > ## It looks like character size of windows(rescale="fit") refers to originally intended device size of 
> > ## width=16.53543, height=11.69291 as 
> > fit["text", "x"]/R["din", "x"]*width
> [1] 0.1415101
> > ## aprox. equal 
> > fixed["text", "x"]
> [1] 0.1405518

As documented:

  Using \code{\link{strwidth}} or
  \code{\link{strheight}} after a window has been rescaled gives
  dimensions in the original units, but only approximately as they are
  derived from the metrics of the rescaled fonts.

> ## If we now repeat this procedure with device sizes small enough to avoid initial rescaling
> ## the phenomenon disappears

Right, as documented.

> ###############################################################################
> ## wrong row distances with windows(rescale="fit")
> ## (looks like device initialization error)
> ###############################################################################
> 
> 
> width <- 16.53543
> height <- 11.69291
> 
> ## as a reference
> windows(width=width, height=height, rescale="fixed")
> plot(0:2,0:2, type="n")
> text(1,1,"there is hardly anything i know for sure\nneither of the future nor of the past\nnor should i know what to ask\nif the person answering was you\n\n(Ernst Jandl, stanzen)"
> ,cex=2)
> 
> ## Here rows are too close together
> windows(width=width, height=height, rescale="fit")
> plot(0:2,0:2, type="n")
> text(1,1,"there is hardly anything i know for sure\nneither of the future nor of the past\nnor should i know what to ask\nif the person answering was you\n\n(Ernst Jandl, stanzen)"
> ,cex=3)

I can't reproduce that.  It may depend on the fonts available.

> ## Specifying smaller device size thus avoiding initial rescaling 
> ## makes the problem disappear
> 
> width <- 9
> height <- 6
> 
> windows(width=width, height=height, rescale="fit")
> plot(0:2,0:2, type="n")
> text(1,1,"there is hardly anything i know for sure\nneither of the future nor of the past\nnor should i know what to ask\nif the person answering was you\n\n(Ernst Jandl, stanzen)"
> ,cex=3)
> 
> ## Once correctly initialized further rescaling using the mouse does retain correct distances
> 
> dev.off()
> dev.off()
> dev.off()
> 
> 
> 
> ###############################################################################
> ## windows(rescale="fit") destroys aspect ratio 
> ## (looks like device initialization error)
> ###############################################################################
> 
> 
> dev.show <- function(){
> 	din <- par("din")
> 	c(width=din[1], height=din[2], aspectratio=din[1]/din[2])
> }
> width <- 42/2.54
> height <- 29.7/2.54
> 
> > width
> [1] 16.53543
> > height
> [1] 11.69291
> > width/height
> [1] 1.414141
> 
> 
> ## create a device
> > windows(width=width, height=height, rescale="fit")
> > dev.show()
>       width      height aspectratio 
>    9.229167    6.385417    1.445351 
> 
> ## some resizing of the window BEFORE plot() is called
> # par("din") doesn't SEEM to change
> > dev.show()
>       width      height aspectratio 
>    9.229167    6.385417    1.445351 
>    
> # but in fact calling plot() and dev.show()
> > plot(0,0)
> > dev.show()
>       width      height aspectratio 
>    6.321506    5.562500    1.136451 
> 
> ## now some resizing of the window AFTER plot() is called
> > dev.show()
>       width      height aspectratio 
>    4.708333    4.500471    1.046187 
> > dev.show()
>       width      height aspectratio 
>    4.718750    3.297956    1.430811 
> > dev.show()
>       width      height aspectratio 
>   3.3255361   4.4375000   0.7494166 
> > dev.show()
>       width      height aspectratio 
>   1.4091170   5.1145833   0.2755096 
> > dev.show()
>       width      height aspectratio 
>   1.4062500   5.1145833   0.2749491 
> > dev.show()
>       width      height aspectratio 
>   0.4701945   3.3854167   0.1388882 
>   
> ## we got very differing aspect ratios
> ## One reason for that COULD be that the initially intended device sizes are not kept, 
> ## so that many rescalings cumulate the deviations.
> ## May be par(din) should not be changed at all (keep the representation layer stable)
> ## and only apply rescaling/zooming/scrolling only to the graphical presentation.

Possibly.  I don't think the device size is very interesting after
rescaling.  What are you using it for?

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 794 *
Subject: some (may be related) problems with windows(rescale=)
From: =?iso-8859-1?Q?"Jens=20Oehlschl=E4gel"?= <joehl@web.de>
Date: Thu, 28 Dec 2000 17:54:47 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 794 <==
From joehl@web.de  Thu Dec 28 20:04:17 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA28903
	for <R-bugs@biostat.ku.dk>; Thu, 28 Dec 2000 20:04:16 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id UAA08459
	for <r-bugs@hypatia.math.ethz.ch>; Thu, 28 Dec 2000 20:04:31 +0100 (MET)
Received: from UNKNOWN(212.227.116.80), claiming to be "mailgate3.cinetic.de"
 via SMTP by hypatia, id smtpdAAAa00247; Thu Dec 28 20:04:29 2000
Received: from cinetic.de (popeye.cinetic.de [194.122.194.100])
	by mailgate3.cinetic.de (8.9.3/8.9.3/SuSE Linux 8.9.3-0.1) with SMTP id RAA24799
	for <r-bugs@lists.r-project.org>; Thu, 28 Dec 2000 17:54:47 +0100
Date: Thu, 28 Dec 2000 17:54:47 +0100
Message-Id: <200012281654.RAA24799@mailgate3.cinetic.de>
MIME-Version: 1.0
Organization: http://freemail.web.de/
From: =?iso-8859-1?Q?"Jens=20Oehlschl=E4gel"?= <joehl@web.de>
To: r-bugs@stat.math.ethz.ch
Subject: some (may be related) problems with windows(rescale=)
Precedence: fm-user
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from quoted-printable to 8bit by pubhealth.ku.dk id UAA28903

###############################################################################

Before reporting 4 problems with windows(rescale=) I want to congrat on R1.2 and to thank r-developers for quickly adding the rescale workaround to the windows version.

Happy New Year


Jens Oehlschlaegel


###############################################################################



###############################################################################
## windows(rescale="fixed") does not keep original device size 
## (probably device initialization error)
###############################################################################

dev.show <- function(){
	din <- par("din")
	c(width=din[1], height=din[2], aspectratio=din[1]/din[2])
}
width <- 42/2.54
height <- 29.7/2.54

> width
[1] 16.53543
> height
[1] 11.69291
> width/height
[1] 1.414141


> windows(width=width, height=height, rescale="R")
> dev.show()
      width      height aspectratio 
   9.229167    6.385417    1.445351 
> dev.off()
null device 
          1 
> windows(width=width, height=height, rescale="fixed")
> dev.show()
      width      height aspectratio 
   9.229167    6.385417    1.445351 
> dev.off()
null device 
          1 
> windows(width=width, height=height, rescale="fit")
> dev.show()
      width      height aspectratio 
   9.229167    6.385417    1.445351 


## Shouldn't at least rescale="fixed" give the desired device size and aspect ratio?
## The Help to windows() says:
## Using `"fixed"' will leave
##     the plot size unchanged, adding scrollbars if part of the plot is
##     obscured. This setting also affects the initial re-scaling if the
##     specified window size is too big.   



###############################################################################
## windows(rescale="fit") gives strange character sizes 
## (looks like device initialization error)
###############################################################################


## In the following examples the created devices seem to be equally initialized with respect to par(din)
## However, with windows(rescale="fit") I observe different par(pin) and different character sizes in text() and strwidth()

width <- 16.53543
height <- 11.69291

windows(width=width, height=height, rescale="fixed")
par("cex")
plot(0:2,0:2, type="n")
text(1,1,"abc\ndef", cex=2)
text(1,0.5,"fixed", cex=2)
temp <- t(sapply(par(c("din", "fin", "pin")),c))
colnames(temp) <- c("x", "y")
temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
fixed <- temp

windows(width=width, height=height, rescale="fit")
par("cex")
plot(0:2,0:2, type="n")
text(1,1,"abc\ndef", cex=2)
text(1,0.5,"fit", cex=2)
temp <- t(sapply(par(c("din", "fin", "pin")),c))
colnames(temp) <- c("x", "y")
temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
fit <- temp

windows(width=width, height=height, rescale="R")
par("cex")
plot(0:2,0:2, type="n")
text(1,1,"abc\ndef", cex=2)
text(1,0.5,"R", cex=2)
temp <- t(sapply(par(c("din", "fin", "pin")),c))
colnames(temp) <- c("x", "y")
temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
R <- temp

# now compare
fixed
fit
R

> fixed
             x         y
din  9.2291667 6.3854167
fin  9.2291667 6.3854167
pin  8.0666667 4.6604167
text 0.1394628 0.2896737
> fit
              x         y
din  9.22916667 6.3854167
fin  9.22916667 6.3854167
pin  8.79000000 5.7337500
text 0.07935154 0.1122302
> R
             x         y
din  9.2291667 6.3854167
fin  9.2291667 6.3854167
pin  8.0666667 4.6604167
text 0.1394628 0.2896737


> ## It looks like character size of windows(rescale="fit") refers to originally intended device size of 
> ## width=16.53543, height=11.69291 as 
> fit["text", "x"]/R["din", "x"]*width
[1] 0.1415101
> ## aprox. equal 
> fixed["text", "x"]
[1] 0.1405518


## If we now repeat this procedure with device sizes small enough to avoid initial rescaling
## the phenomenon disappears

dev.off()
dev.off()
dev.off()

width <- 9.2291667
height <- 6.3854167

windows(width=width, height=height, rescale="fixed")
par("cex")
plot(0:2,0:2, type="n")
text(1,1,"abc\ndef", cex=2)
text(1,0.5,"fixed", cex=2)
temp <- t(sapply(par(c("din", "fin", "pin")),c))
colnames(temp) <- c("x", "y")
temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
fixed <- temp

windows(width=width, height=height, rescale="fit")
par("cex")
plot(0:2,0:2, type="n")
text(1,1,"abc\ndef", cex=2)
text(1,0.5,"fit", cex=2)
temp <- t(sapply(par(c("din", "fin", "pin")),c))
colnames(temp) <- c("x", "y")
temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
fit <- temp

windows(width=width, height=height, rescale="R")
par("cex")
plot(0:2,0:2, type="n")
text(1,1,"abc\ndef", cex=2)
text(1,0.5,"R", cex=2)
temp <- t(sapply(par(c("din", "fin", "pin")),c))
colnames(temp) <- c("x", "y")
temp <- rbind(temp, text=c(strwidth("abc\ndef", cex=2), strheight("abc\ndef", cex=2)))
R <- temp

# now compare
fixed
fit
R

> fixed
             x         y
din  9.1666667 6.1562500
fin  9.1666667 6.1562500
pin  8.0041667 4.4312500
text 0.1405518 0.3046544
> fit
             x         y
din  9.1666667 6.1562500
fin  9.1666667 6.1562500
pin  8.0041667 4.4312500
text 0.1405518 0.3046544
> R
             x         y
din  9.1666667 6.1562500
fin  9.1666667 6.1562500
pin  8.0041667 4.4312500
text 0.1405518 0.3046544



###############################################################################
## wrong row distances with windows(rescale="fit")
## (looks like device initialization error)
###############################################################################


width <- 16.53543
height <- 11.69291

## as a reference
windows(width=width, height=height, rescale="fixed")
plot(0:2,0:2, type="n")
text(1,1,"there is hardly anything i know for sure\nneither of the future nor of the past\nnor should i know what to ask\nif the person answering was you\n\n(Ernst Jandl, stanzen)"
,cex=2)

## Here rows are too close together
windows(width=width, height=height, rescale="fit")
plot(0:2,0:2, type="n")
text(1,1,"there is hardly anything i know for sure\nneither of the future nor of the past\nnor should i know what to ask\nif the person answering was you\n\n(Ernst Jandl, stanzen)"
,cex=3)


## Specifying smaller device size thus avoiding initial rescaling 
## makes the problem disappear

width <- 9
height <- 6

windows(width=width, height=height, rescale="fit")
plot(0:2,0:2, type="n")
text(1,1,"there is hardly anything i know for sure\nneither of the future nor of the past\nnor should i know what to ask\nif the person answering was you\n\n(Ernst Jandl, stanzen)"
,cex=3)

## Once correctly initialized further rescaling using the mouse does retain correct distances

dev.off()
dev.off()
dev.off()



###############################################################################
## windows(rescale="fit") destroys aspect ratio 
## (looks like device initialization error)
###############################################################################


dev.show <- function(){
	din <- par("din")
	c(width=din[1], height=din[2], aspectratio=din[1]/din[2])
}
width <- 42/2.54
height <- 29.7/2.54

> width
[1] 16.53543
> height
[1] 11.69291
> width/height
[1] 1.414141


## create a device
> windows(width=width, height=height, rescale="fit")
> dev.show()
      width      height aspectratio 
   9.229167    6.385417    1.445351 

## some resizing of the window BEFORE plot() is called
# par("din") doesn't SEEM to change
> dev.show()
      width      height aspectratio 
   9.229167    6.385417    1.445351 
   
# but in fact calling plot() and dev.show()
> plot(0,0)
> dev.show()
      width      height aspectratio 
   6.321506    5.562500    1.136451 

## now some resizing of the window AFTER plot() is called
> dev.show()
      width      height aspectratio 
   4.708333    4.500471    1.046187 
> dev.show()
      width      height aspectratio 
   4.718750    3.297956    1.430811 
> dev.show()
      width      height aspectratio 
  3.3255361   4.4375000   0.7494166 
> dev.show()
      width      height aspectratio 
  1.4091170   5.1145833   0.2755096 
> dev.show()
      width      height aspectratio 
  1.4062500   5.1145833   0.2749491 
> dev.show()
      width      height aspectratio 
  0.4701945   3.3854167   0.1388882 
  
## we got very differing aspect ratios
## One reason for that COULD be that the initially intended device sizes are not kept, 
## so that many rescalings cumulate the deviations.
## May be par(din) should not be changed at all (keep the representation layer stable)
## and only apply rescaling/zooming/scrolling only to the graphical presentation.



###############################################################################


--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = x86
 os = Win32
 system = x86, Win32
 status = 
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 15
 language = R

Windows NT 4.0 (build 1381) Service Pack 6

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base

______________________________________________________________________________
Die Fachpresse ist sich einig: WEB.DE 15mal Testsieger! Kostenlos E-Mail, 
Fax, SMS, Verschlüsselung, POP3, WAP....testen Sie uns! http://freemail.web.de

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
