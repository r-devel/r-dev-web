=================================================
This is an automated collection of open reports in
the R-bugs repository.
=================================================

Directory:  Accuracy

* PR# 751 *
Subject: BUG: polyroot()
From: "Li Dongfeng" <mavip1@inet.polyu.edu.hk>
Date: Tue, 28 Nov 2000 13:24:33 +0800
--Numerical instability. We may want a better algorithm!
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 751 <==
From mavip1@inet.polyu.edu.hk  Tue Nov 28 06:25:25 2000
Received: from hkpa04.polyu.edu.hk (hkpa04.PolyU.edu.hk [158.132.14.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id GAA06942
	for <r-bugs@biostat.ku.dk>; Tue, 28 Nov 2000 06:25:20 +0100 (MET)
Received: from hkpu01 ([158.132.174.240]) by hkpa04.polyu.edu.hk
          (Netscape Messaging Server 4.15) with SMTP id G4PZ0X01.43N for
          <r-bugs@biostat.ku.dk>; Tue, 28 Nov 2000 13:24:33 +0800 
Message-ID: <001b01c058fb$7db19700$f0ae849e@polyu.edu.hk>
From: "Li Dongfeng" <mavip1@inet.polyu.edu.hk>
To: <r-bugs@biostat.ku.dk>
Subject: BUG: polyroot()
Date: Tue, 28 Nov 2000 13:24:33 +0800
MIME-Version: 1.0
Content-Type: text/plain;
	charset="gb2312"
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.50.4133.2400
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4133.2400
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from base64 to 8bit by pubhealth.ku.dk id GAA06942

I have found that the polyroot()
function in R-1.1.1(both solaris
and Win32 version) gives totally
incorrect result. Here is the offending
code:

# Polyroot bug report:
# from R-1.1.1
> sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
 [1] 0.8758259 0.9486499 0.9731015 1.5419189 1.7466214 1.7535362 1.7589484
 [8] 2.0216317 2.4421509 2.5098488 2.6615572 2.7717724 2.8444048 2.9147685
[15] 2.9302278 2.9757159 3.2037151 3.2052962 3.2498510 3.2815881 3.3250881
[22] 4.6593700 4.7048556 5.2738258 5.7369920 5.9017094
# from Splus 2000
> sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
 [1] 0.8038812 0.8038812 0.8758259 0.8758259 0.9235722
 [6] 0.9235722 0.9439788 0.9439788 0.9536692 0.9536692
[11] 0.9582403 0.9582403 0.9596028 1.0420978 1.0435796
[16] 1.0435796 1.0485816 1.0485816 1.0593458 1.0593458
[21] 1.0827524 1.0827524 1.1417794 1.1417794 1.2439649
[26] 1.2439649

From mathematical theory I know that the Splus result
is correct while the R result is wrong. I would have
checked the source if I had the time.



==> 751.reply.1 <==
From pd@biostat.ku.dk  Thu Dec  7 00:53:06 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA04390;
	Thu, 7 Dec 2000 00:53:05 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id AAA28616;
	Thu, 7 Dec 2000 00:58:28 +0100
Sender: pd@blueberry.kubism.ku.dk
To: mavip1@inet.polyu.edu.hk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] BUG: polyroot() (PR#751)
References: <200011280525.GAA06952@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 07 Dec 2000 00:58:27 +0100
In-Reply-To: mavip1@inet.polyu.edu.hk's message of "Tue, 28 Nov 2000 06:25:26 +0100 (MET)"
Message-ID: <x2k89dxfto.fsf@blueberry.kubism.ku.dk>
Lines: 96
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mavip1@inet.polyu.edu.hk writes:

> I have found that the polyroot()
> function in R-1.1.1(both solaris
> and Win32 version) gives totally
> incorrect result. Here is the offending
> code:
> 
> # Polyroot bug report:
> # from R-1.1.1
> > sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
>  [1] 0.8758259 0.9486499 0.9731015 1.5419189 1.7466214 1.7535362 1.7589484
>  [8] 2.0216317 2.4421509 2.5098488 2.6615572 2.7717724 2.8444048 2.9147685
> [15] 2.9302278 2.9757159 3.2037151 3.2052962 3.2498510 3.2815881 3.3250881
> [22] 4.6593700 4.7048556 5.2738258 5.7369920 5.9017094
> # from Splus 2000
> > sort(abs(polyroot(c(1, -2,1,0,0,0,0,0,0,0,0,0,-2,5,-2,0,0,0,0,0,0,0,0,0,1,-2,1))))
>  [1] 0.8038812 0.8038812 0.8758259 0.8758259 0.9235722
>  [6] 0.9235722 0.9439788 0.9439788 0.9536692 0.9536692
> [11] 0.9582403 0.9582403 0.9596028 1.0420978 1.0435796
> [16] 1.0435796 1.0485816 1.0485816 1.0593458 1.0593458
> [21] 1.0827524 1.0827524 1.1417794 1.1417794 1.2439649
> [26] 1.2439649
> 
> >From mathematical theory I know that the Splus result
> is correct while the R result is wrong. I would have
> checked the source if I had the time.

There seems to be a rather bad numerical instability with the R code.
If we define

 polyeval<-function(coef,x){v<-0;for (i in rev(coef)) v<-v*x+i; v}

(Horner's scheme), we get 

> polyeval(1:5,polyroot(1:5))
[1] -2.220446e-16-2.664833e-16i -2.220446e-16-1.554475e-16i
[3] -2.220446e-16+1.436839e-16i -2.220446e-16-5.076235e-16i

which is kind of OK except that it looks odd that the real part is the
same for all 4 roots. Increasing the degree gives

> polyeval(10:1,polyroot(10:1))
[1] 9.230968e-08+5.257143e-08i 9.230977e-08+5.257158e-08i
[3] 9.230961e-08+5.257162e-08i 9.230956e-08+5.257151e-08i
[5] 9.230974e-08+5.257145e-08i 9.230975e-08+5.257161e-08i
[7] 9.230949e-08+5.257178e-08i 9.230974e-08+5.257161e-08i
[9] 9.230969e-08+5.257184e-08i

which is fairly OK, but it does look odd that we can't get closer to
zero than that since there are no multiple roots, and again it is
peculiar that the values are so similar. The next items in the
sequence are -ahem- interesting:

> polyeval(11:1,polyroot(11:1))
 [1] 2.305607e-06+1.791577e-05i 2.309550e-06+1.791714e-05i
 [3] 2.307622e-06+1.792101e-05i 2.304150e-06+1.791869e-05i
 [5] 2.307087e-06+1.791537e-05i 2.309716e-06+1.791873e-05i
 [7] 2.306030e-06+1.792098e-05i 2.304727e-06+1.792011e-05i
 [9] 2.308569e-06+1.791588e-05i 2.308994e-06+1.792018e-05i
> polyeval(12:1,polyroot(12:1))
 [1] 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i
 [5] 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i
 [9] 70.94521-90.6597i 70.94521-90.6597i 70.94521-90.6597i
> polyeval(13:1,polyroot(13:1))
 [1] -9.076647e-05-0.0003440688i -1.253803e-04-0.0003691299i
 [3] -8.894859e-05-0.0003941022i -7.310528e-05-0.0003638818i
 [5] -1.144849e-04-0.0003471283i -1.221901e-04-0.0003814892i
 [7] -7.857251e-05-0.0003869614i -7.284137e-05-0.0003760067i
 [9] -1.029218e-04-0.0003424790i -1.136443e-04-0.0003910680i
[11] -1.016283e-04-0.0003956270i -1.225930e-04-0.0003567609i
> polyeval(14:1,polyroot(14:1))
 [1]     11.28833+   28.72917i     11.28833+   28.72917i
 [3]   5809.74030-  427.90119i -19407.81458+ 3462.91985i
 [5]  -2823.47547-  494.63498i -40909.65435-10789.57874i
 [7]  -8336.95783+ 5241.26935i    344.71455- 1520.94876i
 [9]   5357.44530-24665.94094i  57313.79892-43530.37668i
[11]  11464.67537+29484.08287i  30010.79343+24624.25551i
[13]  25799.32156+53755.92101i
> polyeval(15:1,polyroot(15:1))
 [1]  4.110828e+01+5.028631e+01i  4.123746e+01+5.033469e+01i
 [3]  4.113423e+01+5.043357e+01i  4.106175e+01+5.031924e+01i
 [5]  2.130747e+06+7.226414e+05i -1.088699e+08+1.096129e+09i
 [7]  1.785940e+09+1.407187e+09i  9.750674e+10-5.059480e+10i
 [9] -3.102572e+09-9.212065e+10i  7.213065e+09-1.023845e+10i
[11]  1.682049e+10+2.202050e+10i  1.889123e+10-1.046838e+11i
[13] -6.220741e+10-4.563469e+10i -1.477005e+10-3.393510e+10i

Root finding in high-degree polynomials is known to be nasty business,
but this looks more than ordinarily bad.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 751.audit <==
Sun Dec 10 14:32:11 2000	pd	changed notes
Sun Dec 10 14:32:11 2000	pd	foobar
Sun Dec 10 14:32:11 2000	pd	moved from incoming to Accuracy

==> 751.followup.1 <==
From mark0060@tc.umn.edu  Wed Jan 17 03:51:59 2001
Received: from amethyst.tc.umn.edu (amethyst.tc.umn.edu [160.94.153.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id DAA19519
	for <r-bugs@biostat.ku.dk>; Wed, 17 Jan 2001 03:51:58 +0100 (MET)
Received: from [134.84.252.67] by amethyst.tc.umn.edu for r-bugs@biostat.ku.dk; Tue, 16 Jan 2001 20:51:40 -0600
Message-Id: <001b01c08041$2de9cae0$43fc5486@c9wz101>
Reply-To: "Kristian Markon" <mark0060@tc.umn.edu>
From: "Kristian Markon" <mark0060@tc.umn.edu>
To: <r-bugs@biostat.ku.dk>
Subject: PR#751
Date: Tue, 16 Jan 2001 20:51:38 -0800
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.00.2615.200
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2615.200

I'd just like to report a possible R bug--or rather, confirm an existing one
(bug #751).

I have had some difficulty using the polyroot() function.

For example, in Win 98, R 1.1.1,

> polyroot(c(2,1,1))

correctly (per the help index) gives the roots of  1 + (1*x) + (2*x^2) as

[1] -0.5+1.322876i -0.5-1.322876i

However,

> polyroot(c(-100,0,1))

gives the roots of

[1]  10+0i -10+0i

which corresponds to -100 + x^2, not 1 - (100*x^2).

Also,

> polyroot(c(0,0,0,1))

gives

[1]   0+0i   0+0i -10+0i

which aren't all roots of x^3.


Thanks for all your efforts.

I apologize if I'm missing something.

Kristian Markon











==> 751.reply.2 <==
From pd@biostat.ku.dk  Wed Jan 17 08:02:05 2001
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id HAA19898;
	Wed, 17 Jan 2001 07:59:35 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id IAA01976;
	Wed, 17 Jan 2001 08:01:11 +0100
Sender: pd@blueberry.kubism.ku.dk
To: mark0060@tc.umn.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] PR#751
References: <200101170252.DAA19529@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 17 Jan 2001 08:01:11 +0100
In-Reply-To: mark0060@tc.umn.edu's message of "Wed, 17 Jan 2001 03:52:00 +0100 (MET)"
Message-ID: <x2hf2yirwo.fsf@blueberry.kubism.ku.dk>
Lines: 71
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mark0060@tc.umn.edu writes:

> I'd just like to report a possible R bug--or rather, confirm an existing one
> (bug #751).
> 
> I have had some difficulty using the polyroot() function.
> 
> For example, in Win 98, R 1.1.1,
> 
> > polyroot(c(2,1,1))
> 
> correctly (per the help index) gives the roots of  1 + (1*x) + (2*x^2) as
> 
> [1] -0.5+1.322876i -0.5-1.322876i

Mm, no. The coefficients are by increasing degree, so these are the
roots of 2+x+x^2

> x<-polyroot(c(2,1,1))
> x
[1] -0.5+1.322876i -0.5-1.322876i
> 2+x+x^2
[1] -2.220446e-16+4.440892e-16i -2.220446e-16-4.440892e-16i


> However,
> 
> > polyroot(c(-100,0,1))
> 
> gives the roots of
> 
> [1]  10+0i -10+0i
> 
> which corresponds to -100 + x^2, not 1 - (100*x^2).

as it should.

> 
> Also,
> 
> > polyroot(c(0,0,0,1))
> 
> gives
> 
> [1]   0+0i   0+0i -10+0i
> 
> which aren't all roots of x^3.

That one is way out, however. Even more "fun":

> polyroot(c(-100,0,1))
[1]  10+0i -10+0i
> x<- polyroot(c(0,0,0,1))
> x
[1]   0+0i   0+0i -10+0i
> x<-polyroot(c(2,1,1))
> x<- polyroot(c(0,0,0,1))
> x
[1]  0.0+0.000000i  0.0+0.000000i -0.5-1.322876i

I.e. the result of polyroot(c(0,0,0,1)) depends on the previous
polyroot calculation! So there's more to the problem than numerical
instability.

Thanks for pointing it out.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 751.followup.2 <==
From apjaworski@mmm.com  Wed Jan 17 17:21:34 2001
Received: from sulu.mmm.com (sulu.mmm.com [192.28.4.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA00032
	for <R-bugs@biostat.ku.dk>; Wed, 17 Jan 2001 17:21:33 +0100 (MET)
From: apjaworski@mmm.com
Received: from us-ritahayworth.mmm.com (us-ritahayworth.mmm.com [169.10.9.87])
	by sulu.mmm.com (8.8.7/8.8.7) with ESMTP id KAA23813;
	Wed, 17 Jan 2001 10:21:14 -0600 (CST)
Subject: Re: [Rd] PR#751
X-Priority: 3 (Normal)
To: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
X-Mailer: Lotus Notes Release 5.0.3  March 21, 2000
Message-ID: <OF636EC57A.115D0ABC-ON862569D7.00599413@mmm.com>
Date: Wed, 17 Jan 2001 10:21:10 -0600
X-MIMETrack: Serialize by Router on US-RitaHayworth/US-Corporate/3M/US(Release 5.0.3 |March
 21, 2000) at 01/17/2001 10:21:14 AM
MIME-Version: 1.0
Content-type: text/plain; charset=us-ascii


... snip ...

> For example, in Win 98, R 1.1.1,
>
> > polyroot(c(2,1,1))
>
> correctly (per the help index) gives the roots of  1 + (1*x) + (2*x^2) as
>
> [1] -0.5+1.322876i -0.5-1.322876i

Mm, no. The coefficients are by increasing degree, so these are the
roots of 2+x+x^2

... snip ...

The manual page seems to have a typo.  It says (1.2.0 on Win)

Arguments:

       z: the vector of polynomial coefficients in decreasing order.


Andy


==> 751.reply.3 <==
From pd@biostat.ku.dk  Wed Jan 17 17:58:58 2001
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA00346;
	Wed, 17 Jan 2001 17:58:58 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id SAA02739;
	Wed, 17 Jan 2001 18:00:38 +0100
Sender: pd@blueberry.kubism.ku.dk
To: apjaworski@mmm.com
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] PR#751
References: <OF636EC57A.115D0ABC-ON862569D7.00599413@mmm.com>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 17 Jan 2001 18:00:38 +0100
In-Reply-To: apjaworski@mmm.com's message of "Wed, 17 Jan 2001 10:21:10 -0600"
Message-ID: <x2zogqru4p.fsf@blueberry.kubism.ku.dk>
Lines: 37
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

apjaworski@mmm.com writes:

> ... snip ...
> 
> > For example, in Win 98, R 1.1.1,
> >
> > > polyroot(c(2,1,1))
> >
> > correctly (per the help index) gives the roots of  1 + (1*x) + (2*x^2) as
> >
> > [1] -0.5+1.322876i -0.5-1.322876i
> 
> Mm, no. The coefficients are by increasing degree, so these are the
> roots of 2+x+x^2
> 
> ... snip ...
> 
> The manual page seems to have a typo.  It says (1.2.0 on Win)
> 
> Arguments:
> 
>        z: the vector of polynomial coefficients in decreasing order.
> 

I suppose that could be clearer (it kind of depends on what you
consider the "normal" order), but it also has

              p(x) = z1 + z2 * x + ... + z[n] * x^(n-1)

which should be clear enough.


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 751.reply.4 <==
From pd@biostat.ku.dk  Wed Jan 17 20:45:51 2001
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA01167;
	Wed, 17 Jan 2001 20:45:50 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id UAA15273;
	Wed, 17 Jan 2001 20:47:29 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Cc: mark0060@tc.umn.edu, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] PR#751
References: <200101170252.DAA19529@pubhealth.ku.dk> <x2hf2yirwo.fsf@blueberry.kubism.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 17 Jan 2001 20:47:27 +0100
In-Reply-To: Peter Dalgaard BSA's message of "17 Jan 2001 08:01:11 +0100"
Message-ID: <x2vgreyn8v.fsf@blueberry.kubism.ku.dk>
Lines: 47
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> > [1]   0+0i   0+0i -10+0i
> > 
> > which aren't all roots of x^3.
> 
> That one is way out, however. Even more "fun":
> 
> > polyroot(c(-100,0,1))
> [1]  10+0i -10+0i
> > x<- polyroot(c(0,0,0,1))
> > x
> [1]   0+0i   0+0i -10+0i
> > x<-polyroot(c(2,1,1))
> > x<- polyroot(c(0,0,0,1))
> > x
> [1]  0.0+0.000000i  0.0+0.000000i -0.5-1.322876i
> 
> I.e. the result of polyroot(c(0,0,0,1)) depends on the previous
> polyroot calculation! So there's more to the problem than numerical
> instability.
> 
> Thanks for pointing it out.

Found and fixed. Unfortunately the code had just forgotten to test for
the case where you end with a zero-degree polynomial after zero-root
removal, so the fix has zero effect on the accuracy issue. 

The fix is simply 

--- src/appl/cpoly.c    2000/11/24 21:34:31     1.20
+++ src/appl/cpoly.c    2001/01/17 19:45:24
@@ -148,6 +148,8 @@
     nn++;
     /*-- Now, global var.  nn := #{coefficients} = (relevant degree)+1 */
 
+    if (nn == 1) return;
+
     /* make a copy of the coefficients and shr[] = | p[] | */
     for (i = 0; i < nn; i++) {
        pr[i] = opr[i];

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Add-ons

* PR# 895 *
Subject: CI for wilcoxon test
From: kylouskova@euromise.cz
Date: Thu, 5 Apr 2001 11:02:47 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 895 <==
From kylouskova@euromise.cz  Thu Apr  5 11:02:47 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA07687
	for <R-bugs@biostat.ku.dk>; Thu, 5 Apr 2001 11:02:47 +0200 (MET DST)
Date: Thu, 5 Apr 2001 11:02:47 +0200 (MET DST)
From: kylouskova@euromise.cz
Message-Id: <200104050902.LAA07687@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: CI for wilcoxon test
MIME-Version: 1.0
Content-Type: text/plain; charset=unknown-8bit
Content-Transfer-Encoding: 8bit

Full_Name: Marketa Kylouskova
Version: 1.2.1
OS: Windows
Submission from: (NULL) (147.231.7.2)


Hi,
	I believe there is a bug in the extension of wilcox.test, namely in
determination of confidence intervals. I concentrated on the two-sample test
only. I examined and tested its performance on this working data set:

x<-rnorm(10,3,1)		# So I have two samples, I will test whether
y<-rnorm(10,0,1)		# x is greater than y, i.e. one-sided alternative “greater”

say 
x<-c(3.770684,4.654342,3.496403,1.772743,1.624953,2.645835,3.099477,1.706758,3.507709,1.982924)
y<-c(-0.8161288,0.1632923,0.6421997,1.9270846,-0.4668112,0.3587806,0.3312529,-0.5393900,
0.1057892,1.7963575)

then

wilcox.test(x,y,alternative="greater",conf.int=T)

gives

         Wilcoxon rank sum test 

data:  x and y 
W = 94, p-value = 0.0001624 
alternative hypothesis: true mu is greater than 0 
95 percent confidence interval:
 -3.344416        NA 

which is apparently contradictory (p-value is much less than 0.05 while exact CI
contains 0). I examined the code and I found that while the exact wilcoxon test
is applied on ranks of x (thus testing that mu = x – y is greater than 0), the
exact CI is computed based on differences y - x, hence finding a CI for mu = y –
x). The same applies, in my opinion, to approximative CI, where he optimization
interval is set as (mumin,mumax) with

mumin <- min(y) - max(x)
mumax <- max(y) - min(x)

I didn’t go through other aspects, although I believe that the continuity
correction should be checked if some changes are made, and also that some closer
look onto definitions of uci and lci in the exact CI computations should be made
(here it depends on your definition of the CI for exact distributions, i.e.
whether the CI = {uci<=mu<lci} (then I think it’s OK) or CI = {uci<=mu<=lci}
(then I think lci= diffs[ql] and not diffs[ql + 1]). Could this be specified in
the documentation?

Thank you in advance for checking my suspicions :) and for your reaction.

	Marketa Kylouskova
	kylouskova@euromise.cz


==> 895.audit <==
Sat Apr  7 10:28:00 2001	ripley	moved from incoming to Add-ons

==> 895.reply.1 <==
From hornik@ci.tuwien.ac.at  Sun Apr  8 16:39:36 2001
Received: from mr.tuwien.ac.at (mr.tuwien.ac.at [128.130.2.10])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA03167
	for <R-bugs@biostat.ku.dk>; Sun, 8 Apr 2001 16:39:35 +0200 (MET DST)
Received: from mithrandir.hornik.net (c18.dialin.tuwien.ac.at [192.35.243.28])
	by mr.tuwien.ac.at (8.11.1/8.11.1) with ESMTP id f38Ecef23970;
	Sun, 8 Apr 2001 16:38:52 +0200 (MET DST)
Received: from hornik by mithrandir.hornik.net with local (Exim 3.12 #1 (Debian))
	id 14mFzg-00029S-00; Sun, 08 Apr 2001 16:16:44 +0200
From: Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
Message-ID: <15056.29388.963897.379866@mithrandir.hornik.net>
Date: Sun, 8 Apr 2001 16:16:44 +0200
To: kylouskova@euromise.cz
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] CI for wilcoxon test (PR#895)
In-Reply-To: <200104050902.LAA07697@pubhealth.ku.dk>
References: <200104050902.LAA07697@pubhealth.ku.dk>
X-Mailer: VM 6.92 under Emacs 20.7.2
Reply-To: Kurt.Hornik@ci.tuwien.ac.at
Sender: Kurt Hornik <hornik@ci.tuwien.ac.at>

>>>>> kylouskova  writes:

> Full_Name: Marketa Kylouskova
> Version: 1.2.1
> OS: Windows
> Submission from: (NULL) (147.231.7.2)


> Hi,

> 	I believe there is a bug in the extension of wilcox.test, namely
> in determination of confidence intervals. I concentrated on the
> two-sample test only. I examined and tested its performance on this
> working data set:

> ...

> which is apparently contradictory (p-value is much less than 0.05
> while exact CI contains 0). I examined the code and I found that while
> the exact wilcoxon test is applied on ranks of x (thus testing that mu
> = x – y is greater than 0), the exact CI is computed based on
> differences y - x, hence finding a CI for mu = y – x). The same
> applies, in my opinion, to approximative CI, where he optimization
> interval is set as (mumin,mumax) with

> ...

Thanks for pointing this out.  The confidence interval was for the
difference in locations of y and x and should have been the other way
round.  Fixed now.

-k
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 496 *
From: bonneau@epi.roazhon.inra.fr (en148)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
--base R has no est.variogram function.
--This appears to be a bug report on sgeostat.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 496 <==
From bonneau@epi.roazhon.inra.fr  Tue Mar 21 11:40:23 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA24613
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 11:40:21 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA00472
	for <r-bugs@hypatia.math.ethz.ch>; Tue, 21 Mar 2000 11:40:33 +0100 (MET)
Received: from epi.roazhon.inra.fr(194.167.76.1)
 via SMTP by hypatia, id smtpdAAAa0007L; Tue Mar 21 11:40:28 2000
Received: from (bonneau@localhost)
          by epi.roazhon.inra.fr (8.8.8/jtpda-5.3) id KAA09010
          for r-bugs@lists.r-project.org; Tue, 21 Mar 2000 10:57:13 +0100 (MET)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
From: bonneau@epi.roazhon.inra.fr (en148)
Message-Id: <200003210957.KAA09010@epi.roazhon.inra.fr>

I am using R 0.65.1 under linux (Redhat 6.0),
and I have a problem with the est.variogram function when the first lag is empty (I am trying to estimate anisotropic varios)

fittedpnt<-point(fitted, x="X2", y="X3")
fittedpair<-pair(fittedpnt, num.lags=15, type="anisotropic", theta=60, dtheta=20, maxdist=maxfittedist)
fittedvario<-est.variogram(fittedpnt, fittedpair, "fit")

With my datas I have no pair in lags 1 to 3 and the error message is :
Error in psort(x, partial) : index 0 outside bounds

What can I do, in order to fix the bug ?

==> 496.audit <==
Sat Apr 01 07:32:27 2000	ripley	changed notes
Sat Apr 01 07:32:27 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 824 *
Subject: trouble with netCDF 
From: jasont@indigoindustrial.co.nz
Date: Thu, 25 Jan 2001 12:00:39 +1300
--Only on a specific sample file: send to maintainer.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 824 <==
From postmaster@franz.stat.wisc.edu  Thu Jan 25 00:00:38 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA13606
	for <r-bugs@biostat.ku.dk>; Thu, 25 Jan 2001 00:00:37 +0100 (MET)
Received: from smtp.worley.co.nz (really [203.167.214.58]) by franz.stat.wisc.edu
	via in.smtpd with esmtp (ident fwuser using rfc1413)
	id <m14LYuE-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Wed, 24 Jan 2001 17:00:46 -0600 (CST) 
Received: from camille.indigoindustrial.co.nz ([172.16.6.75]) by smtp.worley.co.nz with MailMarshal (3,3,0,0) 
	id <B00020733>; Thu, 25 Jan 2001 12:04:02 +1300
Received: (from jasont@localhost)
	by camille.indigoindustrial.co.nz (8.9.3/8.9.3) id MAA04889;
	Thu, 25 Jan 2001 12:00:39 +1300
Date: Thu, 25 Jan 2001 12:00:39 +1300
From: jasont@indigoindustrial.co.nz
Message-Id: <200101242300.MAA04889@camille.indigoindustrial.co.nz>
To: r-bugs@r-project.org
Subject: trouble with netCDF 
Cc: jasont@camille.indigoindustrial.co.nz

Having trouble with netCDF since I upgraded to 1.2.1 (did directly
from 1.1.1).  Package was recompiled after the upgrade.

Symptoms:
open.netCDF returns cleanly, but read.netCDF causes R to segfault
and dump core.  What else do you need me to write to help?

--please do not edit the information below--

Version:
 platform = i586-pc-linux-gnu
 arch = i586
 os = linux-gnu
 system = i586, linux-gnu
 status = 
 major = 1
 minor = 2.1
 year = 2001
 month = 01
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:netCDF, package:RODBC, package:ts, package:local, package:ctest, Autoloads, package:base

==> 824.followup.1 <==
From ripley@stats.ox.ac.uk  Thu Jan 25 00:09:14 2001
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA13639
	for <R-bugs@biostat.ku.dk>; Thu, 25 Jan 2001 00:09:13 +0100 (MET)
Received: from max166.public.ox.ac.uk (max166.public.ox.ac.uk [192.76.27.166])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id XAA09108;
	Wed, 24 Jan 2001 23:09:15 GMT
Date: Wed, 24 Jan 2001 23:07:56 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: <ripley@auk.stats>
To: <jasont@indigoindustrial.co.nz>
cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] trouble with netCDF (PR#824)
In-Reply-To: <200101242300.AAA13617@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.31.0101242303390.9789-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 25 Jan 2001 jasont@indigoindustrial.co.nz wrote:

> Having trouble with netCDF since I upgraded to 1.2.1 (did directly
> from 1.1.1).  Package was recompiled after the upgrade.

You did use netCDF_1.1 for 1.2.1 did you.  I wonder?
netCDF_1.0-1 will not work.

> Symptoms:
> open.netCDF returns cleanly, but read.netCDF causes R to segfault
> and dump core.  What else do you need me to write to help?

The first item is to report that it had passed R CMD check netCDF?  That
uses read.netCDF.  If so the problem is data-specific, if not it
is with your installation.  So we either need the data or a lot
more about your installation of netCDF.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 824.followup.2 <==
From jasont@indigoindustrial.co.nz  Thu Jan 25 01:18:34 2001
Received: from smtp.worley.co.nz (fwuser@fw.worley.co.nz [203.167.214.58])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA13908
	for <R-bugs@biostat.ku.dk>; Thu, 25 Jan 2001 01:18:30 +0100 (MET)
Received: from camille.indigoindustrial.co.nz ([172.16.6.75]) by smtp.worley.co.nz with MailMarshal (3,3,0,0) 
	id <B000207d7>; Thu, 25 Jan 2001 13:22:00 +1300
Received: (from jasont@localhost)
	by camille.indigoindustrial.co.nz (8.9.3/8.9.3) id NAA14287;
	Thu, 25 Jan 2001 13:18:38 +1300
Date: Thu, 25 Jan 2001 13:18:37 +1300
From: Jason Turner <jasont@indigoindustrial.co.nz>
To: r-bugs@r-project.org
Cc: jasont@indigoindustrial.co.nz, R-bugs@biostat.ku.dk
Subject: Re: [Rd] trouble with netCDF (PR#824)
Message-ID: <20010125131836.A4997@camille.indigoindustrial.co.nz>
References: <200101242300.AAA13617@pubhealth.ku.dk> <Pine.GSO.4.31.0101242303390.9789-100000@auk.stats>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
In-Reply-To: <Pine.GSO.4.31.0101242303390.9789-100000@auk.stats>; from ripley@stats.ox.ac.uk on Wed, Jan 24, 2001 at 11:07:56PM +0000


First and foremost, regarding:

> Please do not send bug reports to R-bugs and R-help: the first
> set goes to R-devel too which means that the active developers see it
> twice (and are probably twice as likely to ignore it, as I will next time). 

My appologies.  I'm well aware that R is a labour of love for those involved,
and I truly appreciate what they've given the rest of us.  The last thing
I want to do is irritate any of you.  Now trying to pull foot from 
mouth.  And making every note to not do this sort of thing in future.

Thanks for the quick reply with information.  

> You did use netCDF_1.1 for 1.2.1 did you.  

Yes.

> The first item is to report that it had passed R CMD check netCDF?  

Output from that is....

---Begin ~/R/netCDF.Rcheck/00check.log ---

* using log directory /home/jasont/R/netCDF.Rcheck
* checking for file `netCDF/DESCRIPTION' ... OK
* checking package directory ... OK
* checking DESCRIPTION Package field ... OK
* checking DESCRIPTION Version field ... OK
* checking DESCRIPTION Title field ... OK
* checking DESCRIPTION License field ... OK
* checking DESCRIPTION Author field ... OK
* checking DESCRIPTION Maintainer field ... WARNING
*   no DESCRIPTION Maintainer field found
* checking Rd files ... OK
* checking for undocumented objects ... OK
* creating netCDF-Ex.R ... OK
* checking examples ... OK
* creating netCDF-manual.tex ... OK
* checking netCDF-manual.tex ... OK

---End ~/R/netCDF.Rcheck/00check.log ---

Looks good to me.  As you've probably guessed, I'm new
to R, so take the following with the requisite number
of grains of salt:  in the R-ex directory, the 
read.netCDF.R file contains either blank lines
or commented lines, and nothing else.  There might
be some keywords there for the example software?

---Begin ~/R/netCDF.Rcheck/netCDF/R-ex/read.netCDF.R ---

###--- >>> `read.netCDF' <<<----- Read subsets of a netCDF file

        ## alias         help(read.netCDF)

##___ Examples ___:



## Keywords: 'file'.   
---End ~/R/netCDF.Rcheck/netCDF/R-ex/read.netCDF.R ---

That's it.


NetCDF installation:  version 3.4, built from source.
Other NetCDF utilities continue to work nicely, which 
is how I'm working around the issue.  Now, I'm taking
existing netCDF files, converting them to csv files,
and either reading them directly, or loading them
to PostgreSQL, and using RPgSQL or RODBC.  Conversion
to csv is done using home-brewed c programs which
were dynamically linked against libnetcdf.so.  As
such, I'm pretty sure the library is still working fine.

I have a nice sample netCDF file, but I doubt it's appropriate
for the bugs list (waste of bandwidth).  It's just under 2K.

-- 
Indigo Industrial Controls Ltd.
64-21-343-545
jasont@indigoindustrial.co.nz

==> 824.followup.3 <==
From postmaster@franz.stat.wisc.edu  Thu Jan 25 01:18:45 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA13922
	for <r-bugs@biostat.ku.dk>; Thu, 25 Jan 2001 01:18:45 +0100 (MET)
Received: from smtp.worley.co.nz (really [203.167.214.58]) by franz.stat.wisc.edu
	via in.smtpd with esmtp (ident fwuser using rfc1413)
	id <m14La7t-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Wed, 24 Jan 2001 18:18:57 -0600 (CST) 
Received: from camille.indigoindustrial.co.nz ([172.16.6.75]) by smtp.worley.co.nz with MailMarshal (3,3,0,0) 
	id <B000207d7>; Thu, 25 Jan 2001 13:22:00 +1300
Received: (from jasont@localhost)
	by camille.indigoindustrial.co.nz (8.9.3/8.9.3) id NAA14287;
	Thu, 25 Jan 2001 13:18:38 +1300
Date: Thu, 25 Jan 2001 13:18:37 +1300
From: Jason Turner <jasont@indigoindustrial.co.nz>
To: r-bugs@r-project.org
Cc: jasont@indigoindustrial.co.nz, R-bugs@biostat.ku.dk
Subject: Re: [Rd] trouble with netCDF (PR#824)
Message-ID: <20010125131836.A4997@camille.indigoindustrial.co.nz>
References: <200101242300.AAA13617@pubhealth.ku.dk> <Pine.GSO.4.31.0101242303390.9789-100000@auk.stats>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
In-Reply-To: <Pine.GSO.4.31.0101242303390.9789-100000@auk.stats>; from ripley@stats.ox.ac.uk on Wed, Jan 24, 2001 at 11:07:56PM +0000


First and foremost, regarding:

> Please do not send bug reports to R-bugs and R-help: the first
> set goes to R-devel too which means that the active developers see it
> twice (and are probably twice as likely to ignore it, as I will next time). 

My appologies.  I'm well aware that R is a labour of love for those involved,
and I truly appreciate what they've given the rest of us.  The last thing
I want to do is irritate any of you.  Now trying to pull foot from 
mouth.  And making every note to not do this sort of thing in future.

Thanks for the quick reply with information.  

> You did use netCDF_1.1 for 1.2.1 did you.  

Yes.

> The first item is to report that it had passed R CMD check netCDF?  

Output from that is....

---Begin ~/R/netCDF.Rcheck/00check.log ---

* using log directory /home/jasont/R/netCDF.Rcheck
* checking for file `netCDF/DESCRIPTION' ... OK
* checking package directory ... OK
* checking DESCRIPTION Package field ... OK
* checking DESCRIPTION Version field ... OK
* checking DESCRIPTION Title field ... OK
* checking DESCRIPTION License field ... OK
* checking DESCRIPTION Author field ... OK
* checking DESCRIPTION Maintainer field ... WARNING
*   no DESCRIPTION Maintainer field found
* checking Rd files ... OK
* checking for undocumented objects ... OK
* creating netCDF-Ex.R ... OK
* checking examples ... OK
* creating netCDF-manual.tex ... OK
* checking netCDF-manual.tex ... OK

---End ~/R/netCDF.Rcheck/00check.log ---

Looks good to me.  As you've probably guessed, I'm new
to R, so take the following with the requisite number
of grains of salt:  in the R-ex directory, the 
read.netCDF.R file contains either blank lines
or commented lines, and nothing else.  There might
be some keywords there for the example software?

---Begin ~/R/netCDF.Rcheck/netCDF/R-ex/read.netCDF.R ---

###--- >>> `read.netCDF' <<<----- Read subsets of a netCDF file

        ## alias         help(read.netCDF)

##___ Examples ___:



## Keywords: 'file'.   
---End ~/R/netCDF.Rcheck/netCDF/R-ex/read.netCDF.R ---

That's it.


NetCDF installation:  version 3.4, built from source.
Other NetCDF utilities continue to work nicely, which 
is how I'm working around the issue.  Now, I'm taking
existing netCDF files, converting them to csv files,
and either reading them directly, or loading them
to PostgreSQL, and using RPgSQL or RODBC.  Conversion
to csv is done using home-brewed c programs which
were dynamically linked against libnetcdf.so.  As
such, I'm pretty sure the library is still working fine.

I have a nice sample netCDF file, but I doubt it's appropriate
for the bugs list (waste of bandwidth).  It's just under 2K.

-- 
Indigo Industrial Controls Ltd.
64-21-343-545
jasont@indigoindustrial.co.nz

==> 824.followup.4 <==
From postmaster@franz.stat.wisc.edu  Thu Jan 25 01:43:44 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA14078
	for <r-bugs@biostat.ku.dk>; Thu, 25 Jan 2001 01:43:44 +0100 (MET)
Received: from smtp.worley.co.nz (really [203.167.214.58]) by franz.stat.wisc.edu
	via in.smtpd with esmtp (ident fwuser using rfc1413)
	id <m14LaW2-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Wed, 24 Jan 2001 18:43:54 -0600 (CST) 
Received: from camille.indigoindustrial.co.nz ([172.16.6.75]) by smtp.worley.co.nz with MailMarshal (3,3,0,0) 
	id <B00020813>; Thu, 25 Jan 2001 13:46:49 +1300
Received: (from jasont@localhost)
	by camille.indigoindustrial.co.nz (8.9.3/8.9.3) id NAA14352
	for r-bugs@r-project.org; Thu, 25 Jan 2001 13:43:26 +1300
Date: Thu, 25 Jan 2001 13:43:26 +1300
From: Jason Turner <jasont@indigoindustrial.co.nz>
To: r-bugs@r-project.org
Subject: Re: [Rd] trouble with netCDF (PR#824)
Message-ID: <20010125134325.A14333@camille.indigoindustrial.co.nz>
References: <200101242300.AAA13617@pubhealth.ku.dk> <Pine.GSO.4.31.0101242303390.9789-100000@auk.stats>
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
In-Reply-To: <Pine.GSO.4.31.0101242303390.9789-100000@auk.stats>; from ripley@stats.ox.ac.uk on Wed, Jan 24, 2001 at 11:07:56PM +0000

Another interesting point - read.netCDF does *not* cause
R to dump core if debug(read.netCDF) is on. To be clear:

> rm(list=ls(all=T))
> library(netCDF)

# --- works ---
> debug(read.netCDF)
> fd<-open.netCDF("data.nc")
> z<-read.netCDF(fd,"foo")

--- lots of stuff deleted ---

> length(z)
[1] 143
--- what it should be

> close.netCDF(fd)
[1] TRUE   

#--- end works ---

That works fine.  Carrying on in the same session:

# --- doesn't work ---

> rm(z,fd)
> undebug(read.netCDF)
> fd<-open.netCDF("data.nc")
> z<-read.netCDF(fd,"foo")
Segmentation fault (core dumped)   

# --- end doesn't work ---

Now more puzzled.

Jason Turner
-- 
Indigo Industrial Controls Ltd.
64-21-343-545
jasont@indigoindustrial.co.nz

==> 824.followup.5 <==
From ripley@stats.ox.ac.uk  Thu Jan 25 08:13:58 2001
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA15016
	for <R-bugs@biostat.ku.dk>; Thu, 25 Jan 2001 08:13:57 +0100 (MET)
Received: from max128.public.ox.ac.uk (max128.public.ox.ac.uk [192.76.27.128])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id HAA09811;
	Thu, 25 Jan 2001 07:14:08 GMT
Date: Thu, 25 Jan 2001 07:12:48 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: <ripley@auk.stats>
To: <jasont@indigoindustrial.co.nz>
cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] trouble with netCDF (PR#824)
In-Reply-To: <200101250018.BAA13932@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.31.0101250709440.10090-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 25 Jan 2001 jasont@indigoindustrial.co.nz wrote:

> NetCDF installation:  version 3.4, built from source.
> Other NetCDF utilities continue to work nicely, which
> is how I'm working around the issue.  Now, I'm taking
> existing netCDF files, converting them to csv files,
> and either reading them directly, or loading them
> to PostgreSQL, and using RPgSQL or RODBC.  Conversion
> to csv is done using home-brewed c programs which
> were dynamically linked against libnetcdf.so.  As
> such, I'm pretty sure the library is still working fine.
>
> I have a nice sample netCDF file, but I doubt it's appropriate
> for the bugs list (waste of bandwidth).  It's just under 2K.

I think the thing to do now is to contact the netCDF package
maintainer (Thomas Lumley) with that example.

As I am sure you appreciate we need to eliminate the simple causes first,
and they are common.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 824.audit <==
Mon Jan 29 08:33:45 2001	ripley	moved from incoming to Add-ons
Wed Feb 21 14:41:51 2001	ripley	changed notes
Wed Feb 21 14:41:51 2001	ripley	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 812 *
Subject: segmentation fault in integrate
From: Achim Zeileis <zeileis@ci.tuwien.ac.at>
Date: Thu, 11 Jan 2001 22:49:59 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 812 <==
From zeileis@ci.tuwien.ac.at  Thu Jan 11 22:49:50 2001
Received: from fangorn.ci.tuwien.ac.at (root@fangorn.ci.tuwien.ac.at [128.131.51.24])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA26987
	for <R-bugs@biostat.ku.dk>; Thu, 11 Jan 2001 22:49:50 +0100 (MET)
Received: from ci.tuwien.ac.at (zeileis@thorin.ci.tuwien.ac.at [128.131.51.33])
	by fangorn.ci.tuwien.ac.at (8.9.3/8.8.5) with ESMTP id WAA16997;
	Thu, 11 Jan 2001 22:49:28 +0100
X-Authentication-Warning: fangorn.ci.tuwien.ac.at: Host zeileis@thorin.ci.tuwien.ac.at [128.131.51.33] claimed to be ci.tuwien.ac.at
Sender: zeileis@ci.tuwien.ac.at
Message-ID: <3A5E2A87.6864792F@ci.tuwien.ac.at>
Date: Thu, 11 Jan 2001 22:49:59 +0100
From: Achim Zeileis <zeileis@ci.tuwien.ac.at>
X-Mailer: Mozilla 4.75 [en] (X11; U; Linux 2.2.15 i686)
X-Accept-Language: en
MIME-Version: 1.0
To: r-devel@stat.math.ethz.ch
CC: R-bugs@biostat.ku.dk
Subject: segmentation fault in integrate
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

I tried to integrate numerically a function wich is similar to the
following:

> dummy <- function(x) { exp(-1*x) * dnorm(x) }
> dummy(-100)
[1] 0
> dummy(-1000)
[1] NaN
> dummy(-10000)
[1] NaN

If I choose the lower boundary to be too small integrate causes a
segmentation fault:

> library(integrate)
> integrate(dummy, -100, 0)$value
[1] 1.387143
> integrate(dummy, -1000, 0)$value
[1] NaN
Warning message:
Ifail=1, maxpts was too small. Check the returned relerr! in: adapt(1,
lower, upper, minpts, maxpts, functn, eps, ...)
> integrate(dummy, -10000, 0)$value
Segmentation fault

I'm running R.1.2.0 on Debian Linux.

Regards
Achim


> version
         _                
platform i686-pc-linux-gnu
arch     i686             
os       linux-gnu        
system   i686, linux-gnu  
status                    
major    1                
minor    2.0              
year     2000             
month    12               
day      15               
language R   



-------------------------

Achim Zeileis
Institut für Statistik
Technische Universität Wien

==> 812.audit <==
Sat Jan 13 18:52:20 2001	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Analyses

* PR# 861 *
Subject: histogram of frequencies
From: bernd.winkler@genedata.com
Date: Mon, 5 Mar 2001 15:01:49 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 861 <==
From bernd.winkler@genedata.com  Mon Mar  5 15:01:54 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA28195
	for <R-bugs@biostat.ku.dk>; Mon, 5 Mar 2001 15:01:49 +0100 (MET)
Date: Mon, 5 Mar 2001 15:01:49 +0100 (MET)
From: bernd.winkler@genedata.com
Message-Id: <200103051401.PAA28195@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: histogram of frequencies

Full_Name: Dr. Bernd Winkler
Version: 1.2.2
OS: Linux
Submission from: (NULL) (194.59.179.176)


Hi all,

having updated to version 1.2.2 last week I experienced some strange behaviour
of 
the hist function.

I want to plot a histogram of frequencies resp. counts, for example poisson 
random numbers, on a predefined and fixed x scale

> hist(rpois(500, 2), breaks=0:10)

But instead of the frequencies I get the density of these data.
Introducing the parameter freq=TRUE then I get the frequencies but 
with the following warning message

> hist(rpois(500, 2),breaks=0:10, freq=TRUE)
Warning message: 
the AREAS in the plot are wrong -- rather use `freq=FALSE'! in:
plot.histogram(r, freq = freq, col = col, border = border, main = main,  

The following excerpt from hist.default(...) (new in 1.2.2) might have caused
this behaviour:
    ...
    diddle <- 1e-07 * max(abs(range(breaks)))
    fuzz <- if (right) 
        c(if (include.lowest) -diddle else diddle, rep(diddle, 
            length(breaks) - 1))
    else c(rep(-diddle, length(breaks) - 1), if (include.lowest) diddle else
-diddle)
    breaks <- breaks + fuzz
    ...

The addition of the fuzz variable to the breaks causes hist 
to think of no equidistant breaks (even if they are) and therefore 
a density plot is generated by default. Removing these lines the 
behaviour is like the one in version 1.2.1 and earlier. 
Is there an alternative doing this with the new version?
And what about the border color parameter in barplot?

Many thanks in advance

Bernd





==> 861.followup.1 <==
From pd@biostat.ku.dk  Mon Mar  5 15:55:24 2001
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA29844;
	Mon, 5 Mar 2001 15:55:23 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id PAA28469;
	Mon, 5 Mar 2001 15:59:38 +0100
Sender: pd@blueberry.kubism.ku.dk
To: bernd.winkler@genedata.com
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] histogram of frequencies (PR#861)
References: <200103051401.PAA28206@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@pubhealth.ku.dk>
Date: 05 Mar 2001 15:59:37 +0100
In-Reply-To: bernd.winkler@genedata.com's message of "Mon, 5 Mar 2001 15:01:55 +0100 (MET)"
Message-ID: <x2itlob6sm.fsf@blueberry.kubism.ku.dk>
Lines: 25
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

bernd.winkler@genedata.com writes:

> The addition of the fuzz variable to the breaks causes hist 
> to think of no equidistant breaks (even if they are) and therefore 
> a density plot is generated by default. Removing these lines the 
> behaviour is like the one in version 1.2.1 and earlier. 
> Is there an alternative doing this with the new version?
> And what about the border color parameter in barplot?

Argh! This just goes to prove how hard it is to fix one bug without
introducing another.... 

The two types of fuzz in hist.default should not be of the same size! 
Try setting the multiplier in "diddle" to a smaller value, like 1e-12.
Either that or we should test for equidistant breaks before adding the
fuzz. 

It only happens with user-specified breaks, though, and the error
message with freq=T is of course ignorable.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 861.audit <==
Mon Mar 12 08:16:46 2001	ripley	moved from incoming to Analyses
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Documentation

* PR# 886 *
Subject: Error (?) in documentation of 'swiss' data in R base package
From: k.j.mcconway@open.ac.uk
Date: Wed, 28 Mar 2001 16:46:49 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 886 <==
From k.j.mcconway@open.ac.uk  Wed Mar 28 16:46:49 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA22290
	for <R-bugs@biostat.ku.dk>; Wed, 28 Mar 2001 16:46:49 +0200 (MET DST)
Date: Wed, 28 Mar 2001 16:46:49 +0200 (MET DST)
From: k.j.mcconway@open.ac.uk
Message-Id: <200103281446.QAA22290@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Error (?) in documentation of 'swiss' data in R base package

Full_Name: Kevin McConway
Version: 1.2.2
OS: WinNT
Submission from: (NULL) (137.108.11.58)


Hardly crucial, but I've come upon a potential error in the documentation of the
'swiss' datafram in the R base package. The description accurately matches what
is said in the Mosteller and Tukey source quoted, but according to the data
archived at Princeton (links from
http://opr.princeton.edu/archive/eufert/switz.html), the variable that Mosteller
and Tukey report as infant mortality is actually the proportion of 'draftees'
with education beyond primary school. Infant mortality is on the archived file,
but the values are quite a lot different. Of course, it's possible that
Mosteller and Tukey were right and the people who did the archiving at
Princenton, later, got it wrong.

==> 886.audit <==
Sat Apr  7 10:29:17 2001	ripley	moved from incoming to Documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 856 *
Subject: "}  {" problem in Rd files
From: Paul Gilbert <pgilbert@bank-banque-canada.ca>
Date: Mon, 26 Feb 2001 11:10:01 -0500
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 856 <==
From pgilbert@bank-banque-canada.ca  Mon Feb 26 17:16:58 2001
Received: from mail1.bank-banque-canada.ca (mail1.bank-banque-canada.ca [140.80.193.130])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA18037
	for <r-bugs@biostat.ku.dk>; Mon, 26 Feb 2001 17:16:57 +0100 (MET)
Received: from fwx-t1 ([140.80.193.132])
	by mail1.bank-banque-canada.ca (8.9.3/8.9.3) with SMTP id LAA17531
	for <r-bugs@biostat.ku.dk>; Mon, 26 Feb 2001 11:10:43 -0500 (EST)
Message-ID: <3A9A7FD9.91F9481D@bank-banque-canada.ca>
Date: Mon, 26 Feb 2001 11:10:01 -0500
From: Paul Gilbert <pgilbert@bank-banque-canada.ca>
X-Mailer: Mozilla 4.7 [en] (Win95; U)
X-Accept-Language: en
MIME-Version: 1.0
To: R-bugs <r-bugs@biostat.ku.dk>
Subject: "}  {" problem in Rd files
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

I better report this before I forget again (I think it may also be a
problem with \item) :

>Paul Gilbert wrote:

>> >   \section{Model Parameters}{
>>
>> I seem to recall having a bit of trouble with this quietly omitting
things when the
>> last "{" had a space before it or was on a new line. I'm not sure if
that >>is still a problem (or if indeed it ever was).

>Indeed it is, and there would be a few extra dents in the wall at head
>height here if you had not mentioned it.  Thanks.

>Jim





==> 856.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Feb 26 18:12:13 2001
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA18466
	for <R-bugs@biostat.ku.dk>; Mon, 26 Feb 2001 18:12:12 +0100 (MET)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id RAA02535;
	Mon, 26 Feb 2001 17:12:21 GMT
Message-Id: <200102261712.RAA02535@toucan.stats.ox.ac.uk>
Date: Mon, 26 Feb 2001 17:12:20 +0000 (GMT)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] "}  {" problem in Rd files (PR#856)
To: pgilbert@bank-banque-canada.ca
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: lrHcNbcNEsNc+755EcdjxQ==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 


> From: pgilbert@bank-banque-canada.ca
> Date: Mon, 26 Feb 2001 17:16:59 +0100 (MET)
> To: r-devel@stat.math.ethz.ch
> Subject: [Rd] "}  {" problem in Rd files (PR#856)
> CC: R-bugs@biostat.ku.dk
> X-Loop: R-bugs@biostat.ku.dk
> 
> I better report this before I forget again (I think it may also be a
> problem with \item) :
> 
> >Paul Gilbert wrote:
> 
> >> >   \section{Model Parameters}{
> >>
> >> I seem to recall having a bit of trouble with this quietly omitting
> things when the
> >> last "{" had a space before it or was on a new line. I'm not sure if
> that >>is still a problem (or if indeed it ever was).
> 
> >Indeed it is, and there would be a few extra dents in the wall at head
> >height here if you had not mentioned it.  Thanks.

Also \deqn, \eqn.  However, they do work when used as documented
in R-exts, so I am not sure this is a bug.  Adding new lines and spaces
is a problem in other places in Rd too: not a fatal one but gets
unwanted spaces in the output.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 856.audit <==
Sun Mar  4 10:14:49 2001	ripley	moved from incoming to Documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Graphics

* PR# 897 *
Subject:  bug in contour() ? 
From: kuensch@stat.math.ethz.ch
Date: Fri, 6 Apr 2001 16:21:24 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 897 <==
From postmaster@franz.stat.wisc.edu  Fri Apr  6 16:21:28 2001
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA26071
	for <r-bugs@biostat.ku.dk>; Fri, 6 Apr 2001 16:21:27 +0200 (MET DST)
Received: from stat.math.ethz.ch (really [129.132.58.23]) by franz.stat.wisc.edu
	via smail with esmtp (ident daemon using rfc1413)
	id <m14lX7B-000JcCC@franz.stat.wisc.edu> (Debian Smail3.2.0.111)
	for <r-bugs@r-project.org>; Fri, 6 Apr 2001 09:21:29 -0500 (CDT) 
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id QAA21329;
	Fri, 6 Apr 2001 16:21:27 +0200 (MET DST)
Received: from helen(129.132.58.10), claiming to be "helen.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005BW; Fri Apr  6 16:21:24 2001
Received: (kuensch@localhost) by helen.ethz.ch (8.9.3/D-MATH-client) id QAA02887; Fri, 6 Apr 2001 16:21:24 +0200
Date: Fri, 6 Apr 2001 16:21:24 +0200
From: kuensch@stat.math.ethz.ch
Message-Id: <200104061421.QAA02887@helen.ethz.ch>
To: r-bugs@r-project.org
Subject:  bug in contour() ? 
Cc: kuensch@stat.math.ethz.ch

The following example just "hangs", i.e.
the final contour() does not terminate.

x <- pi*(0.5+((-13):12))/36
w <- 0.377*cos(2*x)*sqrt(abs(cos(2*x)))
v <- c(rep(-1.47,13),rep(1.722,13))*abs(sin(x))^1.5
cr  <- outer(w,w)+outer(v,v)
s <- sqrt(diag(cr))
cr <- cr/outer(s,s)
contour(cr[1:26,26:1],levels=seq(-1,1,0.1),axes=T)




--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 1
 minor = 2.2
 year = 2001
 month = 02
 day = 26
 language = R

Search Path:
 .GlobalEnv, package:ctest, package:SfS, Autoloads, package:base

==> 897.followup.1 <==
From ligges@statistik.uni-dortmund.de  Fri Apr  6 16:42:05 2001
Received: from nx5.HRZ.Uni-Dortmund.DE (nx5.HRZ.Uni-Dortmund.DE [129.217.131.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA27043
	for <R-bugs@biostat.ku.dk>; Fri, 6 Apr 2001 16:42:05 +0200 (MET DST)
Received: from amadeus.statistik.uni-dortmund.de by nx5.HRZ.Uni-Dortmund.DE
          via smtp-local with ESMTP; Fri, 6 Apr 2001 16:42:14 +0200
Received: from statistik.uni-dortmund.de ([129.217.207.201])
	by amadeus.statistik.uni-dortmund.de (8.9.3+Sun/8.9.3) with ESMTP id QAA27685;
	Fri, 6 Apr 2001 16:42:14 +0200 (MET DST)
Message-ID: <3ACDD5BE.D7368980@statistik.uni-dortmund.de>
Date: Fri, 06 Apr 2001 16:42:06 +0200
From: Uwe Ligges <ligges@statistik.uni-dortmund.de>
Organization: Fachbereich Statistik, Universitaet Dortmund
X-Mailer: Mozilla 4.76 [en] (WinNT; U)
X-Accept-Language: en
MIME-Version: 1.0
To: kuensch@stat.math.ethz.ch
CC: R-bugs@biostat.ku.dk
Subject: Re: [Rd] bug in contour() ? (PR#897)
References: <200104061421.QAA26081@pubhealth.ku.dk>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

kuensch@stat.math.ethz.ch wrote:
> 
> The following example just "hangs", i.e.
> the final contour() does not terminate.
> 
> x <- pi*(0.5+((-13):12))/36
> w <- 0.377*cos(2*x)*sqrt(abs(cos(2*x)))
> v <- c(rep(-1.47,13),rep(1.722,13))*abs(sin(x))^1.5
> cr  <- outer(w,w)+outer(v,v)
> s <- sqrt(diag(cr))
> cr <- cr/outer(s,s)
> contour(cr[1:26,26:1],levels=seq(-1,1,0.1),axes=T)
> 
> --please do not edit the information below--
> 
> Version:
>  platform = i686-pc-linux-gnu
>  arch = i686
>  os = linux-gnu
>  system = i686, linux-gnu
>  status =
>  major = 1
>  minor = 2.2
>  year = 2001
>  month = 02
>  day = 26
>  language = R


... and R crashes on WinNT 4.0.

Uwe Ligges

==> 897.followup.2 <==
From tlumley@u.washington.edu  Fri Apr  6 17:49:28 2001
Received: from jason03.u.washington.edu (jason03.u.washington.edu [140.142.8.11])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA27517
	for <R-bugs@biostat.ku.dk>; Fri, 6 Apr 2001 17:49:26 +0200 (MET DST)
Received: from homer01.u.washington.edu (tlumley@homer01.u.washington.edu [140.142.15.35])
	by jason03.u.washington.edu (8.11.2+UW01.01/8.11.2+UW01.03) with ESMTP id f36FnYi39408;
	Fri, 6 Apr 2001 08:49:34 -0700
Received: from localhost (tlumley@localhost)
	by homer01.u.washington.edu (8.11.2+UW01.01/8.11.2+UW01.03) with ESMTP id f36FnYT192530;
	Fri, 6 Apr 2001 08:49:34 -0700
Date: Fri, 6 Apr 2001 08:49:34 -0700 (PDT)
From: Thomas Lumley <tlumley@u.washington.edu>
To: <r-devel@stat.math.ethz.ch>
cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] bug in contour() ? (PR#897)
In-Reply-To: <200104061421.QAA26081@pubhealth.ku.dk>
Message-ID: <Pine.A41.4.33.0104060843400.89396-100000@homer01.u.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 6 Apr 2001 kuensch@stat.math.ethz.ch wrote:

> The following example just "hangs", i.e.
> the final contour() does not terminate.
>
> x <- pi*(0.5+((-13):12))/36
> w <- 0.377*cos(2*x)*sqrt(abs(cos(2*x)))
> v <- c(rep(-1.47,13),rep(1.722,13))*abs(sin(x))^1.5
> cr  <- outer(w,w)+outer(v,v)
> s <- sqrt(diag(cr))
> cr <- cr/outer(s,s)
> contour(cr[1:26,26:1],levels=seq(-1,1,0.1),axes=T)

It's following a list that ends up being circular (loop of about 10
entries) around plot3d.c:697.

I don't understand the code that sets up the segment database, but
presumably there's a bug there. The loop happens in the same place under
gctorture, so I don't think it's memory management.

	-thomas


> --please do not edit the information below--
>
> Version:
>  platform = i686-pc-linux-gnu
>  arch = i686
>  os = linux-gnu
>  system = i686, linux-gnu
>  status =
>  major = 1
>  minor = 2.2
>  year = 2001
>  month = 02
>  day = 26
>  language = R
>
> Search Path:
>  .GlobalEnv, package:ctest, package:SfS, Autoloads, package:base
>
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
>

Thomas Lumley			Asst. Professor, Biostatistics
tlumley@u.washington.edu	University of Washington, Seattle
^^^^^^^^^^^^^^^^^^^^^^^^
 NOTE NEW EMAIL ADDRESS



==> 897.audit <==
Sat Apr  7 10:28:00 2001	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 202 *
Subject: persp box occlusion bug
From: wsi@gcal.ac.uk
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
--The persp algorithm does not apply the occlusion rules to the frame, 
--which is always plotted first. 
--A bug, but not very simple to fix.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 202 <==
From wsi@gcal.ac.uk  Wed Jun  2 15:02:10 1999
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA27126
	for <R-bugs@biostat.ku.dk>; Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
From: wsi@gcal.ac.uk
Message-Id: <199906021302.PAA27126@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: persp box occlusion bug

Full_Name: Bill Simpson
Version: 64.1
OS: linux
Submission from: (NULL) (193.62.250.209)


Bug in persp() bounding box:
If the surface being plotted extends below the lower z-axis boundary, the box
is
drawn with the wrong occlusion. The box is shown as being occluded by the
surface
even though it should be in front of the surface.

The box is correct for surface extending above the box. Problem is only for
surface extending below the box.

This exhibits the bug:

std<-rep(seq(-32,32,8),9)/1000 * 60
cf<-rep(seq(-32,32,8),rep(9,9))/1000 *60 
dp<-(cf-std)/.6
std<-unique(std)
cf<-unique(cf)
dp<-t(matrix(dp,length(cf),length(std)))
persp(std,cf,dp, xlim=c(-2,2), ylim=c(-2,2), zlim=c(0,5),theta=-40,    
phi=45,
box=TRUE,ltheta=-120, lphi=120,
d=1.5, shade=.7)


==> 202.audit <==
Wed Jun 30 19:31:18 1999	pd	moved from incoming to Graphics
Thu Jul 01 18:19:48 1999	pd	changed notes
Sun Feb 20 10:07:11 2000	ripley	changed notes
Mon Feb 28 17:17:51 2000	pd	changed notes
Mon Feb 28 17:18:28 2000	pd	changed notes
Mon Feb 28 17:19:35 2000	pd	changed notes
Mon Feb 28 17:20:17 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 750 *
Subject: abline() does not obey "xpd" (clipping rules)
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 27 Nov 2000 18:27:11 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 750 <==
From maechler@stat.math.ethz.ch  Mon Nov 27 18:27:05 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA04861
	for <R-bugs@biostat.ku.dk>; Mon, 27 Nov 2000 18:27:04 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA21229
	for <R-bugs@stat.math.ethz.ch>; Mon, 27 Nov 2000 18:27:14 +0100 (MET)
Received: from UNKNOWN(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005Bf; Mon Nov 27 18:27:12 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id SAA01940; Mon, 27 Nov 2000 18:27:11 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14882.39279.553452.20503@gargle.gargle.HOWL>
Date: Mon, 27 Nov 2000 18:27:11 +0100
To: R-bugs@stat.math.ethz.ch
Subject: abline() does not obey "xpd" (clipping rules)
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

This is not a bug in the very strict sense,
but for consistency,  
I feel that
    abline() 
should obey  par("xpd") setting, even by ...-argument.
The following code shows how  lines() ``works'' and abline() does not :

  par(mfrow=c(2,1))
  plot(1:4)
  plot(1:10)
  par(xpd=NA); abline(v=1:10); par(xpd=FALSE)
  ## or even
  abline(v=1:10, xpd = NA, col = "purple")
  ## lines() *does* work with xpd arg:
  lines(4:5,c(1,40), col = 2, xpd = FALSE)# clip to plot
  lines(5:6,c(1,40), col = 3, xpd = TRUE)# clip to figure
  lines(6:7,c(1,20), col = 4, xpd = NA)# clip to device 
  text(4:6, 10.5, "xpd =", xpd = TRUE, col = 2:4)
  text(4:6, 10, c("FALSE","TRUE","NA"), col = 2:4, adj = 0)


Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 750.reply.1 <==
From maechler@stat.math.ethz.ch  Wed Nov 29 14:02:47 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA24751
	for <R-bugs@biostat.ku.dk>; Wed, 29 Nov 2000 14:02:46 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id OAA15367
	for <R-bugs@biostat.ku.dk>; Wed, 29 Nov 2000 14:03:01 +0100 (MET)
Received: from UNKNOWN(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa003k0; Wed Nov 29 14:02:57 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id OAA05829; Wed, 29 Nov 2000 14:02:56 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14884.65152.785676.980519@gargle.gargle.HOWL>
Date: Wed, 29 Nov 2000 14:02:56 +0100
To: R-bugs@biostat.ku.dk
Subject: abline() AND rect() do not obey "xpd" (clipping) (PR#750)
In-Reply-To: <200011271727.SAA04871@pubhealth.ku.dk>
References: <200011271727.SAA04871@pubhealth.ku.dk>
X-Mailer: VM 6.86 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:

    MM> This is not a bug in the very strict sense,
    MM> but for consistency,  
    MM> I feel that
    MM> abline() 
    MM> should obey  par("xpd") setting, even by ...-argument.
    MM> The following code shows how  lines() ``works'' and abline() does not :

    MM> par(mfrow=c(2,1))
    MM> plot(1:4)
    MM> plot(1:10)
    MM> par(xpd=NA); abline(v=1:10); par(xpd=FALSE)
    MM> ## or even
    MM> abline(v=1:10, xpd = NA, col = "purple")
    MM> ## lines() *does* work with xpd arg:
    MM> lines(4:5,c(1,40), col = 2, xpd = FALSE)# clip to plot
    MM> lines(5:6,c(1,40), col = 3, xpd = TRUE)# clip to figure
    MM> lines(6:7,c(1,20), col = 4, xpd = NA)# clip to device 
    MM> text(4:6, 10.5, "xpd =", xpd = TRUE, col = 2:4)
    MM> text(4:6, 10, c("FALSE","TRUE","NA"), col = 2:4, adj = 0)

Also, 
      rect() 
fails similarly.
This gives funny legend()s :

 plot(1:10)
 legend(1,7.5,  c("1st", "2nd", "third"), col = 1:3, lwd = 1:3, pch = 1:3)
 op <- par(xpd = NA)
 legend(1,11.5, c("1st", "2nd", "third"), col = 1:3, lwd = 1:3, pch = 1:3)
 ## pch = 1 also doesn't ?!?? ?? why??  It does here :
 points(2+ 1:8, rep(11, 8), pch = 1:8, col = "purple")
 ## and other pch's do here
 legend(4,11.9, c("1st", "2nd", "third"), col = 1:3, lwd = 1:3, pch = 6:4)
 par(op)

## Note that there seems another peculiar clipping bug 
##       with pch = 1 in legend

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 750.audit <==
Wed Nov 29 14:17:37 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 660 *
Subject: identify.default ignores any setting of cex.
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Fri, 15 Sep 2000 10:23:39 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 660 <==
From postmaster@franz.stat.wisc.edu  Fri Sep 15 11:23:32 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA13327
	for <R-bugs@biostat.ku.dk>; Fri, 15 Sep 2000 11:23:32 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA17846
	for <r-bugs@hypatia.math.ethz.ch>; Fri, 15 Sep 2000 11:23:49 +0200 (MET DST)
Received: from franz.stat.wisc.edu(128.105.174.95)
 via SMTP by hypatia, id smtpdAAAa004Mn; Fri Sep 15 11:23:42 2000
Received: from toucan.stats.ox.ac.uk (really [163.1.20.20]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m13Zrkl-000IW0C@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <R-bugs@r-project.org>; Fri, 15 Sep 2000 04:25:51 -0500 (CDT) 
Received: from localhost (ripley@localhost)
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id KAA14892
	for <R-bugs@r-project.org>; Fri, 15 Sep 2000 10:23:39 +0100 (BST)
X-Authentication-Warning: toucan.stats: ripley owned process doing -bs
Date: Fri, 15 Sep 2000 10:23:39 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
X-Sender: ripley@toucan.stats
To: R-bugs@r-project.org
Subject: identify.default ignores any setting of cex.
Message-ID: <Pine.GSO.4.05.10009151011510.14885-100000@toucan.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

R 1.1.1 on Windows, but I think this is widespread.

Using either

par(cex=0.5)
plot(1:10)
identify(1:10)

or

plot(1:10)
identify(1:10, cex=0.5)

ignores the cex setting.  The root cause is that par(cex=0.5)
alters cexbase for the device but sets cex=1.0, and the internal
text plotting routines use cex and not cexbase.

The obvious fix is to set cex to cexbase in do_identify. However,
if this is fixed, there is another problem, The offset of the label
is related to the cex in use for the label, and not for the symbol.
So

plot(1:10, type="n")
points(1:10, cex=5)
identify(1:10)

is not sensible in placing the labels.  That may be hard to anticipate,
but 

plot(1:10)
identify(1:10, cex=0.5)

needs to use cex=1 not cex=0.5 for the adjustment.  Perhaps identify is
trying too hard, and should give the user more control over the precise
position of the label (as S-PLUS does).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 660.audit <==
Wed Oct 25 06:57:35 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 791 *
Subject:  par(lab= *) / axis(*) bug 
From: maechler@stat.math.ethz.ch
Date: Fri, 22 Dec 2000 10:59:26 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 791 <==
From postmaster@franz.stat.wisc.edu  Fri Dec 22 10:59:23 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA08619
	for <r-bugs@biostat.ku.dk>; Fri, 22 Dec 2000 10:59:23 +0100 (MET)
Received: from stat.math.ethz.ch (really [129.132.58.23]) by franz.stat.wisc.edu
	via in.smtpd with esmtp (ident daemon using rfc1413)
	id <m149OzA-000IXMC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Fri, 22 Dec 2000 03:59:36 -0600 (CST) 
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA02617;
	Fri, 22 Dec 2000 10:59:34 +0100 (MET)
Received: from UNKNOWN(129.132.58.33), claiming to be "florence.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa000cp; Fri Dec 22 10:59:26 2000
Received: (maechler@localhost) by florence.ethz.ch (8.9.3/D-MATH-client) id KAA23075; Fri, 22 Dec 2000 10:59:26 +0100
Date: Fri, 22 Dec 2000 10:59:26 +0100
From: maechler@stat.math.ethz.ch
Message-Id: <200012220959.KAA23075@florence.ethz.ch>
To: r-bugs@r-project.org
Subject:  par(lab= *) / axis(*) bug 
Cc: maechler@stat.math.ethz.ch

As the subject says,
here is example code (with comments) showing the problem:

p1 <- function(lab = c(8,12,7))
{
    ## This `fails' (on a virgin device)
    clab <- paste(lab,collapse=",")
    plot(1,1, xlim = c(0,15), ylim = c(-.8,1), type ="n", axes = FALSE,
         main=paste("plot(*,axes=F); par(lab= c(",clab,"));  axis(*) x 2",sep=""))
    box(col="gray80")
    op <- par(lab = lab) ; on.exit(par(op))
    axis(1, pos = 0)
    axis(2, pos = 0, las = 1)
    par(op)
    op
}

p2 <- function(lab = c(8,12,7))
{
    ## This works  [par()  *BEFORE*  plot() ]
    clab <- paste(lab,collapse=",")
    op <- par(lab = lab) ; on.exit(par(op))

    plot(1,1, xlim = c(0,15), ylim = c(-.8,1), type ="n", axes = FALSE,
         main=paste("par(lab= c(",clab,")); plot(*,axes=F); axis(*) x 2",sep=""))
    box(col="gray80")
    axis(1, pos = 0)
    axis(2, pos = 0, las = 1)
    op ## lab 5 5 7
}

dev.off()
par(mfrow=c(2,1), mar=c(2,2,3,1))
p1()
p2()




--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Patched
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 19
 language = R

Search Path:
 .GlobalEnv, package:nls, package:splines, package:lqs, package:modreg, package:stepfun, package:mva, package:eda, package:ts, package:VLMC, package:ctest, package:SfS, Autoloads, package:base

==> 791.audit <==
Tue Dec 26 10:31:10 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 776 *
Subject: strwidth does not take font into account
From: Martyn Plummer <plummer@iarc.fr>
Date: Tue, 19 Dec 2000 14:56:01 +0100 (CET)
--This needs a substantial redesign.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 776 <==
From postmaster@franz.stat.wisc.edu  Tue Dec 19 14:53:40 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA05819
	for <r-bugs@biostat.ku.dk>; Tue, 19 Dec 2000 14:53:39 +0100 (MET)
Received: from smtp02.iarc.fr (really [212.157.236.234]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m148NHG-000IYiC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 07:58:02 -0600 (CST) 
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id OAA21720
	for <r-bugs@r-project.org>; Tue, 19 Dec 2000 14:53:55 +0100
Message-ID: <XFMail.001219145601.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
Date: Tue, 19 Dec 2000 14:56:01 +0100 (CET)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: r-bugs@r-project.org
Subject: strwidth does not take font into account

One for the wishlist.

The text() function permits the use of different fonts with the arguments
"font" or "vfont".  These create text strings of the same height as the
default font, but of different widths: bold face is slightly wider; vector
fonts are usually much wider.  I think the strwidth() function needs to
take the font into account by also having "font" and "vfont" arguments.
Currently it reports the string width using the default font, which can
be quite different.

Here is a little test function you can use to see how far off the
reported string width is.

test.strwidth <-
function(text, vfont=NULL, cex=NULL, ...)
{
 plot(0,0,xlim=c(-1,1),ylim=c(-1,1), type="n")
 text(0,0, text, adj=c(0,0), offset=0, cex=cex, vfont=vfont, ...)
 abline(h=c(0, strheight(text, cex=cex)), lty=2)
 abline(v=c(0, strwidth(text, cex=cex)), lty=2)
}

e.g.

test.strwidth("This is some text", cex=2)
test.strwidth("This is some text", cex=2, font=2)
test.strwidth("This is some text", vfont=c("sans serif", "plain"))

Martyn

Please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status =
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base




==> 776.audit <==
Tue Dec 26 10:31:10 2000	ripley	moved from incoming to Graphics
Sat Feb 24 08:55:28 2001	ripley	changed notes
Sat Feb 24 08:55:28 2001	ripley	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 820 *
Subject: interaction.plot
From: "Mark M. Span" <span@psy.uva.nl>
Date: Mon, 22 Jan 2001 10:47:39 +0100
--mtext is unscaled by default.  It is not clear if this should
--use the par("cex") setting or an inline cex setting such as cex.axis.
--It might make more sense to use axis rather than mtext, as boxplot does.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 820 <==
From postmaster@franz.stat.wisc.edu  Mon Jan 22 10:43:38 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA09043
	for <r-bugs@biostat.ku.dk>; Mon, 22 Jan 2001 10:43:37 +0100 (MET)
Received: from mail.psy.uva.nl (really [145.18.113.16]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14KdVr-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Mon, 22 Jan 2001 03:43:47 -0600 (CST) 
Received: from rea2205 (rea2205.psy.uva.nl [145.18.152.205])
	by mail.psy.uva.nl (8.9.3/8.9.3) with SMTP id KAA21513
	for <r-bugs@r-project.org>; Mon, 22 Jan 2001 10:43:45 +0100 (MET)
Message-ID: <008501c08458$5bfc6530$cd981291@psy.uva.nl>
From: "Mark M. Span" <span@psy.uva.nl>
To: <r-bugs@r-project.org>
Subject: interaction.plot
Date: Mon, 22 Jan 2001 10:47:39 +0100
Organization: UvA
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.50.4133.2400
X-MimeOLE: Produced By Microsoft MimeOLE V5.50.4133.2400

I notices some indesireable behaviour in interaction.plot. The scaling of
the x-axis labels discards the overall settings for the 'cex' attribute,
leading to unscaled labels. The source for this behaviour is the line

mtext(xlabs, 1, at = xvals)

in interaction.plot.

to get this function to perform conform the manual, change this line to

mtext(xlabs, 1, at = xvals, cex=par("cex"))

and all is well.

because of the simplicity of this 'fix' I assume that it is a crossplatform
thingie, but for the record:

I use R-Win in winNT, 1.2.0, upgrading soon.

just my .02 euro..

I'll just end this mail with a standard declaration of love for R

greetz. Mark M. Span


==> 820.audit <==
Thu Jan 25 00:05:53 2001	ripley	moved from incoming to Graphics
Sat Feb 24 08:53:40 2001	ripley	changed notes
Sat Feb 24 08:53:40 2001	ripley	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 816 *
Subject: dotplot: character size of labels
From: RINNER Heinrich <H.RINNER@TIROL.GV.AT>
Date: Thu, 18 Jan 2001 14:54:32 +0100
--Suggested fix is incorporated in 1.2.2.
--
--There is a deeper problem:  mtext() ignores par(cex=.5) in general.  
--To see the problem try:  par(cex=.5); mtext("hi")
--Paul thinks the right fix is to change the argument list for mtext so that
--cex=par(cex) by default rather than cex=NA by default (plus corresponding
--internal changes to  do_mtext in plot.c).
--This needs to be done very carefully because (i) the change suggested above 
--mayhave side-effects in many other pieces of interpreted code 
--(ii) do_mtext ignores dd->gp.cexbase unlike, for example, do_plot_xy 
--and anything to do with cexbase needs extreme care.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 816 <==
From postmaster@franz.stat.wisc.edu  Thu Jan 18 16:57:16 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA13627
	for <r-bugs@biostat.ku.dk>; Thu, 18 Jan 2001 16:57:15 +0100 (MET)
Received: from ingw1.tirol.gv.at (really [212.183.27.1]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14JHRE-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Thu, 18 Jan 2001 09:57:24 -0600 (CST) 
Received: from xms.tirol.gv.at (xms.tirol.gv.at [10.11.128.200])
	by ingw1.tirol.gv.at (Mailer) with ESMTP id 22ADE2825
	for <r-bugs@r-project.org>; Thu, 18 Jan 2001 14:49:47 +0100 (NFT)
Received: from xms.tirol.gv.at (unverified) by xms.tirol.gv.at
 (Content Technologies SMTPRS 4.1.5) with ESMTP id <T0a0b80c8512ecf1400@xms.tirol.gv.at> for <r-bugs@r-project.org>;
 Thu, 18 Jan 2001 14:54:33 +0100
Received: by xms.tirol.gv.at with Internet Mail Service (5.5.2650.21)
	id <CLGLQ6B7>; Thu, 18 Jan 2001 14:54:33 +0100
Message-ID: <C4D44AB4CB62D311BA6500041202E8862640F8@xms1.tirol.gv.at>
From: RINNER Heinrich <H.RINNER@TIROL.GV.AT>
To: "'r-bugs@r-project.org'" <r-bugs@r-project.org>
Subject: dotplot: character size of labels
Date: Thu, 18 Jan 2001 14:54:32 +0100
Return-Receipt-To: RINNER Heinrich <H.RINNER@TIROL.GV.AT>
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2650.21)
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from quoted-printable to 8bit by pubhealth.ku.dk id QAA13627

There seems to be a bug in "dotplot" concerning the "cex" parameter. Setting
cex has no effect on the character size of the labels of the points.
This problem was posted to r-help today (Thu, 18 Jan 2001); the solution
given by Brian Ripley (and Uwe Ligges) seems to work for me.

Heinrich Rinner.
 
> version
         _              
platform i386-pc-mingw32
arch     x86            
os       Win32          
system   x86, Win32     
status                  
major    1              
minor    2.0            
year     2000           
month    12             
day      15             
language R              

> ----------
> Von: 	Prof Brian Ripley[SMTP:ripley@stats.ox.ac.uk]
> Gesendet: 	Donnerstag, 18. Jänner 2001 10:35
> An: 	RINNER Heinrich
> Cc: 	'r-help@stat.math.ethz.ch'
> Betreff: 	Re: [R] dotplot: character size of labels
> 
> On Thu, 18 Jan 2001, RINNER Heinrich wrote:
> 
> > Dear R users,
> >
> > using dotplot (R1.2.0, WinNT4.0), I am trying to change the character
> size
> > of the labels of the points:
> >
> > > # example
> > > data(VADeaths)
> > > dotplot(VADeaths, main = "Death Rates in Virginia - 1940")
> > > # I'd like to have smaller character size of the labels (for age and
> > population groups)
> > > ?dotplot
> > > # for argument "cex", this says: "Setting cex to a value smaller than
> one
> > can be a useful way of avoiding label overlap."
> > > dotplot(VADeaths, main = "Death Rates in Virginia - 1940", cex = 0.5)
> > > # the main title and the plotting characters are smaller now, but not
> the
> > labels
> > > # trying to set other graphics parameters seems to have no effect:
> > > dotplot(VADeaths, main = "Death Rates in Virginia - 1940", cex.axis =
> 0.5)
> > > dotplot(VADeaths, main = "Death Rates in Virginia - 1940", cex.lab =
> 0.5)
> >
> > I'd be grateful for any hint how to do this correctly;
> 
> Looks like a bug. Inside dotplot alter to
> 
>         for (i in 1:n) mtext(labs[i], side = 2, line = loffset,
>             at = y[i], adj = 0, col = color, las = 2, cex = cex, ...)
> 
>         for (i in 1:nlevels(groups)) mtext(glabels[i], side = 2,
>             line = goffset, at = gpos[i], adj = 0, col = gcolor,
>             las = 2, cex = cex, ...)
> 
> However, it really needs more than that to calculate the spaces for the
> labels correctly.
> 
> 
> -- 
> Brian D. Ripley,                  ripley@stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272860 (secr)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 

==> 816.audit <==
Sat Jan 20 10:24:14 2001	ripley	moved from incoming to Graphics
Tue Jan 23 03:38:23 2001	paul	changed notes
Tue Jan 23 03:38:23 2001	paul	foobar
Sun Feb 18 10:11:12 2001	ripley	changed notes
Sun Feb 18 10:11:12 2001	ripley	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 830 *
Subject: Disappearing x axis in plot.factor
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 30 Jan 2001 00:27:13 -0500
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 830 <==
From postmaster@franz.stat.wisc.edu  Tue Jan 30 06:27:08 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id GAA28413
	for <r-bugs@biostat.ku.dk>; Tue, 30 Jan 2001 06:27:08 +0100 (MET)
Received: from infiniti.ece.cmu.edu (really [128.2.216.84]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14NTK3-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Mon, 29 Jan 2001 23:27:19 -0600 (CST) 
Received: (from tov@localhost) by infiniti.ece.cmu.edu (AIX4.3/UCB 8.8.8/8.8.8) id AAA70126; Tue, 30 Jan 2001 00:27:14 -0500
X-Authentication-Warning: infiniti.ece.cmu.edu: tov set sender to tov@ece.cmu.edu using -f
Sender: tov@infiniti.ece.cmu.edu
To: r-bugs@r-project.org
Cc: Thomas Vogels <tov@ece.cmu.edu>
Subject: Disappearing x axis in plot.factor
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 30 Jan 2001 00:27:13 -0500
Message-ID: <pxvgqxehji.fsf@infiniti.ece.cmu.edu>
Lines: 68
User-Agent: Gnus/5.0807 (Gnus v5.8.7) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi.

While there is an x-axis set up for:
> plot.factor(factor(1:3))

this axis is not present for
> plot.factor(factor(1:3), col="red")

which actually should just be the same as the first plot and call
barplot(table(.)), shouldn't it?  Where did the ticks and labels go?

Note that
> barplot (table(factor(1:3)), col="red")
has the x-axis.

Something funky is going on with axisnames or args in plot.factor that
I can't figure out.  The situation can be remedied with
> plot.factor(factor(1:3), col="red", axes=TRUE)

alas, why do you need "axes=TRUE"?

Regards,
  -tom



Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> Thomas Vogels <tov@ece.cmu.edu> writes:
> 
> 
> > Now the (actually not so) funny thing is that the labels for the
> > x-axis disappear when I specify colors for the bars.  (R 1.2.1, Linux)
> > Ok, maybe the other thing I'll have to catch up on is the docu...
> 
> The logic around "axisnames" in plot.factor looks not quite right.
> Could you file a bug report on this so that we dont forget?
> 
> barplot(table(factor(1:3)),col="green")
> plot(factor(1:3),col="green",axes=T)
> 
> both work, although the latter is clearly silly.


--please do not edit the information below--

Version:
 platform = i386-pc-linux-gnu
 arch = i386
 os = linux-gnu
 system = i386, linux-gnu
 status = 
 major = 1
 minor = 2.1
 year = 2001
 month = 01
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base



-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204


==> 830.reply.1 <==
From pd@biostat.ku.dk  Tue Jan 30 16:29:00 2001
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA09778;
	Tue, 30 Jan 2001 16:28:59 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id QAA02447;
	Tue, 30 Jan 2001 16:32:31 +0100
Sender: pd@blueberry.kubism.ku.dk
To: tov@ece.cmu.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Disappearing x axis in plot.factor (PR#830)
References: <200101300527.GAA28423@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 30 Jan 2001 16:32:30 +0100
In-Reply-To: tov@ece.cmu.edu's message of "Tue, 30 Jan 2001 06:27:11 +0100 (MET)"
Message-ID: <x28znt5a41.fsf@blueberry.kubism.ku.dk>
Lines: 50
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

tov@ece.cmu.edu writes:

> Hi.
> 
> While there is an x-axis set up for:
> > plot.factor(factor(1:3))
> 
> this axis is not present for
> > plot.factor(factor(1:3), col="red")
> 
> which actually should just be the same as the first plot and call
> barplot(table(.)), shouldn't it?  Where did the ticks and labels go?
> 
> Note that
> > barplot (table(factor(1:3)), col="red")
> has the x-axis.
> 
> Something funky is going on with axisnames or args in plot.factor that
> I can't figure out.  The situation can be remedied with
> > plot.factor(factor(1:3), col="red", axes=TRUE)
> 
> alas, why do you need "axes=TRUE"?

Because of the logic of

        axisnames <- if (length(dargs <- list(...)) > 0) {
            nam <- names(dargs)
            ((any("axes" == nam) && dargs$axes) || (any("xaxt" == 
                nam) && dargs$xaxt != "n"))
        }

gives FALSE if there are any "..." arguments, and neither of axes= and
xaxt= are given.

I think the first part of plot.factor wants to be 

     if (missing(y) || is.factor(y)) {
	dargs <- list(...)
        axisnames <- if (!is.null(dargs$axes)) dargs$axes
	    else if (!is.null(dargs$xaxt)) dargs$xaxt != "n"
            else TRUE
    }

Anyone know better?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 830.audit <==
Wed Feb  7 08:51:14 2001	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 828 *
Subject: termplot fails for composite non-factor terms
From: John Maindonald <john.maindonald@anu.edu.au>
Date: Sat, 27 Jan 2001 11:57:37 +1100 (EST)
--Neither of the proposed changes actually works in sufficient generality.
--
--The easy and unimportant part of this, the labels, is fixed in 1.2.2. Getting
--the data right is a project for 1.3
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 828 <==
From postmaster@franz.stat.wisc.edu  Sat Jan 27 01:57:37 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA07865
	for <r-bugs@biostat.ku.dk>; Sat, 27 Jan 2001 01:57:36 +0100 (MET)
Received: from leonard.anu.edu.au (really [150.203.2.15]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14MJgZ-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Fri, 26 Jan 2001 18:57:47 -0600 (CST) 
Received: (from u9801539@localhost)
	by leonard.anu.edu.au (8.9.3/8.9.3) id LAA25063
	for r-bugs@r-project.org; Sat, 27 Jan 2001 11:57:37 +1100 (EST)
Date: Sat, 27 Jan 2001 11:57:37 +1100 (EST)
From: John Maindonald <john.maindonald@anu.edu.au>
Message-Id: <200101270057.LAA25063@leonard.anu.edu.au>
To: r-bugs@r-project.org
Subject: termplot fails for composite non-factor terms

I am running R 1.2.1 under Windows 98SE.

termplot() currently fails when there are composite terms, thus:
  > library(mass)
  > data(hills)
  > hills.lm <- lm(time ~ climb + poly(dist, 2), data = hills)
  > termplot(hills.lm)
  Hit <Return> to see next plot: 
  Error in eval(expr, envir, enclos) : Object "dist" not found

The call
  > termplot(hills.lm,data=hills)
does run without generating an error message, i.e. there is a 
problem with the default setting for the parameter 'data'. 
However the x-axis for the term poly(dist,2) is then incorrectly 
labelled as poly(dist,2), rather than dist
The label poly(dist,2) surely belongs as part of the y-axis label.

Here are suggested fixes

1. In the default parameters for the function call change
   data = model.frame(model)
to
   data = get(as.character(model$call$data))

[This does not work if the variable values are specified in the
function call.  It is not clear to me how to fix that.]

2. A few lines from the beginning, replace
    if (is.null(xlabs)) 
        xlabs <- nmt
    if (is.null(ylab)) 
        ylab <- substitute(link(foo), list(foo = formula(model)[[2]]))
with
   if (is.null(xlabs)) 
        xlabs <- unlist(lapply(cn,function(x)
        if(length(x)>1)as.character(x[[2]]) else as.character(x)))
   if (is.null(ylab)) 
        ylab <- paste("Partial for", nmt)

[The current y-label is "link(<yvar>)".  If it is thought necessary
to specify this, it should be additional to e.g., in my example,
"Partial for poly(dist,2)"]

Replace ylab = ylab with 
   ylab = ylab[i]
in the two places (arguments to plot()) where it appears.

John Maindonald               email : john.maindonald@anu.edu.au        
Statistical Consulting Unit,  phone : (6125)3998        
c/o CMA, SMS,                 fax   : (6125)5549  
John Dedman Mathematical Sciences Building
Australian National University
Canberra ACT 0200
Australia

==> 828.followup.1 <==
From tlumley@u.washington.edu  Sat Jan 27 02:08:54 2001
Received: from jason02.u.washington.edu (root@jason02.u.washington.edu [140.142.8.52])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id CAA07896
	for <R-bugs@biostat.ku.dk>; Sat, 27 Jan 2001 02:08:53 +0100 (MET)
Received: from homer06.u.washington.edu (tlumley@homer06.u.washington.edu [140.142.15.40])
	by jason02.u.washington.edu (8.9.3+UW00.05/8.9.3+UW00.12) with ESMTP id RAA28204;
	Fri, 26 Jan 2001 17:09:04 -0800
Received: from localhost (tlumley@localhost)
	by homer06.u.washington.edu (8.9.3+UW00.05/8.9.3+UW00.12) with ESMTP id RAA186066;
	Fri, 26 Jan 2001 17:09:03 -0800
Date: Fri, 26 Jan 2001 17:09:03 -0800 (PST)
From: Thomas Lumley <tlumley@u.washington.edu>
To: john.maindonald@anu.edu.au
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] termplot fails for composite non-factor terms (PR#828)
In-Reply-To: <200101270057.BAA07875@pubhealth.ku.dk>
Message-ID: <Pine.A41.4.21.0101261704120.21498-100000@homer06.u.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Sat, 27 Jan 2001 john.maindonald@anu.edu.au wrote:

> I am running R 1.2.1 under Windows 98SE.
> 
> termplot() currently fails when there are composite terms, thus:
>   > library(mass)
>   > data(hills)
>   > hills.lm <- lm(time ~ climb + poly(dist, 2), data = hills)
>   > termplot(hills.lm)
>   Hit <Return> to see next plot: 
>   Error in eval(expr, envir, enclos) : Object "dist" not found
> 
> The call
>   > termplot(hills.lm,data=hills)
> does run without generating an error message, i.e. there is a 
> problem with the default setting for the parameter 'data'. 
> However the x-axis for the term poly(dist,2) is then incorrectly 
> labelled as poly(dist,2), rather than dist
> The label poly(dist,2) surely belongs as part of the y-axis label.
> 
> Here are suggested fixes
> 
> 1. In the default parameters for the function call change
>    data = model.frame(model)
> to
>    data = get(as.character(model$call$data))
> 
> [This does not work if the variable values are specified in the
> function call.  It is not clear to me how to fix that.]

Also, it does not specify where to get() the data: what environment to
use. The reason that the data= argument is present in termplot() is that
we can't tell where to find the data in general.

The situation is better as of R1.2, since we can look up variables in the
environment of the model formula. This would fix not only termplot() but a
number of other prediction-related problems.


> 2. A few lines from the beginning, replace
>     if (is.null(xlabs)) 
>         xlabs <- nmt
>     if (is.null(ylab)) 
>         ylab <- substitute(link(foo), list(foo = formula(model)[[2]]))
> with
>    if (is.null(xlabs)) 
>         xlabs <- unlist(lapply(cn,function(x)
>         if(length(x)>1)as.character(x[[2]]) else as.character(x)))
>    if (is.null(ylab)) 
>         ylab <- paste("Partial for", nmt)
> 
> [The current y-label is "link(<yvar>)".  If it is thought necessary
> to specify this, it should be additional to e.g., in my example,
> "Partial for poly(dist,2)"]
> 
> Replace ylab = ylab with 
>    ylab = ylab[i]
> in the two places (arguments to plot()) where it appears.


This looks like a good idea. 

	-thomas


==> 828.audit <==
Mon Jan 29 08:36:10 2001	ripley	moved from incoming to Graphics
Fri Feb 16 22:43:59 2001	thomas	changed notes
Fri Feb 16 22:43:59 2001	thomas	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 837 *
Subject: screen doesn't handle redrawing properly
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 01 Feb 2001 14:20:52 -0500
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 837 <==
From tov@ece.cmu.edu  Thu Feb  1 20:20:40 2001
Received: from infiniti.ece.cmu.edu (INFINITI.ECE.CMU.EDU [128.2.133.84])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA08721
	for <r-bugs@biostat.ku.dk>; Thu, 1 Feb 2001 20:20:39 +0100 (MET)
Received: (from tov@localhost) by infiniti.ece.cmu.edu (AIX4.3/UCB 8.8.8/8.8.8) id OAA30464; Thu, 1 Feb 2001 14:20:52 -0500
X-Authentication-Warning: infiniti.ece.cmu.edu: tov set sender to tov@ece.cmu.edu using -f
Sender: tov@infiniti.ece.cmu.edu
To: r-bugs@biostat.ku.dk
Cc: Thomas Vogels <tov@ece.cmu.edu>
Subject: screen doesn't handle redrawing properly
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 01 Feb 2001 14:20:52 -0500
Message-ID: <pxitmub46j.fsf@infiniti.ece.cmu.edu>
Lines: 74
User-Agent: Gnus/5.0807 (Gnus v5.8.7) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi.  As far as I understand it, there is a list of graphic primitives
stored for a device.  So for example, when I iconify/deiconify an X11
window, the plot will be redrawn.  Now screen (split.screen and
friends) appear not to handle this list properly, the list is reset or
not reset at odd times.  The commands below will show clearly what I
mean.  There are two effects:

  - After splitting the device real estate into two screens, I can
    plot on these screens, alternating between them.  When I then
    touch the window to force a redraw, *all* the plots are redrawn,
    not just the last (and visible) ones.
    [This happens when the X server runs on AIX, R runs on AIX or Sun.]

  - Again, after splitting, plotting on one screen can affect the
    other screen.  I.e. plot(...); plot (...) on the left screen can
    erase the *right* screen.
    [This happens for all platforms I have access to, AIX, Linux, Sun.]

The first effect may be due to a bad interaction with the X server,
but the second effect is surely not desirable, is it?  Am I mis-using
'screen' here?

R> split.screen (c(1,2))
[1] 1 2
R> # Draw 10000 points to make the effect obvious
R> screen (1)
R> plot (1:10000, 1:10000, main="1")
R> screen (2)
R> plot (1:10000, 1:10000, main="2")
R> # Ok, go back to screen 1, draw plots 3 and 4
R> screen (1)
R> plot (1:10000, 10000:1, main="3")
R> screen (2)
R> plot (1:10000, 10000:1, main="4")
R> 
R> ########################################
R> # NOW lower/raise window, do something to force device to redraw itself.
R> # You'll see again plot 1 (!), 2 (!), 3, and 4.  Why 1 and 2?
R> ########################################
R> 
R> # Here's how to erase screen 2 from screen 1 (!)
R> screen (1)
R> plot (1:10, 1:10, main="3a")
R> ########################################
R> # The following plot will erase screen 2
R> ########################################
R> plot (1:10, 1:10, main="3b")
R> 
R> # The good news is that this resets the list of graphic ops:
R> screen (2)
R> plot (1:10, 1:10, main="4")
R> # Now if you touch the window, you'll see only plot 3b and 4.

Regards,
  -tom

R> R.version
         _                   
platform sparc-sun-solaris2.7
arch     sparc               
os       solaris2.7          
system   sparc, solaris2.7   
status   Patched             
major    1                   
minor    2.1                 
year     2001                
month    01                  
day      31                  
language R                   

-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204


==> 837.audit <==
Wed Feb  7 08:51:14 2001	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 831 *
Subject: screen can't go back to (split) screen with log="y" plot
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 30 Jan 2001 00:39:41 -0500
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 831 <==
From postmaster@franz.stat.wisc.edu  Tue Jan 30 06:39:31 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id GAA28455
	for <r-bugs@biostat.ku.dk>; Tue, 30 Jan 2001 06:39:30 +0100 (MET)
Received: from infiniti.ece.cmu.edu (really [128.2.216.84]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14NTW2-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Mon, 29 Jan 2001 23:39:42 -0600 (CST) 
Received: (from tov@localhost) by infiniti.ece.cmu.edu (AIX4.3/UCB 8.8.8/8.8.8) id AAA26672; Tue, 30 Jan 2001 00:39:42 -0500
X-Authentication-Warning: infiniti.ece.cmu.edu: tov set sender to tov@ece.cmu.edu using -f
Sender: tov@infiniti.ece.cmu.edu
To: r-bugs@r-project.org
Cc: Thomas Vogels <tov@ece.cmu.edu>
Subject: screen can't go back to (split) screen with log="y" plot
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas Vogels <tov@ece.cmu.edu>
User-Agent: Gnus/5.0807 (Gnus v5.8.7) Emacs/20.7
Date: 30 Jan 2001 00:39:41 -0500
Message-ID: <pxsnm1egyq.fsf@infiniti.ece.cmu.edu>
Lines: 76
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi.  Let's try to explain the subject line with some code:

> split.screen (c(2,1))
[1] 1 2
> screen(1)
> plot (1:2, 1:2, log="y", main="1")
> screen (2)
> plot (1:2, 1:2, main="2")
> screen (1)
Error in par(.split.screens[[n]]) : invalid value specified for graphics parameter "yaxp".
> close.screen(all=TRUE)

Let's add comments:

> split.screen (c(2,1))
[1] 1 2

OK, plot in the top half screen:
> screen(1)
> plot (1:2, 1:2, log="y", main="1")
> par("yaxp")
[1]  1  2 -5

OK, switch to bottom half:
> screen (2)
> plot (1:2, 1:2, main="2")
> par("yaxp")
[1] 1 2 5

OK, looks fine, let's go back up:
> screen (1)
Error in par(.split.screens[[n]]) : invalid value specified for graphics parameter "yaxp".

Bummer.
> close.screen(all=TRUE)

Somehow I'm hoping you'll tell me I'm doing something wrong, because
I'd really would like to be able to do the following:
  repeat {
    #calculate
    screen(1)
    #fancy plot
    screen (2)
    #even fancier plot ;-)
    if (user.bored()) break
  }
Which is roughly what I was doing when the error messages started
popping up.

Thanks,
  -tom

--please do not edit the information below--

Version:
 platform = i386-pc-linux-gnu
 arch = i386
 os = linux-gnu
 system = i386, linux-gnu
 status = 
 major = 1
 minor = 2.1
 year = 2001
 month = 01
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base



-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204


==> 831.followup.1 <==
From ripley@stats.ox.ac.uk  Tue Jan 30 08:40:46 2001
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA28901
	for <R-bugs@biostat.ku.dk>; Tue, 30 Jan 2001 08:40:46 +0100 (MET)
Received: from max144.public.ox.ac.uk (max144.public.ox.ac.uk [192.76.27.144])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id HAA21509;
	Tue, 30 Jan 2001 07:40:54 GMT
Date: Tue, 30 Jan 2001 07:39:25 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: <ripley@auk.stats>
To: <tov@ece.cmu.edu>
cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] screen can't go back to log="y" plot (PR#831)
In-Reply-To: <200101300539.GAA28465@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.31.0101300725290.17104-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

[I have abbreviated the subject as jitterbug has been having probems
with long subjects.]

The issue here is that one cannot mix log/non-log axes in the calls to
screen(), as the appropriate par() parameter is read-only, but the
meaning of yaxp depends on it.  But beyond that you can't set
x/yaxp for log axes.

You should be able to do this: you can in the S original.

A simpler version:

plot (1:2, 1:2, log="y", main="1")
zz <- par("yaxp")
zz
[1]  1  2 -5
par(yaxp=zz)
Error in par(yaxp = zz) : invalid value specified for graphics parameter
"yaxp".

So you can't reset the yaxp parameter to what it is reported as!


Additional bug: the meaning of x/yaxp for log axes is not defined
in help(par).


On Tue, 30 Jan 2001 tov@ece.cmu.edu wrote:

>
> Hi.  Let's try to explain the subject line with some code:
>
> > split.screen (c(2,1))
> [1] 1 2
> > screen(1)
> > plot (1:2, 1:2, log="y", main="1")
> > screen (2)
> > plot (1:2, 1:2, main="2")
> > screen (1)
> Error in par(.split.screens[[n]]) : invalid value specified for graphics parameter "yaxp".
> > close.screen(all=TRUE)
>
> Let's add comments:
>
> > split.screen (c(2,1))
> [1] 1 2
>
> OK, plot in the top half screen:
> > screen(1)
> > plot (1:2, 1:2, log="y", main="1")
> > par("yaxp")
> [1]  1  2 -5
>
> OK, switch to bottom half:
> > screen (2)
> > plot (1:2, 1:2, main="2")
> > par("yaxp")
> [1] 1 2 5
>
> OK, looks fine, let's go back up:
> > screen (1)
> Error in par(.split.screens[[n]]) : invalid value specified for graphics parameter "yaxp".
>
> Bummer.
> > close.screen(all=TRUE)
>
> Somehow I'm hoping you'll tell me I'm doing something wrong, because
> I'd really would like to be able to do the following:
>   repeat {
>     #calculate
>     screen(1)
>     #fancy plot
>     screen (2)
>     #even fancier plot ;-)
>     if (user.bored()) break
>   }
> Which is roughly what I was doing when the error messages started
> popping up.
>
> Thanks,
>   -tom
>
> --please do not edit the information below--
>
> Version:
>  platform = i386-pc-linux-gnu
>  arch = i386
>  os = linux-gnu
>  system = i386, linux-gnu
>  status =
>  major = 1
>  minor = 2.1
>  year = 2001
>  month = 01
>  day = 15
>  language = R
>
> Search Path:
>  .GlobalEnv, package:ctest, Autoloads, package:base
>
>
>
> --
> mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204
>
>
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
>

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 831.followup.2 <==
From tov@ece.cmu.edu  Thu Feb  1 02:13:08 2001
Received: from infiniti.ece.cmu.edu (INFINITI.ECE.CMU.EDU [128.2.133.84])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id CAA25173
	for <R-bugs@biostat.ku.dk>; Thu, 1 Feb 2001 02:13:07 +0100 (MET)
Received: (from tov@localhost) by infiniti.ece.cmu.edu (AIX4.3/UCB 8.8.8/8.8.8) id UAA19026; Wed, 31 Jan 2001 20:12:41 -0500
X-Authentication-Warning: infiniti.ece.cmu.edu: tov set sender to tov@ece.cmu.edu using -f
Sender: tov@infiniti.ece.cmu.edu
To: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] screen can't go back to log="y" plot (PR#831)
References: <Pine.GSO.4.31.0101300725290.17104-100000@auk.stats>
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 31 Jan 2001 20:12:41 -0500
In-Reply-To: Prof Brian D Ripley's message of "Tue, 30 Jan 2001 07:39:25 +0000 (GMT)"
Message-ID: <px7l3bcik6.fsf@infiniti.ece.cmu.edu>
Lines: 81
User-Agent: Gnus/5.0807 (Gnus v5.8.7) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

> [I have abbreviated the subject as jitterbug has been having probems
> with long subjects.]
> 
> The issue here is that one cannot mix log/non-log axes in the calls to
> screen(), as the appropriate par() parameter is read-only, but the
> meaning of yaxp depends on it.  But beyond that you can't set
> x/yaxp for log axes.
> 
> You should be able to do this: you can in the S original.
> 
> A simpler version:
> 
> plot (1:2, 1:2, log="y", main="1")
> zz <- par("yaxp")
> zz
> [1]  1  2 -5
> par(yaxp=zz)
> Error in par(yaxp = zz) : invalid value specified for graphics parameter
> "yaxp".
> 
> So you can't reset the yaxp parameter to what it is reported as!
[snip]

The code in main/par.c ignores the value of xlog (or ylog) when
setting xaxp (or yaxp).  Right now you have in Specify (and Specify2):

... else if (streql(what, "xaxp")) {
	value = coerceVector(value, REALSXP);
	lengthCheck(what, value, 3);
	naRealCheck(REAL(value)[0], what);
	naRealCheck(REAL(value)[1], what);
        posIntCheck((int) (REAL(value)[2]), what);

Shouldn't that be something like:

... else if (streql(what, "xaxp")) {
	value = coerceVector(value, REALSXP);
	lengthCheck(what, value, 3);
	naRealCheck(REAL(value)[0], what);
	naRealCheck(REAL(value)[1], what);
        if (dd->gp.xlog)
            logAxpCheck((int) (REAL(value)[2]), what);
        else
            posIntCheck((int) (REAL(value)[2]), what);

Where logAxpCheck is suitably defined as:

static void logAxpCheck(int x, char *s)
{
    if (x == NA_INTEGER || x == 0 || x > 4)
	par_error(s);
}

since only values < 0 or the values 1, 2, 3 are allowed?


> Additional bug: the meaning of x/yaxp for log axes is not defined
> in help(par).

excerpt from help(par):

    xaxp: A vector of the form `c(x1, x2, n)' giving the coordinates
          of the extreme tick marks and the number of intervals
          between tick-marks.

Could you add:

          The value of n must be positive for linear scale axes.  For
          logarithmic scale axes n must be either negative (then there
          will be (1-n) ticks at a linear distance) or one of 1, 2, or
          3 where n then indicates the number of ticks per decade.

similar for yaxp?  What am I missing?
Regards,
  -tom

-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204

==> 831.audit <==
Wed Feb  7 08:51:14 2001	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 887 *
Subject: axis(adj=anything) has no effect
From: jhallman@frb.gov
Date: Wed, 28 Mar 2001 20:51:05 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 887 <==
From jhallman@frb.gov  Wed Mar 28 20:51:06 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA23265
	for <R-bugs@biostat.ku.dk>; Wed, 28 Mar 2001 20:51:05 +0200 (MET DST)
Date: Wed, 28 Mar 2001 20:51:05 +0200 (MET DST)
From: jhallman@frb.gov
Message-Id: <200103281851.UAA23265@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: axis(adj=anything) has no effect

Full_Name: Jeff Hallman
Version: 1.2.2
OS: SunOS5.6
Submission from: (NULL) (132.200.32.33)


Giving an adj argument to axis() seems to have no effect.  In Splus, adj = 0 
left-justifies the labels under the ticks, adj = 1 right justifies them, and 
numbers in between can also be used.  I like to use adj = 0.9 to get something
that looks like this:

-----------+-----------+-----------+------------+---------
        1980        1981        1982         1983

as an axis for a plot of monthly time series data.



==> 887.audit <==
Sat Apr  7 10:29:17 2001	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 865 *
Subject:  axis(...,las=1) breaks postscript code in certain cases 
From: maechler@stat.math.ethz.ch
Date: Wed, 7 Mar 2001 18:08:58 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 865 <==
From postmaster@franz.stat.wisc.edu  Wed Mar  7 18:09:00 2001
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA29209
	for <r-bugs@biostat.ku.dk>; Wed, 7 Mar 2001 18:08:59 +0100 (MET)
Received: from stat.math.ethz.ch (really [129.132.58.23]) by franz.stat.wisc.edu
	via smail with esmtp (ident daemon using rfc1413)
	id <m14ahQz-000J39C@franz.stat.wisc.edu> (Debian Smail3.2.0.111)
	for <r-bugs@r-project.org>; Wed, 7 Mar 2001 11:09:09 -0600 (CST) 
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA01076;
	Wed, 7 Mar 2001 18:09:06 +0100 (MET)
Received: from florence(129.132.58.33), claiming to be "florence.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa000G_; Wed Mar  7 18:08:58 2001
Received: (maechler@localhost) by florence.ethz.ch (8.9.3/D-MATH-client) id SAA16747; Wed, 7 Mar 2001 18:08:58 +0100
Date: Wed, 7 Mar 2001 18:08:58 +0100
From: maechler@stat.math.ethz.ch
Message-Id: <200103071708.SAA16747@florence.ethz.ch>
To: r-bugs@r-project.org
Subject:  axis(...,las=1) breaks postscript code in certain cases 
Cc: maechler@stat.math.ethz.ch

A colleage of mine (Roland Brun) has found the following 
reproducible problem: 

  In some circumstances, incorrect (for gv/gs) PostScript seems to be
  created when "las = 1".

  {for many versions of R (Linux) at least}

The following code shows you the symptom
    (gv pops up an error message window) :


##- Generate data 
y1 <- 10^seq(0,6)   ##- positive exponents 
y2 <- 10^seq(-4,2)  ##- including negative exponents 

postscript("test.ps")

par(mfrow=c(2,2),mar=c(3,6,0,0)+0.1,oma=c(3,1,1,1),mgp=c(4.5,1,0))

##- Plot1: works perfectly (y1 and las=0)
plot(1:length(y1),y1,type="p",axes=F,log="y")
  box()
  axis(1,at=1:length(y1))
  axis(2,at=y1,las=0) 

##- Plot2: works perfectly (y1 and las=1)
plot(1:length(y1),y1,type="p",axes=F,log="y")
  box()
  axis(1,at=1:length(y1))
  axis(2,at=y1,las=1) 

##- Plot3: works perfectly (y2 and las=0)
plot(1:length(y2),y2,type="p",axes=F,log="y")
  box()
  axis(1,at=1:length(y2))
  axis(2,at=y2,las=0) 

##- Plot4: breaks postscript code (y2 and las=1)
plot(1:length(y2),y2,type="p",axes=F,log="y")
  box()
  axis(1,at=1:length(y2))
  axis(2,at=y2,las=1) 

dev.off()
system("gv test.ps")




--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Under development (unstable)
 major = 1
 minor = 3.0
 year = 2001
 month = 03
 day = 07
 language = R

Search Path:
 .GlobalEnv, package:ctest, package:SfS, Autoloads, package:base

==> 865.audit <==
Thu Mar  8 18:23:52 2001	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 857 *
Subject: Plotting points on a filled.contour plot
From: marchini@stats.ox.ac.uk
Date: Tue, 27 Feb 2001 10:00:30 +0100 (MET)
--This needs at least to be documented, and preferably par("usr")
--set to the coordinate system of the plotting region after use.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 857 <==
From marchini@stats.ox.ac.uk  Tue Feb 27 10:00:31 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA23867
	for <R-bugs@biostat.ku.dk>; Tue, 27 Feb 2001 10:00:30 +0100 (MET)
Date: Tue, 27 Feb 2001 10:00:30 +0100 (MET)
From: marchini@stats.ox.ac.uk
Message-Id: <200102270900.KAA23867@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Plotting points on a filled.contour plot

Full_Name: Jonathan Marchini
Version: R 1.2.2
OS: linux-gnu
Submission from: (NULL) (163.1.103.108)


When adding points to a filled.contour plot they do not appear at the correct
coordinates.
The following code demonstrates this.
 
a<-expand.grid(1:20,1:20)
b<-matrix(a[,1]+a[,2],20)
filled.contour(x=1:20,y=1:20,z=b)
points(10,10)  

==> 857.followup.1 <==
From paul@stat.auckland.ac.nz  Tue Feb 27 22:56:18 2001
Received: from mailhost.auckland.ac.nz (mailhost.auckland.ac.nz [130.216.1.4] (may be forged))
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA03530
	for <R-bugs@biostat.ku.dk>; Tue, 27 Feb 2001 22:56:16 +0100 (MET)
Received: from stat1.stat.auckland.ac.nz (stat1.stat.auckland.ac.nz [130.216.93.1])
	by mailhost.auckland.ac.nz (8.9.2/8.9.2/8.9.2-ua) with ESMTP id KAA09588;
	Wed, 28 Feb 2001 10:56:25 +1300 (NZDT)
Received: from murrell (murrell.stat.auckland.ac.nz [130.216.93.23])
	by stat1.stat.auckland.ac.nz (8.9.3+Sun/8.8.8) with SMTP id KAA24060;
	Wed, 28 Feb 2001 10:56:25 +1300 (NZDT)
Message-ID: <003501c0a10a$77f7b040$175dd882@stat.auckland.ac.nz>
From: "Paul Murrell" <paul@stat.auckland.ac.nz>
To: <marchini@stats.ox.ac.uk>, <r-devel@stat.math.ethz.ch>
Cc: <R-bugs@biostat.ku.dk>
References: <200102270900.KAA23881@pubhealth.ku.dk>
Subject: Re: [Rd] Plotting points on a filled.contour plot (PR#857)
Date: Wed, 28 Feb 2001 11:13:09 +1300
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.00.2014.211
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2014.211

Hi


> When adding points to a filled.contour plot they do not appear at the
correct
> coordinates.
> The following code demonstrates this.
>
> a<-expand.grid(1:20,1:20)
> b<-matrix(a[,1]+a[,2],20)
> filled.contour(x=1:20,y=1:20,z=b)
> points(10,10)


The problem here is that filled.contour is actually a combination of two
plots;  one is the filled contour and one is the legend.  filled.contour
sets up two separate coordinate systems for these two plots, but only does
so internally - once the function has returned these coordinate systems are
lost.  In order to access the coordinate system of the main contour plot you
can specify graphics commands in the plot.axes argument.  For example, in
your case, replace your call to filled.contour with the following, and all
is as it should be ...

filled.contour(x=1:20,y=1:20,z=b,plot.axes={axis(1);axis(2);points(10,10)})

Paul



==> 857.audit <==
Sun Mar  4 10:15:11 2001	ripley	moved from incoming to Graphics
Sun Mar  4 10:17:53 2001	ripley	changed notes
Sun Mar  4 10:17:53 2001	ripley	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  In-Out

none

Directory:  Installation

none

Directory:  Language

* PR# 879 *
From: Duncan Murdoch <murdoch@stats.uwo.ca>
Date: Sun, 18 Mar 2001 07:45:13 -0500 (EST)
--precedence of %% appears to be not as documented
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 879 <==
From postmaster@franz.stat.wisc.edu  Sun Mar 18 13:45:10 2001
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA06349
	for <r-bugs@biostat.ku.dk>; Sun, 18 Mar 2001 13:45:10 +0100 (MET)
Received: from pony.its.uwo.ca (really [129.100.2.63]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m14ecYh-000JAcC@franz.stat.wisc.edu> (Debian Smail3.2.0.111)
	for <r-bugs@r-project.org>; Sun, 18 Mar 2001 06:45:19 -0600 (CST) 
Received: from fisher.stats.uwo.ca (fisher.stats.uwo.ca [129.100.45.201])
	by pony.its.uwo.ca (8.10.2/8.10.2) with ESMTP id f2ICjDm10309
	for <r-bugs@r-project.org>; Sun, 18 Mar 2001 07:45:13 -0500 (EST)
Received: from localhost (murdoch@localhost)
	by fisher.stats.uwo.ca (8.9.3/8.8.7) with ESMTP id HAA07970
	for <r-bugs@r-project.org>; Sun, 18 Mar 2001 07:45:13 -0500
Date: Sun, 18 Mar 2001 07:45:13 -0500 (EST)
From: Duncan Murdoch <murdoch@stats.uwo.ca>
To: r-bugs@r-project.org
Message-ID: <Pine.LNX.4.21.0103180743580.7967-100000@fisher.stats.uwo.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

According to the documentation (R-lang p. 56), * 
and %% (mod) have equal operator precedence, so they 
should group from left to right.  Thus

  3 * 4 %% 5

should give 2, i.e. (3*4) mod 5.  However, I get 

 >   3 * 4 %% 5
 [1] 12

i.e. 3 * (4 mod 5).

Other experiments suggest to me that %% is given 
higher priority than *, it's not the "left to right" 
rule that is not being followed.

Duncan Murdoch


==> 879.audit <==
Tue Mar 20 12:07:40 2001	ripley	changed notes
Tue Mar 20 12:07:40 2001	ripley	foobar
Tue Mar 20 12:07:40 2001	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 408 *
Subject: convolution bug
From: wsimpson@gcal.ac.uk
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 408 <==
From wsimpson@gcal.ac.uk  Fri Jan 28 11:17:36 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA11325
	for <R-bugs@biostat.ku.dk>; Fri, 28 Jan 2000 11:17:36 +0100 (MET)
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
From: wsimpson@gcal.ac.uk
Message-Id: <200001281017.LAA11325@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: convolution bug

Full_Name: Bill Simpson
Version: 65.1 , 0.90.1
OS: Linux
Submission from: (NULL) (193.62.250.209)


I reported this on r-help, but here is official bug report.

The present convolve() does not do convolution by default. Its default behaviour
is
correlation. This is a bug.

The default argument conj should be set to FALSE.

The zero-padding should be on the right for linear convolution (don't ask me
why you call this type="open"; I suggest type="linear").

Here is what I expect linear convolution to do:
myconvolve<-function (x,h) 
{
    nx <- length(x)
    nh <- length(h)
    #zero pad
    if(nx>nh)
       {
       x <- c(x,rep(0, nh-1))
       h<-c(h,rep(0,nx-1))
       }
    else
       {
       h <- c(h,rep(0, nx-1))
       x<-c(x,rep(0,nh-1))
       }
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/length(x)
#I am not sure about this, the R IFFT is weird
}

What "circular" convolution should do is just
eliminate the zero-padding:

myconvolve2<-function (x,h)
{
#no padding, circular convolution
    nx <- length(x)
    nh <- length(h)
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/(nx)
}


I suggest that you create two functions, convolve() and correlate(), and get
rid
of the conj argument in convolve().

==> 408.audit <==
Wed Feb 16 19:28:42 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 669 *
Subject: Bug(s) w/ rbind.data.frame(); fix also read.table(*, as.is = TRUE) ?
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 25 Sep 2000 10:17:15 +0200
--status of AsIs columns
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 669 <==
From maechler@stat.math.ethz.ch  Mon Sep 25 10:17:01 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA01907
	for <R-bugs@biostat.ku.dk>; Mon, 25 Sep 2000 10:17:01 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA07627
	for <R-bugs@stat.math.ethz.ch>; Mon, 25 Sep 2000 10:17:19 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa001r9; Mon Sep 25 10:17:15 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA01475; Mon, 25 Sep 2000 10:17:15 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14799.2571.494467.836722@gargle.gargle.HOWL>
Date: Mon, 25 Sep 2000 10:17:15 +0200
To: R-bugs@stat.math.ethz.ch
Subject: Bug(s) w/ rbind.data.frame(); fix also read.table(*, as.is = TRUE) ?
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

This is not only bug report, but also a RFC (request for comments):

The basic problem is that there are (at least) two ways of easily getting
non-factor character columns in data.frames.
The first is  
    read.table(*, as.is = TRUE) 
and the second is
    data.frame(.., I(...), ..)	      

which differ in their result. Whereas the first produces `pure' character
columns in the data.frame, the second approach gives `AsIs' classed
columns (character, or, e.g. logical).

Now, as the following shows,  rbind.data.frame()  *is* buggy anyway,
I wonder if we shouldn't change read.table(*, as.is = TRUE)
such that the non-numeric columns of its result become "AsIs" classed as
well:

-----------

str(d1 <- data.frame(a=1:3, b = I(letters[1:3])))
## d1 is `alright'
## d0: The same but a `character' *not* protected by AsIs:
d0 <- d1
d0$b <- unclass(d0$b)
str(d0)
## Note that this is *really* the same as a what you get from
##  read.table(*, as.is = TRUE)
##  ----------
##  R's read.table() is S+ compatible; however I wonder if
##  we shouldn't add  "AsIs" classes to all non-numeric components...
##  the classes, shouldn't harm, but ensure consistency of treatment..

str(d11 <- rbind(d1, new = c(7, "N"))) ## alright
str(d01 <- rbind(d0, new = c(7, "N"))) ## all wrong :
## Both columns were coerced to factors !!
##-- S-PLUS 5 coerces both to "character" -- which is better,
##  since the new row *is* all character

## R makes nonsense with 'b' [factor w/ 1 level "N": NA NA NA 1]
## S+ 5.1 does exactly the right thing [both a & b still look like in d0,d1 :
str(d12 <- rbind(d1, new = data.frame(a= 7, b="N")))##
str(d02 <- rbind(d0, new = data.frame(a= 7, b="N")))##

---------

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 669.audit <==
Wed Oct 25 20:31:21 2000	ripley	changed notes
Wed Oct 25 20:31:21 2000	ripley	foobar
Wed Oct 25 20:31:21 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 412 *
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 412 <==
From postmaster@franz.stat.wisc.edu  Sun Feb  6 01:16:33 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26868
	for <R-bugs@biostat.ku.dk>; Sun, 6 Feb 2000 01:16:31 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id BAA18080
	for <r-bugs@hypatia.math.ethz.ch>; Sun, 6 Feb 2000 01:16:38 +0100 (MET)
Received: from franz.stat.wisc.edu(128.105.174.95)
 via SMTP by hypatia, id smtpdAAAa004QS; Sun Feb  6 01:16:33 2000
Received: from pubhealth.ku.dk (really [130.225.108.10]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m12HFNP-000ZSxC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Sat, 5 Feb 2000 18:16:31 -0600 (CST) 
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26864
	for <r-bugs@r-project.org>; Sun, 6 Feb 2000 01:16:18 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA12311;
	Sun, 6 Feb 2000 01:18:51 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-bugs@r-project.org
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
Message-ID: <x2900zyyhh.fsf@blueberry.kubism.ku.dk>
Lines: 51
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit


Call objects don't always behave as you'd expect. They're mostly
list-like, but with exceptions:

> f<-function(x,y,...)match.call(expand.dots=FALSE)
> xx <- f(y=1,2,z=3,4)
> dd <- xx$...
> xx$... <- NULL
> c(xx,dd)
[[1]]
f(x = 2, y = 1)

$z
[1] 3

[[3]]
[1] 4

> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, z = 3, 4)

(Splus has this rather differently, since dd becomes a call to list()
rather than a list of promises:

S> c(xx,dd)
f(x = 2, y = 1, list, z = 3, 4)
S> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, list, z = 3, 4)

...but at least gives the same in both cases)

Also, the names of arguments added with [[<- is getting dropped if a
new element is required:

> xx[["abc"]]<-123
> xx
f(x = 2, y = 1, 123)

S has what I'd expect there:

S> xx[["abc"]]<-123
S> xx
f(x = 2, y = 1, abc = 123)

[R-0.99.0 prerelease on RedHat6.1, but this is likely not a new thing.]

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 412.audit <==
Wed Feb 16 19:26:57 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 869 *
Subject:  inconsistent results when calling functions with other func
From: "White, Paul" <Paul.White@dsto.defence.gov.au>
Date: Thu, 8 Mar 2001 18:26:35 +1100 
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 869 <==
From postmaster@franz.stat.wisc.edu  Thu Mar  8 08:34:49 2001
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA02088
	for <r-bugs@biostat.ku.dk>; Thu, 8 Mar 2001 08:34:48 +0100 (MET)
Received: from digger1.defence.gov.au (really [203.5.217.4]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m14auwr-000JHfC@franz.stat.wisc.edu> (Debian Smail3.2.0.111)
	for <r-bugs@r-project.org>; Thu, 8 Mar 2001 01:34:57 -0600 (CST) 
Received: from dsto-ms2.dsto.defence.gov.au (dsto-ms2.dsto.defence.gov.au [131.185.2.150])
	by digger1.defence.gov.au (8.10.1/8.10.1) with ESMTP id f287YaQ20932
	for <r-bugs@r-project.org>; Thu, 8 Mar 2001 18:04:36 +1030 (CST)
Received: from muttley.dsto.defence.gov.au (unverified) by dsto-ms2.dsto.defence.gov.au
 (Content Technologies SMTPRS 4.1.5) with ESMTP id <T83b90296522bd3110d@dsto-ms2.dsto.defence.gov.au> for <r-bugs@r-project.org>;
 Thu, 8 Mar 2001 18:02:51 +1030
Received: from fmbex001.dsto.defence.gov.au (fmbex001.dsto.defence.gov.au [146.221.39.73])
	by muttley.dsto.defence.gov.au (8.9.3/8.9.3/8.9.3.LMD.990513) with ESMTP id QAA05954
	for <r-bugs@r-project.org>; Thu, 8 Mar 2001 16:56:31 +0930 (CST)
Received: by fmbex001.dsto.defence.gov.au with Internet Mail Service (5.5.2650.21)
	id <GLYF0N96>; Thu, 8 Mar 2001 18:26:34 +1100
Message-ID: <751E281AA9DED31194FA0090274DFFBC0837D3@fmbex003.dsto.defence.gov.au>
From: "White, Paul" <Paul.White@dsto.defence.gov.au>
To: "'r-bugs@r-project.org'" <r-bugs@r-project.org>
Subject:  inconsistent results when calling functions with other func
	tions as args
Date: Thu, 8 Mar 2001 18:26:35 +1100 
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2650.21)
Content-Type: text/plain

Hello Bug people,

I have an unexpected behavior and am unsure whether the problem is in my
thinking, my implementation or the program R.

Basically I get two different answers depending on how I call a function
which takes other functions as arguments as indicated below.
To me it should make no difference if f is a function that returns the
function g then z(f(x)) whould give the same as
y<- f(x)
z(y)
but I appear to get different answers as below. I have not distilled the
problem down to something you can replicate in total but have I done
something obviously wrong ?

Regards
Paul White 
ps I just checked with 1.2.2 and it still has the same behavior.

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status =
 major = 1
 minor = 2.1
 year = 2001
 month = 01
 day = 15
 language = R


> risk <- function(f,g,H,lower.limits,upper.limits) 
+ {   prob.of.fracture <-  function(x)
+       { a  <- x[1] 
+         kc <- x[2] 
+         f(a) * g(kc) * H(a,kc) }
+
adapt(2,lower.limits,upper.limits,minpts=200,maxpts=20000,prob.of.fracture,e
ps=1e-3) }
>
risk(eifs.at.time.using.density(5000,eifs,1e-4,2),g,H,c(0.001,20),c(.5,60))
[1] 1.999471
       value       relerr       minpts       lenwrk        ifail 
    28.39852 0.0003455776          627         2803            0 
> 
> eifs.5000 <- eifs.at.time.using.density(5000,eifs,1e-4,2)
[1] 1.999471
> risk(eifs.5000,g,H,c(0.001,20),c(.5,60))
       value       relerr       minpts       lenwrk        ifail 
5.461088e-13 0.0006449058          741         2803            0 


==> 869.reply.1 <==
From pd@blueberry.kubism.ku.dk  Thu Mar  8 10:22:02 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA04148;
	Thu, 8 Mar 2001 10:22:01 +0100 (MET)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id KAA05061;
	Thu, 8 Mar 2001 10:23:51 +0100
Sender: pd@pubhealth.ku.dk
To: Paul.White@dsto.defence.gov.au
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] inconsistent results when calling functions with other func (PR#869)
References: <200103080734.IAA02098@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 Mar 2001 10:23:50 +0100
In-Reply-To: Paul.White@dsto.defence.gov.au's message of "Thu, 8 Mar 2001 08:34:51 +0100 (MET)"
Message-ID: <x2elw8fwbd.fsf@blueberry.kubism.ku.dk>
Lines: 59
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Paul.White@dsto.defence.gov.au writes:

> Hello Bug people,
> 
> I have an unexpected behavior and am unsure whether the problem is in my
> thinking, my implementation or the program R.
> 
> Basically I get two different answers depending on how I call a function
> which takes other functions as arguments as indicated below.
> To me it should make no difference if f is a function that returns the
> function g then z(f(x)) whould give the same as
> y<- f(x)
> z(y)
> but I appear to get different answers as below. I have not distilled the
> problem down to something you can replicate in total but have I done
> something obviously wrong ?

Lazy evaluation sometimes plays tricks on the unsuspecting. In the
first case, eifs.at.time.using.density(5000,eifs,1e-4,2) is evaluated
when adapt first calls prob.of.fracture, in the other it is of course
evaluated from the start. If eifs.at.time.using.density is dependent
on values that might have changed...

You're not showing us eifs.at.time.using.density, so it is difficult
to say whether you have a bug or not.

> > risk <- function(f,g,H,lower.limits,upper.limits) 
> + {   prob.of.fracture <-  function(x)
> +       { a  <- x[1] 
> +         kc <- x[2] 
> +         f(a) * g(kc) * H(a,kc) }
> +
> adapt(2,lower.limits,upper.limits,minpts=200,maxpts=20000,prob.of.fracture,e
> ps=1e-3) }
> >
> risk(eifs.at.time.using.density(5000,eifs,1e-4,2),g,H,c(0.001,20),c(.5,60))
> [1] 1.999471
>        value       relerr       minpts       lenwrk        ifail 
>     28.39852 0.0003455776          627         2803            0 
> > 
> > eifs.5000 <- eifs.at.time.using.density(5000,eifs,1e-4,2)
> [1] 1.999471
> > risk(eifs.5000,g,H,c(0.001,20),c(.5,60))
>        value       relerr       minpts       lenwrk        ifail 
> 5.461088e-13 0.0006449058          741         2803            0 
> 
> 
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 869.audit <==
Mon Mar 12 08:16:46 2001	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 813 *
Subject: match.call problem
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 12 Jan 2001 17:46:15 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 813 <==
From postmaster@franz.stat.wisc.edu  Fri Jan 12 17:46:04 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA09757
	for <r-bugs@biostat.ku.dk>; Fri, 12 Jan 2001 17:46:04 +0100 (MET)
Received: from pubhealth.ku.dk (really [130.225.108.10]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14H7LE-000IWyC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Fri, 12 Jan 2001 10:46:16 -0600 (CST) 
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA09753
	for <r-bugs@r-project.org>; Fri, 12 Jan 2001 17:45:20 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id RAA12842;
	Fri, 12 Jan 2001 17:46:16 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-bugs@r-project.org
Subject: match.call problem
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 12 Jan 2001 17:46:15 +0100
Message-ID: <x2lmsgvhuw.fsf@blueberry.kubism.ku.dk>
Lines: 62
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit


Previously reported by Martin as a plot.formula issue, but I believe
it boils down to this:

> f <- function(x,...)match.call(expand.dots=FALSE)
> g <- function(x,y=2,...)f(x,y=y,...)
> g(1)
f(x = x, ... = list(y = y, ...))
> g(1,b=2) 
f(x = x, ... = list(y = y, b = 2))
> g(1,y=2)
f(x = x, ... = list(y = y, ...))

Notice that ... appears if all actual arguments to g are matched in
the call to f. This is the *name* "..." as in as.name("..."). I would
have expected just ... = list(y = y) in those cases.

Simpler

> f <- function(x,...)match.call(expand.dots=FALSE)
> g <- function(x,...)f(x,...)
> g(1)
f(x = x, ... = list(...))
> g(1,2)
f(x = x, ... = list(..1 = 2))
> g(1,a=2)
f(x = x, ... = list(a = 2))

or yet again simpler

> f <- function(...)match.call(expand.dots=FALSE)
> g <- function(...)f(...)
> g(1)
f(... = list(..1 = 1))
> g()
f(... = list(...))
> f()
f()


For comparison, Splus 3.4 has this kind of stuff:

> f <- function(...)match.call(expand.dots=FALSE)
> g <- function(...)f(...)
> g()
f(... = list())
> f()
f(... = list())
> g(1)
f(... = list(1))
> g(a=1)  
f(... = list(a = 1))

I don't see why we don't do the same (although given differences in
lazy evaluation, there might be a point to it), but just getting rid
of the ... in the lists would help quite a bit.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 813.audit <==
Sat Jan 13 18:52:20 2001	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Low-level

* PR# 505 *
Subject: interrupted save 
From: Thomas Lumley <thomas@biostat.washington.edu>
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 505 <==
From thomas@biostat.washington.edu  Sat Mar 25 21:16:39 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA08785
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 21:16:38 +0100 (MET)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id MAA24561
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 12:16:50 -0800 (PST)
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: R-bugs@biostat.ku.dk
Subject: interrupted save 
In-Reply-To: <Pine.GSO.4.21.0003251204350.22429-100000@mail.biostat.washington.edu>
Message-ID: <Pine.GSO.4.21.0003251207350.22429-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


If an error occurs during a save the file does not appear to be
closed and buffers flushed.  This can lead to corruption if the same
filename is used later and then the buffer is flushed on program exit.

For example, tn the context of PR #504

 f<-function(x,...){ function(y) list(x=x,y=y,...)}
 a<-f(1,2,3)
 save(list="a",file="a.rdata")  ## -- error --
 b<-1:10
 save(list="b",file="a.rdata")
 load("a.rdata")  ## works
 q("no")
 
 R

 load("a.rdata")  ## error



This is R1.0 on Linux

	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


==> 505.audit <==
Thu Apr 13 06:21:36 2000	ripley	moved from incoming to Low-level
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Misc

* PR# 875 *
Subject: Re: [R] Bug in qchisq?
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 10 Mar 2001 02:26:11 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 875 <==
From pd@blueberry.kubism.ku.dk  Sat Mar 10 02:24:17 2001
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id CAA25075
	for <R-bugs@biostat.ku.dk>; Sat, 10 Mar 2001 02:24:16 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id CAA22722
	for <r-bugs@stat.math.ethz.ch>; Sat, 10 Mar 2001 02:24:26 +0100 (MET)
Received: from mail.kubism.ku.dk(130.225.108.10), claiming to be "pubhealth.ku.dk"
 via SMTP by hypatia, id smtpdAAAa005Yt; Sat Mar 10 02:24:20 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id CAA25071;
	Sat, 10 Mar 2001 02:24:06 +0100 (MET)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id CAA16264;
	Sat, 10 Mar 2001 02:26:11 +0100
Sender: pd@pubhealth.ku.dk
To: Kenneth Cabrera <krcabrer@epm.net.co>
Cc: r-bugs@stat.math.ethz.ch
Subject: Re: [R] Bug in qchisq?
References: <3AA97DB7.1C92737A@epm.net.co>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 10 Mar 2001 02:26:11 +0100
In-Reply-To: Kenneth Cabrera's message of "Fri, 09 Mar 2001 20:04:55 -0500"
Message-ID: <x2pufq2z4c.fsf@blueberry.kubism.ku.dk>
Lines: 26
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Kenneth Cabrera <krcabrer@epm.net.co> writes:

> Hello developers and users:
> 
> My system fails (the computer freezes) when I use the ncp  parameter,
> with the lower.tail=FALSE option in the qchisq function.
> 
> qchisq(0.025,31,ncp=1,lower.tail=FALSE)

Yup, that's a bug. We have in pnchisq.c

48          for (ux = 1.0; pnchisq(ux, n, lambda, lower_tail, log_p) <
p; ux *= 2);
49          for (lx = ux;  pnchisq(lx, n, lambda, lower_tail, log_p) >
p; lx *= 0.5);

but if we look at the opposite tail, we also need to reverse that
logic since pnchisq(x,...) is now decreasing in x. Otherwise the
algorithm will get stuck in one of the for loops.

(Mailed to r-bugs)
-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 875.audit <==
Mon Mar 12 08:16:46 2001	ripley	moved from incoming to Misc

==> 875.reply.1 <==
From maechler@stat.math.ethz.ch  Tue Mar 13 10:43:50 2001
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA16598;
	Tue, 13 Mar 2001 10:43:49 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA04869;
	Tue, 13 Mar 2001 10:43:58 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa001Bw; Tue Mar 13 10:43:51 2001
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA08031; Tue, 13 Mar 2001 10:43:50 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15021.60374.219222.398746@gargle.gargle.HOWL>
Date: Tue, 13 Mar 2001 10:43:50 +0100
To: p.dalgaard@biostat.ku.dk
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] Re: [R] Bug in qchisq? (PR#875)
In-Reply-To: <200103100124.CAA25085@pubhealth.ku.dk>
References: <200103100124.CAA25085@pubhealth.ku.dk>
X-Mailer: VM 6.86 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "PD" == p dalgaard <p.dalgaard@biostat.ku.dk> writes:

    PD> Kenneth Cabrera <krcabrer@epm.net.co> writes:
    >> Hello developers and users:
    >> 
    >> My system fails (the computer freezes) when I use the ncp  parameter,
    >> with the lower.tail=FALSE option in the qchisq function.
    >> 
    >> qchisq(0.025,31,ncp=1,lower.tail=FALSE)

    PD> Yup, that's a bug. We have in pnchisq.c

    PD> 48   for (ux = 1.0; pnchisq(ux, n, lambda, lower_tail, log_p) < p; 
    PD> 	ux *= 2);
    PD> 49   for (lx = ux;  pnchisq(lx, n, lambda, lower_tail, log_p) > p;
    PD> 	lx *= 0.5);

    PD> but if we look at the opposite tail, we also need to reverse that
    PD> logic since pnchisq(x,...) is now decreasing in x. Otherwise the
    PD> algorithm will get stuck in one of the for loops.

Now fixed for R-devel (to become 1.3.0), together with the "FIXME" comment
a few lines above.

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Models

* PR# 862 *
Subject: Wrong sign for Pearson residuals
From: faraway@umich.edu
Date: Mon, 5 Mar 2001 18:04:34 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 862 <==
From faraway@umich.edu  Mon Mar  5 18:04:34 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA01333
	for <R-bugs@biostat.ku.dk>; Mon, 5 Mar 2001 18:04:34 +0100 (MET)
Date: Mon, 5 Mar 2001 18:04:34 +0100 (MET)
From: faraway@umich.edu
Message-Id: <200103051704.SAA01333@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Wrong sign for Pearson residuals

Full_Name: Julian Faraway
Version: 1.2.1
OS: Linux + NT
Submission from: (NULL) (141.211.66.172)


Consider the following data from McCullagh and Nelder:

> clot
   time conc lot
1   118    5 one
2    58   10 one
3    42   15 one
4    35   20 one
5    27   30 one
6    25   40 one
7    21   60 one
8    19   80 one
9    18  100 one
10   69    5 two
11   35   10 two
12   26   15 two
13   21   20 two
14   18   30 two
15   16   40 two
16   13   60 two
17   12   80 two
18   12  100 two
> g <- glm(time ~ log(conc)*lot, Gamma, clot)
> residuals(g)
         1          2          3          4          5          6          7 
-0.0400835  0.0864112  0.0490090  0.0290499 -0.0384659  0.0011126 -0.0286959 
         8          9         10         11         12         13         14 
-0.0375571 -0.0263724 -0.0292475  0.0637151  0.0394632 -0.0175449  0.0143592 
        15         16         17         18 
 0.0103035 -0.0557378 -0.0466764  0.0171410 
> residuals(g,type="pearson")
         1          2          3          4          5          6          7 
 0.0395493 -0.0889174 -0.0498126 -0.0293318  0.0379742 -0.0011130  0.0284220 
         8          9         10         11         12         13         14 
 0.0370884  0.0261410  0.0289630 -0.0650753 -0.0399839  0.0174424 -0.0144280 
        15         16         17         18 
-0.0103389  0.0547070  0.0459530 -0.0172391 

The Pearson residuals have the wrong sign. It seems the sign is taken from the 
working residuals. The sign is reversed because the inverse link function
used in this example. The problem could be easily fixed by taking the sign from

the response residuals.

==> 862.audit <==
Thu Mar  8 18:23:52 2001	ripley	moved from incoming to Models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Startup

* PR# 486 *
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
--workaround to the origin problem in 1.0.1
--New report: try does not work from the profile.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 486 <==
From maechler@stat.math.ethz.ch  Tue Mar 14 10:32:36 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA17249
	for <R-bugs@biostat.ku.dk>; Tue, 14 Mar 2000 10:32:35 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA21252;
	Tue, 14 Mar 2000 10:32:48 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005C1; Tue Mar 14 10:32:44 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA03934; Tue, 14 Mar 2000 10:32:44 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14542.1851.731086.380@lynne.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
To: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Cc: R-bugs@stat.math.ethz.ch
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
 (PR#470)
In-Reply-To: <Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
References: <14532.56910.278837.379365@lynne.ethz.ch>
	<Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

    BDR> On Tue, 7 Mar 2000, Martin Maechler wrote:
    >> >>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
    >> 
    BDR> On Tue, 7 Mar 2000, Trenkler, Dietrich wrote:
    >> >> I think I've discovered what went wrong.
    >> >> 
    >> >> My workspace included a function wilcox.test formerly copied from
    >> >> ctest. Now ctest ist part of the distribution and because of that I
    >> >> always got the message:
    >> >> 
    >> >> [Previously saved workspace restored]
    >> >> 
    >> >> Error in autoload("wilcox.test", "ctest") :
    >> >> Object already exists
    >> >> 
    >> >> I didn't take care of this message. Now I removed wilcox.test, saved
    >> >> the WS, restarted R without the vanilla-option and alas, anova
    >> >> now works.
    >> >> 
    >> >> It seems that R stops initializing after encountering the error
    >> >> mentioned above. Is this correct?   
    >> 
    BDR> Yes, in that the rest of the system Rprofile file is skipped
    BDR> and hence options show.signif.stars and show.coef.Pvalues are not set.
    >> but other options as well..
    >> I think this shouldn't happen and *is* a bug.

    BDR> It looks to me as if a bit more protection is needed in print.coefmat,
    BDR> at least.

	 which Brian has implemented in the mean time.

	 ....

    >> For the 1.0.x patches, at least, I'll move the autoload()'s to the end of
    >> profile/Common.R

    BDR> I _think_ they should have try() around them, which is what S-PLUS 
    BDR> now does with all startup code.

I tried this, but it does not work :

try(autoload(..)) works okay when used after startup, but not *during*
startup.  However, I'll put a workaround into Common.R

Should this {try(.) not working during startup} be another bug report ?

Martin

==> 486.audit <==
Sat Mar 25 09:44:47 2000	maechler	moved from incoming to Startup
Sat Apr 08 07:41:36 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  System-specific

* PR# 896 *
Subject: Optimize: difference between R for Linux and Windows
From: "Marketa Kylouskova" <Marketa.Kylouskova@euromise.cz>
Date: 5 Apr 2001 12:30:29 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 896 <==
From Marketa.Kylouskova@euromise.cz  Thu Apr  5 12:31:11 2001
Received: from unix.euromise.cz (unix.euromise.cz [147.231.7.2])
	by pubhealth.ku.dk (8.9.3/8.9.1) with SMTP id MAA09127
	for <r-bugs@biostat.ku.dk>; Thu, 5 Apr 2001 12:31:08 +0200 (MET DST)
Received: (qmail 22214 invoked from network); 5 Apr 2001 10:31:16 -0000
Received: (ofmipd unknown); 5 Apr 2001 10:30:54 -0000
Received: from MISE/SpoolDir by mise.euromise.cz (Mercury 1.48);
    5 Apr 01 12:31:00 +0100
Received: from SpoolDir by MISE (Mercury 1.48); 5 Apr 01 12:30:35 +0100
Date: 5 Apr 2001 12:30:29 +0100
Message-ID: <20010405123029.1.22213.qmail@unix.euromise.cz>
From: "Marketa Kylouskova" <Marketa.Kylouskova@euromise.cz>
To: r-bugs@biostat.ku.dk
Organization: EuroMISE Center
MIME-Version: 1.0
Content-type: Multipart/Mixed; boundary=Message-Boundary-4491
Subject: Optimize: difference between R for Linux and Windows
Priority: normal
X-mailer: Pegasus Mail for Win32 (v3.12a)


--Message-Boundary-4491
Content-type: text/enriched; charset=US-ASCII
Content-transfer-encoding: 7BIT
Content-description: Mail message body

<flushboth><color><param>0100,0100,0100</param><FontFamily><param>Times New Roman</param>Dear developers,</flushboth>

<flushboth>	I have a problem with some discrepancy in the performance of the 
function <FontFamily><param>Courier New</param><smaller>optimize<FontFamily><param>Times New Roman</param><bigger> between R 1.2.1 for Windows and R 1.2.2 (and less) 
for Linux. While trying to correct the wilcox.test (see my previous bug 
report) I encountered the following problem: I wanted to check the 
behaviour of the function <FontFamily><param>Courier New</param><smaller>wdiff<FontFamily><param>Times New Roman</param><bigger> used in the search for CI limits.</flushboth>


<paraindent><param>out</param><FontFamily><param>Courier New</param><smaller>x<<-rnorm(10,3,1)	</paraindent>

<paraindent><param>out</param>y<<-rnorm(10,0,1)	<bigger></paraindent>


<paraindent><param>out</param><FontFamily><param>Times New Roman</param><bigger>say </paraindent>


<flushboth><FontFamily><param>Courier New</param><smaller>x<<-
c(3.770684,4.654342,3.496403,1.772743,1.624953,2.645835,
3.099477,1.706758,3.507709,1.982924)</flushboth>

<flushboth>y<<-c(-0.8161288,0.1632923,0.6421997,1.9270846,-
0.4668112,0.3587806,0.3312529,-0.5393900,</flushboth>

<flushboth>0.1057892,1.7963575)</flushboth>


<paraindent><param>out</param>mu<<-0</paraindent>

<paraindent><param>out</param>n.x<<-length(x)</paraindent>

<paraindent><param>out</param>n.y<<-length(y)</paraindent>


<paraindent><param>out</param>wdiff <<- function(d, zq) {</paraindent>

<paraindent><param>out</param>   	dr <<- rank(c(x- mu -d,y))</paraindent>

<paraindent><param>out</param>   	NTIES.CI <<- table(dr)</paraindent>

<paraindent><param>out</param>   	dz <<- (sum(dr[seq(along = x)]) - n.x * (n.x + 1)/2 -
 n.x * n.y/2)</paraindent>

<paraindent><param>out</param>	CORRECTION.CI<<-0</paraindent>

<paraindent><param>out</param>   SIGMA.CI <<- sqrt((n.x * n.y/12) * ((n.x + n.y + 1) - 
sum(NTIES.CI^3 - NTIES.CI)/((n.x + n.y) * (n.x + 
n.y - 1))))</paraindent>

<paraindent><param>out</param>   dz <<- (dz - CORRECTION.CI)/SIGMA.CI</paraindent>

<paraindent><param>out</param>   abs(dz - zq)</paraindent>

<paraindent><param>out</param>}</paraindent>


<flushboth><FontFamily><param>Times New Roman</param><bigger>To examine the behivour I plotted the course of the <FontFamily><param>Courier New</param><smaller>wdiff<FontFamily><param>Times New Roman</param><bigger> for a lot of d 
and three zq (0.05, 0.5, 0.95) and I let optimize to compute the minimums. 
Then I plotted it. </flushboth>


<paraindent><param>out</param><FontFamily><param>Courier New</param><smaller>mumin<<-min(x)-max(y)</paraindent>

<paraindent><param>out</param>mumax<<-max(x)-min(y) </paraindent>


<paraindent><param>out</param>lll<<-seq(mumin,mumax,by=0.01)</paraindent>

<paraindent><param>out</param>wdl<<-apply(cbind(lll),1,wdiff,zq=qnorm(0.05))</paraindent>

<paraindent><param>out</param>wdm<<-apply(cbind(lll),1,wdiff,zq=qnorm(0.50))</paraindent>

<paraindent><param>out</param>wdu<<-apply(cbind(lll),1,wdiff,zq=qnorm(0.95))</paraindent>


<paraindent><param>out</param>plot(lll,wdl,type="l")</paraindent>

<paraindent><param>out</param>lines(lll,wdm,lty=4)</paraindent>

<paraindent><param>out</param>lines(lll,wdu,lty=7)</paraindent>



<paraindent><param>out</param>ol<<-
optimize(wdiff,c(mumin,mumax),zq=qnorm(0.05))$minimu
m</paraindent>

<paraindent><param>out</param>om<<-optimize(wdiff,c(mumin,mumax),zq=qnorm(0.5))$minimum</paraindent>

<paraindent><param>out</param>ou<<-
optimize(wdiff,c(mumin,mumax),zq=qnorm(0.95))$minimu
m</paraindent>


<paraindent><param>out</param>abline(v=ol)</paraindent>

<paraindent><param>out</param>abline(v=om,lty=4)</paraindent>

<paraindent><param>out</param>abline(v=ou,lty=7)</paraindent>



<flushboth><FontFamily><param>Times New Roman</param><bigger>When it ran on my home Linux (R 1.2.2 (2001-02-26) Compiled from 
source tarball on Linux with gcc version 2.95.2 19991024) it computed the 
minimum for zq = 0.05 only, for the others it found something totally 
wrong (see attached figure shouldntbe.gif). Then I checked it at work on 
S+2000 and R 1.2.1 for Windows and it gave the correct results and 
picture (see attached figure shouldbe.gif). Could you, please, advise me 
whether the problem stands in the platform version or in my compiled 
version, and what should I do to make it work properly?</flushboth>


<flushboth>Thank you very much for your help.</flushboth>


<flushboth>	Marketa Kylouskova</flushboth>

<flushboth>	{ HYPERLINK "mailto:marketa@ucw.cz" }marketa@ucw.cz</flushboth>

<flushboth>	kylouskova@euromise.cz</flushboth>



<nofill>

--Message-Boundary-4491
Content-type: text/plain; charset=US-ASCII
Content-disposition: inline
Content-description: Attachment information.

The following section of this message contains a file attachment
prepared for transmission using the Internet MIME message format.
If you are using Pegasus Mail, or any another MIME-compliant system,
you should be able to save it or view it from within your mailer.
If you cannot, please ask your system administrator for assistance.

   ---- File information -----------
     File:  shouldbe.gif
     Date:  5 Apr 2001, 11:35
     Size:  6826 bytes.
     Type:  GIF-image

--Message-Boundary-4491
Content-type: Image/GIF; name="shouldbe.gif"
Content-disposition: attachment; filename="shouldbe.gif"
Content-transfer-encoding: BASE64

R0lGODdhGANjAvcAAAAAAIAAAACAAICAAAAAgIAAgACAgMDAwMDcwKbK8EAgAGAgAIAgAKAg
AMAgAOAgAABAACBAAEBAAGBAAIBAAKBAAMBAAOBAAABgACBgAEBgAGBgAIBgAKBgAMBgAOBg
AACAACCAAECAAGCAAICAAKCAAMCAAOCAAACgACCgAECgAGCgAICgAKCgAMCgAOCgAADAACDA
AEDAAGDAAIDAAKDAAMDAAODAAADgACDgAEDgAGDgAIDgAKDgAMDgAODgAAAAQCAAQEAAQGAA
QIAAQKAAQMAAQOAAQAAgQCAgQEAgQGAgQIAgQKAgQMAgQOAgQABAQCBAQEBAQGBAQIBAQKBA
QMBAQOBAQABgQCBgQEBgQGBgQIBgQKBgQMBgQOBgQACAQCCAQECAQGCAQICAQKCAQMCAQOCA
QACgQCCgQECgQGCgQICgQKCgQMCgQOCgQADAQCDAQEDAQGDAQIDAQKDAQMDAQODAQADgQCDg
QEDgQGDgQIDgQKDgQMDgQODgQAAAgCAAgEAAgGAAgIAAgKAAgMAAgOAAgAAggCAggEAggGAg
gIAggKAggMAggOAggABAgCBAgEBAgGBAgIBAgKBAgMBAgOBAgABggCBggEBggGBggIBggKBg
gMBggOBggACAgCCAgECAgGCAgICAgKCAgMCAgOCAgACggCCggECggGCggICggKCggMCggOCg
gADAgCDAgEDAgGDAgIDAgKDAgMDAgODAgADggCDggEDggGDggIDggKDggMDggODggAAAwCAA
wEAAwGAAwIAAwKAAwMAAwOAAwAAgwCAgwEAgwGAgwIAgwKAgwMAgwOAgwABAwCBAwEBAwGBA
wIBAwKBAwMBAwOBAwABgwCBgwEBgwGBgwIBgwKBgwMBgwOBgwACAwCCAwECAwGCAwICAwKCA
wMCAwOCAwACgwCCgwECgwGCgwICgwKCgwMCgwOCgwADAwCDAwEDAwGDAwIDAwKDAwP/78KCg
pICAgP8AAAD/AP//AAAA//8A/wD//////ywAAAAAGANjAgAI/gD/CRxIsKDBgwgTKlzIsKHD
hxAjSpxIsaLFixgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjypxJs6bNmzhz6tzJs6fP
n0CDCh1KtKjRo0iTKl3KtKnTp1CjSp1KtarVq1izat3KtavXr2DDih1LtqzZs2jTql3Ltq3b
t3Djyp1Lt67du3jz6t3Lt6/fv4ADCx5MuLDhw4gTK17MuLHjx5AjS55MubLly5gza97MubPn
z6BDix5NurTp06hTq17NurXr17Bjy55Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz
59CjS59Ovbr169iza9/Ovbv37+DD/osfT768+fPo06tfz769+/fw48ufT7++/fv48+vfz7+/
//8ABijggAQWaOCBCCao4IIMNujggxBGKOGEFFZo4YUYZqjhhhx26OGHIIYo4ogklmjiiSim
qOKKLLbo4oswxijjjDTWaOONOOao44489ujjj0AGKeSQRBZp5JFIJqnkkkw26eSTUEYp5ZRU
VmnllVhmqeWWXEIJwJdghinmmGSWaeaZaKap5ppstunmm3DGKeecdNZp55145qnnnnz26eef
gAYapl4AdGlToQciipeiPjLalKMDQkqXpDpSmpSl/2EKl6Y2clqUp/uBypao1pG6lKlAoWqf
qmex2qKr/zzBKp+sY9Gaoq044eqerl/xmpyvPgE7k7DpEauVsSAi+5Ky5TFrlbMcQruStOFR
K5W1vGEbk7Ymccudt48GCe5I42ZXrlLnQpjuR+tW165R78IWb0nzalQvdPcGlW+W+zbXb7CG
1vTvcgPHelHBjiHclsLHMZzrwbdG5XBxEx+KUcXjYbyQxosh6rFAin78j8gdcSwTrWYmK3F0
X4Ls8sggF9pyyzDXbKvJ24KEc6krJ0qozipDtbNh8Q7tkrFGS5f0QEvn1rRKSA/3tEJPT22b
1SchPaiGVSs388sC/0wS1g33jNy/ZNOrtm9pF9S1z3k52zZxb5fd09wiQYt3cP51F7g30Gtn
u1XfBP7NbrcBN2Q4TTKL7PjLND8+cuM1HyT53WKPnThDi1tsM+RgSx4y2A4V3DlHerPd2ump
sW4v4hkSrpjrEMeddexm+5255oIfm/vstgdPL5kSyo4Y7bUvenTxv0e6O9TMC40g8smzRP3q
zQt4fUXjbr+a8QEu7ujWEXUvJoPgB+Z99Vkx6r5E7a5PWvqZdjW62+Uzjn724dvPtEGmit/+
pAe3wf0Pf5ZLmf5c8zf6+Ud8XyMIqt4lP/pU0DOsA9MB88e4MlXpggmJHOg+JxgQlg5zpjFh
qiZ1QNENRoWcQ2H/CGggGG5MhgByYH9sSDWAlaaB/P7L4fNywsPI6JA/RUTIwNZUnyOGaoif
ygwQaag74SEliSUMYv2seBQsqk+LafHi4bjYRcxM8SlilEwaN3gpC4Jxh1D8lKDitBsnlmWN
qItjX/AoFDvmh498vOEAa6hHvgRSjdMrpCEHWUXlFaZzh8xZAe8SyRCqCXtUdEsl2VeXTVLE
ky3xI34AORlRouuNSFRkYkA5LVQ+kYwJY40pV6XK412yjwbMpPNgqRlWlsyVYvHlJ2tJGWFu
ZJZNJGYph3JGpxjzhcpcZmeQyZVnctCRoLEmJ0+VSF72kng6aWa41EIyy5ASNdoMSzr/cs7T
rLNX5JxmNKVYrG5i053mBP/mH+dJz8pQE5evaac7wdmYf+prhOXMJj8/sy5xMuWde1woBh9j
0PgIlIGx1KX2JDpRSbZPn6Pk6DQ1CDyNOlM2F5VXx0B6n5QGdFm5RKM9KVmbd1bUYCgVqUJX
yVJaehOT1ovpSSdpF4hCTYEsm2lRf2NUeCm1k0wNnGqm1tTb/bSmXzSpEK+KVXb2NJlcpY0n
b/oelzqNZovUqlNvY1bdVJKsu9Lp9/wC12E5Ta5TzZtQx0nIsF4tomp9IF7zmlaZEhWqwoma
7wILR792dS91ZU9b3QpYw3Lzro597C8Xa9lG0lRqzqlqZuMpNZL+6qF1HCxQXyfLp7LQOHiM
7Hr+Jtub2H7VjaNlax45O9S+3pNuv0XtYV8L2+BeNqgkhJQLo0oWVon2YZ/tbDhHyDf7oema
FDPuKZGLHUgCcJh2WypjU+mV8YE3vMTtrWereT9LevBs0VUvSp67XbAk9CH0vYlp5SJb9SBP
ZueFb3r5ut5eOZdgGXHocQs84OI62LfxFTBwU5Lf+kYYvQFu3Xy/Q1u+7Xdht51IhRcsXn/F
pb+Wq5Zqxcq9vQoXwiU28VtQjJ4OT1iTIZ7VisWKVvy6mMQeGbF0EYsvHI/3ldr1mpGHvNHc
AmeCP7Zw4Xb811Hl2KJU1mwYrwwfG8MWhBV1HICblWUtY9YiJBPytXT+2mPd1ta1c0FZat88
3DhfrHEfVukJW8sykg7qvZPDc4LlitTYXJDG8traLQNNPjSXWc0lG9MdQwxpvYbNyRL+Lm8J
LOMFJllpkz5yiil76U8ntblcxk3RHn0+M5PuKohGZ8zafLIyM7pyOa1VqvUcaP3aGoGzobX/
RM3GYOMwxpZmsaY/SmxS78TLF6uyOnf9Upya+phuti+1MWrtCwPOzAqWcsKuO+szMS1N5271
sYlMLrYKe6515i94Kj1oiNC7mr9WnaHhLG8Oa7vZLc23BGGW59VGuY2MefeJBZ7uRld72Ewm
mm0x3elwIxzG7O7O6fx4b3xTnDkb3/ZsGd7/O1zDWuT+JTnnFD6/8gJTjA7/OKq3NWbCejzi
dC24t+3s6dbVHCtHXCMooQ07eB/8ikTL6rUpbHCgo7xVSt95KLFncaSHELJRRzZMyNdxQfKZ
v+ZmNCuJPjyTp5DbYBe7aXWOdZn7q+v2bnBBVU7nTb+YwTwXj+FiTWa3d9rpAPfp0rcu6XT3
8uhljPfCyVN1gFKOuo0d/HUaD6/7wT2YdK/t3nZmXsVvyjybf3qNM0+uteO58AQPe7kBPblp
MxvnW5R8rLhObrUTdNFsPzne+A77kso+4+xtG+/lS1HSIx7wVRk+p4vvd5AXe82B/zcim/+c
y/ew39P/fSdNH3PR/h8miRUm+6Rof2sqWl+JeTei8dGStvZffOCen7E0qeL+6OM2mCy/evbV
W//eR35wGtRePrZ/U0E2JiMpRTRi4nNuwLZnRhQyrLdWBeh9aKSAEGdyAVRMDTcz+RcsuWd1
/hdqGnhzGKhEhSZPQHZ3REEp5wd1FyhBGbhT4qaCNNhkL9h62JVyFLg88bdkkrWDU9eDICYa
BAVQIbiCo/KBc0d9zGeExJcqltKCZiF+ZjRd6Gd/tXaF7IeC2leFzDQaFdR1VHgZEwNpmBKG
XCh1oeE+AqR/MliAHIhWxNOB6seE41ZuPvSEM1iBqHeC/fRstceDDweIqueEy4eFmzGG/2kI
Uxm2Qoj4E1LogGqIZUj4iHmIduEUiEG4T5X4hddHf/vmiM/HXQGlhO3WYp54hPqBMAjoUQxk
ilZoiDU4Q5c4itATKg6jfCoGiaPGiBmzTd12iMJodLWYLpGYg7K4bik4jDYHid1HirnWiaKo
h7NIjFqXaEX4bMm4h8v4dZP4PX8Gi1uXRWanhZaYiFAIXUhEh0N4OV6Hd5kojrwjWHWIcfpy
Lsc4jY5Wj/BIiHa1VcrIjbHnjJ6jeabDi+coMOwoawTpa4x3TIXoikHIK/mIefdYkPwGjchF
kRkZj/+YIBQEhEynal2Ej6D1bcmWhYK4WdXIa84oj6dYXYmnkv/UGEUk2ZAYyVwSKJEtmYrZ
9o3m0i0LGZNCSUJj1I2h2IVI5os16ZPSBpS0yJTM6JSuln67WHRSOY9a+X5PeY1MpTG+dIAw
2YxeqToYE5ZtNJTWCHyJVXkRyJZRWZY62ZMs2ZT/J5f6NpV1qZfkpZTKZpfYZlVYOWV2uJb7
yJMhoYsAhG6rp251B5Vz9iioF2Qi6V6F9paRCZnOBn1HKVVbuUt++ZfRpo6UmZDtoYiiKXqK
6W+FaYN7mZKeCZqa6S6x+JpImZgV2XN4WSHEIjetdIvagZpVSZeN2JmCuWHbIZypWZy6yVqq
uFvBuX4MlXzbOJjWyTOtKUtjqY9WljX/23la2QmO31mOpTaERalx0kmE1zKZzMmVsrmbJ/ks
o/mch+kdyvmToAiM+omcn5mc6bmK8wmY9caaoVlynImK9Fk+4/l38PlgV4Zozxid4RmNkoiQ
CDqgiBmYvzihSXmgIuZ9uRmQ2Fdk+XmhfGmi8/afLRd31VmhxImiBDqbiYU1shJm2bihBSo4
VhOh74hmIXkw5xOiFiqj8RlDNgk/GkqThJmjj+mhrmePVili7tihTip91ZcnGAqAyoWMSAp5
ofhzyyaNT1p95clZPRaDpVlTanlQXZqgT1amyLdBaNpdEqOWnMKBCOWQZAqnJ6dpczp5briT
ijOoyVWbXLqc/+NIggPHgn7onPgpoLbongN4Zh8ZZXZKlMZWpZ8YqNw5qYZ2o4l6g69mpJhK
pZBKnpK6MWsKhiK6eOayqkNKqqc6a8PZnHKHncTWiiDoqRRqqHBJm/pkSkIqq756qyhCKsLa
lUSkogBJqAkaSXNER636eRoHq8G4qScaqb/qgw2aVAI4k8SKqmyaUdtKrTF6Kow5geRarvKX
onbnpoXFrtzKn7w2NzTahPJqnsDpkoC3mrVirbrGoXnpO+9zmw3IpGPardNxXxPIcfGqsKTl
rgQbrG0nsPJ5lR9VsAIZpkS6hRbbQ8OKQLsnruAarpvimB07hUejsT7jQH8Gse2KsP8lAqY9
yaPzyqyp6p8ju6DL+khZl6+4CnQ0m7OVRVc426vP4q/HB7RrsWqtV5ENRD/yAyc/a6ybGKKU
J6gHO3P8CLNKE3qVma2EcZ/9+YZJ2zRYlF9ki2D9appxiq9eC2rHgrZWy1MfO5oM+4dC67YX
S4BMC6y6R7IvSXs8q65+W7edIrge6Jg2C0/zl7IscnovKoJd+7fU0UxDA34jKLNKaqSWR13L
9a03Oapaq6+QsbY0Z3ah20II9XiiE7LYlblRuq5x22cAi5Asu6sxW7mIi559q7ixerNLyLlb
ZpHUCX9EW7yHO7v2qa3b1XmyqLmPW7v9JmZ9urR66rwuOL3/lotYaXa977puCehPR6usw8h5
I8q7zKt3cpSnlTM+ODO+mwu5RaupPjSlqrux27u86dt3VImtwGur8su9vXs8rXukbxvAlaq9
d2SBd2tk3xu/O9qLAclDQoa6p5Y9rGiOpqu+/Xuuv7uB+8KC5jq/1LtSHQXAfKrAVkrA6wt6
b1SGJezCH8wZ+LvCLNypW1uLU4iy/OuqPzhe9XKGTWvD5WugPcuiPbrAO8y1envCoaXCOems
VJOuI8nBlPvE3eu7HruvHJvFXki85LrBEUuvX+zEWlzAKHi7afrCiSnFziSt6PjABAOqXsyr
9XmdDJy8Z0fHcquRSnxnV0zB9suQ/2JMwzqsxy6ax2VLurO6hkfsoOOapY2cw/9rmG5syL5H
yaWKvIWsyVCMjjZlmzpDxCU6iKHsfIxcyYu8yuyiKQaItGpcVi0qpSZpuPy6xZBcstPanmYM
r9Ppx5npy8b5oW28iWGLwodsxJYMyNp4zM6Mrpm6zPbJxr/sqJ/UqIT8yOopzCaMktnczJ6b
pNDpo3Z8xpP7Q5HMtpGGgx5pzPupu7kMa5posgCasHgMz8Bstq8XoHXELLpCOwfmz2Krzi5n
b9rsbuI8yM/8xm3qyiVpzcx80PH8R+yZoeRsgo3byrwsy5kclEHmw/nMyagToS9L0h1tqrPs
0alMxbEpz//TTL9g1bkOfZz623QrvZShysrQDNMsDcRzKaZZCZudnNIq/dE0Qi2Yic18jNNI
nUOw7MhMnTfSYjSw69K6fM/6hyxKXdUFrWHejKMrOTZenc5kmdXzPMnITNY2zUwiHdMtjckQ
XcqSy9A8ndG1jKhPDdUXzc3E3MtwjdacmLdmPdeAHdg5vbAno3xg+aZhHcQvTdQ1LdSbGdd3
Kdm42dbzZSeOTc03RnhvjdKHkzprfbnr7MHXCoMbDaNvTNq/SaePPSFKbXvgfM2KHdvme8r9
2Zulbdq4ncYz3Mm8/dqw7dkfMtvoTNBlJ6HG3ZZJTMoQyXbCoi1XPdaCHcSEjdX/op1guTfd
xF3cMl1PhcraFT08q23PmA244f3TBqvPNO3eka3elp1on5y9gUzeIS3RRTrfaW3XU93Qhxrg
PQ3SzS3XV9TXwwIrcqbIgPrbei3gJxuRWFzb/ungDJraGN7EA07g612rRZ3eI53he6zczN3h
j4re9U2aE17S+i3J132s7czTylLdOAzUPEKRLQ7HUv3f33LahwfhfKvZnrzhPW7hmabWibzj
JM7FJj6zCLzN5Yyx/O3ix0vZI26Z51zkBR60FPaduJLj2n3lK34eGHzih5nd5o3fCH3HQw7f
4r3lQY0/HoPmIn7fDF6jXebjI0LdOh7mo2fku4yWbC7m/8lN5nqeiEMb4rYq5I2s4DSe5MF9
IjB5p31YuOSt4JQI5zWU6GMuwhAILu+G6XkO6H2c4to7wp2+xJDd5Ef+5Kqu4e/tKo+O5Ind
IciK4hmqKpbO4VMexZAO60qOmLp+f6yOYa6uwiKU2sM+H2Xu67TOqcHOp1BG7L1+Wrlo5wv9
3dEO7Dqo6U0awtvOxDk865dcw6XiOroavOM+08Xe2XzIevDLMFsK5G/e7u7OeYEIvUg+7cx+
6FEy74q+6tW+OdD+p5lu751tr8tn8KPu7bwZ7gAO8dkOwrWuInQeqwxPy6Ru4A1LYrcueAhv
6xO/wB/P7gMfLbh2ltze5gd/8v8D63S5q9aiQu7HvtfyDYoxP8mwfN717vIvL5+hPaRRrdMv
7uRBv7iXRPM+Tc8I/upMTp1g/t7urNWW+tA78ng1qfRLr9srz/I4gvXMqPVGzfVeD+0UT390
K4Swx6hLTfD+HZf9XPZm7/Zv36xaevSpXuJgDaXm/vXJfPZ9fyNKq+Uh79xxX9gg7/MbMvgV
7vAXwvh6X/QmAvm8LvlOHuQ9b/kkQvngrfhc8/fNu/EKwvkN7vgWQvpcrvl7DvpPv33R+vqw
H/uyP/u0X/u2f/u4n/u6v/t8gtgB28XAr7JlTPXCH/zFv7/Iz4nGj8bH3/zOH1LKm/xgzPzT
H3DR//z/1P/7y2/922+83Y/P1Z/44Q/+2e/90s/952/+2K/+40/37v/+8B//8j//9F//9n//
+J//+r///N///v//APFP4ECCBQ0eRJhQ4UKGDR0+hBhR4kSKFS1exJhR40aOHT1+BBlS5EiS
JU2eRJlS5UqWLV2+hBlT5kyaNW3exJlT506ePX3+HAhAKNCVAIieFDr0KMmkS1MadRoyadOo
Va2ahPov61WPSrlyzLr1K8awYz96NXtRbFq2bR2KXes2otG4ct8WrGtX4da8ehvS9Suxb2DC
V+EWfgh1MOKEixkTdPxYq8DIhStLxozzcOaFlzF7tgyasGLOB6eKLp0a5WbV/gZRW26NF23s
yZRp17Z9W3dL1rpfj94d1Dfk4MKLH2eKt/hvv8wDOzfbezd05NURSqdNva12u9wNn55927t1
8thjj/+Knqv58+KVk4e/sezy6cvn03efO/5+suHzZwfPN//+A1A9/g5EMEEFF2SwQQcfhDBC
CSeksEILL8QwQw035LBDDz8EMUQRRySxRBNPRDFFFVdksUUXX4QxRhlnpLFGG2/EMUcdd+Sx
Rx9/BDJIIYckskgjj0QySSWXZLJJJ5+EMkopp6SySiuvxDJLLbfksksvvwQzTDHHJLNMpHIz
0Ew111yQNNzYhDNOEN1MU04778wOTTz35DNCOvsElzRQBP8UtFBDjyP0UEUXTS1RRh+FFLja
6oy0Ukt50/NSTTetylFOPwVVJ09DJbVUU09FNVVVV2W1VVdfhTVWWWeltVZbb8U1V1135bVX
X38FNlhhhyW2WGOPRTZZZZdltllnn4U2WmmnpbZaa6/FNlttt+W2W2+/BTdcccclt1xzz0U3
XXXXZbddd9+FN15556W3XnsjDQgAOw==
--Message-Boundary-4491
Content-type: text/plain; charset=US-ASCII
Content-disposition: inline
Content-description: Attachment information.

The following section of this message contains a file attachment
prepared for transmission using the Internet MIME message format.
If you are using Pegasus Mail, or any another MIME-compliant system,
you should be able to save it or view it from within your mailer.
If you cannot, please ask your system administrator for assistance.

   ---- File information -----------
     File:  shouldntbe.gif
     Date:  5 Apr 2001, 11:35
     Size:  42371 bytes.
     Type:  GIF-image

--Message-Boundary-4491
Content-type: Image/GIF; name="shouldntbe.gif"
Content-disposition: attachment; filename="shouldntbe.gif"
Content-transfer-encoding: BASE64

R0lGODdhDAJhAvcAAAQCBHyKbFxCHKzCnFxiTLSKbDwSBMSmfNzi1IRiPEwqBIxyTGxCJNzC
nJSifGxSLLSadJyCXFQ2FNS2lOzSrDQWBJxyVKyOZIRqRHxSNCwOBDweBPz29GQ6HMyujMSe
fKyCZPzivAQKBLSSbOzGpFw+FOzWzEwiBExWRJx6VJRqTHxaNJR6VGxKJLyifPTatIxiRFwy
FKSKZFw2FOS+nLSShAwCBGRKJMTStMymhEwyFHRaNLyadNS+nIxqREQmBPTm5KR6XIRaPGRy
XJRyTOTGvKSCXNSujPzqxHRKLGRCHOTKpHRSLNy2lKyWbDQOBEQeBKyKZLySdIxqVHxiPDwa
BOTq3IRiTFQuDOTCnPzWtKyOdMSejOzOrJx+ZPzatFw6JMzaxJR2XKSGbNSunAQGBJSWlMSm
jKy+lLSedFQ6FPTSrCQiJGQ+HMSifPzmvAwKBLSWbEwmBJx+VHxeRGxONIxmRFw6FAwGB8yq
ibyee4xuTIRePpR2VKSGZNSykmRGJKyqrHR+ZNTW1FxWXJyujFxqVIyefFReTLTCrPz+/Oze
1KyKfISOdLyWfMzWvOzu5NTezHRWPNy2pGRuVFQyElw+JNy+nPTOrLSObTwWBcSqhIRmREwu
DGxGJdzGpDQaBJx2VqySbHxWNiwSDPz6/KyGZuzKp5RuTXxePJR+XGxOLLSWfKR+XvzuzHRO
LXRWNNy6lzQSBUQiBeTGpPzevPTWtLTGpNzm1NS6lMyyjLyWdIxuVIRmTKySdAQCDFxCJMSm
hIRiREwqDIxyVGxSNLSafJyCZFQ2HDQWDKyObIRqTDweDGQ6JMSehPzixAQKDLSSdFw+HEwi
DJx6XHxaPJR6XGxKLLyihIxiTKSKbFw2HAwCDGRKLMymjHRaPLyafIxqTEQmDIRaRJRyVKSC
ZNSulPzqzGRCJHRSNDQODEQeDKyKbHxiRDwaDOTq5FQuFOTCpPzavAQGDLSefFQ6HPTStGQ+
JMSihPzmxAwKDLSWdEwmDJx+XIxmTFw6HCwAAAAADAJhAgAI/gDL9RNYLoIfgwaNmDJykJ0f
UxH4AIgwRsaYKH6iXNyosSPHi9ouhByZKUomGcoujIiiTEY0UZlEFYBJM6ZNUS9fZnISjafP
nj33QdgVR4oTR0chGAU3dKixXU13PaW3i6oxHvSwas3K1Y2LDzxcgBNLdqyeA3rcpF2LT08w
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

==> 896.followup.1 <==
From Marketa.Kylouskova@euromise.cz  Thu Apr  5 13:19:37 2001
Received: from unix.euromise.cz (unix.euromise.cz [147.231.7.2])
	by pubhealth.ku.dk (8.9.3/8.9.1) with SMTP id NAA09982
	for <r-bugs@biostat.ku.dk>; Thu, 5 Apr 2001 13:19:37 +0200 (MET DST)
Received: (qmail 23321 invoked from network); 5 Apr 2001 11:19:45 -0000
Received: (ofmipd unknown); 5 Apr 2001 11:19:23 -0000
Received: from MISE/SpoolDir by mise.euromise.cz (Mercury 1.48);
    5 Apr 01 13:19:29 +0100
Received: from SpoolDir by MISE (Mercury 1.48); 5 Apr 01 13:19:12 +0100
Date: 5 Apr 2001 13:19:07 +0100
Message-ID: <20010405131907.1.23320.qmail@unix.euromise.cz>
From: "Marketa Kylouskova" <Marketa.Kylouskova@euromise.cz>
To: r-bugs@biostat.ku.dk
Organization: EuroMISE Center
MIME-Version: 1.0
Content-type: text/plain; charset=US-ASCII
Content-transfer-encoding: 7BIT
Subject: PR#896
Priority: normal
X-mailer: Pegasus Mail for Win32 (v3.12a)

Sorry to all that are angry about the form of my previous mail. I 
didn't realise what would happen :((.

Here it is in (hopefully) plain text (if my mailer doesn't spoil it again):

##############

Dear developers,
	I have a problem with some discrepancy between R 1.2.1 for 
Windows and R 1.2.2 (and less) for Linux. While trying to correct 
the wilcox.test (see my previous bug report) I encountered the 
following problem: I wanted to check the behaviour of the function 
wdiff used in the search for CI limits.

x<-rnorm(10,3,1)	
y<-rnorm(10,0,1)	
say 

x<-
c(3.770684,4.654342,3.496403,1.772743,1.624953,2.645835,3.0994
77,1.706758,3.507709,1.982924)
y<-c(-0.8161288,0.1632923,0.6421997,1.9270846,-
0.4668112,0.3587806,0.3312529,-0.5393900,
0.1057892,1.7963575)

mu<-0
n.x<-length(x)
n.y<-length(y)

wdiff <- function(d, zq) {
   	dr <- rank(c(x- mu -d,y))
   	NTIES.CI <- table(dr)
   	dz <- (sum(dr[seq(along = x)]) - n.x * (n.x + 1)/2 - n.x * n.y/2)
	CORRECTION.CI<-0
   SIGMA.CI <- sqrt((n.x * n.y/12) * ((n.x + n.y + 1) - 
sum(NTIES.CI^3 - NTIES.CI)/((n.x + n.y) * (n.x + n.y - 1))))
   dz <- (dz - CORRECTION.CI)/SIGMA.CI
   abs(dz - zq)
}

To examine the behivour I plotted the course of the wdiff for a lot of 
d and three zq (0.05, 0.5, 0.95) and I let optimize to compute the 
minimums. Then I plotted it. 

mumin<-min(x)-max(y)
mumax<-max(x)-min(y) 

lll<-seq(mumin,mumax,by=0.01)
wdl<-apply(cbind(lll),1,wdiff,zq=qnorm(0.05))
wdm<-apply(cbind(lll),1,wdiff,zq=qnorm(0.50))
wdu<-apply(cbind(lll),1,wdiff,zq=qnorm(0.95))

plot(lll,wdl,type="l")
lines(lll,wdm,lty=4)
lines(lll,wdu,lty=7)


ol<-optimize(wdiff,c(mumin,mumax),zq=qnorm(0.05))$minimum
om<-optimize(wdiff,c(mumin,mumax),zq=qnorm(0.5))$minimum
ou<-optimize(wdiff,c(mumin,mumax),zq=qnorm(0.95))$minimum

abline(v=ol)
abline(v=om,lty=4)
abline(v=ou,lty=7)


When it ran on my home Linux (R 1.2.2 (2001-02-26) Compiled 
from source tarball on Linux with gcc version 2.95.2 19991024) it 
computed the minimum for zq = 0.05 only, for the others it found 
something totally wrong (three curves with "valleys", one line 
indicating the right minimum, one line indicating where the 
computed minimum surely doesn't lie; moreover, it was the same 
for both 0.5 and 0.95). Then I checked it at work on S+2000 and R 
1.2.1 for Windows and it gave the correct results and picture (three 
curves with "valleys" and three lines indicating where the minimum 
lies). Could you, please, advise me whether the problem stands in 
the platform version or in my compiled version, and what should I 
do to make it work properly?

Thank you very much for your help.

	Marketa Kylouskova
	marketa@ucw.cz
	kylouskova@euromise.cz

 



==> 896.audit <==
Sat Apr  7 10:28:00 2001	ripley	moved from incoming to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 863 *
Subject: src/main/arithmetic.c on OpenBSD
From: ian@darwinsys.com (Ian Darwin)
Date: Tue,  6 Mar 2001 19:49:53 -0500 (EST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 863 <==
From postmaster@franz.stat.wisc.edu  Wed Mar  7 01:50:05 2001
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA17426
	for <r-bugs@biostat.ku.dk>; Wed, 7 Mar 2001 01:50:04 +0100 (MET)
Received: from tomts6-srv.bellnexxia.net (really [209.226.175.26]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m14aS9f-000JARC@franz.stat.wisc.edu> (Debian Smail3.2.0.111)
	for <r-bugs@r-project.org>; Tue, 6 Mar 2001 18:50:15 -0600 (CST) 
Received: from darian.darwinsys.com ([64.228.44.192])
          by tomts6-srv.bellnexxia.net
          (InterMail vM.4.01.03.16 201-229-121-116-20010115) with ESMTP
          id <20010307004957.IMJM25007.tomts6-srv.bellnexxia.net@darian.darwinsys.com>
          for <r-bugs@r-project.org>; Tue, 6 Mar 2001 19:49:57 -0500
Received: by darian.darwinsys.com (Postfix, from userid 100)
	id 0F24B2475; Tue,  6 Mar 2001 19:49:53 -0500 (EST)
To: r-bugs@r-project.org
Subject: src/main/arithmetic.c on OpenBSD
Message-Id: <20010307004953.0F24B2475@darian.darwinsys.com>
Date: Tue,  6 Mar 2001 19:49:53 -0500 (EST)
From: ian@darwinsys.com (Ian Darwin)

First, let me say how glad I am to discover R! As a former user of S
at the University of Toronto and, briefly S-Plus from StatSci (I had
a binary version of that on Slolaris for a while), I was really glad
to find the "R" project.

This is perhaps not your bug, but I did have one minor glitch in
compiling R. OpenBSD 2.8's math.h does not export the "struct
exception" unless you define __LIBM_PRIVATE. The attached patch is
all that is needed to make it compile. Feel free to apply this patch
in future releases, or not (maybe with "#ifdef __OpenBSD__" around it).

Again, thanks for the software.

Ian Darwin
ian@darwinsys.com

--- src/main/arithmetic.c.orig	Tue Mar  6 17:58:18 2001
+++ src/main/arithmetic.c	Tue Mar  6 18:27:38 2001
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include "Defn.h"		/*-> Arith.h */
+#define __LIBM_PRIVATE	/* OpenBSD -> for definition of "struct exception" */
+#include "Defn.h"		/*-> Arith.h -> math.h */
+#undef __LIBM_PRIVATE	
 #define MATHLIB_PRIVATE
 #include <Rmath.h>
 #undef MATHLIB_PRIVATE

==> 863.audit <==
Thu Mar  8 18:24:07 2001	ripley	foobar
Thu Mar  8 18:24:07 2001	ripley	moved from incoming to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 851 *
Subject: Comments on R-1.2.1 builds
From: "Nelson H. F. Beebe" <beebe@math.utah.edu>
Date: Fri, 16 Feb 2001 17:44:17 -0700 (MST)
--These are only warnings: some have been eliminated for 1.2.2.
--Some are about constructs needed to satisfy other compilers.
--
--Also: configure problem with g77 on SGI.
--(Should be taken care of for 1.2.3).
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 851 <==
From postmaster@franz.stat.wisc.edu  Sat Feb 17 01:44:14 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA19300
	for <r-bugs@biostat.ku.dk>; Sat, 17 Feb 2001 01:44:11 +0100 (MET)
Received: from sunshine.math.utah.edu (really [128.110.198.2]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14TvU6-000J5HC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Fri, 16 Feb 2001 18:44:22 -0600 (CST) 
Received: from suncore.math.utah.edu (suncore0.math.utah.edu [128.110.198.5])
	by sunshine.math.utah.edu (8.9.3/8.9.3) with ESMTP id RAA20034;
	Fri, 16 Feb 2001 17:44:18 -0700 (MST)
Received: (from beebe@localhost)
	by suncore.math.utah.edu (8.9.3/8.9.3) id RAA29625;
	Fri, 16 Feb 2001 17:44:17 -0700 (MST)
Date: Fri, 16 Feb 2001 17:44:17 -0700 (MST)
From: "Nelson H. F. Beebe" <beebe@math.utah.edu>
To: r-bugs@r-project.org
Cc: beebe@math.utah.edu
X-US-Mail: "Center for Scientific Computing, Department of Mathematics, 322
        INSCC, University of Utah, 155 S 1400 E RM 233, Salt Lake City, UT
        84112-0090, USA"
X-Telephone: +1 801 581 5254
X-FAX: +1 801 585 1640, +1 801 581 4148
X-URL: http://www.math.utah.edu/~beebe
Subject: Comments on R-1.2.1 builds
Message-ID: <CMM.0.92.0.982370657.beebe@suncore.math.utah.edu>

The R-1.2.1 builds have gone fairly smoothly on most of my UNIX
architectures, but there were many warnings reported by the picky SGI
compiler that could be eliminated in future releases.

Generally, I have found the SGI compilers very helpful in ferreting
out portability problems, unused and/or obsolete variables, unexpected
datatype coercions, etc., and they compile faster than any other
compilers too.

First, I configured like this:

env CC='c89 -mips3 -O3' ./configure && make all

This reports:

	R is now configured for mips-sgi-irix6.5

	  Source directory:          .
	  Installation directory:    /usr/local
	  C compiler:                c89 -mips3 -O3  -OPT:IEEE_NaN_inf=ON -g
	  C++ compiler:              c++  -g -O2
	  FORTRAN compiler:          g77  -OPT:IEEE_NaN_inf=ON -g -O2

	  X11 support:               yes
	  Gnome support:             no
	  Tcl/Tk support:            yes

	  R profiling support:       yes
	  R as a shared library:     no

The build proceeds until this failure:

	g77 -OPT:IEEE_NaN_inf=ON  -g -O2 -c ch2inv.f -o ch2inv.o
	f771: Invalid option `-OPT:IEEE_NaN_inf=ON'
	make[3]: *** [ch2inv.o] Error 1

Evidently, it was not prepared for the GNU Fortran compiler.

I started over with a new clean unpack of the distribution,
with

	env FC=f77 F77=f77 CC=c89 CXX=CC ./configure &&
		make all check install

and got a working build and install.  It reports

	R is now configured for mips-sgi-irix6.5

	  Source directory:          .
	  Installation directory:    /usr/local
	  C compiler:                c89  -OPT:IEEE_NaN_inf=ON -g
	  C++ compiler:              CC  -g
	  FORTRAN compiler:          f77  -OPT:IEEE_NaN_inf=ON -g

	  X11 support:               yes
	  Gnome support:             no
	  Tcl/Tk support:            yes

	  R profiling support:       yes
	  R as a shared library:     no


Here are the all the compiler warnings reported:

------------------------------------------------------------------------
DIRECTORY: R-1.2.1/src/appl
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c chull.c -o chull.o
cc-1185 c89: WARNING File = chull.c, Line = 77
  An enumerated type is mixed with another type.

      Rboolean vert, neg_dir=0;
                             ^

cc-1185 c89: WARNING File = chull.c, Line = 84
  An enumerated type is mixed with another type.

      vert = (x[jj] == xt);
           ^

cc-1185 c89: WARNING File = chull.c, Line = 87
  An enumerated type is mixed with another type.

        neg_dir = ((s > 0 && d1 < 0.) || (s < 0 && d1 > 0.));
                ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c cpoly.c -o cpoly.o
cc-1185 c89: WARNING File = cpoly.c, Line = 490
  An enumerated type is mixed with another type.

      *bool = hypot(hvr, hvi) <= are * 10. * hypot(hr[n-1], hi[n-1]);
            ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c lbfgsb.c -o lbfgsb.o
cc-1552 c89: WARNING File = lbfgsb.c, Line = 326
  The variable "l1" is set but never used.

      int lsnd, l1, l2, l3, ld, lr, lt;
                ^

cc-1552 c89: WARNING File = lbfgsb.c, Line = 326
  The variable "l2" is set but never used.

      int lsnd, l1, l2, l3, ld, lr, lt;
                    ^

cc-1552 c89: WARNING File = lbfgsb.c, Line = 326
  The variable "l3" is set but never used.

      int lsnd, l1, l2, l3, ld, lr, lt;
                        ^

cc-1551 c89: WARNING File = lbfgsb.c, Line = 687
  The variable "xstep" is used before its value is set.

                   nint, word, iback, stp, xstep, k);
                                           ^

cc-1552 c89: WARNING File = lbfgsb.c, Line = 582
  The variable "time" is set but never used.

      double time;
             ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c pretty.c -o pretty.o
cc-1185 c89: WARNING File = pretty.c, Line = 82
  An enumerated type is mixed with another type.

        i_small = dx < cell * U * imax2(1,*ndiv) * DBL_EPSILON *3;
                ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c strsignif.c -o strsignif.o
cc-1552 c89: WARNING File = strsignif.c, Line = 80
  The variable "jL" is set but never used.

      int iex, j, jL, len_flag = strlen(*flag);
                  ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c uncmin.c -o uncmin.o
cc-1551 c89: WARNING File = uncmin.c, Line = 2443
  The variable "mxtake" is used before its value is set.

         steptl, sx, fscale, itnlim, iretcd, mxtake, msg);
                                             ^

------------------------------------------------------------------------
DIRECTORY: R-1.2.1/src/nmath
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c polygamma.c -o polygamma.o
cc-1167 c89: WARNING File = polygamma.c, Line = 167
  Pointer points outside of underlying object.

  static double *b = (double *)&bvalues -1;
                                        ^

------------------------------------------------------------------------
DIRECTORY: R-1.2.1/src/unix
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c devices.c -o devices.o
cc-1185 c89: WARNING File = devices.c, Line = 111
  An enumerated type is mixed with another type.

                                 colormodel, maxcubesize)) {
                                 ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c edit.c -o edit.o
cc-1185 c89: WARNING File = edit.c, Line = 109
  An enumerated type is mixed with another type.

            t = deparse1(x, 0);
                            ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c system.c -o system.o
cc-1185 c89: WARNING File = system.c, Line = 196
  An enumerated type is mixed with another type.

                UsingReadline = 0;
                              ^

cc-1185 c89: WARNING File = system.c, Line = 211
  An enumerated type is mixed with another type.

      R_Interactive = isatty(0);
                    ^

cc-1185 c89: WARNING File = system.c, Line = 234
  An enumerated type is mixed with another type.

      fpu_setup(1);
                ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c sys-common.c -o sys-common.o
cc-1185 c89: WARNING File = sys-common.c, Line = 173
  An enumerated type is mixed with another type.

      return stat(R_ExpandFileName(path), &sb) == 0;
             ^

cc-1185 c89: WARNING File = sys-common.c, Line = 188
  An enumerated type is mixed with another type.

      if (name && name[0] != '.') return 0;
                                         ^

cc-1185 c89: WARNING File = sys-common.c, Line = 189
  An enumerated type is mixed with another type.

      else return 1;
                  ^

------------------------------------------------------------------------
DIRECTORY: R-1.2.1/src/main
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c RNG.c -o RNG.o
cc-1185 c89: WARNING File = RNG.c, Line = 63
  An enumerated type is mixed with another type.

      { 0, 0, "Wichmann-Hill",          3,      dummy},
        ^

cc-1185 c89: WARNING File = RNG.c, Line = 63
  An enumerated type is mixed with another type.

      { 0, 0, "Wichmann-Hill",          3,      dummy},
           ^

cc-1185 c89: WARNING File = RNG.c, Line = 64
  An enumerated type is mixed with another type.

      { 1, 0, "Marsaglia-MultiCarry",   2,      dummy},
        ^

cc-1185 c89: WARNING File = RNG.c, Line = 64
  An enumerated type is mixed with another type.

      { 1, 0, "Marsaglia-MultiCarry",   2,      dummy},
           ^

cc-1185 c89: WARNING File = RNG.c, Line = 65
  An enumerated type is mixed with another type.

      { 2, 0, "Super-Duper",            2,      dummy},
        ^

cc-1185 c89: WARNING File = RNG.c, Line = 65
  An enumerated type is mixed with another type.

      { 2, 0, "Super-Duper",            2,      dummy},
           ^

cc-1185 c89: WARNING File = RNG.c, Line = 66
  An enumerated type is mixed with another type.

      { 3, 0, "Mersenne-Twister",           1+624,      dummy},
        ^

cc-1185 c89: WARNING File = RNG.c, Line = 66
  An enumerated type is mixed with another type.

      { 3, 0, "Mersenne-Twister",           1+624,      dummy},
           ^

cc-1185 c89: WARNING File = RNG.c, Line = 67
  An enumerated type is mixed with another type.

      { 4, 0, "Knuth-TAOCP",          1+100,    dummy},
        ^

cc-1185 c89: WARNING File = RNG.c, Line = 67
  An enumerated type is mixed with another type.

      { 4, 0, "Knuth-TAOCP",          1+100,    dummy},
           ^

cc-1185 c89: WARNING File = RNG.c, Line = 68
  An enumerated type is mixed with another type.

      { 5, 0, "User-supplied",            0,    dummy},
        ^

cc-1185 c89: WARNING File = RNG.c, Line = 68
  An enumerated type is mixed with another type.

      { 5, 0, "User-supplied",            0,    dummy},
           ^

cc-1185 c89: WARNING File = RNG.c, Line = 264
  An enumerated type is mixed with another type.

        newRNG = tmp % 100;
               ^

cc-1185 c89: WARNING File = RNG.c, Line = 265
  An enumerated type is mixed with another type.

        newN01 = tmp / 100;
               ^

cc-1185 c89: WARNING File = RNG.c, Line = 382
  An enumerated type is mixed with another type.

        RNGkind(asInteger(rng));
                ^

cc-1185 c89: WARNING File = RNG.c, Line = 385
  An enumerated type is mixed with another type.

        Norm_kind(asInteger(norm));
                  ^

cc-1185 c89: WARNING File = RNG.c, Line = 404
  An enumerated type is mixed with another type.

        kind = asInteger(skind);
             ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c arithmetic.c -o arithmetic.o
cc-1185 c89: WARNING File = arithmetic.c, Line = 505
  An enumerated type is mixed with another type.

        x = complex_binary(PRIMVAL(op), x, y);
                           ^

cc-1185 c89: WARNING File = arithmetic.c, Line = 511
  An enumerated type is mixed with another type.

            x = real_binary(PRIMVAL(op), x, y);
                            ^

cc-1185 c89: WARNING File = arithmetic.c, Line = 514
  An enumerated type is mixed with another type.

            x = integer_binary(PRIMVAL(op), x, y);
                               ^

cc-1185 c89: WARNING File = arithmetic.c, Line = 553
  An enumerated type is mixed with another type.

        return integer_unary(PRIMVAL(op), s1);
                             ^

cc-1185 c89: WARNING File = arithmetic.c, Line = 555
  An enumerated type is mixed with another type.

        return real_unary(PRIMVAL(op), s1);
                          ^

cc-1185 c89: WARNING File = arithmetic.c, Line = 557
  An enumerated type is mixed with another type.

        return complex_unary(PRIMVAL(op), s1);
                             ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c array.c -o array.o
cc-1185 c89: WARNING File = array.c, Line = 98
  An enumerated type is mixed with another type.

        copyMatrix(snr, vals, byrow);
                              ^

cc-1185 c89: WARNING File = array.c, Line = 100
  An enumerated type is mixed with another type.

        copyListMatrix(snr, vals, byrow);
                                  ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c bind.c -o bind.o
cc-1185 c89: WARNING File = bind.c, Line = 496
  An enumerated type is mixed with another type.

        if (n != R_NilValue && pmatch(R_RecursiveSymbol, n, 1)) {
                                                            ^

cc-1185 c89: WARNING File = bind.c, Line = 505
  An enumerated type is mixed with another type.

        else if (n != R_NilValue &&  pmatch(R_UseNamesSymbol, n, 1)) {
                                                                 ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c builtin.c -o builtin.o
cc-1185 c89: WARNING File = builtin.c, Line = 573
  An enumerated type is mixed with another type.

            if (TAG(y) != R_NilValue && pmatch(STRING_ELT(x, 0), TAG(y), 1)) {
                                                                         ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c character.c -o character.o
cc-1552 c89: WARNING File = character.c, Line = 368
  The variable "uclass" is set but never used.

      int i, len, minlen, uclass;
                          ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c coerce.c -o coerce.o
cc-1185 c89: WARNING File = coerce.c, Line = 703
  An enumerated type is mixed with another type.

                SET_STRING_ELT(rval, i, STRING_ELT(deparse1(CAR(vp), 0), 0));
                                        ^

cc-1185 c89: WARNING File = coerce.c, Line = 776
  An enumerated type is mixed with another type.

                               STRING_ELT(deparse1(VECTOR_ELT(v, i), 0), 0));
                               ^

cc-1185 c89: WARNING File = coerce.c, Line = 902
  An enumerated type is mixed with another type.

        x = install(CHAR(STRING_ELT(deparse1(x, 1), 0)));
                    ^

------------------------------------------------------------------------
c89 -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -OPT:IEEE_NaN_inf=ON  -g -c connections.c -o connections.o
cc-1185 c89: WARNING File = connections.c, Line = 127
  An enumerated type is mixed with another type.

      con->canwrite = (con->mode[0] == 'w' || con->mode[0] == 'a');
                    ^

cc-1185 c89: WARNING File = connections.c, Line = 128
  An enumerated type is mixed with another type.

      con->canread = !con->canwrite;
                   ^

cc-1185 c89: WARNING File = connections.c, Line = 291
  An enumerated type is mixed with another type.

      con->canwrite = (con->mode[0] == 'w');
                    ^

cc-1185 c89: WARNING File = connections.c, Line = 292
  An enumerated type is mixed with another type.

      con->canread = !con->canwrite;
                   ^

cc-1185 c89: WARNING File = connections.c, Line = 494
  An enumerated type is mixed with another type.

      new->canread = (strcmp(mode, "r") == 0);
                   ^

cc-1185 c89: WARNING File = connections.c, Line = 495
  An enumerated type is mixed with another type.

      new->canwrite = (strcmp(mode, "w") == 0);
                    ^

cc-1185 c89: WARNING File = connections.c, Line = 772
  An enumerated type is mixed with another type.

            con->incomplete = strlen(this->lastline) > 0;
                            ^

cc-1552 c89: WARNING File = connections.c, Line = 855
  The variable "con" is set but never used.

      Rconnection con = NULL;
                  ^

cc-1185 c89: WARNING File = connections.c, Line = 910

==> 851.audit <==
Sat Feb 17 11:44:41 2001	ripley	moved from incoming to System-specific
Sat Feb 17 11:56:52 2001	ripley	changed notes
Sat Feb 17 11:56:52 2001	ripley	foobar
Sun Feb 18 10:13:14 2001	ripley	changed notes
Sun Feb 18 10:13:14 2001	ripley	foobar
Sat Apr  7 18:22:04 2001	hornik	changed notes
Sat Apr  7 18:22:04 2001	hornik	foobar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 848 *
Subject: X11 device doesn't handle destroy events correcly
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 13 Feb 2001 17:40:46 -0500
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 848 <==
From postmaster@franz.stat.wisc.edu  Tue Feb 13 23:40:36 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA10552
	for <r-bugs@biostat.ku.dk>; Tue, 13 Feb 2001 23:40:36 +0100 (MET)
Received: from infiniti.ece.cmu.edu (really [128.2.133.84]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14So7r-000J2mC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Tue, 13 Feb 2001 16:40:47 -0600 (CST) 
Received: (from tov@localhost) by infiniti.ece.cmu.edu (AIX4.3/UCB 8.8.8/8.8.8) id RAA70658; Tue, 13 Feb 2001 17:40:46 -0500
X-Authentication-Warning: infiniti.ece.cmu.edu: tov set sender to tov@ece.cmu.edu using -f
Sender: tov@infiniti.ece.cmu.edu
To: r-bugs@r-project.org
Cc: Thomas Vogels <tov@ece.cmu.edu>
Subject: X11 device doesn't handle destroy events correcly
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas Vogels <tov@ece.cmu.edu>
Date: 13 Feb 2001 17:40:46 -0500
Message-ID: <px3ddi6wb5.fsf@infiniti.ece.cmu.edu>
Lines: 258
User-Agent: Gnus/5.0807 (Gnus v5.8.7) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi, there are two problems in devX11.c.  The one is an undocumented
nuisance and the other isn't a bug until you try to embed an X11
device in another window (think tktoplevel() in tcltk package...).

Let's take a look at locator() first: Assuming you call locator() with
a current X11 device, this call is handled in X11_Locator
(src/unix/X11/devX11.c).  When you have one window open and call
locator, you have three options to quit the locator: click Button 1
(to locate), click Button 2 (to abort), or destroy the window.  The
later results in the error message: "Error in locator(1) : No graphics
device is active". That's OK, sort of.

This gets problematic when you open two windows:
> x11()  # assume that's device 2
> x11()  # assume that's device 3
> plot(1)
> locator(1)  # with device 3 == dev.cur()!

When you now destroy device 3 (where locator expects the click), you have
*no alternative but to close _all_ windows* to abort the locator.  The
locator continues to wait for mouse clicks in device 3 where of course
no further clicks can come from.  That's the nuisance part.

The second problem is that the device may try to plot() into a
non-existant window.  Assume that the window was destroyed by some
other part of the program.  The device (at some point in the future)
will receive a DestroyNotify event that handleEvent ignores.
Blissfully!  *No KillDevice is called* when the window is destroyed by
something other than the WM_DELETE_WINDOW mechanism!  This happens
when you embed the X11 device into another window/application.  For
starters, the device no longer receives WM_DELETE_WINDOW client
messages.  But it does receive a DestroyNotify event when the parent
(the container window) is destroyed.  HandleEvent should, well
_handle_ this _event_.

The patch below is a _suggestion_ how to solve both problems.  It is
against the current r-devel, 1.3, as of 2/13.  I believe this behavior
exists in version 1.2 as well and can be solved there the same way.
The patch is just meant as a convenient and concise way to describe
my suggestion.  I'd greatly appreciate feedback or other ideas!

Implementation:

-- the variable inclose is now in the device specific structure (why
   was it global?)  After the window is mapped, inclose is TRUE until
   the window is destroyed explicitly or a DestroyNotify event has been
   received.
-- the deviceSpecific pointer is set to NULL after the memory has been
   freed. This (side?) effect is used in X11_Locator to detect the
   closing of the current device  which _must_ lead to an error.
-- the if statement to handle events of type DestroyEvent is added to 
   handleEvent
-- when the user closes the device (dev.off()), the window is
   destroyed in X11_Close
-- when the user pushes the close button in the window frame, the
   window is destroyed in handleEvent and X11_Close is initiated
   (the WM_DELETE_WINDOW mechanism already in place.)
-- when the window is destroyed for another reason (e.g. the parent
   being destroyed), it is not destroyed again but X11_Close is still
   initiated.

Regards,
  -tom


--------------------------------------------------
*** devX11.c_orig	Tue Feb 13 15:32:24 2001
--- devX11.c	Tue Feb 13 17:24:04 2001
***************
*** 116,121 ****
--- 116,122 ----
      FILE *fp;				/* file for a bitmap device */
      int quality;			/* JPEG quality */
  
+     Rboolean inclose;                   /* TRUE if window is being closed */
  } x11Desc;
  
  
***************
*** 145,151 ****
  static Atom _XA_WM_PROTOCOLS, protocol;
  
  static Rboolean displayOpen = FALSE;
- static Rboolean inclose = FALSE;
  static int numX11Devices = 0;
  
  	/********************************************************/
--- 146,151 ----
***************
*** 619,632 ****
  	xd->windowHeight = event.xconfigure.height;
  	xd->resize = 1;
      }
      else if ((event.type == ClientMessage) &&
! 	     (event.xclient.message_type == _XA_WM_PROTOCOLS))
! 	if (!inclose && event.xclient.data.l[0] == protocol) {
! 	    XFindContext(display, event.xclient.window,
  			 devPtrContext, &temp);
  	    dd = (DevDesc *) temp;
! 	    KillDevice(dd);
  	}
  }
  
  static void R_ProcessEvents(void *data)
--- 619,652 ----
  	xd->windowHeight = event.xconfigure.height;
  	xd->resize = 1;
      }
+     else if (event.type == DestroyNotify) {
+         /* The window is being destroyed, kill the device, too. */
+         XFindContext(display, event.xdestroywindow.window,
+                      devPtrContext, &temp);
+         dd = (DevDesc *) temp;
+         xd = (x11Desc *) dd->deviceSpecific;
+         if (!xd->inclose) {
+             xd->inclose = TRUE;
+             KillDevice(dd);
+         }
+     }
      else if ((event.type == ClientMessage) &&
! 	     (event.xclient.message_type == _XA_WM_PROTOCOLS)) {
! 	if (event.xclient.data.l[0] == protocol) {
!             XFindContext(display, event.xclient.window,
  			 devPtrContext, &temp);
  	    dd = (DevDesc *) temp;
! 	    xd = (x11Desc *) dd->deviceSpecific;
! 	    if (!xd->inclose) {
! 		/* Dispatch destroy only once */
! 		xd->inclose = TRUE;
! 		XDestroyWindow(display, xd->window);
! 		XSync (display, 0);
! 		KillDevice(dd);
! 	    }
  	}
+     }
+ 
  }
  
  static void R_ProcessEvents(void *data)
***************
*** 1208,1213 ****
--- 1228,1234 ----
  		     ExposureMask | ButtonPressMask | StructureNotifyMask);
  	XMapWindow(display, xd->window);
  	XSync(display, 0);
+         xd->inclose = FALSE;
  
  	/* Gobble expose events */
  
***************
*** 1464,1476 ****
      x11Desc *xd = (x11Desc *) dd->deviceSpecific;
  
      if (xd->type == WINDOW) {
! 	/* process pending events */
! 	/* set block on destroy events */
! 	inclose = TRUE;
  	R_ProcessEvents((void*) NULL);
  
  	XFreeCursor(display, xd->gcursor);
- 	XDestroyWindow(display, xd->window);
  	XSync(display, 0);
      } else {
  	if (xd->npages && xd->type != XIMAGE) {
--- 1485,1506 ----
      x11Desc *xd = (x11Desc *) dd->deviceSpecific;
  
      if (xd->type == WINDOW) {
! 	/* There are three reasons to be here: */
! 	/* 1) The user clicked on a button in the window frame */
! 	/*    and we received a DELETE_WINDOW from the wm, */
! 	/* 2) Somebody destroyed our window directly, or if */
! 	/*    embedded, the parent is being destroyed, and so */
! 	/*    we got a DestroyNotify event, too, */
! 	/* 3) The user used dev.off() to get rid of us. Bye. */
! 
! 	if (!xd->inclose) {
! 	    xd->inclose = TRUE;
! 	    XDestroyWindow(display, xd->window);
! 	}
! 	/* process pending events (esp. reap events for this window) */
  	R_ProcessEvents((void*) NULL);
  
  	XFreeCursor(display, xd->gcursor);
  	XSync(display, 0);
      } else {
  	if (xd->npages && xd->type != XIMAGE) {
***************
*** 1517,1523 ****
      }
  
      free(xd);
!     inclose = FALSE;
  }
  
  	/********************************************************/
--- 1547,1553 ----
      }
  
      free(xd);
!     dd->deviceSpecific = NULL;
  }
  
  	/********************************************************/
***************
*** 1858,1866 ****
  		else
  		    done = 2;
  	    }
! 	}
! 	else
  	    handleEvent(event);
      }
      /* if it was a Button1 succeed, otherwise fail */
      return (done == 1);
--- 1888,1901 ----
  		else
  		    done = 2;
  	    }
! 	} else {
  	    handleEvent(event);
+ 	    if (!dd->deviceSpecific) {
+ 		/* Allow new active window to redraw */
+ 		R_ProcessEvents((void*)NULL);
+ 		error ("Device closed while waiting for input.\n");
+ 	    }
+         }
      }
      /* if it was a Button1 succeed, otherwise fail */
      return (done == 1);
--------------------------------------------------




--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Under development (unstable)
 major = 1
 minor = 3.0
 year = 2001
 month = 02
 day = 12
 language = R

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base


-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204


==> 848.followup.1 <==
From pd@biostat.ku.dk  Wed Feb 14 01:10:35 2001
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA10968;
	Wed, 14 Feb 2001 01:10:34 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA02066;
	Wed, 14 Feb 2001 01:11:56 +0100
Sender: pd@blueberry.kubism.ku.dk
To: tov@ece.cmu.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] X11 device doesn't handle destroy events correcly (PR#848)
References: <200102132240.XAA10562@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@pubhealth.ku.dk>
Date: 14 Feb 2001 01:11:56 +0100
In-Reply-To: tov@ece.cmu.edu's message of "Tue, 13 Feb 2001 23:40:37 +0100 (MET)"
Message-ID: <x2elx2yvg3.fsf@blueberry.kubism.ku.dk>
Lines: 25
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

tov@ece.cmu.edu writes:


> Blissfully!  *No KillDevice is called* when the window is destroyed by
> something other than the WM_DELETE_WINDOW mechanism!  This happens
> when you embed the X11 device into another window/application.  For
> starters, the device no longer receives WM_DELETE_WINDOW client
> messages.  But it does receive a DestroyNotify event when the parent
> (the container window) is destroyed.  HandleEvent should, well
> _handle_ this _event_.

Heh. Quite probably, this is also the source of the FVWM trouble
reported earlier although that triggered an infinite loop which should
probably be guarded against by other means as well. 

Thanks for filing this (good to have as bug report so that we don't
forget - it's the sort of thing that often has to wait until someone
has a clear enough mind and sufficient stamina to try and get it
right.)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 848.audit <==
Sat Feb 17 11:44:41 2001	ripley	moved from incoming to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  TooMuchAtOnce

* PR# 811 *
Subject: problem with strptime example (and mention of bug.report)
From: Stephen Eglen <stephen@anc.ed.ac.uk>
Date: Thu, 11 Jan 2001 19:18:39 GMT
--1) On OSF4, strptime is deficient. Nothing we can do.
--
--2) On Windows NT, the strptime problems are (i) German locale, English dates,
--(ii) Windows system errors with unknown DST (it move times to DST).
--(i) now has another warning in the help file (there already was one).
--(ii) was already worked around for 1.2.1.
--
--3) bug.report() uses a mailer option that does not exist on OSF4.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 811 <==
From postmaster@franz.stat.wisc.edu  Thu Jan 11 22:22:48 2001
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA26396
	for <r-bugs@biostat.ku.dk>; Thu, 11 Jan 2001 22:22:47 +0100 (MET)
Received: from mango.cns.ed.ac.uk (really [129.215.238.26]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m14GnFH-000IXTC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Thu, 11 Jan 2001 13:18:47 -0600 (CST) 
Received: (from stephen@localhost)
	by mango.cns.ed.ac.uk (8.9.1/8.9.1) id TAA06239;
	Thu, 11 Jan 2001 19:18:39 GMT
Date: Thu, 11 Jan 2001 19:18:39 GMT
Message-Id: <200101111918.TAA06239@mango.cns.ed.ac.uk>
From: Stephen Eglen <stephen@anc.ed.ac.uk>
To: r-bugs@r-project.org
Subject: problem with strptime example (and mention of bug.report)

Hi,

The help file for strptime has the following code which doesn't work
for me:

     ## read in date info in format `ddmmmyyyy'
     x <- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")
     z <- strptime(x, "%d%b%Y")
> z
[1] "NA" "NA" "NA" "NA"

Do these work for other people?

whereas it works fine if I use a separator (/) in the date@

> strptime("9/Feb/1960", "%d/%b/%Y")
[1] "1960-02-09"

> strptime("9Feb1960", "%d%b%Y")
[1] "NA"

Stephen

p.s. I failed to send this using bug.report(); on DEC OSF/1, "mailx"
does not recognise the -c switch for setting the carbon copy (CC)
field, causing an error.  One solution might be to remove the -c
argument from the cmdarg in bug.rerport(), or put a 
"~c joe@bloggs.com" directive at the end of the file to set the CC field.

--please do not edit the information below--

Version:
 platform = alphaev56-dec-osf4.0f
 arch = alphaev56
 os = osf4.0f
 system = alphaev56, osf4.0f
 status = 
 major = 1
 minor = 2.0
 year = 2000
 month = 12
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:ctest, Autoloads, package:base


==> 811.followup.1 <==
From ripley@stats.ox.ac.uk  Thu Jan 11 22:54:32 2001
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA27090
	for <R-bugs@biostat.ku.dk>; Thu, 11 Jan 2001 22:54:31 +0100 (MET)
Received: from localhost (ripley@localhost)
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id VAA05133;
	Thu, 11 Jan 2001 21:54:44 GMT
X-Authentication-Warning: toucan.stats: ripley owned process doing -bs
Date: Thu, 11 Jan 2001 21:54:43 +0000 (GMT)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
X-X-Sender:  <ripley@toucan.stats>
To: <stephen@anc.ed.ac.uk>
cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] problem with strptime example (PR#811)
In-Reply-To: <200101112122.WAA26408@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.31.0101112146290.5126-100000@toucan.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 11 Jan 2001 stephen@anc.ed.ac.uk wrote:

> Hi,
>
> The help file for strptime has the following code which doesn't work
> for me:
>
>      ## read in date info in format `ddmmmyyyy'
>      x <- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")
>      z <- strptime(x, "%d%b%Y")
> > z
> [1] "NA" "NA" "NA" "NA"
>
> Do these work for other people?

Yes, on several platforms.  It will be a problem with your OS's strptime
code.  It must be, I think, as the alternative we supply works.

> whereas it works fine if I use a separator (/) in the date@
>
> > strptime("9/Feb/1960", "%d/%b/%Y")
> [1] "1960-02-09"
>
> > strptime("9Feb1960", "%d%b%Y")
> [1] "NA"

We really do not put out new features without testing them!


>
> Stephen
>
> p.s. I failed to send this using bug.report(); on DEC OSF/1, "mailx"
> does not recognise the -c switch for setting the carbon copy (CC)
> field, causing an error.  One solution might be to remove the -c
> argument from the cmdarg in bug.rerport(), or put a
> "~c joe@bloggs.com" directive at the end of the file to set the CC field.
>
> --please do not edit the information below--
>
> Version:
>  platform = alphaev56-dec-osf4.0f
>  arch = alphaev56
>  os = osf4.0f
>  system = alphaev56, osf4.0f
>  status =
>  major = 1
>  minor = 2.0
>  year = 2000
>  month = 12
>  day = 15
>  language = R
>
> Search Path:
>  .GlobalEnv, package:ctest, Autoloads, package:base
>
>
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
>

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 811.followup.2 <==
From ligges@statistik.uni-dortmund.de  Fri Jan 12 11:15:33 2001
Received: from nx5.HRZ.Uni-Dortmund.DE (nx5.HRZ.Uni-Dortmund.DE [129.217.131.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA02850
	for <R-bugs@biostat.ku.dk>; Fri, 12 Jan 2001 11:15:32 +0100 (MET)
Received: from amadeus.statistik.uni-dortmund.de by nx5.HRZ.Uni-Dortmund.DE
          via smtp-local with ESMTP; Fri, 12 Jan 2001 11:15:34 +0100
Received: from statistik.uni-dortmund.de (hiwi4 [129.217.207.94])
	by amadeus.statistik.uni-dortmund.de (8.9.3+Sun/8.9.3) with ESMTP id LAA13591;
	Fri, 12 Jan 2001 11:15:33 +0100 (MET)
Message-ID: <3A5ED97F.6E808F03@statistik.uni-dortmund.de>
Date: Fri, 12 Jan 2001 11:16:31 +0100
From: Uwe Ligges <ligges@statistik.uni-dortmund.de>
X-Mailer: Mozilla 4.76 [en] (WinNT; U)
X-Accept-Language: en
MIME-Version: 1.0
To: ripley@stats.ox.ac.uk
CC: R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with strptime example (PR#811)
References: <200101112154.WAA27100@pubhealth.ku.dk>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


ripley@stats.ox.ac.uk wrote:
> 
> On Thu, 11 Jan 2001 stephen@anc.ed.ac.uk wrote:
> 
> > Hi,
> >
> > The help file for strptime has the following code which doesn't work
> > for me:
> >
> >      ## read in date info in format `ddmmmyyyy'
> >      x <- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")
> >      z <- strptime(x, "%d%b%Y")
> > > z
> > [1] "NA" "NA" "NA" "NA"
> >
> > Do these work for other people?
> 
> Yes, on several platforms.  It will be a problem with your OS's strptime
> code.  It must be, I think, as the alternative we supply works.
> 
> > whereas it works fine if I use a separator (/) in the date@
> >
> > > strptime("9/Feb/1960", "%d/%b/%Y")
> > [1] "1960-02-09"
> >
> > > strptime("9Feb1960", "%d%b%Y")
> > [1] "NA"
> 
> We really do not put out new features without testing them!


Also very strange on WinNT4.0 (R-1.2.0): 


  x <- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")
  z <- strptime(x, "%d%b%Y")
  z
[1] "1960-01-01 01:00:00" "1960-01-02 01:00:00" "NA"                 
"1960-07-30 01:00:00"


Uwe Ligges

==> 811.followup.3 <==
From ripley@stats.ox.ac.uk  Fri Jan 12 11:56:09 2001
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA03586
	for <R-bugs@biostat.ku.dk>; Fri, 12 Jan 2001 11:56:09 +0100 (MET)
Received: from localhost (ripley@localhost)
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id KAA06620;
	Fri, 12 Jan 2001 10:52:36 GMT
X-Authentication-Warning: toucan.stats: ripley owned process doing -bs
Date: Fri, 12 Jan 2001 10:52:36 +0000 (GMT)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
X-X-Sender:  <ripley@toucan.stats>
To: Uwe Ligges <ligges@statistik.uni-dortmund.de>
cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] problem with strptime example (PR#811)
In-Reply-To: <3A5ED97F.6E808F03@statistik.uni-dortmund.de>
Message-ID: <Pine.GSO.4.31.0101121048420.6610-100000@toucan.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 12 Jan 2001, Uwe Ligges wrote:

>
> ripley@stats.ox.ac.uk wrote:
> >
> > On Thu, 11 Jan 2001 stephen@anc.ed.ac.uk wrote:
> >
> > > Hi,
> > >
> > > The help file for strptime has the following code which doesn't work
> > > for me:
> > >
> > >      ## read in date info in format `ddmmmyyyy'
> > >      x <- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")
> > >      z <- strptime(x, "%d%b%Y")
> > > > z
> > > [1] "NA" "NA" "NA" "NA"
> > >
> > > Do these work for other people?
> >
> > Yes, on several platforms.  It will be a problem with your OS's strptime
> > code.  It must be, I think, as the alternative we supply works.
> >
> > > whereas it works fine if I use a separator (/) in the date@
> > >
> > > > strptime("9/Feb/1960", "%d/%b/%Y")
> > > [1] "1960-02-09"
> > >
> > > > strptime("9Feb1960", "%d%b%Y")
> > > [1] "NA"
> >
> > We really do not put out new features without testing them!
>
>
> Also very strange on WinNT4.0 (R-1.2.0):
>
>
>   x <- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")
>   z <- strptime(x, "%d%b%Y")
>   z
> [1] "1960-01-01 01:00:00" "1960-01-02 01:00:00" "NA"
> "1960-07-30 01:00:00"

I don't get the NA. The 1am is a Windows bug: this only happens in
times prior to 1970, which for Windows do not exist.  It seems to assume
that if isdst is non-zero, it is DST, rather than for isdst > 0.
I have a workaround, so for 1.2.1 (on my machines) this will behave as
expected.

The date-time functions do depend on OS functions being correct, and
although I have done a lot of workarounds, no doubt more errors will
emerge.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 811.audit <==
Sat Jan 13 18:50:59 2001	ripley	changed notes
Sat Jan 13 18:50:59 2001	ripley	foobar
Sat Jan 13 18:50:59 2001	ripley	moved from incoming to TooMuchAtOnce
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Windows

none

Directory:  incoming

* PR# 899 *
Subject: documentation problems in str.Rd
From: Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at>
Date: Sat, 7 Apr 2001 23:08:23 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 899 <==
From postmaster@franz.stat.wisc.edu  Sat Apr  7 23:56:52 2001
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA01835
	for <r-bugs@biostat.ku.dk>; Sat, 7 Apr 2001 23:56:51 +0200 (MET DST)
Received: from mr.tuwien.ac.at (really [128.130.2.10]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m14m0hY-000JGHC@franz.stat.wisc.edu> (Debian Smail3.2.0.111)
	for <r-bugs@r-project.org>; Sat, 7 Apr 2001 16:57:00 -0500 (CDT) 
Received: from mithrandir.hornik.net (a119.dialin.tuwien.ac.at [192.35.240.9])
	by mr.tuwien.ac.at (8.11.1/8.11.1) with ESMTP id f37Lukf23525
	for <r-bugs@r-project.org>; Sat, 7 Apr 2001 23:56:52 +0200 (MET DST)
Received: from hornik by mithrandir.hornik.net with local (Exim 3.12 #1 (Debian))
	id 14lzwV-0007VQ-00
	for <r-bugs@r-project.org>; Sat, 07 Apr 2001 23:08:23 +0200
From: Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <15055.33223.701136.778150@mithrandir.hornik.net>
Date: Sat, 7 Apr 2001 23:08:23 +0200
To: r-bugs@r-project.org
Subject: documentation problems in str.Rd
X-Mailer: VM 6.92 under Emacs 20.7.2
Reply-To: Kurt.Hornik@ci.tuwien.ac.at
Sender: Kurt Hornik <hornik@ci.tuwien.ac.at>

File `src/library/base/man/str.Rd' shows the usage

  ls.str(name, pattern, mode = "any", max.level = 1, give.attr = FALSE)

whereas the code for ls.str() really has

  function (..., mode = "any", max.level = 1, give.attr = FALSE)

where the `...' is passed to ls().

The usage indicates `pattern' as a positional argument, which it is not.
Hence, e.g.
  ls.str("package:base", "^a")
will not work as documented.

I think one needs to document the `...' structure and say that the ...
args are passed on to ls().

Also, currently arguments `name', `pattern' and `mode' to ls.str() and
argument `...' to lsf.str() and the str* functions are not documented.

--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Patched
 major = 1
 minor = 2.2
 year = 2001
 month = 04
 day = 07
 language = R

Search Path:
 .GlobalEnv, package:kh, Autoloads, package:base
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 898 *
Subject: silent extern error
From: bellis@hsph.harvard.edu
Date: Sat, 7 Apr 2001 23:32:50 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 898 <==
From bellis@hsph.harvard.edu  Sat Apr  7 23:32:51 2001
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA01716
	for <R-bugs@biostat.ku.dk>; Sat, 7 Apr 2001 23:32:50 +0200 (MET DST)
Date: Sat, 7 Apr 2001 23:32:50 +0200 (MET DST)
From: bellis@hsph.harvard.edu
Message-Id: <200104072132.XAA01716@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: silent extern error

Full_Name: Byron Ellis
Version: 1.2.2
OS: all
Submission from: (NULL) (140.247.105.95)


R_ext/Arith.h

#ifdef MAIN
#define extern
#endif
#ifdef __cplusplus
extern "C" {
#endif

these two should be reversed. Its never a problem because builds aren't done
against C++ compilers, but its still an error (just a low priority one).

also, you could change that to

#ifdef __cplusplus
extern "C" {
#endif
#ifdef __MAIN__
#define extern
#elif _MSC_VER
#define extern __dllspec(dllimport)
#endif

with the corresponding change to the #undef region. This would allow people to
develop for R using MSVC++ more easily.

==> 898.followup.1 <==
From ripley@stats.ox.ac.uk  Sun Apr  8 07:54:05 2001
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id HAA02383
	for <R-bugs@biostat.ku.dk>; Sun, 8 Apr 2001 07:54:04 +0200 (MET DST)
Received: from max106.public.ox.ac.uk (max106.public.ox.ac.uk [192.76.27.106])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id GAA20449;
	Sun, 8 Apr 2001 06:54:11 +0100 (BST)
Date: Sun, 8 Apr 2001 06:55:59 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: <ripley@auk.stats>
To: <bellis@hsph.harvard.edu>
cc: <R-bugs@biostat.ku.dk>
Subject: Re: [Rd] silent extern error (PR#898)
Message-ID: <Pine.GSO.4.31.0104080654210.17317-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Sat, 7 Apr 2001 bellis@hsph.harvard.edu wrote:

> Full_Name: Byron Ellis
> Version: 1.2.2
> OS: all
> Submission from: (NULL) (140.247.105.95)
>
>
> R_ext/Arith.h
>
> #ifdef MAIN
> #define extern
> #endif
> #ifdef __cplusplus
> extern "C" {
> #endif
>
> these two should be reversed. Its never a problem because builds aren't done
> against C++ compilers, but its still an error (just a low priority one).

Sorry, but as __MAIN__ (not MAIN) is only defined in one C module internal
to R, why is it an error?  It would be an error if there ever was an
intention that module was to be in C++, but there is not.  The #ifdef
__cplusplus constructs are only there to allow the header files to be used
in C++ addons, and defining __MAIN__ is *not* part of the API.

In short, those two #ifdef's are mutually exclusive, so their order is
immaterial.  How can one order be an error?


> also, you could change that to
>
> #ifdef __cplusplus
> extern "C" {
> #endif
> #ifdef __MAIN__
> #define extern
> #elif _MSC_VER
> #define extern __dllspec(dllimport)
> #endif
>
> with the corresponding change to the #undef region. This would allow people to
> develop for R using MSVC++ more easily.

However, *that* would be an error.  _MSC_VER may well be defined during the
actual compilation of R, and __MAIN__ is only defined in the compilation of
main.c.  So compilation would fail under VC++ (and other compilers which
define _MSC_VER).

(It is also possible for _MSC_VER to be defined but not have a value, so is
the test what you really meant?)

If we intended to make compilation for other C compilers easier we would
need to add lines like that to lots of the header files, and for more than
one compiler system.  However, we don't particularly want to make the use
of Arith.h under VC++ easier, as VC++ does not handle IEEE arithmetic
correctly!   In short, using Arith.h in addons compiled with VC++ is
likely to give incorrect results.

(We know from past experience that R can be compiled with VC++ (6.0sp3, to
be precise) but then fails make check, giving incorrect results in the
arithmetic tests and elsewhere.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 898.followup.2 <==
From bellis@hsph.harvard.edu  Sun Apr  8 08:48:20 2001
Received: from hsph.harvard.edu (hsph.harvard.edu [128.103.75.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA02482
	for <R-bugs@biostat.ku.dk>; Sun, 8 Apr 2001 08:48:19 +0200 (MET DST)
Received: from localhost (bellis@localhost)
	by hsph.harvard.edu (8.9.3+Sun/8.9.1) with ESMTP id CAA21638;
	Sun, 8 Apr 2001 02:47:39 -0400 (EDT)
Date: Sun, 8 Apr 2001 02:47:39 -0400 (EDT)
From: Byron Ellis <bellis@hsph.harvard.edu>
To: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] silent extern error (PR#898)
In-Reply-To: <Pine.GSO.4.31.0104080654210.17317-100000@auk.stats>
Message-ID: <Pine.GSO.4.10.10104080156400.17186-100000@hsph.harvard.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Sun, 8 Apr 2001, Prof Brian D Ripley wrote:

> On Sat, 7 Apr 2001 bellis@hsph.harvard.edu wrote:
> 
> > Full_Name: Byron Ellis
> > Version: 1.2.2
> > OS: all
> > Submission from: (NULL) (140.247.105.95)
> >
> >
> > R_ext/Arith.h
> >
> > #ifdef MAIN
> > #define extern
> > #endif
> > #ifdef __cplusplus
> > extern "C" {
> > #endif
> >
> > these two should be reversed. Its never a problem because builds aren't done
> > against C++ compilers, but its still an error (just a low priority one).
> 
> Sorry, but as __MAIN__ (not MAIN) is only defined in one C module internal
> to R, why is it an error?  It would be an error if there ever was an
> intention that module was to be in C++, but there is not.  The #ifdef
> __cplusplus constructs are only there to allow the header files to be used
> in C++ addons, and defining __MAIN__ is *not* part of the API.
> 
> In short, those two #ifdef's are mutually exclusive, so their order is
> immaterial.  How can one order be an error?

Okay, then it was a simple misunderstanding on my part in the event that
you will never attempt to compile R under a compiler in C++ mode and you
don't have to worry about it any more.


> 
> 
> > also, you could change that to
> >
> > #ifdef __cplusplus
> > extern "C" {
> > #endif
> > #ifdef __MAIN__
> > #define extern
> > #elif _MSC_VER
> > #define extern __dllspec(dllimport)
> > #endif
> >
> > with the corresponding change to the #undef region. This would allow people to
> > develop for R using MSVC++ more easily.
> 
> However, *that* would be an error.  _MSC_VER may well be defined during the
> actual compilation of R, and __MAIN__ is only defined in the compilation of
> main.c.  So compilation would fail under VC++ (and other compilers which
> define _MSC_VER).
> 
> (It is also possible for _MSC_VER to be defined but not have a value, so is
> the test what you really meant?)

I personally can't think of a VC++ compiler I've used where _MSC_VER is
defined but __declspec(dllimport) is unavailable, except maybe VC++ 1.5
where its been such a long time I can't recall. (Of course, VC++ 1.5
doesn't even RUN under Win2K let alone compile anything :-)) If suppose
you could change it to something like #if _MSC_VER >= 1100 if there is
such a compiler and that would work as well.


> 
> If we intended to make compilation for other C compilers easier we would
> need to add lines like that to lots of the header files, and for more than
> one compiler system.  However, we don't particularly want to make the use
> of Arith.h under VC++ easier, as VC++ does not handle IEEE arithmetic
> correctly!   In short, using Arith.h in addons compiled with VC++ is
> likely to give incorrect results.

Welp, just the two (and putting it above the __cplusplus def) in
R_ext/Arith.h and Rinternals.h. If you also toss a __cplusplus statement
after the #include's in Rinternals.h it also works in C++ mode (which is
missing things like that nasty sizeof() bug). 

> 
> (We know from past experience that R can be compiled with VC++ (6.0sp3, to
> be precise) but then fails make check, giving incorrect results in the
> arithmetic tests and elsewhere.)

Yes, fortunately I'm not using the IEEE arith code--- I'm actually writing
non-numerical support libraries and GUI embedding code. I mostly just like
to do my development using VC++ (probably because I'm getting lazy, but
whatever). Out of curiosity has this been tested with SP4 or 7beta?

> 
> -- 
> Brian D. Ripley,                  ripley@stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272860 (secr)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> 


Byron Ellis (bellis@hsph.harvard.edu)



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 877 *
Subject: segmentation fault of unknown cause
From: Martin Schlather <Martin.Schlather@uni-bayreuth.de>
Date: Wed, 14 Mar 2001 17:45:25 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 877 <==
From Martin.Schlather@uni-bayreuth.de  Wed Mar 14 16:41:22 2001
Received: from btr0x1.rz.uni-bayreuth.de (root@btr0x1.rz.uni-bayreuth.de [132.180.8.29])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA05221
	for <r-bugs@biostat.ku.dk>; Wed, 14 Mar 2001 16:41:22 +0100 (MET)
Received: from uni-bayreuth.de (martin@btgyxa.geo.uni-bayreuth.de [132.180.72.37])
	by btr0x1.rz.uni-bayreuth.de (8.8.8/8.8.8) with ESMTP id QAA05084;
	Wed, 14 Mar 2001 16:41:28 +0100 (MET)
Sender: Bernd.Martin@uni-bayreuth.de
Message-ID: <3AAFA025.3AAAD6@uni-bayreuth.de>
Date: Wed, 14 Mar 2001 17:45:25 +0100
From: Martin Schlather <Martin.Schlather@uni-bayreuth.de>
Reply-To: Martin.Schlather@uni-bayreuth.de
Organization: Univ. Bayreuth
X-Mailer: Mozilla 4.7 [en] (X11; I; Linux 2.2.13 i686)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@biostat.ku.dk
CC: Paulo Ribeiro <p.ribeiro@lancaster.ac.uk>
Subject: segmentation fault of unknown cause
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Dear all,

Paulo Ribeiro, p.ribeiro@lancaster.ac.uk, and myself noticed 
that R sometimes breaks down with a segmentation fault of
(at least for us) unknown course. (We've read #411 and #671 
in the bug report on "optim" -- the problem described
there sounds familiar; but we have not found any hint on a 
segmentation fault.)

Please find at the very end of this email the file 
strange.R and on 
  http://www.geo.uni-bayreuth.de/~martin/R/strange.tgz
an archiv of three files, namely strange.R, cov.data, 
and rf.data. 

The file strange.R uses only mva as library; it does
not contain any Fortran or C call.

On three machines in Lancaster and on my three
computers (2x R-1.2.2, 1x R-1.2.1) we get 
`segmentation fault' for
  /usr/bin/R --vanilla < strange.R

Furthermore, I get a segmentation fault for
  /usr/bin/R
  source("strange.R")
but not Paulo at Lancaster, neither Martin Maechler on
his preversion R-1.3.0 (I had asked Martin before Paulo
found out that `usr/bin/R --vanilla < strange.R' breaks
on his (and mine) computers.)

We would be happy for any comment on whether the
segmentation fault appears anywhere else (and why). 
We noticed that R does not fail if /usr/bin/R is called 
with other or further options but `--vanilla' (Not 
extensively tested yet.)

Cheers,
Martin


PS: For example, a computer in Lancaster (all RedHat) and 
    one here (all SuSe) are both installed by compiling the
    source code of R-1.2.2 and have the specification
         _                
platform i686-pc-linux-gnu
arch     i686             
os       linux-gnu        
system   i686, linux-gnu  
status                    
major    1                
minor    2.2              
year     2001             
month    02               
day      26               
language R   
             
PPS: If the file strange.R works well then it stops with an 
     error message different from "segmentation fault".

-- 
Martin Schlather                 email: Martin.Schlather@uni-bayreuth.de
Abteilung Bodenphysik            phone: +49 (0)921 55 2193          
Univ. Bayreuth                   Fax  : +49 (0)921 55 2246
D -- 95440 Bayreuth, Germany     http://www.geo.uni-bayreuth.de/~martin/

#### the comments in the file strange.R give a report on what happens
#### additionally on all *my* computers -- not tested elsewhere yet


######################################################
############         strange.R         ###############
######################################################

# calling R (v1.2.1 or v1.2.2) without options and
# then `source("strange.R")' causes a segmentation fault

# Note that before failure MLEtarget is called with
# variab=c(1.0501141215486309848e-267, 1.0000000000000000208e-03)
# a value that is outside the given bounds, see lb and optim below
# (This is something that appears quite frequently, independently (?)
# of the segmentation fault I'm interested here!)

# The segmentation fault does not appear if R is called by
#       /usr/bin/R --vsize 20M --nsize 250K --no-save
# (The algorithm will fail with "fn(par, ...) : subscript out of bounds"
#  then, what is OK since the matrix `cm' does not have enough 
#  components)

library(mva)

"mleRF" <-
function (data, coord) 
{
    ENVIR <- environment()
    lc <- nrow(coord)

    ## if you comment out either line, the algorithm
    ## returns the correct error message
    ## "fn(par, ...) : subscript out of bounds"
    distances <- as.double(dist(coord))
    distances <- dist(coord)

    ## lower und upper bounds for optim
    lb <- c(0.00235992765321886, 0.2)
    ub <- c(39.6649897977748, 10)
    
    assign("COUNTER", 1, envir = ENVIR)
    CoVariate <- matrix(1, ncol = 1, nrow = lc)
    MLEtarget <- function(variab) {
        print(variab, dig = 20)
        
        ## the covariance matrix is calculated by an own C programme;
        ## therefore the results have been stored in `cm' to exclude
        ## my programme as course of the trouble
        cov.matrix <- cm[, COUNTER]
        cov.matrix <- try(chol(matrix(cov.matrix, ncol = lc)))
        ## if you replace the above two lines by
        ##    cov.matrix <- matrix(cm[, COUNTER], ncol = lc)
        ##    cov.matrix <- try(chol(cov.matrix))
        ## segmentation fault vanishes, and `optim' returns
        ## "Error in optim(...:  bad value"
        
        assign("COUNTER", COUNTER + 1, envir = ENVIR)
        if (is.numeric(cov.matrix)) {
            if (any(diag(cov.matrix) < 0)) {
                stop("chol det<0!")
            }
        }
        else {
            return(1e+30)
        }
        logdet <- 2 * sum(log(diag(cov.matrix)))
        cov.matrix <- chol2inv(cov.matrix)
        dummy <- t(CoVariate) %*% cov.matrix
        m <- (solve(dummy %*% CoVariate) %*% (dummy %*% data))
        V <- data - CoVariate %*% m
        quadratic <- (t(V) %*% cov.matrix %*% V)
        res <- logdet + lc * log(quadratic)
        print(as.vector(res), dig = 20)
        return(res)
    }
    ## if you outcomment the following `for'-loop
    ## the segmenatation fault vanishes, and optim returns
    ## "Error in optim(...:  bad value"
    for (W in 1:3) {
        mlet <- MLEtarget(c(1,1))
    }
    ## if the `for'-loop is active, the following line
    ## is not necessary as COUNTER has already the value 4
    assign("COUNTER", 4, envir = ENVIR)    
    variab <- c(0.00235992765321890, 2.66384186745229)
    ## if you outcomment the following line, the algorithm
    ## returns the correct error message "fn ... out of bounds"
    distances <- as.double(distances) 
    variab <- try(optim(variab, MLEtarget, method = "L-BFGS-B", 
        lower = lb, upper = ub)$par)
    print("END")
}



## the random field given on a grid by x,y and f is
## calculated by an own C-programme. Therefore the results
## have been stored to exclude my programme as course of
## the trouble
#save(file="rf.data",x,y,f,.Random.seed)
load("rf.data")
  
## see `MLEtarget' for comments on `cm'
#save(file="cov.data",cm)
load("cov.data");

mleRF(coord=cbind(x,y),data=f)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
