=================================================
This is an automated collection of open reports in
the R-bugs repository.
=================================================

Directory:  Accuracy

none

Directory:  Add-ons

* PR# 503 *
Subject: dmvnorm() bug in e1071
From: "Gregory R. Warnes" <warnes@biostat.washington.edu>
Date: Fri, 24 Mar 2000 03:24:45 +0000 (GMT)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 503 <==
From warnes@warnes.net  Fri Mar 24 20:26:17 2000
Received: from hydra.warnes.net (mail@c877378-a.sttln1.wa.home.com [24.9.60.166])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA06279
	for <r-bugs@biostat.ku.dk>; Fri, 24 Mar 2000 20:25:43 +0100 (MET)
Received: from warnes (helo=localhost)
	by hydra.warnes.net with local-esmtp (Exim 3.12 #1 (Debian))
	id 12YKiM-0003AT-00
	for <r-bugs@biostat.ku.dk>; Thu, 23 Mar 2000 19:24:46 -0800
Date: Fri, 24 Mar 2000 03:24:45 +0000 (GMT)
From: "Gregory R. Warnes" <warnes@biostat.washington.edu>
X-Sender: warnes@hydra.warnes.net
To: r-bugs@biostat.ku.dk
Subject: dmvnorm() bug in e1071
Message-ID: <Pine.LNX.4.21.0003240321480.575-100000@hydra.warnes.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Sender: "Gregory R. Warnes" <warnes@warnes.net>


When dmvnorm is applied to matrices it fails.  The offending lines are

  if (length(x) != ncol(sigma)) {
    stop("x and sigma have non-conforming size")
  }

which works fine if x is a dataframe, but not if x is a matrix.

Replacing this test with

  if (ncol(x) != ncol(sigma)) {
    stop("x and sigma have non-conforming size")
  }

Corrects the problem, and still works for data frames and
vectors.  (Vectors have already been converted to matrices).

-Gregory


==> 503.audit <==
Sat Mar 25 09:48:26 2000	maechler	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 496 *
From: bonneau@epi.roazhon.inra.fr (en148)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
--base R has no est.variogram function.
--This appears to be a bug report on sgeostat.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 496 <==
From bonneau@epi.roazhon.inra.fr  Tue Mar 21 11:40:23 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA24613
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 11:40:21 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA00472
	for <r-bugs@hypatia.math.ethz.ch>; Tue, 21 Mar 2000 11:40:33 +0100 (MET)
Received: from epi.roazhon.inra.fr(194.167.76.1)
 via SMTP by hypatia, id smtpdAAAa0007L; Tue Mar 21 11:40:28 2000
Received: from (bonneau@localhost)
          by epi.roazhon.inra.fr (8.8.8/jtpda-5.3) id KAA09010
          for r-bugs@lists.r-project.org; Tue, 21 Mar 2000 10:57:13 +0100 (MET)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
From: bonneau@epi.roazhon.inra.fr (en148)
Message-Id: <200003210957.KAA09010@epi.roazhon.inra.fr>

I am using R 0.65.1 under linux (Redhat 6.0),
and I have a problem with the est.variogram function when the first lag is empty (I am trying to estimate anisotropic varios)

fittedpnt<-point(fitted, x="X2", y="X3")
fittedpair<-pair(fittedpnt, num.lags=15, type="anisotropic", theta=60, dtheta=20, maxdist=maxfittedist)
fittedvario<-est.variogram(fittedpnt, fittedpair, "fit")

With my datas I have no pair in lags 1 to 3 and the error message is :
Error in psort(x, partial) : index 0 outside bounds

What can I do, in order to fix the bug ?

==> 496.audit <==
Sat Apr 01 07:32:27 2000	ripley	changed notes
Sat Apr 01 07:32:27 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 488 *
Subject: Error in lme?
From: simon.frost@ed.ac.uk
Date: Tue, 14 Mar 2000 14:15:52 +0100 (MET)
--No example to reproduce this.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 488 <==
From simon.frost@ed.ac.uk  Tue Mar 14 14:15:53 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA21597
	for <R-bugs@biostat.ku.dk>; Tue, 14 Mar 2000 14:15:52 +0100 (MET)
Date: Tue, 14 Mar 2000 14:15:52 +0100 (MET)
From: simon.frost@ed.ac.uk
Message-Id: <200003141315.OAA21597@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Error in lme?

Full_Name: Simon Frost
Version: 1.0.0
OS: Windows
Submission from: (NULL) (129.215.60.79)


Hi everyone,

I've just installed R for Windows - I've previously been using it on Linux -
and I've run into a problem when using lme.

The lme routine throws up an error in the getGroups.data.frame command,
complaining about an error in the formula:

Error in getGroups.data.frame(dataMix, groups) : 
        Invalid formula for groups

getGroups works just fine, and I haven't run into this problem previously.

Any ideas?

Best wishes
Simon

==> 488.reply.1 <==
From bates@franz.stat.wisc.edu  Tue Mar 14 14:41:32 2000
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA22170
	for <R-bugs@biostat.ku.dk>; Tue, 14 Mar 2000 14:41:31 +0100 (MET)
Received: by franz.stat.wisc.edu
	via sendmail from stdin
	id <m12Urd2-000ZTZC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for R-bugs@biostat.ku.dk; Tue, 14 Mar 2000 07:44:56 -0600 (CST) 
Sender: bates@franz.stat.wisc.edu
To: simon.frost@ed.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Error in lme? (PR#488)
References: <200003141315.OAA21607@pubhealth.ku.dk>
From: Douglas Bates <bates@stat.wisc.edu>
Date: 14 Mar 2000 07:44:56 -0600
In-Reply-To: simon.frost@ed.ac.uk's message of "Tue, 14 Mar 2000 14:15:54 +0100 (MET)"
Message-ID: <6rg0ttll7r.fsf@franz.stat.wisc.edu>
Lines: 15
X-Mailer: Gnus v5.7/Emacs 20.5

simon.frost@ed.ac.uk writes:

> I've just installed R for Windows - I've previously been using it on Linux -
> and I've run into a problem when using lme.
> 
> The lme routine throws up an error in the getGroups.data.frame command,
> complaining about an error in the formula:
> 
> Error in getGroups.data.frame(dataMix, groups) : 
>         Invalid formula for groups
> 
> getGroups works just fine, and I haven't run into this problem previously.

Could you send us an example call that generates this error
(preferably using one of the data sets that comes with R)?

==> 488.audit <==
Sat Apr 01 07:44:08 2000	ripley	changed notes
Sat Apr 08 07:31:32 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 471 *
Subject:  Problems with nlme 
From: Berwin Turlach <berwin@maths.uwa.edu.au>
Date: Tue, 7 Mar 2000 15:28:00 +0800
--Problem 1) was a subscripting bug introduced in 1.0.0 and fixed for 1.0.1
--Problem 2) (mssing datasets) needs a revised nlme
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 471 <==
From berwin@bossiaea.maths.uwa.edu.au  Tue Mar  7 08:27:58 2000
Received: from bossiaea.maths.uwa.edu.au (IDENT:root@bossiaea.maths.uwa.edu.au [130.95.16.247])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA11434
	for <r-bugs@biostat.ku.dk>; Tue, 7 Mar 2000 08:27:54 +0100 (MET)
Received: (from berwin@localhost)
	by bossiaea.maths.uwa.edu.au (8.9.3/8.9.3) id PAA26674;
	Tue, 7 Mar 2000 15:28:00 +0800
Date: Tue, 7 Mar 2000 15:28:00 +0800
From: Berwin Turlach <berwin@maths.uwa.edu.au>
Message-Id: <200003070728.PAA26674@bossiaea.maths.uwa.edu.au>
To: r-bugs@biostat.ku.dk
Subject:  Problems with nlme 
Cc: berwin@bossiaea.maths.uwa.edu.au

Dear R developers,

first of all let me join the chorus of congratulations for the release
of R 1.0.0.  Well, done!

Unfortunately, I find it necessary to e-mail in a bug report regarding
the `nlme' package.  On my office machine I experience the following
trouble:

bossiaea:/opt/R$ R CMD check -c nlme 
Checking package `nlme' ...
 Massaging examples into `nlme-Ex.R' ...
 Running examples in package `nlme' ...
 ERROR

The end of nlme-Ex.Rout is:

> rm(list = ls(all = TRUE)); .Random.seed <- c(0,rep(7654,3))
> ###--- >>> `anova.gls' <<<----- Compare Likelihoods of Fitted Objects
> 
> 	## alias	 help(anova.gls)
> 
> ##___ Examples ___:
> 
> library(nlme)
> data(Ovary)
> # AR(1) errors within each Mare
> fm1 <- gls(follicles ~ sin(2*pi*Time) + cos(2*pi*Time), Ovary,
+            correlation = corAR1(form = ~ 1 | Mare))
Warning message: 
NA/Inf replaced by maximum positive value 
> anova(fm1)
Denom. DF: 305 
                   numDF  F-value p-value
(Intercept)            1 354.7375  <.0001
sin(2 * pi * Time)     1  18.5035  <.0001
cos(2 * pi * Time)     1   1.6633  0.1981
> # variance changes with a power of the absolute fitted values?
> fm2 <- update(fm1, weights = varPower())
Error in update.gls(fm1, weights = varPower()) : 
	subscript out of bounds
Execution halted


(R CMD check MASS is also failing on an example that uses update.gls.)

On my machine at home I run into troubles even faster when running `R
CMD check nlme'.  One of the early examples chokes on the line:
> data(Orthodont)

I had done a "clean install" on that machine, i.e., I first blew away
the older installation of R.  It seems that the datasets Orthodont and
Pixel have been distributed with the nls library in earlier R versions
but not so in R 1.0.0.  But they are not distributed with the current
version of nlme either.

Cheers,

        Berwin

--please do not edit the information below--

Version:
 platform = i686-unknown-linux
 arch = i686
 os = linux
 system = i686, linux
 status = 
 major = 1
 minor = 0.0
 year = 2000
 month = February
 day = 29
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 471.audit <==
Sun Mar 12 13:56:34 2000	ripley	changed notes
Sun Mar 12 13:56:34 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Analyses

none

Directory:  Documentation

* PR# 497 *
Subject: par help wrong: xlog & ylog
From: wsi@gcal.ac.uk
Date: Tue, 21 Mar 2000 14:57:57 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 497 <==
From wsi@gcal.ac.uk  Tue Mar 21 14:57:58 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA29215
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 14:57:57 +0100 (MET)
Date: Tue, 21 Mar 2000 14:57:57 +0100 (MET)
From: wsi@gcal.ac.uk
Message-Id: <200003211357.OAA29215@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: par help wrong: xlog & ylog

Full_Name: 
Version: 1.0.0
OS: linux
Submission from: (NULL) (193.62.250.209)


    

?par lists and describes xlog and ylog, though these are obsolete. It does not
list
log. I found out about log from ?plot.defaults--so that help is OK.

==> 497.reply.1 <==
From pd@biostat.ku.dk  Tue Mar 21 15:14:51 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA29492;
	Tue, 21 Mar 2000 15:14:50 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id PAA13502;
	Tue, 21 Mar 2000 15:18:04 +0100
Sender: pd@blueberry.kubism.ku.dk
To: wsi@gcal.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] par help wrong: xlog & ylog (PR#497)
References: <200003211357.OAA29225@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 21 Mar 2000 15:18:04 +0100
In-Reply-To: wsi@gcal.ac.uk's message of "Tue, 21 Mar 2000 14:57:59 +0100 (MET)"
Message-ID: <x266ugs8yr.fsf@blueberry.kubism.ku.dk>
Lines: 26
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

wsi@gcal.ac.uk writes:

> Full_Name: 
> Version: 1.0.0
> OS: linux
> Submission from: (NULL) (193.62.250.209)
> 
> 
>     
> 
> ?par lists and describes xlog and ylog, though these are obsolete. It does not
> list
> log. I found out about log from ?plot.defaults--so that help is OK.

Not a bug, not obsolete, and works as documented:

> plot(1,log="y")
> par("ylog")    
[1] TRUE


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 497.followup.1 <==
From wsi@gcal.ac.uk  Tue Mar 21 15:24:30 2000
Received: from localhost.localdomain (IDENT:root@cbe207.gcal.ac.uk [193.62.250.209])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA29571
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 15:24:29 +0100 (MET)
Received: from localhost (wsimpson@localhost)
	by localhost.localdomain (8.9.3/8.9.3) with ESMTP id PAA09918;
	Tue, 21 Mar 2000 15:27:26 GMT
X-Authentication-Warning: localhost.localdomain: wsimpson owned process doing -bs
Date: Tue, 21 Mar 2000 15:27:25 +0000 (GMT)
From: Bill Simpson <wsi@gcal.ac.uk>
X-Sender: wsimpson@localhost.localdomain
To: r-devel@stat.math.ethz.ch
cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] par help wrong: xlog & ylog (PR#497)
In-Reply-To: <200003211357.OAA29225@pubhealth.ku.dk>
Message-ID: <Pine.LNX.4.10.10003211522090.9897-100000@localhost.localdomain>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


> Full_Name: 
> Version: 1.0.0
> OS: linux
> Submission from: (NULL) (193.62.250.209)
> 
> ?par lists and describes xlog and ylog, though these are obsolete. It does not
> list
> log. I found out about log from ?plot.defaults--so that help is OK.
Reading through ?par again, I see that xlog and ylog are "read only". (I
initially thought xlog and ylog were obsolete because I could set them) I
don't find the help to be very clear:

ylog: R.O..  A logical value (see `log' in `plot.default').  See
          `xlog' above.

Instead of (see `log' in `plot.default'), why not have log listed here in
the par help? Or is it an argument to plot()? In which case, why not list
it in the help for plot()? I find it hard to find info for plots because
this info seems to be spread out in several places

Bill



==> 497.followup.2 <==
From wsi@gcal.ac.uk  Tue Mar 21 15:27:34 2000
Received: from localhost.localdomain (IDENT:root@cbe207.gcal.ac.uk [193.62.250.209])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA29628;
	Tue, 21 Mar 2000 15:27:34 +0100 (MET)
Received: from localhost (wsimpson@localhost)
	by localhost.localdomain (8.9.3/8.9.3) with ESMTP id PAA09925;
	Tue, 21 Mar 2000 15:30:31 GMT
X-Authentication-Warning: localhost.localdomain: wsimpson owned process doing -bs
Date: Tue, 21 Mar 2000 15:30:31 +0000 (GMT)
From: Bill Simpson <wsi@gcal.ac.uk>
X-Sender: wsimpson@localhost.localdomain
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: wsi@gcal.ac.uk, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] par help wrong: xlog & ylog (PR#497)
In-Reply-To: <x266ugs8yr.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.LNX.4.10.10003211528091.9897-100000@localhost.localdomain>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII



On 21 Mar 2000, Peter Dalgaard BSA wrote:

> wsi@gcal.ac.uk writes:
> 
> > Full_Name: 
> > Version: 1.0.0
> > OS: linux
> > Submission from: (NULL) (193.62.250.209)
> > 
> > 
> >     
> > 
> > ?par lists and describes xlog and ylog, though these are obsolete. It does not
> > list
> > log. I found out about log from ?plot.defaults--so that help is OK.
> 
> Not a bug, not obsolete, and works as documented:
True. True. Not documented in plot help. It is documented in plot.default.
Why not in par, where xlog and ylog are? I find it confusing.

> 
> > plot(1,log="y")
> > par("ylog")    
> [1] TRUE

Bill


==> 497.reply.2 <==
From maechler@stat.math.ethz.ch  Tue Mar 21 17:05:40 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA00830
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 17:05:39 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id RAA06904;
	Tue, 21 Mar 2000 17:05:53 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa001fo; Tue Mar 21 17:05:44 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id RAA03693; Tue, 21 Mar 2000 17:05:43 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14551.40407.662833.214623@lynne.ethz.ch>
Date: Tue, 21 Mar 2000 17:05:43 +0100 (MET)
To: Bill Simpson <wsi@gcal.ac.uk>
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] par help wrong: xlog & ylog (PR#497)
In-Reply-To: <Pine.LNX.4.10.10003211528091.9897-100000@localhost.localdomain>
References: <x266ugs8yr.fsf@blueberry.kubism.ku.dk>
	<Pine.LNX.4.10.10003211528091.9897-100000@localhost.localdomain>
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>


>>>>> "Bill" == Bill Simpson <wsi@gcal.ac.uk> writes:

    Bill> On 21 Mar 2000, Peter Dalgaard BSA wrote:

    >> wsi@gcal.ac.uk writes:
    >> 
    >> > Full_Name: 
    >> > Version: 1.0.0
    >> > OS: linux
    >> > Submission from: (NULL) (193.62.250.209)
    >> > 
    >> > 
    >> >     
    >> > 
    >> > ?par lists and describes xlog and ylog, though these are
    >> > obsolete. It does not list log. I found out about log from
    >> > ?plot.defaults--so that help is OK.
    >> 
    >> Not a bug, not obsolete, and works as documented:
    Bill> True. True. Not documented in plot help. It is documented in plot.default.
    Bill> Why not in par, where xlog and ylog are? I find it confusing.

    >> 
    >> > plot(1,log="y")
    >> > par("ylog")    
    >> [1] TRUE

log is *not* a valid  par(.) argument, what makes you think it should be
documented there ?

  > par(log = "x")
  Warning message: 
  parameter "log" can't be set in: par(args) 


It *is* a valid argument to most(?) plot methods;
plot is the generic function, and the idea is that it only documents what
*ALL* plot methods have in common.  This is the reason that "log = .." is
documented with the default  plot method, plot.default.

You might have a point:  We could (should we?) consider requiring a 
"log =" argument for *ALL* plot methods, and then have it 
documented and possibly even among the listed arguements (the "non ..." ones)
of the generic  plot.

Opinions?

==> 497.reply.3 <==
From thomas@biostat.washington.edu  Tue Mar 21 17:33:44 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA01034
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 17:33:42 +0100 (MET)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id IAA14766;
	Tue, 21 Mar 2000 08:33:51 -0800 (PST)
Date: Tue, 21 Mar 2000 08:33:51 -0800 (PST)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: maechler@stat.math.ethz.ch
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] par help wrong: xlog & ylog (PR#497)
In-Reply-To: <200003211605.RAA00840@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0003210829030.14323-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Tue, 21 Mar 2000 maechler@stat.math.ethz.ch wrote:

> You might have a point:  We could (should we?) consider requiring a 
> "log =" argument for *ALL* plot methods, and then have it 
> documented and possibly even among the listed arguements (the "non ..." ones)
> of the generic  plot.
> 
> Opinions?
> 

Aaagh! No!  What about plots that intrinsically contain zero x or y
values, such as mortality plots (ie upside-down survival plots) or
Receiver Operating Characteristic curves?

Going further, some plot methods have a ... option but don't pass it to
plot. If the method uses plot to set up axes and then calls points() or
lines() to handle the actual drawing it may make sense to pass ... to
points() or lines().  These functions don't understand log=, so it would
be necessary to have an explicit log= option for the method, even if it
was completely inappropriate.

	-thomas


==> 497.audit <==
Sat Mar 25 09:45:25 2000	maechler	moved from incoming to Documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Graphics

* PR# 512 *
Subject: x11 colortype problems ('gray' is broken?)
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 07 Apr 2000 11:53:39 -0400
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 512 <==
From tov@ece.cmu.edu  Fri Apr  7 17:53:24 2000
Received: from ece.cmu.edu (ECE.CMU.EDU [128.2.236.200])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA13852
	for <r-bugs@biostat.ku.dk>; Fri, 7 Apr 2000 17:53:23 +0200 (MET DST)
Received: from bavaria.ece.cmu.edu (root@BAVARIA.ECE.CMU.EDU [128.2.216.38])
	by ece.cmu.edu (8.9.2/8.8.8) with ESMTP id LAA06293;
	Fri, 7 Apr 2000 11:53:39 -0400 (EDT)
Received: (from tov@localhost)
	by bavaria.ece.cmu.edu (8.9.3/8.9.3/Debian 8.9.3-21) id LAA30387;
	Fri, 7 Apr 2000 11:53:39 -0400
Sender: tov@bavaria.ece.cmu.edu
To: r-bugs@biostat.ku.dk
Cc: Thomas Vogels <tov@ece.cmu.edu>
Subject: x11 colortype problems ('gray' is broken?)
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 07 Apr 2000 11:53:39 -0400
Message-ID: <874s9dj4ak.fsf@bavaria.ece.cmu.edu>
Lines: 41
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.5
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi,

  I occasionally run out of color in my X11 terminal.  At this
point, R will issue this error message:
        Error: X11 cannot allocate additional graphics colors.
Consider using colortype="pseudo.cube" or "gray".

An immediate x11(colortype="pseudo.cube") doesn't work as the
colortype seems to be shared among the different x11 plotting windows.
So I have to close all windows first, then I can open an x11 device
with the colortype "pseudo.cube".  (Neither the necessity to close all
windows nor the fact, that colortype is an option to X11 and not to
the plot command, is clear from the help pages or the error message.)

The real problem, however, comes with x11(colortype="gray") as this
brings up just a black screen (and it stays black).  I can't quite see
whether I'm stumbling across some issues with X resources, here.
x11() usually gives a white background.

Thanks,
  -tom


 --
platform = i586-unknown-linux
arch = i586
os = linux
system = i586, linux
status = 
major = 1
minor = 0.0
year = 2000
month = February
day = 29
language = R


-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204


==> 512.audit <==
Sat Apr 08 07:31:32 2000	ripley	moved from incoming to Graphics

==> 512.followup.1 <==
From ripley@stats.ox.ac.uk  Sat Apr  8 12:32:44 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA17908
	for <R-bugs@biostat.ku.dk>; Sat, 8 Apr 2000 12:32:43 +0200 (MET DST)
Received: from max106.public.ox.ac.uk (max106.public.ox.ac.uk [192.76.27.106])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id LAA01090;
	Sat, 8 Apr 2000 11:31:38 +0100 (BST)
Date: Sat, 8 Apr 2000 11:31:15 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: tov@ece.cmu.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] x11 colortype problems ('gray' is broken?) (PR#512)
In-Reply-To: <200004071553.RAA13862@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10004081123590.6335-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 7 Apr 2000 tov@ece.cmu.edu wrote:

> 
> Hi,
> 
>   I occasionally run out of color in my X11 terminal.  At this
> point, R will issue this error message:
>         Error: X11 cannot allocate additional graphics colors.
> Consider using colortype="pseudo.cube" or "gray".
> 
> An immediate x11(colortype="pseudo.cube") doesn't work as the
> colortype seems to be shared among the different x11 plotting windows.
> So I have to close all windows first, then I can open an x11 device
> with the colortype "pseudo.cube".  (Neither the necessity to close all
> windows nor the fact, that colortype is an option to X11 and not to
> the plot command, is clear from the help pages or the error message.)

There is a single colortype shared by all x11 devices.  That couild eb
clearer!

> The real problem, however, comes with x11(colortype="gray") as this
> brings up just a black screen (and it stays black).  I can't quite see
> whether I'm stumbling across some issues with X resources, here.
> x11() usually gives a white background.

No. It's a bug.  When you set x11(colortype="gray") it tries to allocate
min(256, 2^depth) colours, that is all the colours on an 8-bit display.
That is clearly going to fail (unless perhaps your window manager is 
in mono).  So it does fail, set PaletteSize = 0, and then maps all
colours to black.  That's what the x11 driver seems to do when colour
allocation fails.  I suspect it should not open at all under those 
circumstances.

Quick fix:

static void SetupGrayScale()
{
    PaletteSize = 0;
    if (depth > 7)
	depth = 7;
    if (GetGrayPalette(display, colormap, 1 << depth) == 0)
	depth = 1;
}

(8 replaced by 7) in devX11.c.  I'll commit a more sophisticated one
to R-release.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 202 *
Subject: persp box occlusion bug
From: wsi@gcal.ac.uk
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
--The persp algorithm does not apply the occlusion rules to the frame, 
--which is always plotted first. 
--A bug, but not very simple to fix.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 202 <==
From wsi@gcal.ac.uk  Wed Jun  2 15:02:10 1999
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA27126
	for <R-bugs@biostat.ku.dk>; Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
From: wsi@gcal.ac.uk
Message-Id: <199906021302.PAA27126@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: persp box occlusion bug

Full_Name: Bill Simpson
Version: 64.1
OS: linux
Submission from: (NULL) (193.62.250.209)


Bug in persp() bounding box:
If the surface being plotted extends below the lower z-axis boundary, the box
is
drawn with the wrong occlusion. The box is shown as being occluded by the
surface
even though it should be in front of the surface.

The box is correct for surface extending above the box. Problem is only for
surface extending below the box.

This exhibits the bug:

std<-rep(seq(-32,32,8),9)/1000 * 60
cf<-rep(seq(-32,32,8),rep(9,9))/1000 *60 
dp<-(cf-std)/.6
std<-unique(std)
cf<-unique(cf)
dp<-t(matrix(dp,length(cf),length(std)))
persp(std,cf,dp, xlim=c(-2,2), ylim=c(-2,2), zlim=c(0,5),theta=-40,    
phi=45,
box=TRUE,ltheta=-120, lphi=120,
d=1.5, shade=.7)


==> 202.audit <==
Wed Jun 30 19:31:18 1999	pd	moved from incoming to Graphics
Thu Jul 01 18:19:48 1999	pd	changed notes
Sun Feb 20 10:07:11 2000	ripley	changed notes
Mon Feb 28 17:17:51 2000	pd	changed notes
Mon Feb 28 17:18:28 2000	pd	changed notes
Mon Feb 28 17:19:35 2000	pd	changed notes
Mon Feb 28 17:20:17 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 414 *
Subject:  graphics bugs: steep slopes and large values beyond ylim 
From: Ben Bolker <bolker@zoo.ufl.edu>
Date: Mon, 7 Feb 2000 18:28:04 -0500
--Followup on R-devel showed this was due to generating integer coordinates 
--outside +/- 2^15 in the X11 driver.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 414 <==
From ben@bolker-nt.zoo.ufl.edu  Tue Feb  8 00:32:03 2000
Received: from triarch.zoo.ufl.edu (triarch.zoo.ufl.edu [128.227.60.248])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA13274
	for <r-bugs@biostat.ku.dk>; Tue, 8 Feb 2000 00:32:02 +0100 (MET)
Received: from bolker-nt.zoo.ufl.edu ([128.227.60.126])
          by triarch.zoo.ufl.edu (Netscape Messaging Server 3.5)
           with ESMTP id 494; Mon, 7 Feb 2000 18:32:02 -0500
Received: (from ben@localhost)
	by bolker-nt.zoo.ufl.edu (8.9.3/8.9.3) id SAA22301;
	Mon, 7 Feb 2000 18:28:04 -0500
Date: Mon, 7 Feb 2000 18:28:04 -0500
From: Ben Bolker <bolker@zoo.ufl.edu>
Message-Id: <200002072328.SAA22301@bolker-nt.zoo.ufl.edu>
To: r-bugs@biostat.ku.dk
Subject:  graphics bugs: steep slopes and large values beyond ylim 
Cc: ben@bolker-nt.zoo.ufl.edu


  Some of my students have uncovered some apparent graphics bugs in 
R.  I think they may manifest slightly different on different platforms/
with different display devices (they sometimes report a Windows graph
that looks OK but odd results on printing).
  I'm able to replicate similar problems on my Linux (RH 6.0) system.


1. abline() plots nothing, or a wrong line, when the slope is too steep.

plot(0:10,0:10)
abline(a=0,b=100)
abline(a=0,b=200)
abline(a=0,b=300)
abline(a=0,b=80)

2. when plotting with type "l" and with values far beyond the limits of
the plot, semi-random lines appear on the plot.

plot(exp(1:100),ylim=c(0,10),type="l")

Any thoughts?  I poked a little bit at this myself: abline calls GLine, neither of them
seems to do much checking whether the endpoints of the line to be drawn are way outside of the
window (I guess that XDrawLine, which gets called by GLine, can't handle this).
I guess this should probably be fixed at the the level of GLine (it might fix both of
the above problems, but I'm a little bit afraid digging this deeply into the graphics drivers.
  Maybe it will be obvious to someone closer to the code?

--please do not edit the information below--

Version:
 platform = i686-unknown-linux
 arch = i686
 os = linux
 system = i686, linux
 status = 
 major = 0
 minor = 99.0
 year = 2000
 month = February
 day = 7
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 414.audit <==
Wed Feb 16 19:26:57 2000	ripley	moved from incoming to Graphics
Sun Feb 20 10:13:40 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 400 *
Subject: X11 troubles
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 13 Jan 2000 14:31:42 +0100
--a) We don't handle multiple window closes well
--b) X11 errors should be caught by an error handler, not kill R
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 400 <==
From pd@biostat.ku.dk  Thu Jan 13 14:29:00 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA01544
	for <r-bugs@mail.kubism.ku.dk>; Thu, 13 Jan 2000 14:29:00 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id OAA15286;
	Thu, 13 Jan 2000 14:31:43 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-bugs@biostat.ku.dk
Subject: X11 troubles
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 13 Jan 2000 14:31:42 +0100
Message-ID: <x23ds2nlmp.fsf@blueberry.kubism.ku.dk>
Lines: 24
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Just to get these issues recorded in the bug repository:

a) We don't handle multiple window closes well

My "favourite" version of this is when I ^Z out of an R session with
an open graphics window to do something on the command line, then kill
the graphics window (which does nothing), kill it again, realise that
it's because the R session was stopped, and:

[pd@blueberry BUILD]$ %
bin/R
Segmentation fault (core dumped)

b) X11 errors should be caught by an error handler, not kill R.

This is mainly seen when there's an error somewhere else, such as
trouble with the font setup. But in principle, we should at worst shut
down the graphics window, not R itself.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 400.audit <==
Wed Jan 26 19:28:37 2000	ripley	moved from incoming to Graphics
Mon Feb 28 17:07:48 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 510 *
Subject:  Strange behaviour of image 
From: J.C.Rougier@durham.ac.uk
Date: Thu, 6 Apr 2000 19:15:19 +0100 (BST)
--At least an inaccurate description.
--To be changed (with a back-compatibility option) in 1.1.0
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 510 <==
From J.C.Rougier@durham.ac.uk  Thu Apr  6 20:15:04 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA02878
	for <r-bugs@biostat.ku.dk>; Thu, 6 Apr 2000 20:15:03 +0200 (MET DST)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.9.1/8.9.1) with ESMTP id TAA15849
	for <r-bugs@biostat.ku.dk>; Thu, 6 Apr 2000 19:15:20 +0100 (BST)
Received: from laplace by euclid id <TAA29380@euclid>; Thu, 6 Apr 2000 19:15:13 +0100 (BST)
Date: Thu, 6 Apr 2000 19:15:19 +0100 (BST)
Message-Id: <14993.200004061815@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  Strange behaviour of image 

The following commands

z <- matrix(seq(0, 1, len=1000))
image(z, 1, z, zlim=c(0, 1), col=gray(1:10/10))

appear to violate the image functionality as described on the
help page.  As I understand it, by specifying a zlim of c(0, 1)
and a colour vector of length 10, the colours should correspond
to the intervals (0, 0.1), (0.1, 0.2), ..., (0.9, 1.0), this
being 10 equally-spaced intervals on (0, 1).  It is clear from
the image that this has not occurred.  In fact the intervals are
apparently (0, 1/18), (1/18, 3/18), ..., (15/18, 17/18), (17/18,
1).  Have I misunderstood something?

Cheers, Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = Patched
 major = 0
 minor = 99.0
 year = 2000
 month = February
 day = 9
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 510.reply.1 <==
From pd@blueberry.kubism.ku.dk  Thu Apr  6 20:46:16 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA02953
	for <R-bugs@biostat.ku.dk>; Thu, 6 Apr 2000 20:46:16 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id UAA20558;
	Thu, 6 Apr 2000 20:47:44 +0200
Sender: pd@blueberry.kubism.ku.dk
To: J.C.Rougier@durham.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Strange behaviour of image (PR#510)
References: <200004061815.UAA02888@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Apr 2000 20:47:44 +0200
In-Reply-To: J.C.Rougier@durham.ac.uk's message of "Thu, 6 Apr 2000 20:15:05 +0200 (MET DST)"
Message-ID: <x21z4jnk1b.fsf@blueberry.kubism.ku.dk>
Lines: 28
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

J.C.Rougier@durham.ac.uk writes:

> The following commands
> 
> z <- matrix(seq(0, 1, len=1000))
> image(z, 1, z, zlim=c(0, 1), col=gray(1:10/10))
> 
> appear to violate the image functionality as described on the
> help page.  As I understand it, by specifying a zlim of c(0, 1)
> and a colour vector of length 10, the colours should correspond
> to the intervals (0, 0.1), (0.1, 0.2), ..., (0.9, 1.0), this
> being 10 equally-spaced intervals on (0, 1).  It is clear from
> the image that this has not occurred.  In fact the intervals are
> apparently (0, 1/18), (1/18, 3/18), ..., (15/18, 17/18), (17/18,
> 1).  Have I misunderstood something?

I don't see that anything else is being promised...

If someone actually thought about this, then the choice might be
related to the behavior at peaks and troughs. (since a circle with
radius r looks wide compared to the region between two circles with
diameter n*r and (n+1)*r)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 510.audit <==
Sat Apr 08 07:29:46 2000	ripley	changed notes
Sat Apr 08 07:29:46 2000	ripley	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 495 *
Subject: barplot
From: skala@incoma.cz
Date: Tue, 21 Mar 2000 09:20:33 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 495 <==
From skala@incoma.cz  Tue Mar 21 09:20:34 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA22354
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 09:20:33 +0100 (MET)
Date: Tue, 21 Mar 2000 09:20:33 +0100 (MET)
From: skala@incoma.cz
Message-Id: <200003210820.JAA22354@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: barplot

Full_Name: Zdenek Skala
Version: 1.0.0
OS: MS Windows 95
Submission from: (NULL) (194.108.127.14)


Dear all,
a problem with barplot() was already discussed on R-help for R 0.90.0 - sorry,
if this is a known bug, but I was unable to find it in the bugs database.
In:
> barplot(c(.1,.5,1), ylim=(0:1))
or
> barplot(c(.1,.5,1), ylim=c(0,1))
the y axis is drawn from 0.2 to 0.8, in:
> barplot(c(.1,.5,1))
the y axis is drawn from 0.0 to 0.8.
As I was notified earlier by Peter Dalgaard, "the axis settings use yaxs='i' 
(or xaxs if horizontal) which sets the plot boundaries equal to the ylim 
(stated or computed) and marks the axes "internally". The endpoints of the 
axes are not considered to be internal."
Sorry again if this is already reported.
With regards
Zdenek Skala

==> 495.reply.1 <==
From pd@biostat.ku.dk  Tue Mar 21 09:53:22 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA22811;
	Tue, 21 Mar 2000 09:53:21 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id JAA13278;
	Tue, 21 Mar 2000 09:56:30 +0100
Sender: pd@blueberry.kubism.ku.dk
To: skala@incoma.cz
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] barplot (PR#495)
References: <200003210820.JAA22364@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 21 Mar 2000 09:56:30 +0100
In-Reply-To: skala@incoma.cz's message of "Tue, 21 Mar 2000 09:20:35 +0100 (MET)"
Message-ID: <x2aejs66rl.fsf@blueberry.kubism.ku.dk>
Lines: 21
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

skala@incoma.cz writes:

> > barplot(c(.1,.5,1), ylim=c(0,1))
> the y axis is drawn from 0.2 to 0.8, in:

> As I was notified earlier by Peter Dalgaard, "the axis settings use yaxs='i' 
> (or xaxs if horizontal) which sets the plot boundaries equal to the ylim 
> (stated or computed) and marks the axes "internally". The endpoints of the 
> axes are not considered to be internal."
> Sorry again if this is already reported.

I actually thought we had that one fixed, but obviously not ...
As usual, the workaround is to extend the ylim a tiny bit:

barplot(c(.1,.5,1), ylim=c(-.001,1.001))

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 495.audit <==
Sat Mar 25 09:45:25 2000	maechler	moved from incoming to Graphics
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  In-Out

none

Directory:  Installation

* PR# 485 *
Subject: Install R1.0.0
From: Lynn Zhang <lyzhang@umich.edu>
Date: Mon, 13 Mar 2000 16:10:52 -0500 (EST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 485 <==
From lyzhang@umich.edu  Mon Mar 13 22:13:28 2000
Received: from shiwala.admin.lsa.umich.edu (shiwala.admin.lsa.umich.edu [141.211.75.248])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA13925
	for <r-bugs@biostat.ku.dk>; Mon, 13 Mar 2000 22:13:26 +0100 (MET)
Received: from kongzi.admin.lsa.umich.edu (lyzhang@kongzi.admin.lsa.umich.edu [141.211.32.160])
	by shiwala.admin.lsa.umich.edu (8.9.3/8.9.3/LSA 8.9.3 1999/10/05 22:57:41 lyzhang) with ESMTP id QAA15200
	for <r-bugs@biostat.ku.dk>; Mon, 13 Mar 2000 16:13:31 -0500 (EST)
Received: from localhost by kongzi.admin.lsa.umich.edu (8.9.3/8.9.3) with SMTP id QAA23357
	for <r-bugs@biostat.ku.dk>; Mon, 13 Mar 2000 16:10:52 -0500 (EST)
X-Authentication-Warning: kongzi.admin.lsa.umich.edu: lyzhang owned process doing -bs
Date: Mon, 13 Mar 2000 16:10:52 -0500 (EST)
From: Lynn Zhang <lyzhang@umich.edu>
X-Sender: lyzhang@kongzi.admin.lsa.umich.edu
To: r-bugs@biostat.ku.dk
Subject: Install R1.0.0
Message-ID: <Pine.SOL.3.95.1000313160825.18282A-100000@kongzi.admin.lsa.umich.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


Hello,

I tried to compile and install R. After I ran
make 2>&1 | tee log
., I got the following error:

making system.d from system.c
system.c:37: readline/readline.h: No such file or directory
make[3]: *** [system.d] Error 1
make[3]: Leaving directory
`/afs/lsa.umich.edu/group/admin/software/build/R/R-1.
0.0/src/unix'
make[2]: *** [R] Error 2
make[2]: Leaving directory
`/afs/lsa.umich.edu/group/admin/software/build/R/R-1.
0.0/src/unix'
make[1]: *** [R] Error 1
make[1]: Leaving directory
`/afs/lsa.umich.edu/group/admin/software/build/R/R-1.
0.0/src'
make: *** [R] Error 1



Please help.

Lots aof thanks!

*=======================================* 
*	Lynn Zhang             	        *
*	LS&A System Services Team       *
*	lyzhang@umich.edu               *
*=======================================*


==> 485.reply.1 <==
From thomas@biostat.washington.edu  Mon Mar 13 22:24:59 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA13978
	for <R-bugs@biostat.ku.dk>; Mon, 13 Mar 2000 22:24:58 +0100 (MET)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id NAA03758;
	Mon, 13 Mar 2000 13:25:00 -0800 (PST)
Date: Mon, 13 Mar 2000 13:24:59 -0800 (PST)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: lyzhang@umich.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Install R1.0.0 (PR#485)
In-Reply-To: <200003132113.WAA13935@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0003131315460.18281-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 13 Mar 2000 lyzhang@umich.edu wrote:

> 
> Hello,
> 
> I tried to compile and install R. After I ran
> make 2>&1 | tee log
> ., I got the following error:
> 
> making system.d from system.c
> system.c:37: readline/readline.h: No such file or directory

It looks as though you are trying to use GNU readline without it being
present.  This shouldn't be allowed by configure.

Try 
     make distclean
     ./configure
     make

again, to see if the problem goes away. If it doesn't then
look at src/include/config.h to see if you have something like
/* GNU Readline Library */
#define HAVE_LIBREADLINE 1
#define HAVE_READLINE_HISTORY_H 1
#define HAVE_READLINE_READLINE_H 1
indicating that configure thinks you have readline or like
/* GNU Readline Library */
/* #undef HAVE_LIBREADLINE */
/* #undef HAVE_READLINE_HISTORY_H */
/* #undef HAVE_READLINE_READLINE_H */
indicating that it doesn't.

In either case there would be a problem with configure, but a different
one. It's possible, for example, that configure is finding the readline
headers but that the compiler isn't looking in the same place.

Of course this is assuming you do have the GNU readline library and
headers. If you don't, then
	./configure --without-readline
is a workaround, though we would still like to know why configure thinks
you have it.


	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle




> make[3]: *** [system.d] Error 1
> make[3]: Leaving directory
> `/afs/lsa.umich.edu/group/admin/software/build/R/R-1.
> 0.0/src/unix'
> make[2]: *** [R] Error 2
> make[2]: Leaving directory
> `/afs/lsa.umich.edu/group/admin/software/build/R/R-1.
> 0.0/src/unix'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory
> `/afs/lsa.umich.edu/group/admin/software/build/R/R-1.
> 0.0/src'
> make: *** [R] Error 1
> 
> 
> 
> Please help.
> 
> Lots aof thanks!
> 
> *=======================================* 
> *	Lynn Zhang             	        *
> *	LS&A System Services Team       *
> *	lyzhang@umich.edu               *
> *=======================================*
> 
> 
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


==> 485.followup.1 <==
From lyzhang@umich.edu  Tue Mar 14 22:36:11 2000
Received: from shiwala.admin.lsa.umich.edu (shiwala.admin.lsa.umich.edu [141.211.75.248])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA25640
	for <R-bugs@biostat.ku.dk>; Tue, 14 Mar 2000 22:36:10 +0100 (MET)
Received: from kongzi.admin.lsa.umich.edu (lyzhang@kongzi.admin.lsa.umich.edu [141.211.32.160])
	by shiwala.admin.lsa.umich.edu (8.9.3/8.9.3/LSA 8.9.3 1999/10/05 22:57:41 lyzhang) with ESMTP id QAA22968;
	Tue, 14 Mar 2000 16:36:17 -0500 (EST)
Received: from localhost by kongzi.admin.lsa.umich.edu (8.9.3/8.9.3) with SMTP id QAA09313;
	Tue, 14 Mar 2000 16:33:30 -0500 (EST)
X-Authentication-Warning: kongzi.admin.lsa.umich.edu: lyzhang owned process doing -bs
Date: Tue, 14 Mar 2000 16:33:30 -0500 (EST)
From: Lynn Zhang <lyzhang@umich.edu>
X-Sender: lyzhang@kongzi.admin.lsa.umich.edu
To: Thomas Lumley <thomas@biostat.washington.edu>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Install R1.0.0 (PR#485)
In-Reply-To: <Pine.GSO.4.21.0003131315460.18281-100000@mail.biostat.washington.edu>
Message-ID: <Pine.SOL.3.95.1000314163154.17926J-100000@kongzi.admin.lsa.umich.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


Hello,

After I run make, I got the following error,

__d_sign                            /usr/lsa/lib/libblas.a(drotg.o)
ld: fatal: Symbol referencing errors. No output written to ../../bin/R.X11
make[3]: *** [../../bin/R.X11] Error 1
make[3]: Leaving directory
`/afs/lsa.umich.edu/group/admin/software/build/R/R-1.0.0/src/main'
make[2]: *** [R] Error 2
make[2]: Leaving directory
`/afs/lsa.umich.edu/group/admin/software/build/R/R-1.0.0/src/main'
make[1]: *** [R] Error 1
make[1]: Leaving directory
`/afs/lsa.umich.edu/group/admin/software/build/R/R-1.0.0/src'
make: *** [R] Error 1


Would you please help me on that?

Lots of thanks!




*=======================================* 
*	Lynn Zhang             	        *
*	LS&A System Services Team       *
*	lyzhang@umich.edu               *
*=======================================*


==> 485.audit <==
Sat Mar 25 09:40:03 2000	maechler	moved from incoming to Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 478 *
Subject: Conditional for XDR code left out in saveload.c
From: hoffmann@ehmgs2.et.tu-dresden.de
Date: Thu, 9 Mar 2000 09:43:01 +0100 (MET)
--This seems to be a harmless warning, not an error.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 478 <==
From hoffmann@ehmgs2.et.tu-dresden.de  Thu Mar  9 09:43:02 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA07568
	for <R-bugs@biostat.ku.dk>; Thu, 9 Mar 2000 09:43:01 +0100 (MET)
Date: Thu, 9 Mar 2000 09:43:01 +0100 (MET)
From: hoffmann@ehmgs2.et.tu-dresden.de
Message-Id: <200003090843.JAA07568@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Conditional for XDR code left out in saveload.c

Full_Name: Thomas Hoffmann
Version: 1.0.0
OS: OS/2 Warp 4.0 FP 11
Submission from: (NULL) (141.30.125.20)


I autoconfigured/configured the src'es w/o having XDR (#undef HAVE_RPC_XDR_H).

In saveload.c , at the beginning of the file the XDR code is enclosed by
matching #ifdefs.

But in the NEW_SAVE_FORMAT section, there are no #ifdefs around the XDR code.

Does this imply that using the new save format requires using XDR or is 
this simply an oversight?

==> 478.followup.1 <==
From ripley@stats.ox.ac.uk  Thu Mar  9 10:13:28 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA08143
	for <R-bugs@biostat.ku.dk>; Thu, 9 Mar 2000 10:13:27 +0100 (MET)
Received: from max164.public.ox.ac.uk (max164.public.ox.ac.uk [192.76.27.164])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id JAA17986;
	Thu, 9 Mar 2000 09:10:23 GMT
Date: Thu, 9 Mar 2000 09:10:51 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: hoffmann@ehmgs2.et.tu-dresden.de
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Conditional for XDR code left out in saveload.c (PR#478)
In-Reply-To: <200003090843.JAA07578@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10003090908141.7342-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 9 Mar 2000 hoffmann@ehmgs2.et.tu-dresden.de wrote:

> Full_Name: Thomas Hoffmann
> Version: 1.0.0
> OS: OS/2 Warp 4.0 FP 11
> Submission from: (NULL) (141.30.125.20)
> 
> 
> I autoconfigured/configured the src'es w/o having XDR (#undef HAVE_RPC_XDR_H).
> 
> In saveload.c , at the beginning of the file the XDR code is enclosed by
> matching #ifdefs.
> 
> But in the NEW_SAVE_FORMAT section, there are no #ifdefs around the XDR code.
> 
> Does this imply that using the new save format requires using XDR or is 
> this simply an oversight?

The defines in R_SaveToFile and R_LoadFromFile determine what is 
actually used.  I think all that happens is that unused code is not
excluded from the compile (and that happens with the BinarySave code
if XDR is available).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 478.audit <==
Sun Mar 12 13:57:21 2000	ripley	changed notes
Sun Mar 12 13:57:21 2000	ripley	moved from incoming to Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 467 *
Subject: Re: [R] Re: R-1.0.0 is released
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 01 Mar 2000 20:26:40 +0100
--followup to PR#466
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 467 <==
From pd@biostat.ku.dk  Wed Mar  1 20:27:42 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA01870
	for <R-bugs@biostat.ku.dk>; Wed, 1 Mar 2000 20:27:42 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id UAA07371;
	Wed, 1 Mar 2000 20:26:49 +0100 (MET)
Received: from kubism.kubism.ku.dk(130.225.108.10), claiming to be "pubhealth.ku.dk"
 via SMTP by hypatia, id smtpdAAAa001n5; Wed Mar  1 20:26:44 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA01866;
	Wed, 1 Mar 2000 20:26:30 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id UAA10344;
	Wed, 1 Mar 2000 20:26:40 +0100
Sender: pd@blueberry.kubism.ku.dk
To: bhoel@server.python.net (Berthold H?llmann)
Cc: r-help@stat.math.ethz.ch, r-bugs@stat.math.ethz.ch
Subject: Re: [R] Re: R-1.0.0 is released
References: <x23dqc5obk.fsf@blueberry.kubism.ku.dk> <m2zosienvd.fsf@pchoel.privat.uni-hamburg.de>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 01 Mar 2000 20:26:40 +0100
In-Reply-To: bhoel@server.python.net's message of "01 Mar 2000 16:00:54 +0100"
Message-ID: <x29002cwzz.fsf@blueberry.kubism.ku.dk>
Lines: 52
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
X-MIME-Autoconverted: from 8bit to quoted-printable by pubhealth.ku.dk id UAA01866
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from quoted-printable to 8bit by pubhealth.ku.dk id UAA01870

bhoel@server.python.net (Berthold Hllmann) writes:

> Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
> 
> > I've rolled up R-1.0.0.tgz a short while ago. 
> > 
> I've build R-1.0.0 on my
> 
> >uname -a
> Linux pchoel 2.2.14 #3 Mit Jan 5 08:57:39 MET 2000 i686 unknown
> 
> box. Calling "make check" fails with 
....
> > all(tx == tx0)
> Error in all(tx == tx0) : dim<- length of dims do not match the length of object
> Execution halted
> 
> Don't shure what I should think about it. 
> 
> my compiler is:
> 
> >gcc --version
> 2.95.2
> 
> R is compiled using the
> 
> "-fPIC -O3 -fstrict-aliasing -ffast-math -funroll-loops -mpentiumpro -march=pentiumpro -fschedule-insns2"
> 
> compiler switches. I used 
> 
> ./configure --with-g77 --enable-blas_risc --enable-readline --with-x
> 
> for configuring.

That's a pretty heavy set of optimization options you're using there!

Basically, there are two possibilities:

1) You've triggered a compiler bug
2) You've triggered a bug in R

In either case, you'll have to dig deeper and see if you can catch the
exact spot where things go wrong. You might start R with the debugger,
run the base-Ex.R with it while having a breakpoint set at the error
message you are getting. But before that try running the example that
triggers the bug by itself and see if the bug is still tickled.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 467.reply.1 <==
From pd@biostat.ku.dk  Wed Mar  1 20:40:32 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA01920;
	Wed, 1 Mar 2000 20:40:32 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id UAA10356;
	Wed, 1 Mar 2000 20:40:48 +0100
Sender: pd@blueberry.kubism.ku.dk
To: p.dalgaard@biostat.ku.dk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk, r-help@stat.math.ethz.ch
Subject: Re: [Rd] Re: [R] Re: R-1.0.0 is released (PR#467)
References: <200003011927.UAA01880@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 01 Mar 2000 20:40:48 +0100
In-Reply-To: p.dalgaard@biostat.ku.dk's message of "Wed, 1 Mar 2000 20:27:43 +0100 (MET)"
Message-ID: <x266v6cwcf.fsf@blueberry.kubism.ku.dk>
Lines: 11
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

p.dalgaard@biostat.ku.dk writes:

...and notice that it is a very bad idea to mail to both r-help and
r-bugs. Anyone who answers the one on r-help without resetting the
Cc's will generate a new PR# , like I just did!

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 467.audit <==
Sat Apr 01 07:37:57 2000	ripley	moved from incoming to Installation
Sat Apr 01 07:38:40 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 466 *
Subject: Re: R-1.0.0 is released
From: bhoel@server.python.net (Berthold=?iso-8859-1?q?_H=F6llmann?=)
Date: 01 Mar 2000 16:00:54 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 466 <==
From bhoel@server.python.net  Wed Mar  1 18:12:56 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA01317
	for <R-bugs@biostat.ku.dk>; Wed, 1 Mar 2000 18:12:55 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA03990
	for <r-bugs@hypatia.math.ethz.ch>; Wed, 1 Mar 2000 18:13:07 +0100 (MET)
Received: from public.rrz.uni-hamburg.de(134.100.32.55), claiming to be "public.uni-hamburg.de"
 via SMTP by hypatia, id smtpdBAAa000yI; Wed Mar  1 18:12:57 2000
Received: from pchoel.privat.uni-hamburg.de (root@max1-055.public.uni-hamburg.de [134.100.43.55])
	by public.uni-hamburg.de (8.8.8/8.8.8) with ESMTP id SAA10846;
	Wed, 1 Mar 2000 18:12:54 +0100
Received: (from hoel@localhost)
	by pchoel.privat.uni-hamburg.de (8.9.3/8.9.3) id QAA27467;
	Wed, 1 Mar 2000 16:00:54 +0100
X-Authentication-Warning: pchoel.privat.uni-hamburg.de: hoel set sender to bhoel@starship.python.net using -f
Sender: hoel@public.uni-hamburg.de
To: r-help@stat.math.ethz.ch, r-bugs@stat.math.ethz.ch
Subject: Re: R-1.0.0 is released
References: <x23dqc5obk.fsf@blueberry.kubism.ku.dk>
From: bhoel@server.python.net (Berthold=?iso-8859-1?q?_H=F6llmann?=)
Date: 01 Mar 2000 16:00:54 +0100
In-Reply-To: Peter Dalgaard BSA's message of "29 Feb 2000 10:51:27 +0100"
Message-ID: <m2zosienvd.fsf@pchoel.privat.uni-hamburg.de>
Lines: 63
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.6
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> I've rolled up R-1.0.0.tgz a short while ago. 
> 
I've build R-1.0.0 on my

>uname -a
Linux pchoel 2.2.14 #3 Mit Jan 5 08:57:39 MET 2000 i686 unknown

box. Calling "make check" fails with 

...
make[4]: Entering directory `/opt/src/devel/R-1.0.0/tests/Examples'
updating base-Ex.R ...
make[5]: Entering directory `/opt/src/devel/R-1.0.0/src/library'
 >>> Building/Updating help pages for package `base'
     Formats: text example 
make[5]: Leaving directory `/opt/src/devel/R-1.0.0/src/library'
running code in base-Ex.R ...
../../bin/R --vanilla < base-Ex.R > base-Ex.Rout
make[4]: *** [base-Ex.Rout] Error 1
...

and 

>tail tests/Examples/base-Ex.Rout
> 
> cut(rep(1,5),4)#-- dummy
[1] (0.9995,1] (0.9995,1] (0.9995,1] (0.9995,1] (0.9995,1]
Levels:  (0.999,0.9995] (0.9995,1] (1,1.0005] (1.0005,1.001] 
> tx0 <- c(9, 4, 6, 5, 3, 10, 5, 3, 5)
> x <- rep(0:8, tx0)
> tx <- table(x)
> all(tx == tx0)
Error in all(tx == tx0) : dim<- length of dims do not match the length of object
Execution halted

Don't shure what I should think about it. 

my compiler is:

>gcc --version
2.95.2

R is compiled using the

"-fPIC -O3 -fstrict-aliasing -ffast-math -funroll-loops -mpentiumpro -march=pentiumpro -fschedule-insns2"

compiler switches. I used 

./configure --with-g77 --enable-blas_risc --enable-readline --with-x

for configuring.

Cheers

Berthold

-- 
bhoel@starship.python.net / http://starship.python.net/crew/bhoel/
        It is unlawful to use this email address for unsolicited ads
        (USC Title 47 Sec.227). I will assess a US$500 charge for
        reviewing and deleting each unsolicited ad.

==> 466.followup.1 <==
From plummer@iarc.fr  Thu Mar  2 10:59:27 2000
Received: from smtp02.iarc.fr (IDENT:root@uu194-7-167-221.unknown.uunet.be [194.7.167.221])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA06126
	for <R-bugs@biostat.ku.dk>; Thu, 2 Mar 2000 10:59:27 +0100 (MET)
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id KAA13613;
	Thu, 2 Mar 2000 10:58:59 +0100
Message-ID: <XFMail.000302110739.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
In-Reply-To: <200003011712.SAA01327@pubhealth.ku.dk>
Date: Thu, 02 Mar 2000 11:07:39 +0100 (CET)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: bhoel@server.python.net
Subject: RE: [Rd] Re: R-1.0.0 is released (PR#466)
Cc: R-bugs@biostat.ku.dk, r-devel@stat.math.ethz.ch

On 01-Mar-00 bhoel@server.python.net wrote:
> R is compiled using the
> 
> "-fPIC -O3 -fstrict-aliasing -ffast-math -funroll-loops -mpentiumpro
> -march=pentiumpro -fschedule-insns2"
> 
> compiler switches. I used 
> 
> ./configure --with-g77 --enable-blas_risc --enable-readline --with-x
> 
> for configuring.

I can't help noticing that you are configuring for a RISC optimized BLAS
library on an Intel x86 processor.  I have no idea if this is serious,
but it seems a bit odd.

Martyn

==> 466.followup.2 <==
From bacon@aerodyne.com  Thu Mar  2 18:01:00 2000
Received: from chi6-1.relay.mail.uu.net (chi6-1.relay.mail.uu.net [199.171.54.98])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA11561
	for <R-bugs@biostat.ku.dk>; Thu, 2 Mar 2000 18:00:59 +0100 (MET)
From: bacon@aerodyne.com
Received: from aerodyne.com by chi6sosrv11.alter.net with ESMTP 
	(peer crosschecked as: [198.4.243.2])
	id QQieuf23702;
	Thu, 2 Mar 2000 15:27:53 GMT
Received: from aerodyne.com (keeshond.aerodyne.com [198.4.242.196]) by aerodyne.com (Hah!/nope) with ESMTP id KAA01933; Thu, 2 Mar 2000 10:27:39 -0500 (EST)
Message-Id: <200003021527.KAA01933@aerodyne.com>
Date: Thu, 2 Mar 2000 10:36:46 -0500 (EST)
Reply-To: bacon@aerodyne.com
Subject: RE: [Rd] Re: R-1.0.0 is released (PR#466)
To: plummer@iarc.fr
cc: bhoel@server.python.net, R-bugs@biostat.ku.dk, r-devel@stat.math.ethz.ch
In-Reply-To: <XFMail.000302110739.plummer@iarc.fr>
MIME-Version: 1.0
Content-Type: TEXT/plain; CHARSET=US-ASCII

On  2 Mar, Martyn Plummer wrote:
>  On 01-Mar-00 bhoel@server.python.net wrote:
> > R is compiled using the
> > 
> > "-fPIC -O3 -fstrict-aliasing -ffast-math -funroll-loops -mpentiumpro
> > -march=pentiumpro -fschedule-insns2"
> > 
> > compiler switches. I used 
> > 
> > ./configure --with-g77 --enable-blas_risc --enable-readline --with-x
> > 
> > for configuring.
>  
>  I can't help noticing that you are configuring for a RISC optimized BLAS
>  library on an Intel x86 processor.  I have no idea if this is serious,
>  but it seems a bit odd.
>  

Since this feature was added for PowerPC Linux distributions at my
request, I'll comment on this.  I would say that it is very unlikely to
be of any help, but it probably won't hurt.  The configure script will
check to see if libblas_risc can be located.  If it can't be found, it
won't be used.  Configure won't even look for it unless you request it
with --enable-blas_risc.

Furthermore, I don't believe that configure will actually use
libblas_risc unless you also --enable-blas.  I could be wrong in that
regard.  Using --enable-blas_risc could implicitly --enable-blas as
well. It's been many months since I wrote that configure option.  I do
know that configure will test if linking -lblas works first.  If that
fails, it won't even bother with -lblas_risc.  

Hope this helps,

-- 
Fred Bacon

==============================================================================
Aerodyne Research, Inc.                        Phone:  (978) 663-9500 ext. 273
45 Manning Rd.                                   FAX:  (978) 663-4918
Billerica, MA 01821-3976                        http://www.aerodyne.com
==============================================================================
"Oh my God!  Space aliens!  Don't eat me, I have a wife and kids!  Eat them."
                                                             -- Homer Simpson



==> 466.audit <==
Sat Apr 01 07:37:27 2000	ripley	moved from incoming to Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Language

* PR# 412 *
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 412 <==
From postmaster@franz.stat.wisc.edu  Sun Feb  6 01:16:33 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26868
	for <R-bugs@biostat.ku.dk>; Sun, 6 Feb 2000 01:16:31 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id BAA18080
	for <r-bugs@hypatia.math.ethz.ch>; Sun, 6 Feb 2000 01:16:38 +0100 (MET)
Received: from franz.stat.wisc.edu(128.105.174.95)
 via SMTP by hypatia, id smtpdAAAa004QS; Sun Feb  6 01:16:33 2000
Received: from pubhealth.ku.dk (really [130.225.108.10]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m12HFNP-000ZSxC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Sat, 5 Feb 2000 18:16:31 -0600 (CST) 
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26864
	for <r-bugs@r-project.org>; Sun, 6 Feb 2000 01:16:18 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA12311;
	Sun, 6 Feb 2000 01:18:51 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-bugs@r-project.org
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
Message-ID: <x2900zyyhh.fsf@blueberry.kubism.ku.dk>
Lines: 51
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit


Call objects don't always behave as you'd expect. They're mostly
list-like, but with exceptions:

> f<-function(x,y,...)match.call(expand.dots=FALSE)
> xx <- f(y=1,2,z=3,4)
> dd <- xx$...
> xx$... <- NULL
> c(xx,dd)
[[1]]
f(x = 2, y = 1)

$z
[1] 3

[[3]]
[1] 4

> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, z = 3, 4)

(Splus has this rather differently, since dd becomes a call to list()
rather than a list of promises:

S> c(xx,dd)
f(x = 2, y = 1, list, z = 3, 4)
S> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, list, z = 3, 4)

...but at least gives the same in both cases)

Also, the names of arguments added with [[<- is getting dropped if a
new element is required:

> xx[["abc"]]<-123
> xx
f(x = 2, y = 1, 123)

S has what I'd expect there:

S> xx[["abc"]]<-123
S> xx
f(x = 2, y = 1, abc = 123)

[R-0.99.0 prerelease on RedHat6.1, but this is likely not a new thing.]

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 412.audit <==
Wed Feb 16 19:26:57 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 408 *
Subject: convolution bug
From: wsimpson@gcal.ac.uk
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 408 <==
From wsimpson@gcal.ac.uk  Fri Jan 28 11:17:36 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA11325
	for <R-bugs@biostat.ku.dk>; Fri, 28 Jan 2000 11:17:36 +0100 (MET)
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
From: wsimpson@gcal.ac.uk
Message-Id: <200001281017.LAA11325@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: convolution bug

Full_Name: Bill Simpson
Version: 65.1 , 0.90.1
OS: Linux
Submission from: (NULL) (193.62.250.209)


I reported this on r-help, but here is official bug report.

The present convolve() does not do convolution by default. Its default behaviour
is
correlation. This is a bug.

The default argument conj should be set to FALSE.

The zero-padding should be on the right for linear convolution (don't ask me
why you call this type="open"; I suggest type="linear").

Here is what I expect linear convolution to do:
myconvolve<-function (x,h) 
{
    nx <- length(x)
    nh <- length(h)
    #zero pad
    if(nx>nh)
       {
       x <- c(x,rep(0, nh-1))
       h<-c(h,rep(0,nx-1))
       }
    else
       {
       h <- c(h,rep(0, nx-1))
       x<-c(x,rep(0,nh-1))
       }
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/length(x)
#I am not sure about this, the R IFFT is weird
}

What "circular" convolution should do is just
eliminate the zero-padding:

myconvolve2<-function (x,h)
{
#no padding, circular convolution
    nx <- length(x)
    nh <- length(h)
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/(nx)
}


I suggest that you create two functions, convolve() and correlate(), and get
rid
of the conj argument in convolve().

==> 408.audit <==
Wed Feb 16 19:28:42 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Low-level

* PR# 391 *
Subject: Segfault in dataentry()
From: Peter Dalgaard BSA <p.dalgaard@pubhealth.ku.dk>
Date: 29 Dec 1999 11:59:50 +0100
--dataentry(0,0) segfaults
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 391 <==
From pd@biostat.ku.dk  Wed Dec 29 11:53:44 1999
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.8.8+Sun/8.8.8) with ESMTP id LAA02951;
	Wed, 29 Dec 1999 11:53:44 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id LAA01559;
	Wed, 29 Dec 1999 11:59:50 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-core@r-project.org
Subject: Segfault in dataentry()
Cc: r-bugs@biostat.ku.dk
From: Peter Dalgaard BSA <p.dalgaard@pubhealth.ku.dk>
Date: 29 Dec 1999 11:59:50 +0100
Message-ID: <x2d7rqt3kp.fsf@blueberry.kubism.ku.dk>
Lines: 18
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Content-Length: 611


> dataentry(0,0)

Program received signal SIGSEGV, Segmentation fault.
0x808991c in duplicate (s=0x0) at ../../../R/src/main/duplicate.c:42
42	    switch (TYPEOF(s)) {

Apparently that one doesn't get trapped by the no-segfault checks.
Martin? 

(It's not too high priority to fix, but confusing data.entry and
dataentry provokes this quite easily.)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 391.reply.1 <==
From maechler@stat.math.ethz.ch  Fri Dec 31 18:09:17 1999
Received: from stat.math.ethz.ch (hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.8.8+Sun/8.8.8) with ESMTP id SAA12661;
	Fri, 31 Dec 1999 18:09:16 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA16695;
	Fri, 31 Dec 1999 18:09:19 +0100 (MET)
Received: from florence(129.132.58.33), claiming to be "florence.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa0044p; Fri Dec 31 18:09:10 1999
Received: (maechler@localhost) by florence.ethz.ch (8.9.3/D-MATH-client) id SAA15779; Fri, 31 Dec 1999 18:09:14 +0100
X-Authentication-Warning: florence.ethz.ch: maechler set sender to maechler@florence using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14444.58169.886168.959820@gargle.gargle.HOWL>
Date: Fri, 31 Dec 1999 18:09:13 +0100 (MET)
To: p.dalgaard@pubhealth.ku.dk
Cc: R-bugs@biostat.ku.dk
Subject: Re: Segfault in dataentry() (PR#391)
In-Reply-To: <199912291053.LAA02959@pubhealth.ku.dk>
References: <199912291053.LAA02959@pubhealth.ku.dk>
X-Mailer: VM 6.75 under Emacs 20.5.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>
Content-Length: 1008

>>>>> "PD" == p dalgaard <p.dalgaard@pubhealth.ku.dk> writes:

    >> dataentry(0,0)

    PD> Program received signal SIGSEGV, Segmentation fault.  0x808991c in
    PD> duplicate (s=0x0) at ../../../R/src/main/duplicate.c:42 42 switch
    PD> (TYPEOF(s)) {

    PD> Apparently that one doesn't get trapped by the no-segfault checks.
    PD> Martin?

There's a not-so-short  "stop.list" of functions which are *NOT* tested for
segfaults.   dataentry (w/ and w/o ".") is among them.
all the interactive ones are, actually.
[[remember:   The list was quite a bit shorter, and there were R core
	      members who complained...]] 

Look in  ..../tests/make-no-segfault.R for the statements starting with

 edit.int <- c("fix", "edit", "vi", "emacs", "pico", "xemacs", "xedit")
 misc.int <- c("browser", "bug.report", "menu")
 stop.list[["base"]] <-
    ..

to find all the functions which are *not* tested for seg.faults.

Maybe we (R-core) we should really always have
      R_TESTLOTS=yes
in our environments?

==> 391.reply.2 <==
From hornik@ci.tuwien.ac.at  Sat Jan  1 16:40:27 2000
Received: from fangorn.ci.tuwien.ac.at (fangorn.ci.tuwien.ac.at [128.131.51.24])
	by pubhealth.ku.dk (8.8.8+Sun/8.8.8) with ESMTP id QAA13861
	for <R-bugs@biostat.ku.dk>; Sat, 1 Jan 2000 16:40:27 +0100 (MET)
Received: from aragorn.ci.tuwien.ac.at (hornik@aragorn.ci.tuwien.ac.at [128.131.51.35])
	by fangorn.ci.tuwien.ac.at (8.9.3/8.9.3/Debian/GNU) with ESMTP id QAA19454;
	Sat, 1 Jan 2000 16:39:43 +0100
Received: (from hornik@localhost)
	by aragorn.ci.tuwien.ac.at (8.9.3/8.8.5) id QAA19446;
	Sat, 1 Jan 2000 16:40:51 +0100
From: Kurt Hornik <Kurt.Hornik@ci.tuwien.ac.at>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14446.8194.975894.184062@aragorn.ci.tuwien.ac.at>
Date: Sat, 1 Jan 2000 16:40:50 +0100 (CET)
To: maechler@stat.math.ethz.ch
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: Segfault in dataentry() (PR#391)
In-Reply-To: <199912311709.SAA12673@pubhealth.ku.dk>
References: <199912311709.SAA12673@pubhealth.ku.dk>
X-Mailer: VM 6.75 under Emacs 19.34.1
Reply-To: Kurt.Hornik@ci.tuwien.ac.at
Content-Length: 1470

>>>>> maechler  writes:

>>>>> "PD" == p dalgaard <p.dalgaard@pubhealth.ku.dk> writes:
>>> dataentry(0,0)

PD> Program received signal SIGSEGV, Segmentation fault.  0x808991c in
PD> duplicate (s=0x0) at ../../../R/src/main/duplicate.c:42 42 switch
PD> (TYPEOF(s)) {

PD> Apparently that one doesn't get trapped by the no-segfault checks.
PD> Martin?

> There's a not-so-short  "stop.list" of functions which are *NOT* tested for
> segfaults.   dataentry (w/ and w/o ".") is among them.
> all the interactive ones are, actually.
> [[remember:   The list was quite a bit shorter, and there were R core
> 	      members who complained...]] 

> Look in  ..../tests/make-no-segfault.R for the statements starting with

>  edit.int <- c("fix", "edit", "vi", "emacs", "pico", "xemacs", "xedit")
>  misc.int <- c("browser", "bug.report", "menu")
>  stop.list[["base"]] <-
>     ..

> to find all the functions which are *not* tested for seg.faults.

> Maybe we (R-core) we should really always have
>       R_TESTLOTS=yes
> in our environments?

Actually, I'd prefer having some means of markup in the Rd source code
to indicate whether an object should not be employed for the no-segfault
testing.  We could still keep the R_TESTLOTS, though ...

E.g, the socket docs would have something correspding to \dontrun in the
examples section.

This should be cleaner than having to change the script in tests.

(Confusion arose when Fritz added old.packages() two days ago ...)

-k

==> 391.audit <==
Fri Feb 18 15:28:12 2000	pd	moved from incoming to Low-level
Mon Feb 28 17:21:37 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Misc

none

Directory:  Models

none

Directory:  Startup

* PR# 486 *
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
--workaround to the origin problem in 1.0.1
--New report: try does not work from the profile.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 486 <==
From maechler@stat.math.ethz.ch  Tue Mar 14 10:32:36 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA17249
	for <R-bugs@biostat.ku.dk>; Tue, 14 Mar 2000 10:32:35 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA21252;
	Tue, 14 Mar 2000 10:32:48 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005C1; Tue Mar 14 10:32:44 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA03934; Tue, 14 Mar 2000 10:32:44 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14542.1851.731086.380@lynne.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
To: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Cc: R-bugs@stat.math.ethz.ch
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
 (PR#470)
In-Reply-To: <Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
References: <14532.56910.278837.379365@lynne.ethz.ch>
	<Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

    BDR> On Tue, 7 Mar 2000, Martin Maechler wrote:
    >> >>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
    >> 
    BDR> On Tue, 7 Mar 2000, Trenkler, Dietrich wrote:
    >> >> I think I've discovered what went wrong.
    >> >> 
    >> >> My workspace included a function wilcox.test formerly copied from
    >> >> ctest. Now ctest ist part of the distribution and because of that I
    >> >> always got the message:
    >> >> 
    >> >> [Previously saved workspace restored]
    >> >> 
    >> >> Error in autoload("wilcox.test", "ctest") :
    >> >> Object already exists
    >> >> 
    >> >> I didn't take care of this message. Now I removed wilcox.test, saved
    >> >> the WS, restarted R without the vanilla-option and alas, anova
    >> >> now works.
    >> >> 
    >> >> It seems that R stops initializing after encountering the error
    >> >> mentioned above. Is this correct?   
    >> 
    BDR> Yes, in that the rest of the system Rprofile file is skipped
    BDR> and hence options show.signif.stars and show.coef.Pvalues are not set.
    >> but other options as well..
    >> I think this shouldn't happen and *is* a bug.

    BDR> It looks to me as if a bit more protection is needed in print.coefmat,
    BDR> at least.

	 which Brian has implemented in the mean time.

	 ....

    >> For the 1.0.x patches, at least, I'll move the autoload()'s to the end of
    >> profile/Common.R

    BDR> I _think_ they should have try() around them, which is what S-PLUS 
    BDR> now does with all startup code.

I tried this, but it does not work :

try(autoload(..)) works okay when used after startup, but not *during*
startup.  However, I'll put a workaround into Common.R

Should this {try(.) not working during startup} be another bug report ?

Martin

==> 486.audit <==
Sat Mar 25 09:44:47 2000	maechler	moved from incoming to Startup
Sat Apr 08 07:41:36 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  System-specific

* PR# 490 *
Subject: R-1.0.0 on alpha/osf1 memory glitch
From: Ray Brownrigg <Ray.Brownrigg@mcs.vuw.ac.nz>
Date: Fri, 17 Mar 2000 11:25:30 +1300 (NZDT)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 490 <==
From ray@mcs.vuw.ac.nz  Thu Mar 16 23:25:28 2000
Received: from kaukau.mcs.vuw.ac.nz (kaukau.mcs.vuw.ac.nz [130.195.5.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA21828
	for <r-bugs@biostat.ku.dk>; Thu, 16 Mar 2000 23:25:25 +0100 (MET)
Received: from aqua.mcs.vuw.ac.nz (aqua.mcs.vuw.ac.nz [130.195.6.201])
	by kaukau.mcs.vuw.ac.nz (8.10.0.Beta6/8.10.0.Beta6) with ESMTP id e2GMPUS01452
	for <r-bugs@biostat.ku.dk>; Fri, 17 Mar 2000 11:25:31 +1300 (NZDT)
From: Ray Brownrigg <Ray.Brownrigg@mcs.vuw.ac.nz>
Received: (from ray@localhost)
	by aqua.mcs.vuw.ac.nz (8.9.2/8.8.6) id LAA25041
	for r-bugs@biostat.ku.dk; Fri, 17 Mar 2000 11:25:30 +1300 (NZDT)
Date: Fri, 17 Mar 2000 11:25:30 +1300 (NZDT)
Message-Id: <200003162225.LAA25041@aqua.mcs.vuw.ac.nz>
To: r-bugs@biostat.ku.dk
Subject: R-1.0.0 on alpha/osf1 memory glitch

Digital Alpha (various), Digital UNIX V4.0[EF], R-1.0.0, gcc, f77

When using batch mode with the save option, an error message is issued.
However [I have just discovered that] it appears that the operation
does complete, i.e. the .RData file is saved successfully.  The main
problem is that the return code is non-zero (and so it is impossible to
distinguish this "non-error" from some other error in a script).

Reproduce by:

    bats>  echo 'x <- 1' | R --save
    
    R : Copyright 2000, The R Development Core Team
    Version 1.0.0  (February 29, 2000)
    
    R is free software and comes with ABSOLUTELY NO WARRANTY.
    You are welcome to redistribute it under certain conditions.
    Type    "?license" or "?licence" for distribution details.
    
    R is a collaborative project with many contributors.
    Type    "?contributors" for a list.
    
    Type    "demo()" for some demos, "help()" for on-line help, or
            "help.start()" for a HTML browser interface to help.
    Type    "q()" to quit R.
    
    > x <- 1
    >
    xmalloc: out of virtual memory
    bats> 

Note that an alternate form that achieves the same desired effect does
not issue any error messages:

    echo 'x <- 1; save(list = ls(), file = ".RData")' | R --no-save

I can't find any record of the configure summary output (is it saved
anywhere, or does it only appear on the screen?) but I could reproduce
this if necessary.

Ray Brownrigg

==> 490.audit <==
Sat Apr 01 07:28:48 2000	ripley	moved from incoming to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 452 *
Subject: problem with glm
From: Brad McNeney <mcneney@cs.sfu.ca>
Date: Fri, 18 Feb 2000 17:51:54 -0800 (PST)
--Problems on Alpha's with glm. Status unclear
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 452 <==
From mcneney@cs.sfu.ca  Sat Feb 19 02:51:57 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id CAA15326
	for <R-bugs@biostat.ku.dk>; Sat, 19 Feb 2000 02:51:56 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id CAA05839
	for <r-bugs@stat.math.ethz.ch>; Sat, 19 Feb 2000 02:52:05 +0100 (MET)
Received: from cs.sfu.ca(142.58.111.1)
 via SMTP by hypatia, id smtpdAAAa001RB; Sat Feb 19 02:51:57 2000
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id RAA10291
	for <r-bugs@stat.math.ethz.ch>; Fri, 18 Feb 2000 17:51:55 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id RAA0000400367; Fri, 18 Feb 2000 17:51:54 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Fri, 18 Feb 2000 17:51:54 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: r-bugs@stat.math.ethz.ch
Subject: problem with glm
Message-ID: <Pine.OSF.4.21.0002181750080.400767-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

I'm having sporadic problems with glm on my alpha workstation running
Compaq Tru64 UNIX V5.0 (I can't replicate the problem on my Linux PC). I
have the same problem whether I use a version of R built with the native
C-compiler or a version compiled with gcc. In both cases I've built with
g77.

I want to do some simulations with a call to glm in each rep. A simplified
version would be something like:

N_100; NREPS_100; lam.e_5; logit.inv_function(x){ exp(x)/(1+exp(x)) }
for(i in (1:NREPS)) {
   cat(paste("REP",i,"\n"))
   T_rexp(N,(lam.e))
   Delta_rbinom(N,1,logit.inv(1+T))
   ff_glm(Delta ~ T,family=binomial(logit))
}
 
It often completes all reps, but I occasionally get errors related to
lengths of various objects, etc.:

REP 1 
REP 2
<snip>
REP 9 
Error in model.matrix(t, data) : variable lengths differ


REP 1 
<snip>
REP 53 
Error: subscript out of bounds

REP 1 
<snip>
REP 41 
Error in model.matrix(t, data) : invalid variable type

Different error messages, different numbers of reps. When I call glm again
using the values of T and Delta just before the error, it runs error-free.
When I put the data in a data frame before calling glm I can also get
messages like:

REP 1 
<snip>
REP 64 
Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  : 
        invalid variable type


--please do not edit the information below--

Version:
 platform = alpha-dec-osf5.0
 arch = alpha
 os = osf5.0
 system = alpha, osf5.0
 status = Patched
 major = 0
 minor = 99.0
 year = 2000
 month = February
 day = 9
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-------------------------------------------------------------------------
Brad McNeney                               email: mcneney@stat.sfu.ca
Department of Mathematics and Statistics   web: www.math.sfu.ca/~mcneney/
Simon Fraser University                    phone: 604.291.4815
8888 University Drive                      fax: 604.291.4947
Burnaby, British Columbia
Canada V5A 1S6


==> 452.reply.1 <==
From pd@biostat.ku.dk  Sat Feb 19 13:57:47 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA16134;
	Sat, 19 Feb 2000 13:57:46 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id NAA30569;
	Sat, 19 Feb 2000 13:59:28 +0100
Sender: pd@blueberry.kubism.ku.dk
To: mcneney@cs.sfu.ca
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <200002190151.CAA15336@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 19 Feb 2000 13:59:27 +0100
In-Reply-To: mcneney@cs.sfu.ca's message of "Sat, 19 Feb 2000 02:51:58 +0100 (MET)"
Message-ID: <x24sb5l55c.fsf@blueberry.kubism.ku.dk>
Lines: 47
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mcneney@cs.sfu.ca writes:

> N_100; NREPS_100; lam.e_5; logit.inv_function(x){ exp(x)/(1+exp(x)) }
> for(i in (1:NREPS)) {
>    cat(paste("REP",i,"\n"))
>    T_rexp(N,(lam.e))
>    Delta_rbinom(N,1,logit.inv(1+T))
>    ff_glm(Delta ~ T,family=binomial(logit))
> }
>  
> It often completes all reps, but I occasionally get errors related to
> lengths of various objects, etc.:
...
> --please do not edit the information below--
> 
> Version:
>  platform = alpha-dec-osf5.0
>  arch = alpha
>  os = osf5.0
>  system = alpha, osf5.0
>  status = Patched
>  major = 0
>  minor = 99.0
>  year = 2000
>  month = February
>  day = 9
>  language = R
> 
> Search Path:
>  .GlobalEnv, Autoloads, package:base

I just did the above ~10 times on i386 and nothing happened. We've had
previous reports on trouble in the lm/glm/model.matrix etc. region on
Alpha. 

If you compile with all warnings on, are you getting warnings on
pointer/integer comparisons or assignments?

Can you create a reproducible case (with set.seed to keep the random
generator sequence constant) and would you know how run a debugger on
your version so that we can figure out what is going wrong?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.followup.1 <==
From mcneney@cs.sfu.ca  Sun Feb 20 05:11:05 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id FAA17753;
	Sun, 20 Feb 2000 05:11:03 +0100 (MET)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id UAA15662;
	Sat, 19 Feb 2000 20:11:12 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id UAA0000433332; Sat, 19 Feb 2000 20:11:12 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sat, 19 Feb 2000 20:11:12 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <x24sb5l55c.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


> If you compile with all warnings on, are you getting warnings on
> pointer/integer comparisons or assignments?
> 

Yes, all the ones in regex.c that Doug mentioned. Here's a sample
of these and others (warnings related to graphics/X stuff have been
omitted):

uncmin.c: In function `lltslv':
uncmin.c:281: warning: type mismatch in implicit declaration for built-in
function `memcpy'
character.c: In function `stripchars':
character.c:269: warning: subscript has type `char'
character.c:281: warning: subscript has type `char'
character.c:296: warning: subscript has type `char'
character.c:296: warning: subscript has type `char'
character.c:304: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:320: warning: subscript has type `char'
character.c:320: warning: subscript has type `char'
character.c:330: warning: subscript has type `char'
character.c:330: warning: subscript has type `char'
character.c:341: warning: subscript has type `char'
character.c: In function `do_makenames':
character.c:384: warning: subscript has type `char'
character.c:395: warning: subscript has type `char'
/usr/share/misc/bison.simple: In function `Rf_yyparse':
/usr/share/misc/bison.simple:254: warning: `yyval' might be used
uninitialized in this function
regex.c: In function `re_match_2':
regex.c:3770: warning: cast from pointer to integer of different size
regex.c:3770: warning: cast from pointer to integer of different size
regex.c:3776: warning: cast to pointer from integer of different size
regex.c:3776: warning: cast to pointer from integer of different size
regex.c:3923: warning: cast to pointer from integer of different size
regex.c:3923: warning: cast to pointer from integer of different size
regex.c:3976: warning: cast to pointer from integer of different size
regex.c:3976: warning: cast to pointer from integer of different size
regex.c:4082: warning: cast from pointer to integer of different size
regex.c:4083: warning: cast from pointer to integer of different size
regex.c:4115: warning: cast to pointer from integer of different size
regex.c:4115: warning: cast to pointer from integer of different size
regex.c:4128: warning: cast to pointer from integer of different size
regex.c:4128: warning: cast to pointer from integer of different size
regex.c:4296: warning: cast from pointer to integer of different size
regex.c:4297: warning: cast from pointer to integer of different size
saveload.c:495: warning: `BinarySave' defined but not used
saveload.c:1775: warning: `NewBinarySave' defined but not used


I'll see what I can do about getting a more reproducible error. 

Any tips on what to look for if I'm running R within GDB? I don't have
much experience with the debugger. I mostly just use it to see where my
programs are dying. But R is not -- it just gives strange error messages.

TIA,
Brad


==> 452.followup.2 <==
From ripley@stats.ox.ac.uk  Sun Feb 20 09:33:06 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA17966;
	Sun, 20 Feb 2000 09:33:05 +0100 (MET)
Received: from max168.public.ox.ac.uk (max168.public.ox.ac.uk [192.76.27.168])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id IAA20341;
	Sun, 20 Feb 2000 08:33:06 GMT
Date: Sun, 20 Feb 2000 08:32:05 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: Brad McNeney <mcneney@cs.sfu.ca>
cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
Message-ID: <Pine.GSO.4.05.10002200807420.5046-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Sat, 19 Feb 2000, Brad McNeney wrote:

> 
> > If you compile with all warnings on, are you getting warnings on
> > pointer/integer comparisons or assignments?
> > 
> 
> Yes, all the ones in regex.c that Doug mentioned. Here's a sample
> of these and others (warnings related to graphics/X stuff have been
> omitted):

(Two suggestions which are in the current snapshot follow. Looks like
what is which header varies a bit.)

> uncmin.c: In function `lltslv':
> uncmin.c:281: warning: type mismatch in implicit declaration for built-in
> function `memcpy'

Add a line (third one here) to src/include/R_ext/RS.h:

#ifndef R_RS_H
#define R_RS_H

#include <string.h> /* for memcpy */
#include "Rconfig.h" /* for F77_SYMBOL */


> character.c: In function `stripchars':
> character.c:269: warning: subscript has type `char'
> character.c:281: warning: subscript has type `char'
> character.c:296: warning: subscript has type `char'
> character.c:296: warning: subscript has type `char'
> character.c:304: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:320: warning: subscript has type `char'
> character.c:320: warning: subscript has type `char'
> character.c:330: warning: subscript has type `char'
> character.c:330: warning: subscript has type `char'
> character.c:341: warning: subscript has type `char'
> character.c: In function `do_makenames':
> character.c:384: warning: subscript has type `char'
> character.c:395: warning: subscript has type `char'
> /usr/share/misc/bison.simple: In function `Rf_yyparse':
> /usr/share/misc/bison.simple:254: warning: `yyval' might be used
> uninitialized in this function

Those are all normal.

> regex.c: In function `re_match_2':
> regex.c:3770: warning: cast from pointer to integer of different size
> regex.c:3770: warning: cast from pointer to integer of different size

That looks like a regex bug, with a why? comment in the code. Change
(int) to (long), twice.

> regex.c:3776: warning: cast to pointer from integer of different size
> regex.c:3776: warning: cast to pointer from integer of different size
> regex.c:3923: warning: cast to pointer from integer of different size
> regex.c:3923: warning: cast to pointer from integer of different size
> regex.c:3976: warning: cast to pointer from integer of different size
> regex.c:3976: warning: cast to pointer from integer of different size
> regex.c:4082: warning: cast from pointer to integer of different size
> regex.c:4083: warning: cast from pointer to integer of different size
> regex.c:4115: warning: cast to pointer from integer of different size
> regex.c:4115: warning: cast to pointer from integer of different size
> regex.c:4128: warning: cast to pointer from integer of different size
> regex.c:4128: warning: cast to pointer from integer of different size
> regex.c:4296: warning: cast from pointer to integer of different size
> regex.c:4297: warning: cast from pointer to integer of different size

I've never seen those, but try adding

#define STDC_HEADERS 1

at the top of regex.c.  (I am not convinced that is the cause here.)

> saveload.c:495: warning: `BinarySave' defined but not used
> saveload.c:1775: warning: `NewBinarySave' defined but not used

Normal, on a platform with xdr.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 452.reply.2 <==
From pd@biostat.ku.dk  Sun Feb 20 13:28:12 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA18510;
	Sun, 20 Feb 2000 13:28:12 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id NAA31926;
	Sun, 20 Feb 2000 13:30:08 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Brad McNeney <mcneney@cs.sfu.ca>
Cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 20 Feb 2000 13:30:07 +0100
In-Reply-To: Brad McNeney's message of "Sat, 19 Feb 2000 20:11:12 -0800 (PST)"
Message-ID: <x2snyogipc.fsf@blueberry.kubism.ku.dk>
Lines: 34
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Brad McNeney <mcneney@cs.sfu.ca> writes:

> I'll see what I can do about getting a more reproducible error. 
> 
> Any tips on what to look for if I'm running R within GDB? I don't have
> much experience with the debugger. I mostly just use it to see where my
> programs are dying. But R is not -- it just gives strange error messages.

One technique is to set a breakpoint at the line that displays the
error, then you can inspect the condition that caused it (you may have
to go "up" a couple of times to get into an interesting environment.)

Sometimes, it turns out that a variable contains something that it
shouldn't due to memory corruption and then you may have to set a
breakpoint earlier in the code and then maybe a watchpoint on the
memory location.

Another thing that is useful even without gdb is to investigate the
output of traceback() and maybe set 

options(error=quote(DUMP <<- sys.status()))

which allows you to subsequently investigate any active environment at
the time of the error, e.g. using ls(envir=DUMP$sys.frames[[3]]), and
get("x",envir=DUMP$sys.frames[[3]]).

(Newer snapshots have a more elaborate dump.frames function, but the
above should do). 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.audit <==
Sun Feb 20 21:27:15 2000	ripley	moved from incoming to System-specific
Mon Feb 28 17:30:41 2000	pd	changed notes

==> 452.followup.3 <==
From mcneney@cs.sfu.ca  Sat Mar  4 19:23:48 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA25981;
	Sat, 4 Mar 2000 19:23:42 +0100 (MET)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id KAA07172;
	Sat, 4 Mar 2000 10:23:52 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id KAA0000263254; Sat, 4 Mar 2000 10:23:52 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sat, 4 Mar 2000 10:23:52 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <x2snyogipc.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0003041022320.263210-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

I looked into the glm problem some more. Seems to be a memory problem that
occurs just after garbage collection. The easiest way for me to
reproduce  the error is in lapply. I take a list and ask lapply to provide
the descriptive stat summary. I do this several times with the same list.
Most often it gives the correct summary, but just after allocSExp calls
R_gc, one of the summaries for a list element will be NULL. 

E.g for a data frame dat with five columns I get the following (having added
print statements in summary.default and in allocSExp just after the test
for whether gc is necessary):

> lapply(as.list(dat), summary, maxsum = maxsum)
[1] "exiting summary.default"
R_FreeSEXP == NULL  
[1] "exiting summary.default"
[1] "exiting summary.default"
[1] "exiting summary.default"
[1] "exiting summary.default"
$Delta
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    1.00    1.19    2.00    2.00 

$D
NULL

$R
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    1.00    0.86    1.00    1.00 

$V
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.004552 0.740700 1.575000 1.754000 3.205000 3.390000 

$X
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0     0.0     0.5     0.5     1.0     1.0 


I don't know if the following is relevant, but for some reason I've found 
I can avoid this particular problem if I make a small change in lapply in 
its main loop.  Around line 50 of apply.c:

    PROTECT(ans = allocVector(VECSXP, n));
    for(i = 0; i < n; i++) {
        INTEGER(ind)[0] = i + 1;
        VECTOR(ans)[i] = eval(R_fcall, rho);
    }

if I change it to make an assignment to a
temporary variable first everything seems to work fine:

    PROTECT(ans = allocVector(VECSXP, n));
    for(i = 0; i < n; i++) {
        INTEGER(ind)[0] = i + 1;
        tem = eval(R_fcall, rho);
        VECTOR(ans)[i] = tem;
    }

hasn't given me any NULLs yet. 



On 20 Feb 2000, Peter Dalgaard BSA wrote:

> Brad McNeney <mcneney@cs.sfu.ca> writes:
> 
> > I'll see what I can do about getting a more reproducible error. 
> > 


==> 452.reply.3 <==
From pd@biostat.ku.dk  Sun Mar  5 01:02:38 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26687;
	Sun, 5 Mar 2000 01:02:37 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA17617;
	Sun, 5 Mar 2000 01:03:15 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Brad McNeney <mcneney@cs.sfu.ca>
Cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <Pine.OSF.4.21.0003041022320.263210-100000@smahlt.math.sfu.ca>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 05 Mar 2000 01:03:15 +0100
In-Reply-To: Brad McNeney's message of "Sat, 4 Mar 2000 10:23:52 -0800 (PST)"
Message-ID: <x2putauvuk.fsf@blueberry.kubism.ku.dk>
Lines: 47
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Brad McNeney <mcneney@cs.sfu.ca> writes:

> I don't know if the following is relevant, but for some reason I've found 
> I can avoid this particular problem if I make a small change in lapply in 
> its main loop.  Around line 50 of apply.c:
> 
>     PROTECT(ans = allocVector(VECSXP, n));
>     for(i = 0; i < n; i++) {
>         INTEGER(ind)[0] = i + 1;
>         VECTOR(ans)[i] = eval(R_fcall, rho);
>     }
> 
> if I change it to make an assignment to a
> temporary variable first everything seems to work fine:
> 
>     PROTECT(ans = allocVector(VECSXP, n));
>     for(i = 0; i < n; i++) {
>         INTEGER(ind)[0] = i + 1;
>         tem = eval(R_fcall, rho);
>         VECTOR(ans)[i] = tem;
>     }
> 
> hasn't given me any NULLs yet. 

Now that is pretty darn odd... Looks quite a bit like a compiler bug.
Those two pieces of code should be equivalent as far as I can see.

One thing that you might do: objdump -dS apply.o allows you to see
what code the compiler generates for the two cases. Also, of course,
you can try reducing the level of optimization.


Alternatively, the mere addition of "tem" changes the local memory use
of that function so that something that got clobbered before doesn't
get clobbered now.

The effect doesn't seem to be present on Intels:

> dfr<-do.call("data.frame",lapply(1:100,function(i)rnorm(100)))
> any(sapply(lapply(dfr,summary),is.null))
[1] FALSE

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  TooMuchAtOnce

none

Directory:  Windows

none

Directory:  incoming

* PR# 505 *
Subject: interrupted save 
From: Thomas Lumley <thomas@biostat.washington.edu>
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 505 <==
From thomas@biostat.washington.edu  Sat Mar 25 21:16:39 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA08785
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 21:16:38 +0100 (MET)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id MAA24561
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 12:16:50 -0800 (PST)
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: R-bugs@biostat.ku.dk
Subject: interrupted save 
In-Reply-To: <Pine.GSO.4.21.0003251204350.22429-100000@mail.biostat.washington.edu>
Message-ID: <Pine.GSO.4.21.0003251207350.22429-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


If an error occurs during a save the file does not appear to be
closed and buffers flushed.  This can lead to corruption if the same
filename is used later and then the buffer is flushed on program exit.

For example, tn the context of PR #504

 f<-function(x,...){ function(y) list(x=x,y=y,...)}
 a<-f(1,2,3)
 save(list="a",file="a.rdata")  ## -- error --
 b<-1:10
 save(list="b",file="a.rdata")
 load("a.rdata")  ## works
 q("no")
 
 R

 load("a.rdata")  ## error



This is R1.0 on Linux

	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
