=================================================
This is an automated collection of open reports in
the R-bugs repository.
=================================================

Directory:  Accuracy

* PR# 631 *
Subject: svd error 
From: =?iso-8859-1?Q?J=F6rg?= Polzehl <polzehl@wias-berlin.de>
Date: Thu, 10 Aug 2000 16:54:46 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 631 <==
From polzehl@wias-berlin.de  Thu Aug 10 16:56:11 2000
Received: from mail-service.wias-berlin.de (descartes.wias-berlin.de [192.124.249.194])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA02583
	for <r-bugs@biostat.ku.dk>; Thu, 10 Aug 2000 16:56:11 +0200 (MET DST)
Received: from sanb1.wias-berlin.de by mail-service.wias-berlin.de (8.8.8/1.1.22.3/16Mar99-0205PM)
	id QAA0000030892; Thu, 10 Aug 2000 16:56:28 +0200 (MET DST)
Message-Id: <4.3.2.7.0.20000810163403.00aa7870@mail-service.wias-berlin.de>
X-Sender: polzehl@mail-service.wias-berlin.de
X-Mailer: QUALCOMM Windows Eudora Version 4.3.2
Date: Thu, 10 Aug 2000 16:54:46 +0200
To: r-bugs@biostat.ku.dk
From: =?iso-8859-1?Q?J=F6rg?= Polzehl <polzehl@wias-berlin.de>
Subject: svd error 
Cc: polzehl@wias-berlin.de
Mime-Version: 1.0
Content-Type: multipart/mixed;
	boundary="=====================_24736660==_"

--=====================_24736660==_
Content-Type: text/plain; charset="iso-8859-1"; format=flowed
Content-Transfer-Encoding: quoted-printable

SVD-Error on

R 1.1.0
Windows 98


I get the following error applying  svd  on a positive definite matrix :

 > sk2
               [,1]         [,2]          [,3]          [,4]          [,5]
[1,]  1.0460139783  0.084356992 -2.810553e-04 -1.303237e-03  2.011809e-03
[2,]  0.0843569924  1.154650879 -5.152560e-04 -2.389213e-03  3.688230e-03
[3,] -0.0002810553 -0.000515256  1.000002e+00  7.960227e-06 -1.228821e-05
[4,] -0.0013032374 -0.002389213  7.960227e-06  1.000037e+00 -5.697973e-05
[5,]  0.0020118087  0.003688230 -1.228821e-05 -5.697973e-05  1.000088e+00
 > svd(sk2)
Error in svd(sk2) : error  4  in dsvdc

The problem seems to be connected to accuracy since

 > svd(sk2-.0000000000000000001)

works correctly.

I've saved the matrix  sk2  in the attached file.

Regards,

J=F6rg Polzehl
--=====================_24736660==_
Content-Type: application/octet-stream; name="sk2"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="sk2"

UkRYMQoAAAACAAAAAAAAAAMAAAADZGltAAAAAAMAAAADc2syAAAAAAIAAAAAAAAAAAAAAAEAAAAA
AAAAAAAAAAL/////AAAADgAAAAAAAAAAAAAAGT/wvHknO/XaP7WYa3uwMRC/MmtTLMsBmL9VWix1
04ctP2B7EYuQF0Y/tZhre7AxED/yeXMzKfWjv0DiR8RYcTa/Y5KK1dPLfT9uNsdP3h7YvzJrUyzL
AZi/QOJHxFhxNj/wAAHM0oaKPuCxnUzM7+G+6cUur1Qr0r9VWix104ctv2OSitXTy30+4LGdTMzv
4T/wACa0QRFCvw3fsLftHfg/YHsRi5AXRj9uNsdP3h7YvunFLq9UK9K/Dd+wt+0d+D/wAFw7fg5q
AAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAf////8AAAANAAAAAAAAAAAAAAACAAAABQAAAAX/
/////////////////////////w==
--=====================_24736660==_
Content-Type: text/plain; charset="iso-8859-1"; format=flowed
Content-Transfer-Encoding: quoted-printable


=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
Dr. J=F6rg Polzehl
WIAS, Mohrenstr. 39
D-10117 Berlin, Germany
email: polzehl@wias-berlin.de
Tel. +49 30/20372 481
Fax: +49 30/2044975
WWW: http://www.wias-berlin.de/~polzehl

--=====================_24736660==_--


==> 631.reply.1 <==
From bates@stat.wisc.edu  Thu Aug 10 20:18:40 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA03322
	for <R-bugs@biostat.ku.dk>; Thu, 10 Aug 2000 20:18:39 +0200 (MET DST)
Received: by franz.stat.wisc.edu
	via sendmail from stdin
	id <m13MwxA-000ZScC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for R-bugs@biostat.ku.dk; Thu, 10 Aug 2000 13:21:16 -0500 (CDT) 
Sender: bates@franz.stat.wisc.edu
To: polzehl@wias-berlin.de
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] svd error (PR#631)
References: <200008101456.QAA02593@pubhealth.ku.dk>
From: Douglas Bates <bates@stat.wisc.edu>
Date: 10 Aug 2000 13:21:16 -0500
In-Reply-To: polzehl@wias-berlin.de's message of "Thu, 10 Aug 2000 16:56:12 +0200 (MET DST)"
Message-ID: <6raeelx9ib.fsf@franz.stat.wisc.edu>
Lines: 74
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

polzehl@wias-berlin.de writes:

> SVD-Error on
> 
> R 1.1.0
> Windows 98
> 
> 
> I get the following error applying  svd  on a positive definite matrix :
> 
>  > sk2
>                [,1]         [,2]          [,3]          [,4]          [,5]
> [1,]  1.0460139783  0.084356992 -2.810553e-04 -1.303237e-03  2.011809e-03
> [2,]  0.0843569924  1.154650879 -5.152560e-04 -2.389213e-03  3.688230e-03
> [3,] -0.0002810553 -0.000515256  1.000002e+00  7.960227e-06 -1.228821e-05
> [4,] -0.0013032374 -0.002389213  7.960227e-06  1.000037e+00 -5.697973e-05
> [5,]  0.0020118087  0.003688230 -1.228821e-05 -5.697973e-05  1.000088e+00

If you know that the matrix is positive definite then you are probably
better off taking the svd of the Cholesky decomposition of the matrix.

> svd(chol(sk2), nu = 0)
$d
[1] 1.095806 1.000000 1.000000 1.000000 1.000000

$v
             [,1]          [,2]         [,3]        [,4]        [,5]
[1,] -0.478709768  0.0011572932  0.013159984  0.87312442 -0.09119310
[2,] -0.877614104 -0.0003224026  0.006761341 -0.47348540  0.07456035
[3,]  0.002923979 -0.4202666121  0.844168101 -0.04500196 -0.32973090
[4,]  0.013558325  0.7925962305  0.519924862  0.03162204  0.31667897
[5,] -0.020929998  0.4417756749 -0.129766919 -0.10217730 -0.88154213

The singular values of sk2 will be the squares of the singular values
of its Cholesky decomposition.  The left and right singular vectors of
sk2 are identical and can be expressed as the V shown here.  Note that
since one singular value has multiplicity 4, the last four columns of
v are not unique.

>  > svd(sk2)
> Error in svd(sk2) : error  4  in dsvdc

This is related to the convergence in the Linpack subroutine dsvdc.
It is a reasonably good singular value routine but it will
occasionally be unable to converge.  Svd routines often have
difficulty with matrices with repeated singular values, like sk2.

The Lapack routine used in SVD from the Matrix library is more
reliable

> SVD(sk2)
$d
[1] 1.200791 1.000000 1.000000 1.000000 1.000000

$u
             [,1]          [,2]          [,3]          [,4]         [,5]
[1,] -0.478709768  5.814978e-19 -1.734663e-19 -2.917201e-20  0.877973210
[2,] -0.877614104 -2.109493e-02 -1.889409e-02 -3.985595e-03 -0.478513967
[3,]  0.002923979 -4.102994e-02  7.970942e-02 -9.959678e-01  0.001594282
[4,]  0.013558325  1.644232e-01 -9.825683e-01 -8.535898e-02  0.007392597
[5,] -0.020929998  9.853104e-01  1.668804e-01 -2.731482e-02 -0.011411959

$vt
           [,1]         [,2]         [,3]         [,4]        [,5]
[1,] -0.4787098 -0.877614104  0.002923979  0.013558325 -0.02093000
[2,]  0.0000000 -0.021094933 -0.041029944  0.164423228  0.98531038
[3,]  0.0000000 -0.018894086  0.079709424 -0.982568251  0.16688036
[4,]  0.0000000 -0.003985595 -0.995967801 -0.085358979 -0.02731482
[5,]  0.8779732 -0.478513967  0.001594282  0.007392597 -0.01141196

A new release of the Matrix library will be uploaded to CRAN shortly.  I
would advise waiting for it to be compiled for Windows before using
the SVD function extensively.  In looking at PR#630 by Torsten Hothorn
I found a subtle bug in SVD.

==> 631.audit <==
Mon Aug 14 14:27:34 2000	pd	moved from incoming to Accuracy
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 630 *
Subject: lda and svd error
From: Torsten Hothorn <Torsten.Hothorn@rzmail.uni-erlangen.de>
Date: Thu, 10 Aug 2000 15:13:38 +0200 (CEST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 630 <==
From Torsten.Hothorn@rzmail.uni-erlangen.de  Thu Aug 10 15:11:55 2000
Received: from max5.rrze.uni-erlangen.de (root@max5.rrze.uni-erlangen.de [131.188.3.50] (may be forged))
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA01072
	for <r-bugs@biostat.ku.dk>; Thu, 10 Aug 2000 15:11:54 +0200 (MET DST)
Received: from imbe68.imbe.med.uni-erlangen.de by max5.rrze.uni-erlangen.de with ESMTP for r-bugs@biostat.ku.dk; Thu, 10 Aug 2000 15:12:08 +0200
Date: Thu, 10 Aug 2000 15:13:38 +0200 (CEST)
From: Torsten Hothorn <Torsten.Hothorn@rzmail.uni-erlangen.de>
X-Sender: hothorn@artemis.imbe.med.uni-erlangen.de
To: r-bugs@biostat.ku.dk
Subject: lda and svd error
Message-Id: <Pine.LNX.4.21.0008101502140.3057-201000@artemis.imbe.med.uni-erlangen.de>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="1133331701-1931357602-965913218=:3057"

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--1133331701-1931357602-965913218=:3057
Content-Type: TEXT/PLAIN; charset=US-ASCII


For a matrix A:

> A
            [,1]       [,2]
 [1,] -2.4491897  0.2345687
 [2,]  0.1530018 -0.5513182
 [3,] -1.3877140  1.0925618
 [4,]  0.5521078  0.7036401
 [5,]  0.4744903 -1.0868091
 [6,] -0.4296282  0.3931673
 [7,] -0.2413387 -0.7461586
 [8,]  1.0567564 -1.1807899
 [9,]  0.7903647  0.8294825
[10,]  1.6456857 -0.2484038
[11,] -1.1795527 -0.6904602
[12,]  2.6470244  0.7050178
[13,]  1.8169865 -0.1057402
[14,]  1.9720294 -0.1091834

and groupings [1] 0 0 0 0 0 0 0 1 1 1 1 1 1 1

> library(MASS)
> lda(A, groupings)
Error in svd(X, nu = 0) : error  2  in dsvdc

is reported. This is hard to reproduce on other machines, even 

> write.table(A, "dummy")
> B <- as.matrix(read.table("dummy"))
> lda(B, groupings)

on the same machine works fine. I add my .RData file renamed 
as DataR (maybe this can help to reproduce the error). The error occured
during a simulation, I added the sources as "svderr.R".

Torsten

--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 1
 minor = 1.0
 year = 2000
 month = June
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

--1133331701-1931357602-965913218=:3057
Content-Type: APPLICATION/octet-stream; name=DataR
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.21.0008101513380.3057@artemis.imbe.med.uni-erlangen.de>
Content-Description: 
Content-Disposition: attachment; filename=DataR

UkRYMQoAAAAFAAAAAAAAAAMAAAADZGltAAAAAAEAAAABQQAAAAAAAAgAAAAI
Z3JvdXBpbmcAAAAMAAAADC5SYW5kb20uc2VlZAAAAAoAAAAKLlRyYWNlYmFj
awAAAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABf////8AAAACAAAAAAAA
AAD/////AAAAEAAAAAAAAAAAAAAAAQAAACoAAAAqc3RvcChwYXN0ZSgiZXJy
b3IgIiwgeiRpbmZvLCAiIGluIGRzdmRjIikpAAD/////AAAAAgAAAAAAAAAA
/////wAAABAAAAAAAAAAAAAAAAEAAAAOAAAADnN2ZChYLCBudSA9IDApAAD/
////AAAAAgAAAAAAAAAA/////wAAABAAAAAAAAAAAAAAAAEAAAAYAAAAGGxk
YS5kZWZhdWx0KEEsIGdyb3VwaW5nKf////8AAAACAAAAAAAAAAD/////AAAA
EAAAAAAAAAAAAAAAAQAAABEAAAARTmV4dE1ldGhvZCgibGRhIikAAAD/////
AAAAAgAAAAAAAAAA/////wAAABAAAAAAAAAAAAAAAAEAAAAXAAAAF2xkYS5t
YXRyaXgoQSwgZ3JvdXBpbmcpAP////8AAAACAAAAAAAAAAD/////AAAAEAAA
AAAAAAAAAAAAAQAAABAAAAAQbGRhKEEsIGdyb3VwaW5nKf//////////////
////////////////////////////AAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAA
AAAABP////8AAAANAAAAAAAAAAAAAAADAAAAASGIE+ETc44V/////wAAAAIA
AAAAAAAAAAAAAAEAAAAAAAAAAAAAAAP/////AAAADgAAAAAAAAAAAAAADgAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAP/AAAAAAAAA/8AAAAAAAAD/wAAAAAAAAP/AAAAAAAAA/8AAA
AAAAAD/wAAAAAAAAP/AAAAAAAAD/////AAAAAgAAAAAAAAAAAAAAAQAAAAAA
AAAAAAAAAv////8AAAAOAAAAAAAAAAAAAAAcwAOX8MHIaeA/w5WQE34/vb/2
NBOMsXdCP+Gq3gvUFnM/3l4MaikJlL/bfwcqUk/Gv87kL9G6OKo/8Oh5XMER
GD/pSqrXVI3mP/pUuo1+UDG/8t9ys0UCeEAFLRsm5nqQP/0SYHbpeIM//41u
ti/9pT/OBliWQmStv+GkZimVGgA/8XsiHJT4IT/mhDhKsAtrv/FjkfP5/5w/
2SmnFC117r/n4IgDNauUv/Lkg+5c7Wg/6ose7jvUyb/Py7Hhj7m3v+YYP/an
MfY/5o+BfEI5N7+7Ecl7N0bPv7vzcZLmB6UAAAACAAAAAAAAAAAAAAABAAAA
AAAAAAAAAAAB/////wAAAA0AAAAAAAAAAAAAAAIAAAAOAAAAAv//////////
////////////////////////////////
--1133331701-1931357602-965913218=:3057
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="svderr.R"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.21.0008101513381.3057@artemis.imbe.med.uni-erlangen.de>
Content-Description: 
Content-Disposition: attachment; filename="svderr.R"

bGlicmFyeShNQVNTKQ0KDQpTU2xkYSA8LSBmdW5jdGlvbihYLCBZLCBxKQ0K
ew0KCW1YIDwtIHJlcCgxLCBucm93KFgpKSUqJXQoYXBwbHkoWCwgMiwgbWVh
bikpDQoJbVkgPC0gcmVwKDEsIG5yb3coWSkpJSoldChhcHBseShZLCAyLCBt
ZWFuKSkNCglYIDwtIHJiaW5kKFgsWSkNCglteCA8LSByYmluZChtWCwgbVkp
DQoJWCA8LSBYIC0gbXggDQogCVcgPC0gKHQoWCklKiVYKQ0KICAgICAgICBl
ZyA8LSBlaWdlbihzb2x2ZShkaWFnKGRpYWcoVykpKSUqJVcpDQoJcSA8LSBs
ZW5ndGgoZWckdmFsdWVzW2VnJHZhbHVlcyA+IDFdKQ0KICAgICAgICBEIDwt
IGVnJHZlY3RvcnNbLDE6cV0NCgkjIEQgPC0gMS9zcXJ0KGRpYWcoVykpDQoJ
cmV0dXJuKEQpDQp9DQoNCkVycm9yUmF0ZSA8LSBmdW5jdGlvbihkaXNjcmlt
LCBuKQ0Kew0KCWZvbmUgPC0gc3VtKGFzLmludGVnZXIoZGlzY3JpbVsxOm5d
KS0xKS9uDQoJZm51bGwgPC0gKG4gLSBzdW0oYXMuaW50ZWdlcihkaXNjcmlt
WyhuKzEpOigyKm4pXSktMSkpL24NCgkjIGNhdCgiZm51bGw6ICIsIGZudWxs
LCAiIGZvbmUgIiwgZm9uZSwgIlxuIikgDQoJKGZudWxsICsgZm9uZSkvMg0K
fQ0KDQpzaW0xIDwtIGZ1bmN0aW9uKE4sbSxuLCBtdTAsIG11MSwgUykNCnsN
CgllcnJTdGFuZCA8LSBjKCkNCgllcnJTUyA8LSBjKCkNCg0KCWZvciAoaSBp
biAxOk4pDQoJew0KCQlsZWFyblggPC0gbXZybm9ybShtLCBtdTAsIFMpDQoJ
CWxlYXJuWSA8LSBtdnJub3JtKG0sIG11MSwgUykNCgkJZ3JvdXBpbmcgPC0g
YyhyZXAoMCwgbSksIHJlcCgxLCBtKSkNCgkJbGRhU3RhbmQgPC0gbGRhKHJi
aW5kKGxlYXJuWCwgbGVhcm5ZKSwgZ3JvdXBpbmcpDQoJCUQgPC0gU1NsZGEo
bGVhcm5YLCBsZWFyblksIDQpDQoJCUEgPC0gcmJpbmQobGVhcm5YLCBsZWFy
blkpJSolRA0KCQlsZGFTUyA8LSBsZGEoQSwgZ3JvdXBpbmcpDQoJCXRlc3RY
IDwtIG12cm5vcm0obiwgbXUwLCBTKQ0KCQl0ZXN0WSA8LSBtdnJub3JtKG4s
IG11MSwgUykNCgkJZGlzY3JTdGFuZCA8LSBwcmVkaWN0LmxkYShsZGFTdGFu
ZCwgcmJpbmQodGVzdFgsIHRlc3RZKSkkY2xhc3MNCgkJZGlzY3JTUyA8LSBw
cmVkaWN0LmxkYShsZGFTUywgcmJpbmQodGVzdFgsIHRlc3RZKSUqJUQpJGNs
YXNzDQoJCWVyclN0YW5kIDwtIGMoZXJyU3RhbmQsIEVycm9yUmF0ZShkaXNj
clN0YW5kLCBuKSkNCgkJZXJyU1MgPC0gYyhlcnJTUywgRXJyb3JSYXRlKGRp
c2NyU1MsIG4pKQ0KCQljYXQoIlN0YW5kOiAiLCBlcnJTdGFuZFtpXSwgIiBT
UzogIiwgZXJyU1NbaV0sICJcbiIpDQogCX0NCgljYXQoIkVycm9yIFJhdGUg
U3RhbmRhcmQgTERBOiAiLCBtZWFuKGVyclN0YW5kKSwgIlxuIikNCgljYXQo
IkVycm9yIFJhdGUgU1MgTERBOiAiLCBtZWFuKGVyclNTKSwgIlxuIikNCgly
ZXR1cm4obGlzdChlcnJTdGFuZCwgZXJyU1MpKQ0KfQ0KDQojIFMgPC0gbWF0
cml4KGMoMSwwLCAwLjUsIDAsIDAsIDEsIDAsIDAuOSwgMC41LCAwLCAyLCAw
LjMsIDAsIDAuOSwgMC4zLCAxKSwgNCwgNCkNClMgPC0gbWF0cml4KGMoMSww
LDAsMC45LDAsMSwwLDAsMCwwLDEsMCwwLjksMCwwLDEpLCA0LCA0KQ0KbXUw
IDwtIHJlcCgwLCA0KQ0KbXUxIDwtIHJlcCgxLCA0KQ0KbSA8LSBjKDUsNywx
MCwxNSwyMCw1MCwxMDApDQpuIDwtIDEwMDANCk4gPC0gMTAwDQoNCmVyciA8
LSBwbm9ybSgtMC41KnNxcnQodChtdTEgLSBtdTApJSolc29sdmUoUyklKiUo
bXUxIC0gbXUwKSkpDQpjYXQoIkVycm9yIHJhdGU6ICIsIGVyciwgIlxuIikN
Cg0KZUwgPC0gYygpDQplU1MgPC1jKCkNCg0KZm9yIChqIGluIG0pDQp7DQoJ
ZXN0ZXJyIDwtIHNpbTEoTiwgaiwgbiwgbXUwLCBtdTEsIFMpDQoJZUwgPC0g
YyhlTCwgbWVhbihlc3RlcnJbWzFdXSkpDQoJZVNTIDwtIGMoZVNTLCBtZWFu
KGVzdGVycltbMl1dKSkNCn0NCg0K
--1133331701-1931357602-965913218=:3057--

==> 630.audit <==
Mon Aug 14 14:27:34 2000	pd	moved from incoming to Accuracy
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 594 *
Subject: svd() (Linpack) problems/bug for ill-conditioned matrices
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Wed, 5 Jul 2000 18:32:01 +0200 (CEST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 594 <==
From maechler@stat.math.ethz.ch  Wed Jul  5 18:31:44 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA23143
	for <R-bugs@biostat.ku.dk>; Wed, 5 Jul 2000 18:31:44 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA21080
	for <R-bugs@stat.math.ethz.ch>; Wed, 5 Jul 2000 18:32:04 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa0059L; Wed Jul  5 18:32:02 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id SAA08851; Wed, 5 Jul 2000 18:32:01 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14691.25345.790844.876878@gargle.gargle.HOWL>
Date: Wed, 5 Jul 2000 18:32:01 +0200 (CEST)
To: R-bugs@stat.math.ethz.ch
Subject: svd() (Linpack) problems/bug for ill-conditioned matrices
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>


After fixing princomp(), recently,
	    {tiny negative eigen-values are possible for non-negative
	     definite matrices} 
Fritz Leisch drew my attention to the fact the not only eigen() can be
funny, but also svd().

Adrian Trappleti found that the singular values returned 
can be "-0" instead of "0".  This will be a problem in something like

    sd <- svd(Mat) $ d
    max(sd) / min(sd)

which gives  -Inf  instead of Inf in the above case.

I did some more searching and testing with svd(), could easily 
reproduce the "-0" problem,

    hilbert <- function(n, k=n) { i <- 1:n; 1 / outer(i - 1, i[1:k], "+") }

    M1 <- cbind(hilbert(12,8), pi*1e-15, 0)
    (sd <- svd(M1, nu=0, nv=0) $ d)
    sd[1] / sd[10] #--> -Inf  

but even worse:  On both Solaris (2.5.1, gcc 2.95.1, 
				  f77 "WorkShop Compilers 4.2"
                 and Linux (Redhat 6.2, enhanced with gcc 2.95.2;
			    g77 version egcs-2.91.66 19990314/Linux 
				(egcs-1.1.2 release) 
				(from FSF-g77 version 0.5.24-19981002)
I have managed to make svd() stop with
something like "error  170  in dsvdc"  which basically comes from the
underlying LINPACK routine DSVDC() which did not converge in 30 QR iterations.
example code appended
--- The examples I've found are machine dependent and disjoint for Linux &
Solaris.

HOWEVER:  S-PLUS 5.1 on both machines does NOT fail for the identical
	  matrices!
S-PLUS has basically	.Fortran("dsvdcs" ,
and looks like it is calling Linpack as well, but note that the subroutine
has an extra "s" appended (``S version of Linpack'' ??).

---

Then I had a short look at GSL (GNU scientific library) 
			http://sourceware.cygnus.com/gsl/
which calls a LAPACK (instead of LINPACK) routine for svd  which seems to
use Householder- instead of QR- iterations...

The whole makes me think that we should really shift away from Linpack and
towards Lapack for R's numerical linear algebra....

Here is my code which gives both an error (but not the same!) for R
on Linux and Solaris and all runs through S-PLUS 5.1 on both machines.


hilbert <- function(n) { i <- 1:n; 1 / outer(i - 1, i, "+") }
## "better":
hilbert <- function(n, k=n) { i <- 1:n; 1 / outer(i - 1, i[1:k], "+") }

M1 <- cbind(hilbert(12,8), 3.14e-15, 0)
M2 <- cbind(hilbert(15,8), .2,0)
H2c <- hilbert(200,180)

## Gives SVD error "error  170  in dsvdc" on (MM's) Solaris :
ii.sol <- c(87, 40, 120, 164, 93, 98, 108, 156, 77, 52, 127, 50, 58, 123,
        17, 147, 10, 152, 103, 136, 20, 34, 6, 30, 44, 130, 47, 35, 168,
        4, 115, 3, 29, 71, 56, 128, 90, 18, 60, 25, 125, 74, 91, 16,
        9, 111, 46, 137, 53, 110, 21, 94, 78, 104, 100, 99, 76, 126,
        62, 61, 117, 54, 140, 66, 150, 19, 149, 114, 63, 139, 2, 166,
        135, 23, 107, 8, 158, 39, 69, 75, 92, 112, 86, 124, 13, 118,
        151, 80, 146, 68, 43, 159, 36, 31, 144, 85, 122, 141, 11, 167,
        157, 1, 132, 97, 133, 79, 138, 49, 45, 72, 119, 84, 59, 131,
        5, 22, 116, 154, 142, 48, 73, 67, 161, 7, 155, 42, 41, 143, 57,
        33, 162, 102, 134, 101, 37, 148, 64, 160, 24, 27, 55, 83, 121,
        38, 106, 113, 28, 109, 70, 14, 32, 12, 65, 96, 129, 89, 163,
        88, 105, 15, 95, 145, 81, 165, 51, 153, 82, 169, 26)
H2c.sol <- cbind(H2c[,ii.sol], 1)

## NEW rec: -9.413e+14 ; nc =  164
## Gives SVD error 165 on Linux:
ii <- c(34, 101, 120, 53, 140, 108, 112, 9, 10, 96, 154, 89, 17, 131,
        130, 123, 126, 51, 95, 85, 147, 87, 132, 60, 58, 64, 150, 139,
        116, 36, 78, 107, 118, 104, 127, 61, 82, 84, 63, 23, 114, 124,
        83, 162, 55, 99, 50, 141, 8, 24, 25, 19, 65, 15, 2, 143, 145,
        148, 138, 136, 57, 22, 26, 1, 152, 129, 21, 69, 59, 20, 163,
        98, 92, 106, 88, 56, 70, 117, 37, 48, 115, 79, 68, 142, 4, 122,
        76, 28, 155, 29, 45, 13, 30, 47, 62, 31, 121, 119, 125, 74, 144,
        27, 93, 100, 71, 40, 149, 16, 157, 41, 33, 113, 133, 54, 14,
        156, 11, 97, 72, 75, 77, 49, 111, 128, 18, 35, 42, 6, 160, 32,
        3, 91, 66, 73, 44, 39, 81, 90, 153, 135, 43, 151, 159, 102, 161,
        12, 110, 5, 164, 67, 80, 46, 94, 7, 105, 134, 38, 146, 86, 103,
        137, 52, 158, 109)
H2c.lin <- cbind(H2c[,ii], 1)


(sd <- svd(M1, nu=0, nv=0) $ d) ; sd[1] / sd[length(sd)] #--> -Inf
(sd <- svd(M2, nu=0, nv=0) $ d) ; sd[1] / sd[length(sd)] #--> -Inf

summary(svd(H2c.sol)$d)## Error on Solaris only

summary(svd(H2c.lin)$d)## Error on Linux only (RH 6.2, gcc 2.95.2)
## BTW: quite a strong negative ratio
range( ev <- eigen(var(H2c.lin), only=T)$val )
ev[1] / ev[length(ev)] # -5.868e+15 (solaris);  -1.2115e+16 (linux)

### Try different  ii  and always do the following line :
summary(svd(cbind(H2c[,ii], 1))$d)


## BTW: Negative Eigenvalues
range( eigen(var(M2), only=T)$val )







==> 594.audit <==
Fri Jul 07 06:53:38 2000	maechler	moved from incoming to Accuracy
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Add-ons

* PR# 567 *
Subject: ctest not works
From: George Diniz <george@cpqam.fiocruz.br>
Date: Sun, 12 Mar 2000 12:03:45 -0200
--possibly the RH6.2 Fortran bug
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 567 <==
From george@cpqam.fiocruz.br  Mon Jun 12 13:10:28 2000
Received: from nicc.cpqam.fiocruz.br ([200.133.26.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA15969
	for <r-bugs@biostat.ku.dk>; Mon, 12 Jun 2000 13:09:18 +0200 (MET DST)
Received: from cpqam.fiocruz.br (george@[200.199.8.147] (may be forged))
	by nicc.cpqam.fiocruz.br (8.8.6/8.8.6) with ESMTP id MAA20120
	for <r-bugs@biostat.ku.dk>; Sun, 11 Jun 2000 12:19:28 -0300 (EST)
Sender: george@cpqam.fiocruz.br
Message-ID: <38CBA3C1.136B513D@cpqam.fiocruz.br>
Date: Sun, 12 Mar 2000 12:03:45 -0200
From: George Diniz <george@cpqam.fiocruz.br>
X-Mailer: Mozilla 4.72 [en] (X11; U; Linux 2.2.14-5.0 i586)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@biostat.ku.dk
Subject: ctest not works
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

I try load ctest, and don't have sucess

> library(ctest)
Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to
load shared library "/usr/local/lib/R/library/ctest/libs/ctest.so":
  /usr/local/lib/R/library/ctest/libs/ctest.so: undefined symbol: ÝfÔ

What I must to do

I will waiting  your answer

George Diniz


==> 567.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon Jun 12 13:49:16 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA16056
	for <R-bugs@biostat.ku.dk>; Mon, 12 Jun 2000 13:49:15 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id NAA23885;
	Mon, 12 Jun 2000 13:53:14 +0200
Sender: pd@blueberry.kubism.ku.dk
To: george@cpqam.fiocruz.br
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] ctest not works (PR#567)
References: <200006121110.NAA15979@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 12 Jun 2000 13:53:14 +0200
In-Reply-To: george@cpqam.fiocruz.br's message of "Mon, 12 Jun 2000 13:10:29 +0200 (MET DST)"
Message-ID: <x24s6z6rpx.fsf@blueberry.kubism.ku.dk>
Lines: 21
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit

george@cpqam.fiocruz.br writes:

> I try load ctest, and don't have sucess
> 
> > library(ctest)
> Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to
> load shared library "/usr/local/lib/R/library/ctest/libs/ctest.so":
>   /usr/local/lib/R/library/ctest/libs/ctest.so: undefined symbol: ÝfÔ
> 
> What I must to do
> 
> I will waiting  your answer

First of all tell us what system you are on. With that information,
all we can say is that that is not what is supposed to happen...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 567.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Jun 12 13:58:40 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA16101;
	Mon, 12 Jun 2000 13:58:40 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id MAA00504;
	Mon, 12 Jun 2000 12:57:35 +0100 (BST)
Message-Id: <200006121157.MAA00504@toucan.stats.ox.ac.uk>
Date: Mon, 12 Jun 2000 12:57:35 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] ctest not works (PR#567)
To: george@cpqam.fiocruz.br, p.dalgaard@biostat.ku.dk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=ISO-8859-1
Content-MD5: B/7rml5xc3D4PsEG7Znu0A==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 
Content-Transfer-Encoding: 8bit
X-MIME-Autoconverted: from QUOTED-PRINTABLE to 8bit by pubhealth.ku.dk id NAA16101


> To: george@cpqam.fiocruz.br
> From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
> Date: 12 Jun 2000 13:53:14 +0200
> 
> george@cpqam.fiocruz.br writes:
> 
> > I try load ctest, and don't have sucess
> > 
> > > library(ctest)
> > Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to
> > load shared library "/usr/local/lib/R/library/ctest/libs/ctest.so":
> >   /usr/local/lib/R/library/ctest/libs/ctest.so: undefined symbol: ÝfÔ
> > 
> > What I must to do
> > 
> > I will waiting  your answer
> 
> First of all tell us what system you are on. With that information,
> all we can say is that that is not what is supposed to happen...

True, but we can tell you:

This is Linux/Unix not Windows (and not HP either).

That silly symbol name suggests that this is the Fortran bug in RH6.2
we have met before.  If so, the solution is to compile with gcc-2.95.2.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 567.audit <==
Wed Jun 21 12:02:24 2000	ripley	changed notes
Wed Jun 21 12:02:24 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 503 *
Subject: dmvnorm() bug in e1071
From: "Gregory R. Warnes" <warnes@biostat.washington.edu>
Date: Fri, 24 Mar 2000 03:24:45 +0000 (GMT)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 503 <==
From warnes@warnes.net  Fri Mar 24 20:26:17 2000
Received: from hydra.warnes.net (mail@c877378-a.sttln1.wa.home.com [24.9.60.166])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA06279
	for <r-bugs@biostat.ku.dk>; Fri, 24 Mar 2000 20:25:43 +0100 (MET)
Received: from warnes (helo=localhost)
	by hydra.warnes.net with local-esmtp (Exim 3.12 #1 (Debian))
	id 12YKiM-0003AT-00
	for <r-bugs@biostat.ku.dk>; Thu, 23 Mar 2000 19:24:46 -0800
Date: Fri, 24 Mar 2000 03:24:45 +0000 (GMT)
From: "Gregory R. Warnes" <warnes@biostat.washington.edu>
X-Sender: warnes@hydra.warnes.net
To: r-bugs@biostat.ku.dk
Subject: dmvnorm() bug in e1071
Message-ID: <Pine.LNX.4.21.0003240321480.575-100000@hydra.warnes.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Sender: "Gregory R. Warnes" <warnes@warnes.net>


When dmvnorm is applied to matrices it fails.  The offending lines are

  if (length(x) != ncol(sigma)) {
    stop("x and sigma have non-conforming size")
  }

which works fine if x is a dataframe, but not if x is a matrix.

Replacing this test with

  if (ncol(x) != ncol(sigma)) {
    stop("x and sigma have non-conforming size")
  }

Corrects the problem, and still works for data frames and
vectors.  (Vectors have already been converted to matrices).

-Gregory


==> 503.audit <==
Sat Mar 25 09:48:26 2000	maechler	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 496 *
From: bonneau@epi.roazhon.inra.fr (en148)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
--base R has no est.variogram function.
--This appears to be a bug report on sgeostat.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 496 <==
From bonneau@epi.roazhon.inra.fr  Tue Mar 21 11:40:23 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA24613
	for <R-bugs@biostat.ku.dk>; Tue, 21 Mar 2000 11:40:21 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA00472
	for <r-bugs@hypatia.math.ethz.ch>; Tue, 21 Mar 2000 11:40:33 +0100 (MET)
Received: from epi.roazhon.inra.fr(194.167.76.1)
 via SMTP by hypatia, id smtpdAAAa0007L; Tue Mar 21 11:40:28 2000
Received: from (bonneau@localhost)
          by epi.roazhon.inra.fr (8.8.8/jtpda-5.3) id KAA09010
          for r-bugs@lists.r-project.org; Tue, 21 Mar 2000 10:57:13 +0100 (MET)
Date: Tue, 21 Mar 2000 10:57:13 +0100 (MET)
From: bonneau@epi.roazhon.inra.fr (en148)
Message-Id: <200003210957.KAA09010@epi.roazhon.inra.fr>

I am using R 0.65.1 under linux (Redhat 6.0),
and I have a problem with the est.variogram function when the first lag is empty (I am trying to estimate anisotropic varios)

fittedpnt<-point(fitted, x="X2", y="X3")
fittedpair<-pair(fittedpnt, num.lags=15, type="anisotropic", theta=60, dtheta=20, maxdist=maxfittedist)
fittedvario<-est.variogram(fittedpnt, fittedpair, "fit")

With my datas I have no pair in lags 1 to 3 and the error message is :
Error in psort(x, partial) : index 0 outside bounds

What can I do, in order to fix the bug ?

==> 496.audit <==
Sat Apr 01 07:32:27 2000	ripley	changed notes
Sat Apr 01 07:32:27 2000	ripley	moved from incoming to Add-ons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Analyses

none

Directory:  Documentation

none

Directory:  Graphics

* PR# 639 *
Subject: symbols: xlim and ylim cannot be specified
From: Werner Stahel <stahel@stat.math.ethz.ch>
Date: Mon, 21 Aug 2000 15:54:08 +0200 (CEST)
--Fixed for 1.1.2 (?)
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 639 <==
From stahel@stat.math.ethz.ch  Mon Aug 21 15:53:55 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA20286
	for <r-bugs@biostat.ku.dk>; Mon, 21 Aug 2000 15:53:55 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id PAA07297
	for <r-bugs@biostat.ku.dk>; Mon, 21 Aug 2000 15:54:14 +0200 (MET DST)
Received: from erna-w(129.132.58.19), claiming to be "erna-w.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa001lz; Mon Aug 21 15:54:09 2000
Received: (stahel@localhost) by erna-w.ethz.ch (8.9.3/D-MATH-client) id PAA01559; Mon, 21 Aug 2000 15:54:08 +0200
X-Authentication-Warning: erna-w.ethz.ch: stahel set sender to stahel@erna-w using -f
From: Werner Stahel <stahel@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14753.13440.845085.232975@gargle.gargle.HOWL>
Date: Mon, 21 Aug 2000 15:54:08 +0200 (CEST)
To: r-bugs@biostat.ku.dk
Subject: symbols: xlim and ylim cannot be specified
X-Mailer: VM 6.75 under Emacs 20.7.1


symbols(iris[,1],iris[,2],rectangles=as.matrix(iris[,3:4]),inches=0.3,
   ylim=c(1,5))
Error in plot.default(NA, NA, type = "n", ylim = ylim, xlim = xlim, xlab = xlab,  : 
	formal argument "ylim" matched by multiple actual arguments

Since plot is called inside symbols, with specified xlim and ylim,
any specification through  ,...  hurts this call.

I am pretty sure that you won't like to hear the suggestion that
this error message 
  formal argument "anything" matched by multiple actual arguments
should only be a warning.
I would find this more convenient since foreseeing these collisions
and programming such arguments as explicit arguments of the "top" function
is a nuisance when writing functions just for one project.

Ceterum censeo: Thanks for your efforts for developing such a useful
                environment. 

Werner 

--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status =
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, d.complexity, package:SfS, Autoloads, package:base

-- 
Werner Stahel

------------------ This message was sent by ---------------------------------
Werner Stahel                                     http://stat.ethz.ch/~stahel
Seminar fuer Statistik                               phone  : +41 1 632 34 30
ETH-Zentrum, LEO                                     fax    : +41 1 632 12 28
CH-8092 Zurich, Switzerland                          meet me: Leonhardstr. 27
-----------------------------------------------------------------------------

==> 639.reply.1 <==
From maechler@stat.math.ethz.ch  Tue Aug 22 09:00:09 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA24615
	for <R-bugs@biostat.ku.dk>; Tue, 22 Aug 2000 09:00:08 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id JAA04193;
	Tue, 22 Aug 2000 09:00:24 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa0010m; Tue Aug 22 09:00:18 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id JAA02817; Tue, 22 Aug 2000 09:00:18 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14754.9474.313719.691588@gargle.gargle.HOWL>
Date: Tue, 22 Aug 2000 09:00:18 +0200 (CEST)
To: Uwe Ligges <ligges@statistik.uni-dortmund.de>
Cc: R-bugs@stat.math.ethz.ch, stahel@stat.math.ethz.ch
Subject: Re: [Rd] symbols: xlim and ylim cannot be specified (PR#639)
In-Reply-To: <39A1561F.65F06784@statistik.uni-dortmund.de>
References: <200008211353.PAA20296@pubhealth.ku.dk>
	<39A1561F.65F06784@statistik.uni-dortmund.de>
X-Mailer: VM 6.75 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "Uwe" == Uwe Ligges <ligges@statistik.uni-dortmund.de> writes:

    Uwe> stahel@stat.math.ethz.ch wrote:
    >> 
    >> symbols(iris[,1],iris[,2],rectangles=as.matrix(iris[,3:4]),inches=0.3,
    >>         ylim=c(1,5))
    >> Error in plot.default(NA, NA, type = "n", ylim = ylim, xlim = xlim, xlab = xlab,  :
    >> formal argument "ylim" matched by multiple actual arguments
    >> 
    >> Since plot is called inside symbols, with specified xlim and ylim,
    >> any specification through  ,...  hurts this call.
yes,
and Uwe's fix cures this problem.
    [Uwe, you should have CC'ed  R-bugs, not (only) R-devel .. that's why I
     copy it again now].

and I have committed it for the release patches (!! i.e. "1.1.1 patched")

    >> I am pretty sure that you won't like to hear the suggestion that
    >> this error message
    >>    formal argument "anything" matched by multiple actual arguments
    >>    should only be a warning.

    >> I would find this more convenient since foreseeing these collisions
    >> and programming such arguments as explicit arguments of the "top"
    >> function is a nuisance when writing functions just for one project.

Maybe this should be discussed a bit:
The error can only be made into a warning when it makes sense to assume
that it is always okay, to take the *LAST* actual argument as the 
desired one.   This is the case probably whenever "..." comes at the end of the
formal argument list -- which it is in about 95% of cases...

Hmm, what do others think?

    >> Ceterum censeo: Thanks for your efforts for developing such a useful
    >> environment.
Merci!

    Uwe> Suggestion for a fix:

      function (x, y, circles, squares, rectangles, stars, thermometers, 
	  boxplots, inches = TRUE, add = FALSE, fg = 1, bg = NA, xlab = "", 
	  ylab = "", xlim = NULL, ylim = NULL, ...) 
		     ^^^^^^^^^^^^^^^^^^^^^^^^^
      {
      ## [...] snip ##
	if (!add) { 
      ### check, wheter xlim and ylim are already specified:
	      if(is.null(xlim)) {
		  xlim <- range(x, na.rm = TRUE)
		  xlim <- xlim + c(-1, 1) * (0.1 * diff(xlim))
	      }
	      if(is.null(ylim)) {
		  ylim <- range(y, na.rm = TRUE)
		  ylim <- ylim + c(-1, 1) * (0.1 * diff(ylim))
	      }
	      plot(NA, NA, type = "n", ylim = ylim, xlim = xlim, xlab = xlab, 
		  ylab = ylab, ...)
	  }
	  .Internal(symbols(x, y, type, data, inches, bg, fg, ...))
      }

    Uwe> Regards,
    Uwe> Uwe Ligges

Martin Maechler

==> 639.followup.1 <==
From ripley@stats.ox.ac.uk  Tue Aug 22 09:45:44 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA25718
	for <R-bugs@biostat.ku.dk>; Tue, 22 Aug 2000 09:45:44 +0200 (MET DST)
Received: from max95.public.ox.ac.uk (max95.public.ox.ac.uk [192.76.27.95])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id IAA13336;
	Tue, 22 Aug 2000 08:45:59 +0100 (BST)
Date: Tue, 22 Aug 2000 08:45:16 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: maechler@stat.math.ethz.ch
cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] symbols: xlim and ylim cannot be specified (PR#639)
In-Reply-To: <200008220700.JAA24625@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10008220841500.9118-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Tue, 22 Aug 2000 maechler@stat.math.ethz.ch wrote:

> >>>>> "Uwe" == Uwe Ligges <ligges@statistik.uni-dortmund.de> writes:
> 
>     Uwe> stahel@stat.math.ethz.ch wrote:
>     >> 
>     >> symbols(iris[,1],iris[,2],rectangles=as.matrix(iris[,3:4]),inches=0.3,
>     >>         ylim=c(1,5))
>     >> Error in plot.default(NA, NA, type = "n", ylim = ylim, xlim = xlim, xlab = xlab,  :
>     >> formal argument "ylim" matched by multiple actual arguments
>     >> 
>     >> Since plot is called inside symbols, with specified xlim and ylim,
>     >> any specification through  ,...  hurts this call.
> yes,
> and Uwe's fix cures this problem.
>     [Uwe, you should have CC'ed  R-bugs, not (only) R-devel .. that's why I
>      copy it again now].
> 
> and I have committed it for the release patches (!! i.e. "1.1.1 patched")

Why is using NULL preferable here?  The standard paradigm as I understand
it is


         ylab = "", xlim, ylim, ...)
...
            if(missing(xlim)) {
                xlim <- range(x, na.rm = TRUE)
                xlim <- xlim + c(-1, 1) * (0.1 * diff(xlim))
            }

In S there is a problem with passing down missingness, but not in R.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 639.audit <==
Thu Sep 07 06:21:32 2000	ripley	changed notes
Thu Sep 07 06:21:32 2000	ripley	moved from incoming to Graphics
Thu Sep 07 06:22:05 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 625 *
Subject: Re: [Rd] Re: [R] problem clipping R postscript plots within latex
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Wed, 2 Aug 2000 21:38:31 +0100 (GMT Daylight Time)
--Believed to be fixed in 1.2. Patch on r-bugs website.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 625 <==
From ripley@stats.ox.ac.uk  Wed Aug  2 22:39:37 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA03132;
	Wed, 2 Aug 2000 22:39:36 +0200 (MET DST)
Received: from max147.public.ox.ac.uk (max147.public.ox.ac.uk [192.76.27.147])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id VAA25055;
	Wed, 2 Aug 2000 21:39:54 +0100 (BST)
Date: Wed, 2 Aug 2000 21:38:31 +0100 (GMT Daylight Time)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
To: p.dalgaard@biostat.ku.dk
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Re: [R] problem clipping R postscript plots within latex
 (PR#623)
In-Reply-To: <200008021255.OAA00687@pubhealth.ku.dk>
Message-ID: <Pine.WNT.4.05.10008022134410.230-100000@tern.stats>
Sender: ripley@stats.ox.ac.uk
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 2 Aug 2000 p.dalgaard@biostat.ku.dk wrote:

> Martin Maechler <maechler@stat.math.ethz.ch> writes:
> 
> > (from R-help)
> >     PD> Stephen Eglen <stephen@cogsci.ed.ac.uk> writes:
> > 
> >     >  > > generated by R into a latex document.  Specifically, the latex package
> >     >  > > graphicsx allow you to specify the bounding box of the postscript
> >     >  > > file, so that you can just show _part_ of the postscript file if you
> >     >  > > tell it to also clip the area outside of the bounding box.
> >     > ...
> >     >  > Ow. This stems from the use of "initclip" in the R-generated PS. One
> >     >  > shouldn't do that, one should bracket clipped graphics within
> >     >  > gsave/grestore instead. Sounds a bit tricky to get right.
> >     > 
> >     > Thanks.  To solve my current problem, I changed the definition of the
> >     > `cl' operator in the postscript file to:
> >     > 
> >     > /cl  { gsave initclip newpath 3 index 3 index moveto 1 index
> >     >        4 -1 roll lineto  exch 1 index lineto lineto
> >     >        closepath clip grestore newpath } def
> >     > 
> >     > [i.e. just adding the gsave ... grestore pair]
> >     > 
> >     > Whether this is the proper solution though is another matter...
> > 
> >     PD> It isn't. It grestore-s before actually plotting the stuff that
> >     PD> needs to be clipped, so effectively you just disabled R's
> >     PD> clipping. A better way would be to start the plotting with a "gs"
> >     PD> and have
> > 
> >     /cl  { gr gs newpath 3 index 3 index moveto 1 index
> > 	   4 -1 roll lineto  exch 1 index lineto lineto
> > 	   closepath clip newpath } def
> > 
> >     PD> and end everything with a "gr". Not too sure that is perfectly
> >     PD> safe, though...
> > 
> > Are you working on this, Peter?
> > Otherwise, "R-bugs" should probably get about the above report..
> 
> Done... 

Just to note that ?postscript says

    The postscript produced by R is EPS (Encapsulated PostScript)
    compatible,

yet initclip is not allowed in EPS files (PostScript Language Reference
Manual, 2nd edition).  I think the statement was possibly true once ....

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 625.reply.1 <==
From pd@blueberry.kubism.ku.dk  Thu Aug  3 17:26:08 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA10115
	for <R-bugs@biostat.ku.dk>; Thu, 3 Aug 2000 17:26:08 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id RAA30504;
	Thu, 3 Aug 2000 17:32:40 +0200
Sender: pd@blueberry.kubism.ku.dk
To: ripley@stats.ox.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Re: [R] problem clipping R postscript plots within latex (PR#625)
References: <200008022039.WAA03146@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 03 Aug 2000 17:32:39 +0200
In-Reply-To: ripley@stats.ox.ac.uk's message of "Wed, 2 Aug 2000 22:39:38 +0200 (MET DST)"
Message-ID: <x2hf92bbs8.fsf@blueberry.kubism.ku.dk>
Lines: 45
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

ripley@stats.ox.ac.uk writes:

> > >     /cl  { gr gs newpath 3 index 3 index moveto 1 index
> > > 	   4 -1 roll lineto  exch 1 index lineto lineto
> > > 	   closepath clip newpath } def
> > > 
> > >     PD> and end everything with a "gr". Not too sure that is perfectly
> > >     PD> safe, though...


>     The postscript produced by R is EPS (Encapsulated PostScript)
>     compatible,
> 
> yet initclip is not allowed in EPS files (PostScript Language Reference
> Manual, 2nd edition).  

Exactly. 

> I think the statement was possibly true once ....

I don't think so. This is a design problem.

Unfortunately, the simple fix above doesn't seem to work [for rather
foreseeable reasons]. mosaicplot() seems to crash ghostview and even
plot(1:10) comes out without axis titles. 

The latter item occurs because we're doing

clip(region1)
set font
draw text
clip(region2)
draw more text in same font

but restoring the graphics context prior to the first clipping 
requires the font to be set once again. And there are probably many
similar problems. Sigh. 

Paul, are you around?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 625.followup.1 <==
From paul@stat.auckland.ac.nz  Fri Aug  4 01:01:37 2000
Received: from mailhost.auckland.ac.nz (mailhost.auckland.ac.nz [130.216.1.4])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA11427;
	Fri, 4 Aug 2000 01:01:33 +0200 (MET DST)
Received: from stat1.stat.auckland.ac.nz (stat1.stat.auckland.ac.nz [130.216.93.1])
	by mailhost.auckland.ac.nz (8.9.2/8.9.2/8.9.2-ua) with ESMTP id LAA07027;
	Fri, 4 Aug 2000 11:01:49 +1200 (NZST)
Received: from murrell (murrell.stat.auckland.ac.nz [130.216.93.23])
	by stat1.stat.auckland.ac.nz (8.9.3+Sun/8.8.8) with SMTP id LAA18617;
	Fri, 4 Aug 2000 11:01:48 +1200 (NZST)
Message-ID: <003d01bffda0$6e4fee30$175dd882@stat.auckland.ac.nz>
From: "Paul Murrell" <paul@stat.auckland.ac.nz>
To: <ripley@stats.ox.ac.uk>, "Peter Dalgaard BSA" <p.dalgaard@biostat.ku.dk>
Cc: <r-devel@stat.math.ethz.ch>, <R-bugs@biostat.ku.dk>
References: <200008022039.WAA03146@pubhealth.ku.dk> <x2hf92bbs8.fsf@blueberry.kubism.ku.dk>
Subject: Re: [Rd] Re: [R] problem clipping R postscript plots within latex (PR#625)
Date: Fri, 4 Aug 2000 11:13:27 +1200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.00.2014.211
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2014.211

hi


> > yet initclip is not allowed in EPS files (PostScript Language Reference
> > Manual, 2nd edition).
>
> Exactly.
>
> > I think the statement was possibly true once ....
>
> I don't think so. This is a design problem.
>
> Unfortunately, the simple fix above doesn't seem to work [for rather
> foreseeable reasons]. mosaicplot() seems to crash ghostview and even
> plot(1:10) comes out without axis titles.
>
> The latter item occurs because we're doing
>
> clip(region1)
> set font
> draw text
> clip(region2)
> draw more text in same font
>
> but restoring the graphics context prior to the first clipping
> requires the font to be set once again. And there are probably many
> similar problems. Sigh.
>
> Paul, are you around?


Yes I'm around (I'm just concealed by my teaching load).  However, I may not
be much help.  This seems to be a problem with the definitions in the
postscript file header (set up in PSFileHeader).  [Trying not to sound like
I'm dodging a bullet ...] I have never delved too deeply into these so I
cannot really comment on their goodness or badness.  AFAIK this is all
pretty original stuff (by Ross ?), but I'm not sure what it was based on.
Something Ross has mentioned to me a couple of times is a library which
allows you to write C-like code which then gets processed into (correct,
efficient) postscript.  Maybe this would be a good solution (i.e., piggyback
on some other code which has got all of the postscript stuff properly sorted
out).  Sorry I can't be more help at this stage.

paul



==> 625.reply.2 <==
From pd@blueberry.kubism.ku.dk  Fri Aug  4 17:38:57 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA19524;
	Fri, 4 Aug 2000 17:38:56 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id RAA30378;
	Fri, 4 Aug 2000 17:45:43 +0200
Sender: pd@blueberry.kubism.ku.dk
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Cc: ripley@stats.ox.ac.uk, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Re: [R] problem clipping R postscript plots within latex (PR#625)
References: <200008022039.WAA03146@pubhealth.ku.dk> <x2hf92bbs8.fsf@blueberry.kubism.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 Aug 2000 17:45:42 +0200
In-Reply-To: Peter Dalgaard BSA's message of "03 Aug 2000 17:32:39 +0200"
Message-ID: <x2u2d158t5.fsf@blueberry.kubism.ku.dk>
Lines: 70
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

> ripley@stats.ox.ac.uk writes:
> 
> > > >     /cl  { gr gs newpath 3 index 3 index moveto 1 index
> > > > 	   4 -1 roll lineto  exch 1 index lineto lineto
> > > > 	   closepath clip newpath } def
> > > > 
> > > >     PD> and end everything with a "gr". Not too sure that is perfectly
> > > >     PD> safe, though...
...
> 
> Unfortunately, the simple fix above doesn't seem to work [for rather
> foreseeable reasons]. mosaicplot() seems to crash ghostview and even
> plot(1:10) comes out without axis titles. 

However, fixing the font issue seems to have done the trick. Fix
committed to the development branch (to become R 1.2). I'm not
trusting that fix enough to let it go into 1.1.1.

Here's the patch in case someone needs it:


$ cvs diff -ur 1.29 src/main/devPS.c
Index: src/main/devPS.c
===================================================================
RCS file: /home/rdevel/CVS-ARCHIVE/R/src/main/devPS.c,v
retrieving revision 1.29
retrieving revision 1.30
diff -u -r1.29 -r1.30
--- src/main/devPS.c    2000/06/27 22:26:19     1.29
+++ src/main/devPS.c    2000/08/04 15:35:33     1.30
@@ -549,10 +549,10 @@
     fprintf(fp, "/gs  { gsave } def\n");
     fprintf(fp, "/gr  { grestore } def\n");
     if (landscape)
-       fprintf(fp, "/bp  { gs %.2f 0 translate 90 rotate} def\n", paperwidth);
+       fprintf(fp, "/bp  { gs %.2f 0 translate 90 rotate gs } def\n", paperwidth);
     else
-       fprintf(fp, "/bp  { gs } def\n");
-    fprintf(fp, "/ep  { showpage gr } def\n");
+       fprintf(fp, "/bp  { gs gs } def\n");
+    fprintf(fp, "/ep  { showpage gr gr } def\n");
     fprintf(fp, "/m   { moveto } def\n");
     fprintf(fp, "/l   { lineto } def\n");
     fprintf(fp, "/np  { newpath } def\n");
@@ -569,7 +569,7 @@
     fprintf(fp, "       ps mul neg 0 2 1 roll rmoveto\n");
     fprintf(fp, "       1 index stringwidth pop\n");
     fprintf(fp, "       mul neg 0 rmoveto show grestore } def\n");
-    fprintf(fp, "/cl  { initclip newpath 3 index 3 index moveto 1 index\n");
+    fprintf(fp, "/cl  { gr gs newpath 3 index 3 index moveto 1 index\n");
     fprintf(fp, "       4 -1 roll lineto  exch 1 index lineto lineto\n");
     fprintf(fp, "       closepath clip newpath } def\n");
     fprintf(fp, "/rgb { setrgbcolor } def\n");
@@ -1133,6 +1133,8 @@
     PostScriptDesc *pd = (PostScriptDesc *) dd->deviceSpecific;
 
     PostScriptSetClipRect(pd->psfp, x0, x1, y0, y1);
+    /* clipping does grestore so invalidate current font */
+    pd->fontsize = -1; 
 }
 
 static void PS_Resize(DevDesc *dd)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 625.audit <==
Mon Aug 07 13:16:55 2000	ripley	moved from incoming to Graphics
Mon Aug 14 13:58:36 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 202 *
Subject: persp box occlusion bug
From: wsi@gcal.ac.uk
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
--The persp algorithm does not apply the occlusion rules to the frame, 
--which is always plotted first. 
--A bug, but not very simple to fix.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 202 <==
From wsi@gcal.ac.uk  Wed Jun  2 15:02:10 1999
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA27126
	for <R-bugs@biostat.ku.dk>; Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
Date: Wed, 2 Jun 1999 15:02:03 +0200 (MET DST)
From: wsi@gcal.ac.uk
Message-Id: <199906021302.PAA27126@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: persp box occlusion bug

Full_Name: Bill Simpson
Version: 64.1
OS: linux
Submission from: (NULL) (193.62.250.209)


Bug in persp() bounding box:
If the surface being plotted extends below the lower z-axis boundary, the box
is
drawn with the wrong occlusion. The box is shown as being occluded by the
surface
even though it should be in front of the surface.

The box is correct for surface extending above the box. Problem is only for
surface extending below the box.

This exhibits the bug:

std<-rep(seq(-32,32,8),9)/1000 * 60
cf<-rep(seq(-32,32,8),rep(9,9))/1000 *60 
dp<-(cf-std)/.6
std<-unique(std)
cf<-unique(cf)
dp<-t(matrix(dp,length(cf),length(std)))
persp(std,cf,dp, xlim=c(-2,2), ylim=c(-2,2), zlim=c(0,5),theta=-40,    
phi=45,
box=TRUE,ltheta=-120, lphi=120,
d=1.5, shade=.7)


==> 202.audit <==
Wed Jun 30 19:31:18 1999	pd	moved from incoming to Graphics
Thu Jul 01 18:19:48 1999	pd	changed notes
Sun Feb 20 10:07:11 2000	ripley	changed notes
Mon Feb 28 17:17:51 2000	pd	changed notes
Mon Feb 28 17:18:28 2000	pd	changed notes
Mon Feb 28 17:19:35 2000	pd	changed notes
Mon Feb 28 17:20:17 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  In-Out

* PR# 649 *
Subject: Unable to read.table with > 256? columns
From: r@marksmucker.com
Date: Thu, 31 Aug 2000 07:28:02 +0200 (MET DST)
--Unable to reproduce from information supplied 
--(and there is no 256 col limit)
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 649 <==
From r@marksmucker.com  Thu Aug 31 07:28:02 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id HAA25028
	for <R-bugs@biostat.ku.dk>; Thu, 31 Aug 2000 07:28:02 +0200 (MET DST)
Date: Thu, 31 Aug 2000 07:28:02 +0200 (MET DST)
From: r@marksmucker.com
Message-Id: <200008310528.HAA25028@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Unable to read.table with > 256? columns

Full_Name: Mark Smucker
Version: 1.0.1
OS: Windows NT 4 sp 6
Submission from: (NULL) (216.122.46.200)



I'm trying to read in a large matrix (800 x 800 or bigger)
and R prints an error telling me that my rows are not
all the same length.  I've double checked the text file
using gawk and it tells me that they are all the same.

When I pair it down to 247 x 247, then it works, but not
when I have 289 x 289.  I'm guesing that there is some
hardcoded 256 column limit, but I could be wrong.

Otherwise, I'm loving R.  Thank you so much!

Mark



==> 649.followup.1 <==
From ripley@stats.ox.ac.uk  Thu Aug 31 08:24:39 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA25249
	for <R-bugs@biostat.ku.dk>; Thu, 31 Aug 2000 08:24:38 +0200 (MET DST)
Received: from max179.public.ox.ac.uk (max179.public.ox.ac.uk [192.76.27.179])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id HAA04651;
	Thu, 31 Aug 2000 07:24:52 +0100 (BST)
Date: Thu, 31 Aug 2000 07:23:53 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: r@marksmucker.com
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Unable to read.table with > 256? columns (PR#649)
In-Reply-To: <200008310528.HAA25038@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10008310708570.12521-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 31 Aug 2000 r@marksmucker.com wrote:

> Full_Name: Mark Smucker
> Version: 1.0.1
> OS: Windows NT 4 sp 6
> Submission from: (NULL) (216.122.46.200)
> 
> 
> 
> I'm trying to read in a large matrix (800 x 800 or bigger)
> and R prints an error telling me that my rows are not
> all the same length.  I've double checked the text file
> using gawk and it tells me that they are all the same.
> 
> When I pair it down to 247 x 247, then it works, but not
> when I have 289 x 289.  I'm guesing that there is some
> hardcoded 256 column limit, but I could be wrong.

Not that I know of.  But as you want to read a matrix, you will
do much better to use scan to read it as than has less overhead
and allows you to use much shorter lines in the file.  It will
just read consecutive numbers.  As in

A <- matrix(scan("file", what=0), 800, 800, byrow=TRUE)

> Otherwise, I'm loving R.  Thank you so much!

Yours is two versions old now, so please update to 1.1.1.

Here is my test (on 1.1.1 on Windows)

> x <- rnorm(300*300)
> write(x, "file", 300)
> A <- matrix(scan("file", what=0), 300, 300, byrow=TRUE)
> B <- as.matrix(read.table("file"))
> range(A-B)
[1] 0 0

So no limit and no problem. I no longer have a copy of 1.0.1 installed, so
if this is still a problem after you upgrade, can you please re-submit the
bug report with an example that actually fails for you.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 649.audit <==
Thu Sep 07 06:29:33 2000	ripley	changed notes
Thu Sep 07 06:29:33 2000	ripley	moved from incoming to In-Out
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Installation

* PR# 597 *
Subject: multiply defined symbols
From: plucas@csd.abdn.ac.uk
Date: Fri, 7 Jul 2000 12:23:44 +0200 (MET DST)
--Probably system-specific due to use of fort77
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 597 <==
From plucas@csd.abdn.ac.uk  Fri Jul  7 12:23:44 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA07677
	for <R-bugs@biostat.ku.dk>; Fri, 7 Jul 2000 12:23:44 +0200 (MET DST)
Date: Fri, 7 Jul 2000 12:23:44 +0200 (MET DST)
From: plucas@csd.abdn.ac.uk
Message-Id: <200007071023.MAA07677@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: multiply defined symbols

Full_Name: Peter Lucas
Version: 1.1.0
OS: redHat 6.2 Linux
Submission from: (NULL) (139.133.200.15)


I tried to install R 1.1.0 on my i686 PC with Redhat 6.2 Linux on it.
I am using fort77 with f2c. I am not able to build R, as libc.a contains
regex.o, causing a conflict with src/main/regex.o. the ONEWS mentions
that this problem was solved, but it obviously was not. I am not a real
Unix hacker, so I wonder how to proceed.

Peter

==> 597.reply.1 <==
From pd@blueberry.kubism.ku.dk  Fri Jul  7 16:43:29 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA10694
	for <R-bugs@biostat.ku.dk>; Fri, 7 Jul 2000 16:43:28 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id QAA15185;
	Fri, 7 Jul 2000 16:46:02 +0200
Sender: pd@blueberry.kubism.ku.dk
To: plucas@csd.abdn.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] multiply defined symbols (PR#597)
References: <200007071023.MAA07687@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 07 Jul 2000 16:46:02 +0200
In-Reply-To: plucas@csd.abdn.ac.uk's message of "Fri, 7 Jul 2000 12:23:45 +0200 (MET DST)"
Message-ID: <x2wviyrob9.fsf@blueberry.kubism.ku.dk>
Lines: 21
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

plucas@csd.abdn.ac.uk writes:

> I tried to install R 1.1.0 on my i686 PC with Redhat 6.2 Linux on it.
> I am using fort77 with f2c. I am not able to build R, as libc.a contains
> regex.o, causing a conflict with src/main/regex.o. the ONEWS mentions
> that this problem was solved, but it obviously was not. I am not a real
> Unix hacker, so I wonder how to proceed.

One possibility would be to use f2c directly. Pseudo Fortran compilers
like fort77 (which is just a script around f2c) do strange things
occasionally. Use the --with-f2c flag to configure.

The egcs-g77 package that comes with RH6.2 should work for compiling R
itself, but seems to be having trouble with some add-on packages.
gcc-2.95.1 and later seems to be OK.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 597.audit <==
Mon Jul 10 12:30:34 2000	ripley	changed notes
Mon Jul 10 12:30:34 2000	ripley	moved from incoming to Installation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Language

* PR# 645 *
Subject: unlisting a list with names components
From: Peter Perkins <pperkins@ucsd.edu>
Date: Fri, 25 Aug 2000 23:07:47 -0700
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 645 <==
From pperkins@ucsd.edu  Sat Aug 26 09:41:52 2000
Received: from femail1.sdc1.sfba.home.com (femail1.sdc1.sfba.home.com [24.0.95.81])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA00323
	for <r-bugs@biostat.ku.dk>; Sat, 26 Aug 2000 09:41:51 +0200 (MET DST)
Received: from ucsd.edu ([24.4.89.36]) by femail4.sdc1.sfba.home.com
          (InterMail vM.4.01.03.00 201-229-121) with ESMTP
          id <20000826060700.ZXWB8556.femail4.sdc1.sfba.home.com@ucsd.edu>
          for <r-bugs@biostat.ku.dk>; Fri, 25 Aug 2000 23:07:00 -0700
Sender: peter
Message-ID: <39A75EB3.33F4DA55@ucsd.edu>
Date: Fri, 25 Aug 2000 23:07:47 -0700
From: Peter Perkins <pperkins@ucsd.edu>
Reply-To: pperkins@ucsd.edu
X-Mailer: Mozilla 4.7 [en] (X11; I; Linux 2.2.15pre3 ppc)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@biostat.ku.dk
Subject: unlisting a list with names components
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

hi -

i apologize if this is a duplicate.

i think the lines below demonstrate a problem with unlist when the list
contains components that are names.  _anything_ can go in a list,
right?  this came up in the context of trying to
unlist(list(attr(terms(formula), "variables")).

perhaps unrelated but i thought i'd mention: unlist() complains about a
call/formula object, but sapply() does not (a call certainly "looks"
like a list, but includes names at some level).

- peter perkins


$ R --vanilla

> find(list)
[1] "package:base"
> find(unlist)
[1] "package:base"
> list1 <- list(a="a", b="b")
> unlist(list1)
  a   b
"a" "b"
> list2 <- list(a="a", b=as.name("b"))
> unlist(list2)
$a
[1] "a"

$b
b

> mode(list2)
[1] "list"
> mode(unlist(list2))
[1] "list"


--please do not edit the information below--

Version:
 platform = powerpc-unknown-linux-gnu
 arch = powerpc
 os = linux-gnu
 system = powerpc, linux-gnu
 status =
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base



==> 645.audit <==
Thu Sep 07 06:26:36 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 412 *
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 412 <==
From postmaster@franz.stat.wisc.edu  Sun Feb  6 01:16:33 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26868
	for <R-bugs@biostat.ku.dk>; Sun, 6 Feb 2000 01:16:31 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id BAA18080
	for <r-bugs@hypatia.math.ethz.ch>; Sun, 6 Feb 2000 01:16:38 +0100 (MET)
Received: from franz.stat.wisc.edu(128.105.174.95)
 via SMTP by hypatia, id smtpdAAAa004QS; Sun Feb  6 01:16:33 2000
Received: from pubhealth.ku.dk (really [130.225.108.10]) by franz.stat.wisc.edu
	via smail with esmtp
	id <m12HFNP-000ZSxC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Sat, 5 Feb 2000 18:16:31 -0600 (CST) 
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26864
	for <r-bugs@r-project.org>; Sun, 6 Feb 2000 01:16:18 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA12311;
	Sun, 6 Feb 2000 01:18:51 +0100
Sender: pd@blueberry.kubism.ku.dk
To: r-bugs@r-project.org
Subject: anomalies with call objects
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 06 Feb 2000 01:18:50 +0100
Message-ID: <x2900zyyhh.fsf@blueberry.kubism.ku.dk>
Lines: 51
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit


Call objects don't always behave as you'd expect. They're mostly
list-like, but with exceptions:

> f<-function(x,y,...)match.call(expand.dots=FALSE)
> xx <- f(y=1,2,z=3,4)
> dd <- xx$...
> xx$... <- NULL
> c(xx,dd)
[[1]]
f(x = 2, y = 1)

$z
[1] 3

[[3]]
[1] 4

> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, z = 3, 4)

(Splus has this rather differently, since dd becomes a call to list()
rather than a list of promises:

S> c(xx,dd)
f(x = 2, y = 1, list, z = 3, 4)
S> as.call(c(as.list(xx),dd))
f(x = 2, y = 1, list, z = 3, 4)

...but at least gives the same in both cases)

Also, the names of arguments added with [[<- is getting dropped if a
new element is required:

> xx[["abc"]]<-123
> xx
f(x = 2, y = 1, 123)

S has what I'd expect there:

S> xx[["abc"]]<-123
S> xx
f(x = 2, y = 1, abc = 123)

[R-0.99.0 prerelease on RedHat6.1, but this is likely not a new thing.]

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 412.audit <==
Wed Feb 16 19:26:57 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 408 *
Subject: convolution bug
From: wsimpson@gcal.ac.uk
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 408 <==
From wsimpson@gcal.ac.uk  Fri Jan 28 11:17:36 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA11325
	for <R-bugs@biostat.ku.dk>; Fri, 28 Jan 2000 11:17:36 +0100 (MET)
Date: Fri, 28 Jan 2000 11:17:36 +0100 (MET)
From: wsimpson@gcal.ac.uk
Message-Id: <200001281017.LAA11325@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: convolution bug

Full_Name: Bill Simpson
Version: 65.1 , 0.90.1
OS: Linux
Submission from: (NULL) (193.62.250.209)


I reported this on r-help, but here is official bug report.

The present convolve() does not do convolution by default. Its default behaviour
is
correlation. This is a bug.

The default argument conj should be set to FALSE.

The zero-padding should be on the right for linear convolution (don't ask me
why you call this type="open"; I suggest type="linear").

Here is what I expect linear convolution to do:
myconvolve<-function (x,h) 
{
    nx <- length(x)
    nh <- length(h)
    #zero pad
    if(nx>nh)
       {
       x <- c(x,rep(0, nh-1))
       h<-c(h,rep(0,nx-1))
       }
    else
       {
       h <- c(h,rep(0, nx-1))
       x<-c(x,rep(0,nh-1))
       }
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/length(x)
#I am not sure about this, the R IFFT is weird
}

What "circular" convolution should do is just
eliminate the zero-padding:

myconvolve2<-function (x,h)
{
#no padding, circular convolution
    nx <- length(x)
    nh <- length(h)
    x <- fft(fft(x) * fft(h), inv = TRUE)
    Re(x)/(nx)
}


I suggest that you create two functions, convolve() and correlate(), and get
rid
of the conj argument in convolve().

==> 408.audit <==
Wed Feb 16 19:28:42 2000	ripley	moved from incoming to Language
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 642 *
Subject:  Method dispatch fails for autoloaded methods 
From: maechler@stat.math.ethz.ch
Date: Thu, 24 Aug 2000 17:09:09 +0200
--fixed for next (1.2) R version
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 642 <==
From maechler@stat.math.ethz.ch  Thu Aug 24 17:08:56 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA24526
	for <r-bugs@biostat.ku.dk>; Thu, 24 Aug 2000 17:08:56 +0200 (MET DST)
From: maechler@stat.math.ethz.ch
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id RAA11968;
	Thu, 24 Aug 2000 17:09:14 +0200 (MET DST)
Received: from florence(129.132.58.33), claiming to be "florence.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa002uw; Thu Aug 24 17:09:09 2000
Received: (maechler@localhost) by florence.ethz.ch (8.9.3/D-MATH-client) id RAA03378; Thu, 24 Aug 2000 17:09:09 +0200
Date: Thu, 24 Aug 2000 17:09:09 +0200
Message-Id: <200008241509.RAA03378@florence.ethz.ch>
To: r-bugs@biostat.ku.dk
Subject:  Method dispatch fails for autoloaded methods 
Cc: maechler@stat.math.ethz.ch

(As mentioned before, on R-devel)

This code snippet shows what the Subject above says :

> autoload("diff.ts", file="ts")
> diff(ts(1:10,freq=2))
Error in tsp<-(*tmp*, value = c(xtsp[1] + lag * differences * xtsp[3],  :
	invalid time series parameters specified
> traceback()
[1] "tsp<-(*tmp*, value = c(xtsp[1] + lag * differences * xtsp[3], "
[2] "    xtsp[2], xtsp[3]))"
[3] "diff.default(ts(1:10, freq = 2))"
[4] "diff(ts(1:10, freq = 2))"

[The R version doesn't matter; this has been true for 1.1.x as well]

--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Under development (unstable)
 major = 1
 minor = 2.0
 year = 2000
 month = 08
 day = 24
 language = R

Search Path:
 .GlobalEnv, package:SfS, Autoloads, package:base

==> 642.reply.1 <==
From thomas@biostat.washington.edu  Thu Aug 24 19:08:04 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA25116
	for <R-bugs@biostat.ku.dk>; Thu, 24 Aug 2000 19:08:03 +0200 (MET DST)
Received: from atlas (atlas [128.95.21.66])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-2000-05-16a) with ESMTP id KAA12719;
	Thu, 24 Aug 2000 10:08:09 -0700 (PDT)
Date: Thu, 24 Aug 2000 10:08:09 -0700 (PDT)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: maechler@stat.math.ethz.ch
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Method dispatch fails for autoloaded methods (PR#642)
In-Reply-To: <200008241508.RAA24536@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0008241005070.19023-100000@atlas.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 24 Aug 2000 maechler@stat.math.ethz.ch wrote:

> (As mentioned before, on R-devel)
> 
> This code snippet shows what the Subject above says :

The problem is that isFunction is false for diff.ts, since it is only a
promise, not a function.

I think the solution is for usemethod to force the promise (in lines 225ff
of objects.c), but I'm not sure how to do this.

	-thomas


==> 642.reply.2 <==
From pd@blueberry.kubism.ku.dk  Fri Aug 25 00:36:50 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA26071
	for <R-bugs@biostat.ku.dk>; Fri, 25 Aug 2000 00:36:49 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id AAA20531;
	Fri, 25 Aug 2000 00:41:27 +0200
Sender: pd@blueberry.kubism.ku.dk
To: Thomas Lumley <thomas@biostat.washington.edu>
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Method dispatch fails for autoloaded methods (PR#642)
References: <Pine.GSO.4.21.0008241005070.19023-100000@atlas.biostat.washington.edu>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 25 Aug 2000 00:41:27 +0200
In-Reply-To: Thomas Lumley's message of "Thu, 24 Aug 2000 10:08:09 -0700 (PDT)"
Message-ID: <x2lmxm1duw.fsf@blueberry.kubism.ku.dk>
Lines: 31
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Thomas Lumley <thomas@biostat.washington.edu> writes:

> On Thu, 24 Aug 2000 maechler@stat.math.ethz.ch wrote:
> 
> > (As mentioned before, on R-devel)
> > 
> > This code snippet shows what the Subject above says :
> 
> The problem is that isFunction is false for diff.ts, since it is only a
> promise, not a function.
> 
> I think the solution is for usemethod to force the promise (in lines 225ff
> of objects.c), but I'm not sure how to do this.

Yes, must be the right thing to do. We must be doing the same thing
with regular function lookups, no? Not that there are many (if any)
relevant cases, but

> autoload(".TkRoot","tcltk")
> .TkRoot(x)
Error: couldn't find function ".TkRoot"

will cause the .TkRoot promise to be forced, loading tcltk *before* it
can figure out that it isn't a function. I see no reason for object
methods to behave any differently.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 642.audit <==
Thu Sep 07 06:38:09 2000	ripley	moved from incoming to Language
Fri Sep 15 18:50:50 2000	maechler	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 587 *
Subject: dim(a <- ...) sets invisible flag erronously
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Fri, 30 Jun 2000 20:15:59 +0200 (MET DST)
--Not specific to dim: R differs from S for most functions here.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 587 <==
From maechler@stat.math.ethz.ch  Fri Jun 30 20:15:50 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA02851
	for <R-bugs@biostat.ku.dk>; Fri, 30 Jun 2000 20:15:50 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id UAA18670
	for <R-bugs@stat.math.ethz.ch>; Fri, 30 Jun 2000 20:16:09 +0200 (MET DST)
Received: from jessica(129.132.58.24), claiming to be "homes.stat.math.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa004Zd; Fri Jun 30 20:16:00 2000
Received: (maechler@localhost) by homes.stat.math.ethz.ch (8.8.8+Sun/D-MATH-client) id UAA17303; Fri, 30 Jun 2000 20:15:59 +0200 (MET DST)
X-Authentication-Warning: homes.stat.math.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14684.58335.571324.541557@homes.stat.math.ethz.ch>
Date: Fri, 30 Jun 2000 20:15:59 +0200 (MET DST)
To: R-bugs@stat.math.ethz.ch
Subject: dim(a <- ...) sets invisible flag erronously
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

{Nothing really harmful;  R 1.1.0}

dim(.) sets (or doesn't clear) the  ``invisible flag'' for printing in
certain circumstances:

  > dim(a <- cbind(1))
  >

does *not* print as it should :

  > dim(a)
  [1] 1 1

---

Question to the real "hackers" :

How can I check this using R code alone (not using files),
i.e. (how) can I ask an R expression if its ``invisible flag'' is set or not ?

{help(invisible) doesn't help here}.

Maybe one would want an

      is.invisible(.)

function?

-- 
Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 587.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Jul 10 15:36:34 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA20903
	for <R-bugs@biostat.ku.dk>; Mon, 10 Jul 2000 15:36:34 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id OAA12626;
	Mon, 10 Jul 2000 14:36:51 +0100 (BST)
Message-Id: <200007101336.OAA12626@toucan.stats.ox.ac.uk>
Date: Mon, 10 Jul 2000 14:36:51 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] dim(a <- ...) sets invisible flag erronously (PR#587)
To: r-devel@stat.math.ethz.ch, maechler@stat.math.ethz.ch
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: vCXar+2yNs/52Q2nsVCl1Q==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 


> Date: Fri, 30 Jun 2000 20:15:51 +0200 (MET DST)
> From: maechler@stat.math.ethz.ch
> To: r-devel@stat.math.ethz.ch
> Subject: [Rd] dim(a <- ...) sets invisible flag erronously (PR#587)
> CC: R-bugs@biostat.ku.dk
> X-Loop: R-bugs@biostat.ku.dk
> 
> {Nothing really harmful;  R 1.1.0}
> 
> dim(.) sets (or doesn't clear) the  ``invisible flag'' for printing in
> certain circumstances:
> 
>   > dim(a <- cbind(1))
>   >
> 
> does *not* print as it should :
> 
>   > dim(a)
>   [1] 1 1

This is nothing to do with dim: any function will do this.

> foo <- function(x) x
> foo(a <- cbind(1))

It happens because the way invisible is implemented is different in R and S:
in S there is a .Auto.print var in frame 1, and in R there is a global
variable R_visible, so anything during the evaluation that unsets the
flag will ensure that the result is invisible.

I don't see how to avoid this without checking the `depth' in the evaluation
pretty carefully (and R's semantics differ from those of S in that
braced expressions do not generate a frame).

Is this worth fixing?  print(.Last.value) works all the time, and perhaps
you might be persuaded not to write code that uses assignments as arguments?

> ---
> 
> Question to the real "hackers" :
> 
> How can I check this using R code alone (not using files),
> i.e. (how) can I ask an R expression if its ``invisible flag'' is set or not ?
> 
> {help(invisible) doesn't help here}.
> 
> Maybe one would want an
> 
>       is.invisible(.)
> 
> function?

There seems to be an unused internal function do_visibleflag in print.c.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 587.audit <==
Mon Jul 10 12:42:47 2000	ripley	moved from incoming to Language
Mon Jul 10 13:40:28 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Low-level

* PR# 551 *
Subject: Bus Error crash
From: kjetikj@astro.uio.no
Date: Mon, 22 May 2000 13:06:48 +0200 (MET DST)
--- ??? -- not (yet) reproducible with small examples
--- after load()ing large objects
--- on two different DEC alpha versions
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 551 <==
From kjetikj@astro.uio.no  Mon May 22 13:06:49 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA20951
	for <R-bugs@biostat.ku.dk>; Mon, 22 May 2000 13:06:48 +0200 (MET DST)
Date: Mon, 22 May 2000 13:06:48 +0200 (MET DST)
From: kjetikj@astro.uio.no
Message-Id: <200005221106.NAA20951@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Bus Error crash

Full_Name: Kjetil Kjernsmo
Version: 1.0.1
OS: osf1
Submission from: (NULL) (129.240.28.227)


Ouch, another obscure bug...
I just had a bus error crash, with a core dump, a small one this time.
Usual <URL:http://www.astro.uio.no/~kjetikj/tmp/core>.
I had done a few simulations, and done a chisq.test() on them.
These simulations also write about 190MB's to file, but
I have no idea whether that is relevant, and those data are not
used. The calls I do look like this:
> ch1 <- chisq.test(t(apply(cbind(rep(5000000, 4)), 1, lineprofile, 1, 100,
"point")))
> ch1

	 Pearson's Chi-square test 

data:  t(apply(cbind(rep(5e+06, 4)), 1, lineprofile, 1, 100, "point")) 
X-squared = 463.8359, df = 300, p-value = 3.726e-09 

> ch1$observed

Process R bus error (core dumped) at Mon May 22 12:38:49 2000


....so it doesn't crash when I print the whole object, but when I 
a vector of the object, it crashes... And, restarting R, it doesn't
happen.

I heard the sysadm who did the installation had some problems,
I don't know what it was about, but if I understood him correctly,
it only happened when he tuned for EV6, so it shouldn't be a problem now, 
I guess....

Kjetil


==> 551.followup.1 <==
From mcneney@cs.sfu.ca  Thu May 25 00:21:11 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA21037
	for <R-bugs@biostat.ku.dk>; Thu, 25 May 2000 00:21:10 +0200 (MET DST)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id PAA15921;
	Wed, 24 May 2000 15:21:29 -0700 (PDT)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id PAA0000118354; Wed, 24 May 2000 15:21:29 -0700 (PDT)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Wed, 24 May 2000 15:21:29 -0700 (PDT)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: kjetikj@astro.uio.no
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Bus Error crash (PR#551)
In-Reply-To: <200005221106.NAA20961@pubhealth.ku.dk>
Message-ID: <Pine.OSF.4.21.0005241508010.116565-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 22 May 2000 kjetikj@astro.uio.no wrote:

> Full_Name: Kjetil Kjernsmo
> Version: 1.0.1
> OS: osf1
> Submission from: (NULL) (129.240.28.227)
> 
> 
> Ouch, another obscure bug...
> I just had a bus error crash, with a core dump, a small one this time.
> Usual <URL:http://www.astro.uio.no/~kjetikj/tmp/core>.
> I had done a few simulations, and done a chisq.test() on them.
> These simulations also write about 190MB's to file, but
> I have no idea whether that is relevant, and those data are not
> used. The calls I do look like this:
> > ch1 <- chisq.test(t(apply(cbind(rep(5000000, 4)), 1, lineprofile, 1, 100,
> "point")))
> > ch1
> 
> 	 Pearson's Chi-square test 
> 
> data:  t(apply(cbind(rep(5e+06, 4)), 1, lineprofile, 1, 100, "point")) 
> X-squared = 463.8359, df = 300, p-value = 3.726e-09 
> 
> > ch1$observed
> 
> Process R bus error (core dumped) at Mon May 22 12:38:49 2000
> 
> 
> ....so it doesn't crash when I print the whole object, but when I 
> a vector of the object, it crashes... And, restarting R, it doesn't
> happen.
> 
> I heard the sysadm who did the installation had some problems,
> I don't know what it was about, but if I understood him correctly,
> it only happened when he tuned for EV6, so it shouldn't be a problem now, 
> I guess....
> 
> Kjetil

I can't reproduce the problem on my system (R Version: 1.0.0, OS: osf1
V5.0). Compiled with gcc/g77 using optimisation level -O2 (determined by
configure script).

> ch1 <- chisq.test(t(apply(cbind(rep(5000000, 4)), 1, lineprofile, 1,
100,"point")))


> ch1

         Pearson's Chi-square test 

data:  t(apply(cbind(rep(5e+06, 4)), 1, lineprofile, 1, 100, "point")) 
X-squared = 404.6772, df = 300, p-value = 5.125e-05 

> ch1$observed
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14]
[1,]  160  144  205  244  273  314  395  454  521   592   713   864   905 1043
[2,]  139  175  210  232  276  369  372  459  525   566   687   781   886  981

... etc ...


Brad


==> 551.followup.2 <==
From kjetikj@astro.uio.no  Thu May 25 11:51:59 2000
Received: from mons.uio.no (7411@mons.uio.no [129.240.130.14])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA25230
	for <R-bugs@biostat.ku.dk>; Thu, 25 May 2000 11:51:59 +0200 (MET DST)
Received: from alnair.uio.no ([129.240.28.227])
	by mons.uio.no with esmtp (Exim 2.12 #7)
	id 12uuJM-0000Xk-00; Thu, 25 May 2000 11:52:16 +0200
Received: from localhost ([127.0.0.1])
	by alnair.uio.no with esmtp (Exim 2.12 #1)
	id 12uuJE-0003bJ-00; Thu, 25 May 2000 11:52:08 +0200
Date: Thu, 25 May 2000 11:52:08 +0200 (MET DST)
From: Kjetil Kjernsmo <kjetil.kjernsmo@astro.uio.no>
X-Sender: kjetikj@alnair.uio.no
To: Brad McNeney <mcneney@cs.sfu.ca>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Bus Error crash (PR#551)
In-Reply-To: <Pine.OSF.4.21.0005241508010.116565-100000@smahlt.math.sfu.ca>
Message-ID: <Pine.OSF.4.21.0005251145100.13610-100000@alnair.uio.no>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 24 May 2000, Brad McNeney wrote:

>I can't reproduce the problem on my system (R Version: 1.0.0, OS: osf1
>V5.0).

OK. I had a similar crash yesterday on a different machine but I think
with rather identical hardware, it was a batch job that was running
so I don't know exactly what caused the crash (after about 48 CPU hours,
arrgh), but I have a (small) core dump at
<URL:http://www.astro.uio.no/~kjetikj/tmp/core3>

Anyway, Uwe suggested it might be a RAM hardware problem, which is not
impossible. I think these machines were bought while still in beta-test,
and hopefully, Compaq will drop by tomorrow to have a look. 

Best,

Kjetil
-- 
Kjetil Kjernsmo
Graduate astronomy-student                    Problems worthy of attack
University of Oslo, Norway            Prove their worth by hitting back
E-mail: kjetikj@astro.uio.no                                - Piet Hein
Homepage <URL:http://www.astro.uio.no/~kjetikj/>
Webmaster@skepsis.no 


==> 551.followup.3 <==
From kjetikj@astro.uio.no  Fri Jun  9 16:33:08 2000
Received: from mons.uio.no (7411@mons.uio.no [129.240.130.14])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA05935
	for <r-bugs@biostat.ku.dk>; Fri, 9 Jun 2000 16:33:07 +0200 (MET DST)
Received: from alnair.uio.no ([129.240.28.227])
	by mons.uio.no with esmtp (Exim 2.12 #7)
	id 130Pqg-0004Lh-00
	for r-bugs@biostat.ku.dk; Fri, 9 Jun 2000 16:33:26 +0200
Received: from localhost ([127.0.0.1])
	by alnair.uio.no with esmtp (Exim 2.12 #1)
	id 130Pqf-0000aE-00
	for r-bugs@biostat.ku.dk; Fri, 9 Jun 2000 16:33:25 +0200
Date: Fri, 9 Jun 2000 16:33:24 +0200 (MET DST)
From: Kjetil Kjernsmo <kjetil.kjernsmo@astro.uio.no>
X-Sender: kjetikj@alnair.uio.no
To: r-bugs@biostat.ku.dk
Subject: Disappearing values (PR#551)
Message-ID: <Pine.OSF.4.05.10006091627560.847-100000@alnair.uio.no>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Dear all,

Uwe e-mailed me yesterday about the problems some time ago. I had hoped
someone would have a look at our computers, but due to some unfortunate
circumstances, it hasn't happened. However, it seems unlikely that it is
connected to a specific piece of hardware. It could be an
architecture-dependent problem though. I also had a word with those who
did the installation of R, and they had some problems when tuning it for
alphaev6, but it all went smoothly when tuning for alphaev56, and that is
the build I'm running. This is basically the stuff I sent to Uwe
yesterday. 

I have been testing it on three different machines:
alnair, a XP1000 with a 500MHz alphaev6 processor and 619 MB RAM
rukbat, a PWS500au with a 500MHz alphaev56 processor with 238 MB RAM
mirfak, a DEC255/233 with a 233MHz (?) alphaev4 (?) processor with 245MB
(RAM is according to top). All show the same problems consistently. 
I'm not using the match.arg()-approach anymore, BTW, I have moved on to
some object-oriented stuff. 

However, some apparently related (?) problem occurs. Yesterday, I started
working on some simulations I have done (with R of course! :-) ). I did
exactly the same operations on rukbat and mirfak (using ESS-elsewhere
while sitting on alnair), starting with the same calls, vsize=80M,
nsize=800k, no-restore. I loaded a 58MB file with load, and there are a
few variables with arrays of htest-objects. Then, I did 
as.vector(sapply(chisq5M11000, function(x) x$statistic))
to get a vector of the test statistics. Now, occasionally, it prints a
nice vector with all the values intact. Occasionally, one of the entries
are NULL, and then it prints a list, e.g.
[[892]]
X-squared 
 1933.637 

[[893]]
NULL

[[894]]
X-squared 
 1741.416 

The funny thing is that when I did this sapply thing on mirfak and rukbat,
it happened on at exactly the same place on the two machines. First,
mirfak would produce a vector then rukbat would produce a vector, mirfak
would give a list where element # 238 (if I remember correctly) was NULL,
rukbat would produce a list with element #238 NULL, both would produce a
vector again, both would produce a list with element #602 NULL, etc... 

This is pretty much what I've got now... :-)

Best,

Kjetil
-- 
Kjetil Kjernsmo
Graduate astronomy-student                    Problems worthy of attack
University of Oslo, Norway            Prove their worth by hitting back
E-mail: kjetikj@astro.uio.no                                - Piet Hein
Homepage <URL:http://www.astro.uio.no/~kjetikj/>
Webmaster@skepsis.no 





==> 551.audit <==
Fri Jul 07 06:44:08 2000	maechler	changed notes
Fri Jul 07 06:44:08 2000	maechler	moved from incoming to Low-level

==> 551.followup.4 <==
From kjetikj@astro.uio.no  Fri Jul 14 19:18:42 2000
Received: from pat.uio.no (pat.uio.no [129.240.130.16])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA16705
	for <r-bugs@biostat.ku.dk>; Fri, 14 Jul 2000 19:18:42 +0200 (MET DST)
Received: from alnair.uio.no ([129.240.28.227])
	by pat.uio.no with esmtp (Exim 2.12 #7)
	id 13D977-0000KT-00
	for r-bugs@biostat.ku.dk; Fri, 14 Jul 2000 19:19:01 +0200
Received: from localhost ([127.0.0.1])
	by alnair.uio.no with esmtp (Exim 2.12 #1)
	id 13D976-0004qm-00
	for r-bugs@biostat.ku.dk; Fri, 14 Jul 2000 19:19:00 +0200
Date: Fri, 14 Jul 2000 19:19:00 +0200 (MET DST)
From: Kjetil Kjernsmo <kjetil.kjernsmo@astro.uio.no>
X-Sender: kjetikj@alnair.uio.no
To: r-bugs@biostat.ku.dk
Subject: Re: Disappearing values (PR#551)
In-Reply-To: <Pine.OSF.4.05.10006091627560.847-100000@alnair.uio.no>
Message-ID: <Pine.OSF.4.05.10007141906260.3963-100000@alnair.uio.no>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 9 Jun 2000, I wrote:
[...]
> Now, occasionally, it prints a
>nice vector with all the values intact. Occasionally, one of the entries
>are NULL, and then it prints a list, e.g.
[lots of things along these lines]

Now, it seems like this problem has been solved. Reading some old
r-help e-mail I had missed, I came across a message from Brad McNeney
(<URL:http://www.ens.gu.edu.au/robertk/R/help/00a/2068.html>), and it was
apparent that he has had the same problems as I, but solved it by using
gcc instead of cc. Recent communication between Ray Brownrigg and Prof
Brian D Ripley enabled me to compile and get R running myself, and indeed,
the problem has not occured in a number of runs after I did this, I look
upon it as solved.

So, it seems like it may be problematic to use the standard cc compiler on
the alpha platform with Digital UNIX to compile R. Just a minor status
report... :-)

Best,

Kjetil
-- 
Kjetil Kjernsmo
Graduate astronomy-student                    Problems worthy of attack
University of Oslo, Norway            Prove their worth by hitting back
E-mail: kjetikj@astro.uio.no                                - Piet Hein
Homepage <URL:http://www.astro.uio.no/~kjetikj/>
Webmaster@skepsis.no 




~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 545 *
Subject: Segmentation Fault of unknown cause
From: kjetikj@astro.uio.no
Date: Mon, 15 May 2000 16:29:29 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 545 <==
From kjetikj@astro.uio.no  Mon May 15 16:29:29 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA13643
	for <R-bugs@biostat.ku.dk>; Mon, 15 May 2000 16:29:29 +0200 (MET DST)
Date: Mon, 15 May 2000 16:29:29 +0200 (MET DST)
From: kjetikj@astro.uio.no
Message-Id: <200005151429.QAA13643@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Segmentation Fault of unknown cause

Full_Name: Kjetil Kjernsmo
Version: 1.0.0
OS: osf1
Submission from: (NULL) (129.240.28.227)


Hello!

I'm afraid I have another obscure bug. 
R has just crashed with a segmentation fault. 
This time, I have even failed to reproduce it, but fortunately, 
I have a core dump. It's at 
<URL:http://www.astro.uio.no/~kjetikj/tmp/core>

The call I did was 
log10(quantile(chisqtests5M11001, c(0.05, 0.95)))
where chisqtests5M11001 is an array of length 1500 
(it's an array of p-values produced by the chisq.test, but I 
doubt that it is relevant). 

I did lots of strange things prior to the crash, some even 
involving for-loops, but I can't tell what is relevant. Anyway,
a transcript of the session is at 
<URL:http://www.astro.uio.no/~kjetikj/tmp/crash.Rt>

That's all I've got.... 

Kjetil

==> 545.audit <==
Wed Jun 07 06:49:39 2000	maechler	moved from incoming to Low-level
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 536 *
Subject: Problem with match.arg()
From: kjetikj@astro.uio.no
Date: Sun, 7 May 2000 13:58:21 +0200 (MET DST)
--1.0.0 bug fixed for 1.0.1 ??
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 536 <==
From kjetikj@astro.uio.no  Sun May  7 13:58:22 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA29341
	for <R-bugs@biostat.ku.dk>; Sun, 7 May 2000 13:58:21 +0200 (MET DST)
Date: Sun, 7 May 2000 13:58:21 +0200 (MET DST)
From: kjetikj@astro.uio.no
Message-Id: <200005071158.NAA29341@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Problem with match.arg()

Full_Name: Kjetil Kjernsmo
Version: Version 1.0.0
OS: osf1
Submission from: (NULL) (129.240.28.227)


Hello again!

This is a follow-up to my message on R-help about a problem with match.arg()
I have a little more on the topic, but not much really. 

First, it was not entirely true what I wrote in r-help that I call match.arg()
in my ramp(), because ramp() just calls qamp() with runif() as argument, but 
I have found that it happens both in ramp() and qamp().

Last night, just before I went home, R crashed with a segmentation fault. 
Unfortunately, I had limit coredumpsize 0, because I seldom want core-files,
so I haven't got it. I have removed that limit now. I have not been able to 
reproduce the crash, however.

Now, for a
> last.dump
$"apply(cbind(rep(1e+05, 25000)), 1, lineprofile, 10, 100, 1, "point")"
<environment: 140e187f0>

$"FUN(newX[, i], ...)"
<environment: 1404b6608>

$"apply(cbind(-as.integer(numberofbins/2):as.integer(numberofbins/2)), "
<environment: 1404b5460>

$"FUN(newX[, i], ...)"
<environment: 1400f6798>

$"photonsdetectedbin(ncb, intensityfromcloud(ncb, intensityfromcloud, "
<environment: 1400f55c8>

$"sum(rpois(ncloudsbin, sensitivity * intensityfromcloud))"
<environment: 1400f53e8>

$"rpois(ncloudsbin, sensitivity * intensityfromcloud)"
<environment: 1400f5168>

$"intensityfromcloud(ncb, intensityfromcloud, exptime, amptype)"
<environment: 1400f4c68>

$"ramp(ncloudsbin, amptype)"
<environment: 1400f4920>

$"qamp(runif(n), type)"
<environment: 1400ebdc0>

$"match.arg(type)"
<environment: 1400e97f0>

$"all(arg == choices)"
<environment: 140e2d740>

attr(,"error.message")
[1] "Error in arg == choices : comparison (1) is possible only for vector
types\n"
attr(,"class")
[1] "dump.frames"

I have also inserted some print statements at some places in the code. First:
qamp <- function(p,  type=c("point", "nolens"))
{
  print(c(2,type))
  type <- match.arg(type)
  if(type == "point")
    return(1 / (2 * sqrt(1 - p)))
  else return(1)
}
  
ramp <- function(n, type=c("point", "nolens"))
{
  print(c(1,type))
  type <- match.arg(type)
  if(type == "point")
    return(qamp(runif(n), type))
  else return(rep(1, n))
}
(I'll rewrite these to use switch eventually).

And, also in match.arg():
match.arg <- function (arg, choices) {
    if (missing(choices)) {
	formal.args <- formals(sys.function(sys.parent()))
	choices <- eval(formal.args[[deparse(substitute(arg))]])
    }
    print(c(2, arg, choices))
    if (all(arg == choices)) return(choices[1])
[...]
Upon running, I get
[1] "1"     "point"
[1] "point"  "point"  "nolens"
[1] "2"     "point"
[1] "point"  "point"  "nolens"
[thousands of these... :-) ]
[1] "1"     "point"
[1] "point"  "point"  "nolens"
[1] "2"     "point"
[1] "point"  "point"  "nolens"
[1] "1"     "point"
[1] "point"  "point"  "nolens"
[1] "2"     "point"
[1] "point"
Error in arg == choices : comparison (1) is possible only for vector types
So, suddenly, "choices" doesn't have a value, and consequently, the error.
FWIW, I have also printed formals(qamp)$type inside qamp, and it has the 
right value. 

Now, it seems hard to reproduce, I just did 100000 runs of ramp(10000, "point")

directly with no problems. In my code, ramp is called by a function that is
called
by a function, that is... :-) 

However, the code isn't very involved, really, so if you want to try, here it
is:
ncloudsbin <- function(binno, ntotalclouds, numberofbins = 100,
                       linewidth = numberofbins / 6)
  return(ntotalclouds * dnorm(binno, sd = linewidth))

intensityfromcloud <- function(ncloudsbin, cloudintensity, exptime, amptype)
  return(cloudintensity * exptime * ramp(ncloudsbin, amptype))

photonsdetectedbin <- function(ncloudsbin, intensityfromcloud,
                               continuumintensity, exptime, amptype,
                               sensitivity)
  return(sum(rpois(ncloudsbin, sensitivity * intensityfromcloud))
         + rgeom(1, 1 /(1 + (sensitivity * exptime * continuumintensity))))



lineprofile <- function(ntotalclouds, intensityfromcloud, continuumintensity,
                        exptime, amptype, sensitivity = 0.1, numberofbins =
100,
                        linewidth = numberofbins / 6)
{
  tf <- function(binno, ntotalclouds, intensityfromcloud, continuumintensity,
                 exptime, amptype, sensitivity, numberofbins, linewidth)
  {
    ncb <- ncloudsbin(binno, ntotalclouds, numberofbins, linewidth)
    return(photonsdetectedbin(ncb,
                   intensityfromcloud(
                            ncb, intensityfromcloud, exptime, amptype),
                   continuumintensity, exptime, amptype, sensitivity))
  }
  return(apply(cbind(-as.integer(numberofbins/2):as.integer(numberofbins/2)),
               1, tf,
               ntotalclouds, intensityfromcloud, continuumintensity,
               exptime, amptype, sensitivity, numberofbins, linewidth)) 
}

Note that "amptype" is here the "type" of the ?amp-functions. 
I call this by e.g. 
ll25000 <- apply(cbind(rep(100000, 25000)), 1, lineprofile, 10, 100, 1,
"point")


Just an idea: I have some problems in an entirely unrelated and more involved 
piece of code where it seems like sometimes, arguments are not returned from a 
function, that is, one variable of an object suddenly has no value. I haven't
really figured out if that is a bug of mine or in R, but could it be possible 
that something in
	formal.args <- formals(sys.function(sys.parent()))
	choices <- eval(formal.args[[deparse(substitute(arg))]])
doesn't get a value because there is an error in how objects are returned 
from a function?

BTW, I was exiting R (my ESS buffer was getting rather large), and I got the
following:
Save workspace image? [y/n/c]: y
Error: NewWriteItem: unknown type 17

Well, I guess this isn't much go on, but I know you are really good at this!
By running the above code, the error happens on every run here, it is just a
matter
of letting it run for long enough. I hope it is something to start on. I have a
few
more last.dumps on file too, if they are of use.

Kjetil

==> 536.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon May  8 00:35:02 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id AAA00947
	for <R-bugs@biostat.ku.dk>; Mon, 8 May 2000 00:35:02 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id AAA28561;
	Mon, 8 May 2000 00:41:09 +0200
Sender: pd@blueberry.kubism.ku.dk
To: kjetikj@astro.uio.no
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Problem with match.arg() (PR#536)
References: <200005071158.NAA29351@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 May 2000 00:41:09 +0200
In-Reply-To: kjetikj@astro.uio.no's message of "Sun, 7 May 2000 13:58:23 +0200 (MET DST)"
Message-ID: <x2u2gac7ay.fsf@blueberry.kubism.ku.dk>
Lines: 22
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

kjetikj@astro.uio.no writes:

> Full_Name: Kjetil Kjernsmo
> Version: Version 1.0.0
> OS: osf1
> Submission from: (NULL) (129.240.28.227)
> 
...
> BTW, I was exiting R (my ESS buffer was getting rather large), and I got the
> following:
> Save workspace image? [y/n/c]: y
> Error: NewWriteItem: unknown type 17

That one was fixed in 1.0.1, I believe. (Perhaps you should upgrade
and see if the other problem goes away too... I don't see anything
obviously relevant in the NEWS file though)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 536.audit <==
Wed Jun 07 06:48:33 2000	maechler	changed notes
Fri Jul 07 06:53:24 2000	maechler	moved from incoming to Low-level
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 505 *
Subject: interrupted save 
From: Thomas Lumley <thomas@biostat.washington.edu>
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 505 <==
From thomas@biostat.washington.edu  Sat Mar 25 21:16:39 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA08785
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 21:16:38 +0100 (MET)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id MAA24561
	for <R-bugs@biostat.ku.dk>; Sat, 25 Mar 2000 12:16:50 -0800 (PST)
Date: Sat, 25 Mar 2000 12:16:50 -0800 (PST)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: R-bugs@biostat.ku.dk
Subject: interrupted save 
In-Reply-To: <Pine.GSO.4.21.0003251204350.22429-100000@mail.biostat.washington.edu>
Message-ID: <Pine.GSO.4.21.0003251207350.22429-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


If an error occurs during a save the file does not appear to be
closed and buffers flushed.  This can lead to corruption if the same
filename is used later and then the buffer is flushed on program exit.

For example, tn the context of PR #504

 f<-function(x,...){ function(y) list(x=x,y=y,...)}
 a<-f(1,2,3)
 save(list="a",file="a.rdata")  ## -- error --
 b<-1:10
 save(list="b",file="a.rdata")
 load("a.rdata")  ## works
 q("no")
 
 R

 load("a.rdata")  ## error



This is R1.0 on Linux

	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


==> 505.audit <==
Thu Apr 13 06:21:36 2000	ripley	moved from incoming to Low-level
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Misc

none

Directory:  Models

* PR# 628 *
Subject: Re: [Rd] predict.lm is broken in 1.1.0-patched (2000-August-7)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Date: Mon, 7 Aug 2000 22:41:50 +0100 (BST)
--We've fixed the predict() problem, but need to make coef.lm and coef.aov
--consistent
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 628 <==
From ripley@stats.ox.ac.uk  Mon Aug  7 23:41:48 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA03873;
	Mon, 7 Aug 2000 23:41:47 +0200 (MET DST)
Received: from max118.public.ox.ac.uk (max118.public.ox.ac.uk [192.76.27.118])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id WAA13377;
	Mon, 7 Aug 2000 22:42:04 +0100 (BST)
Date: Mon, 7 Aug 2000 22:41:50 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: thomas@biostat.washington.edu, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] predict.lm is broken in 1.1.0-patched (2000-August-7)
 (PR#627)
In-Reply-To: <x2og34232n.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.05.10008072237330.18074-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On 7 Aug 2000, Peter Dalgaard BSA wrote:

> thomas@biostat.washington.edu writes:
> 
> > > > coef.aov
> > > function (object, ...) 
> > > {
> > >     z <- object$coef
> > >     z[!is.na(z)]
> > > }
> > > > coef.lm 
> > > function (object, ...) 
> > > object$coefficients
> > 
> > Ok, this explains it.  I *did* test it with a singular fit, but only with
> > lm(), not with aov().
> > 
> > coef.lm seems a more sensible convention, since it's a lot easy to remove
> > the NAs than to add them.
> 
> I've committed a fix for predict.lm to use object$coefficients
> directly, but I haven't done anything with the coef() methods.

As far as I recall coef.aov is different for easier compatibility with S
output: coef.lm is definitely not compatible.  I think there should
probably be a distinction between the raw information in the object and the
information given by the coef accessor function, and each has its place.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 628.audit <==
Mon Aug 14 14:26:15 2000	pd	changed notes
Mon Aug 14 14:26:15 2000	pd	moved from incoming to Models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  Startup

* PR# 486 *
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
--workaround to the origin problem in 1.0.1
--New report: try does not work from the profile.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 486 <==
From maechler@stat.math.ethz.ch  Tue Mar 14 10:32:36 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA17249
	for <R-bugs@biostat.ku.dk>; Tue, 14 Mar 2000 10:32:35 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA21252;
	Tue, 14 Mar 2000 10:32:48 +0100 (MET)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa005C1; Tue Mar 14 10:32:44 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA03934; Tue, 14 Mar 2000 10:32:44 +0100
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14542.1851.731086.380@lynne.ethz.ch>
Date: Tue, 14 Mar 2000 10:32:43 +0100 (MET)
To: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Cc: R-bugs@stat.math.ethz.ch
Subject: Re: autoload error in profile {was anova-bug in R-version  1.0.0?}
 (PR#470)
In-Reply-To: <Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
References: <14532.56910.278837.379365@lynne.ethz.ch>
	<Pine.GSO.4.05.10003071100180.20079-100000@auk.stats>
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:

    BDR> On Tue, 7 Mar 2000, Martin Maechler wrote:
    >> >>>>> "BDR" == Prof Brian D Ripley <ripley@stats.ox.ac.uk> writes:
    >> 
    BDR> On Tue, 7 Mar 2000, Trenkler, Dietrich wrote:
    >> >> I think I've discovered what went wrong.
    >> >> 
    >> >> My workspace included a function wilcox.test formerly copied from
    >> >> ctest. Now ctest ist part of the distribution and because of that I
    >> >> always got the message:
    >> >> 
    >> >> [Previously saved workspace restored]
    >> >> 
    >> >> Error in autoload("wilcox.test", "ctest") :
    >> >> Object already exists
    >> >> 
    >> >> I didn't take care of this message. Now I removed wilcox.test, saved
    >> >> the WS, restarted R without the vanilla-option and alas, anova
    >> >> now works.
    >> >> 
    >> >> It seems that R stops initializing after encountering the error
    >> >> mentioned above. Is this correct?   
    >> 
    BDR> Yes, in that the rest of the system Rprofile file is skipped
    BDR> and hence options show.signif.stars and show.coef.Pvalues are not set.
    >> but other options as well..
    >> I think this shouldn't happen and *is* a bug.

    BDR> It looks to me as if a bit more protection is needed in print.coefmat,
    BDR> at least.

	 which Brian has implemented in the mean time.

	 ....

    >> For the 1.0.x patches, at least, I'll move the autoload()'s to the end of
    >> profile/Common.R

    BDR> I _think_ they should have try() around them, which is what S-PLUS 
    BDR> now does with all startup code.

I tried this, but it does not work :

try(autoload(..)) works okay when used after startup, but not *during*
startup.  However, I'll put a workaround into Common.R

Should this {try(.) not working during startup} be another bug report ?

Martin

==> 486.audit <==
Sat Mar 25 09:44:47 2000	maechler	moved from incoming to Startup
Sat Apr 08 07:41:36 2000	ripley	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  System-specific

* PR# 592 *
Subject: tseries bug
From: przemat@itti.com.pl
Date: Tue, 4 Jul 2000 14:52:17 +0200 (MET DST)
--Still broken?
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 592 <==
From przemat@itti.com.pl  Tue Jul  4 14:54:06 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA14962
	for <R-bugs@biostat.ku.dk>; Tue, 4 Jul 2000 14:52:17 +0200 (MET DST)
Date: Tue, 4 Jul 2000 14:52:17 +0200 (MET DST)
From: przemat@itti.com.pl
Message-Id: <200007041252.OAA14962@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: tseries bug
MIME-Version: 1.0
Content-Type: text/plain; charset=unknown-8bit
Content-Transfer-Encoding: 8bit

Full_Name: Przemys³aw Matuszewski
Version: R-1.1.0
OS: Linux RH 6.2
Submission from: (NULL) (195.117.211.244)


I have a problem with the package tseries_0.5-2.
The source of tseries_0.5-2 was compiled by command R INSTALL /path/to/package.

There was build the tseries library. Now when I try to load the package I get
the message:
...........................
    
    Type	"demo()" for some demos, "help()" for on-line help, or
    	"help.start()" for a HTML browser interface to help.
    Type	"q()" to quit R.

    > library(tseries)

    Segmentation fault (core dumped)

............................
                        
I would be appreciated if you could give me any suggestion what to do with it.

Best regards

Przemys³aw Matuszewski

przemat@itti.com.pl


==> 592.followup.1 <==
From plummer@iarc.fr  Tue Jul  4 15:19:12 2000
Received: from smtp02.iarc.fr (IDENT:root@uu194-7-167-221.unknown.uunet.be [194.7.167.221])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA15580
	for <R-bugs@biostat.ku.dk>; Tue, 4 Jul 2000 15:19:11 +0200 (MET DST)
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id PAA06989;
	Tue, 4 Jul 2000 15:19:02 +0200
Message-ID: <XFMail.000704152137.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
In-Reply-To: <200007041254.OAA15000@pubhealth.ku.dk>
Date: Tue, 04 Jul 2000 15:21:37 +0200 (CEST)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: przemat@itti.com.pl
Subject: RE: [Rd] tseries bug (PR#592)
Cc: R-bugs@biostat.ku.dk, r-devel@stat.math.ethz.ch

Not a problem with the tseries package, I think, but with Red Hat 6.2,
which has some serious problems dynamically loading Fortran.

Peter Dalgaard has reported that upgrading the C/fortran compilers to 
gcc 2.95.1 or later cures the problem.

I'll see if I can find an RPM of gcc-2.95.1 for RH 6.2 and put it in
the RedHat directory of CRAN.

Martyn

On 04-Jul-00 przemat@itti.com.pl wrote:
> Full_Name: Przemys³aw Matuszewski
> Version: R-1.1.0
> OS: Linux RH 6.2
> Submission from: (NULL) (195.117.211.244)
> 
> 
> I have a problem with the package tseries_0.5-2.
> The source of tseries_0.5-2 was compiled by command R INSTALL
> /path/to/package.
> 
> There was build the tseries library. Now when I try to load the package I get
> the message:
> ...........................
>     
>     Type      "demo()" for some demos, "help()" for on-line help, or
>       "help.start()" for a HTML browser interface to help.
>     Type      "q()" to quit R.
> 
>     > library(tseries)
> 
>     Segmentation fault (core dumped)
> 
> ............................
>                         
> I would be appreciated if you could give me any suggestion what to do with
> it.

==> 592.followup.2 <==
From plummer@iarc.fr  Tue Jul  4 17:01:47 2000
Received: from smtp02.iarc.fr (IDENT:root@uu194-7-167-221.unknown.uunet.be [194.7.167.221])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA16295
	for <R-bugs@biostat.ku.dk>; Tue, 4 Jul 2000 17:01:46 +0200 (MET DST)
Received: from xena.iarc.fr ([10.10.150.125])
	by smtp02.iarc.fr (8.9.3/8.9.3) with ESMTP id QAA07615;
	Tue, 4 Jul 2000 16:59:12 +0200
Message-ID: <XFMail.000704170148.plummer@iarc.fr>
X-Mailer: XFMail 1.3 [p0] on Linux
X-Priority: 3 (Normal)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 8bit
MIME-Version: 1.0
In-Reply-To: <XFMail.000704152137.plummer@iarc.fr>
Date: Tue, 04 Jul 2000 17:01:48 +0200 (CEST)
Organization: International Agency for Research on Cancer
Sender: martyn@xena.iarc.fr
From: Martyn Plummer <plummer@iarc.fr>
To: przemat@itti.com.pl
Subject: RE: [Rd] tseries bug (PR#592)
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk

On 04-Jul-00 Martyn Plummer wrote:
> Not a problem with the tseries package, I think, but with Red Hat 6.2,
> which has some serious problems dynamically loading Fortran.
> 
> Peter Dalgaard has reported that upgrading the C/fortran compilers to 
> gcc 2.95.1 or later cures the problem.

I'm sorry to say that I still get the segfault with gcc-2.95.1 on 
RedHat 6.2.

Martyn

==> 592.audit <==
Fri Jul 07 06:52:28 2000	maechler	moved from incoming to System-specific
Mon Aug 14 14:21:03 2000	pd	changed notes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 452 *
Subject: problem with glm
From: Brad McNeney <mcneney@cs.sfu.ca>
Date: Fri, 18 Feb 2000 17:51:54 -0800 (PST)
--Problems on Alpha's with glm. Status unclear
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 452 <==
From mcneney@cs.sfu.ca  Sat Feb 19 02:51:57 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id CAA15326
	for <R-bugs@biostat.ku.dk>; Sat, 19 Feb 2000 02:51:56 +0100 (MET)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id CAA05839
	for <r-bugs@stat.math.ethz.ch>; Sat, 19 Feb 2000 02:52:05 +0100 (MET)
Received: from cs.sfu.ca(142.58.111.1)
 via SMTP by hypatia, id smtpdAAAa001RB; Sat Feb 19 02:51:57 2000
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id RAA10291
	for <r-bugs@stat.math.ethz.ch>; Fri, 18 Feb 2000 17:51:55 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id RAA0000400367; Fri, 18 Feb 2000 17:51:54 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Fri, 18 Feb 2000 17:51:54 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: r-bugs@stat.math.ethz.ch
Subject: problem with glm
Message-ID: <Pine.OSF.4.21.0002181750080.400767-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

I'm having sporadic problems with glm on my alpha workstation running
Compaq Tru64 UNIX V5.0 (I can't replicate the problem on my Linux PC). I
have the same problem whether I use a version of R built with the native
C-compiler or a version compiled with gcc. In both cases I've built with
g77.

I want to do some simulations with a call to glm in each rep. A simplified
version would be something like:

N_100; NREPS_100; lam.e_5; logit.inv_function(x){ exp(x)/(1+exp(x)) }
for(i in (1:NREPS)) {
   cat(paste("REP",i,"\n"))
   T_rexp(N,(lam.e))
   Delta_rbinom(N,1,logit.inv(1+T))
   ff_glm(Delta ~ T,family=binomial(logit))
}
 
It often completes all reps, but I occasionally get errors related to
lengths of various objects, etc.:

REP 1 
REP 2
<snip>
REP 9 
Error in model.matrix(t, data) : variable lengths differ


REP 1 
<snip>
REP 53 
Error: subscript out of bounds

REP 1 
<snip>
REP 41 
Error in model.matrix(t, data) : invalid variable type

Different error messages, different numbers of reps. When I call glm again
using the values of T and Delta just before the error, it runs error-free.
When I put the data in a data frame before calling glm I can also get
messages like:

REP 1 
<snip>
REP 64 
Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  : 
        invalid variable type


--please do not edit the information below--

Version:
 platform = alpha-dec-osf5.0
 arch = alpha
 os = osf5.0
 system = alpha, osf5.0
 status = Patched
 major = 0
 minor = 99.0
 year = 2000
 month = February
 day = 9
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

-------------------------------------------------------------------------
Brad McNeney                               email: mcneney@stat.sfu.ca
Department of Mathematics and Statistics   web: www.math.sfu.ca/~mcneney/
Simon Fraser University                    phone: 604.291.4815
8888 University Drive                      fax: 604.291.4947
Burnaby, British Columbia
Canada V5A 1S6


==> 452.reply.1 <==
From pd@biostat.ku.dk  Sat Feb 19 13:57:47 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA16134;
	Sat, 19 Feb 2000 13:57:46 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id NAA30569;
	Sat, 19 Feb 2000 13:59:28 +0100
Sender: pd@blueberry.kubism.ku.dk
To: mcneney@cs.sfu.ca
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <200002190151.CAA15336@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 19 Feb 2000 13:59:27 +0100
In-Reply-To: mcneney@cs.sfu.ca's message of "Sat, 19 Feb 2000 02:51:58 +0100 (MET)"
Message-ID: <x24sb5l55c.fsf@blueberry.kubism.ku.dk>
Lines: 47
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mcneney@cs.sfu.ca writes:

> N_100; NREPS_100; lam.e_5; logit.inv_function(x){ exp(x)/(1+exp(x)) }
> for(i in (1:NREPS)) {
>    cat(paste("REP",i,"\n"))
>    T_rexp(N,(lam.e))
>    Delta_rbinom(N,1,logit.inv(1+T))
>    ff_glm(Delta ~ T,family=binomial(logit))
> }
>  
> It often completes all reps, but I occasionally get errors related to
> lengths of various objects, etc.:
...
> --please do not edit the information below--
> 
> Version:
>  platform = alpha-dec-osf5.0
>  arch = alpha
>  os = osf5.0
>  system = alpha, osf5.0
>  status = Patched
>  major = 0
>  minor = 99.0
>  year = 2000
>  month = February
>  day = 9
>  language = R
> 
> Search Path:
>  .GlobalEnv, Autoloads, package:base

I just did the above ~10 times on i386 and nothing happened. We've had
previous reports on trouble in the lm/glm/model.matrix etc. region on
Alpha. 

If you compile with all warnings on, are you getting warnings on
pointer/integer comparisons or assignments?

Can you create a reproducible case (with set.seed to keep the random
generator sequence constant) and would you know how run a debugger on
your version so that we can figure out what is going wrong?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.followup.1 <==
From mcneney@cs.sfu.ca  Sun Feb 20 05:11:05 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id FAA17753;
	Sun, 20 Feb 2000 05:11:03 +0100 (MET)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id UAA15662;
	Sat, 19 Feb 2000 20:11:12 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id UAA0000433332; Sat, 19 Feb 2000 20:11:12 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sat, 19 Feb 2000 20:11:12 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <x24sb5l55c.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


> If you compile with all warnings on, are you getting warnings on
> pointer/integer comparisons or assignments?
> 

Yes, all the ones in regex.c that Doug mentioned. Here's a sample
of these and others (warnings related to graphics/X stuff have been
omitted):

uncmin.c: In function `lltslv':
uncmin.c:281: warning: type mismatch in implicit declaration for built-in
function `memcpy'
character.c: In function `stripchars':
character.c:269: warning: subscript has type `char'
character.c:281: warning: subscript has type `char'
character.c:296: warning: subscript has type `char'
character.c:296: warning: subscript has type `char'
character.c:304: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:312: warning: subscript has type `char'
character.c:320: warning: subscript has type `char'
character.c:320: warning: subscript has type `char'
character.c:330: warning: subscript has type `char'
character.c:330: warning: subscript has type `char'
character.c:341: warning: subscript has type `char'
character.c: In function `do_makenames':
character.c:384: warning: subscript has type `char'
character.c:395: warning: subscript has type `char'
/usr/share/misc/bison.simple: In function `Rf_yyparse':
/usr/share/misc/bison.simple:254: warning: `yyval' might be used
uninitialized in this function
regex.c: In function `re_match_2':
regex.c:3770: warning: cast from pointer to integer of different size
regex.c:3770: warning: cast from pointer to integer of different size
regex.c:3776: warning: cast to pointer from integer of different size
regex.c:3776: warning: cast to pointer from integer of different size
regex.c:3923: warning: cast to pointer from integer of different size
regex.c:3923: warning: cast to pointer from integer of different size
regex.c:3976: warning: cast to pointer from integer of different size
regex.c:3976: warning: cast to pointer from integer of different size
regex.c:4082: warning: cast from pointer to integer of different size
regex.c:4083: warning: cast from pointer to integer of different size
regex.c:4115: warning: cast to pointer from integer of different size
regex.c:4115: warning: cast to pointer from integer of different size
regex.c:4128: warning: cast to pointer from integer of different size
regex.c:4128: warning: cast to pointer from integer of different size
regex.c:4296: warning: cast from pointer to integer of different size
regex.c:4297: warning: cast from pointer to integer of different size
saveload.c:495: warning: `BinarySave' defined but not used
saveload.c:1775: warning: `NewBinarySave' defined but not used


I'll see what I can do about getting a more reproducible error. 

Any tips on what to look for if I'm running R within GDB? I don't have
much experience with the debugger. I mostly just use it to see where my
programs are dying. But R is not -- it just gives strange error messages.

TIA,
Brad


==> 452.followup.2 <==
From ripley@stats.ox.ac.uk  Sun Feb 20 09:33:06 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA17966;
	Sun, 20 Feb 2000 09:33:05 +0100 (MET)
Received: from max168.public.ox.ac.uk (max168.public.ox.ac.uk [192.76.27.168])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id IAA20341;
	Sun, 20 Feb 2000 08:33:06 GMT
Date: Sun, 20 Feb 2000 08:32:05 +0000 (GMT)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: Brad McNeney <mcneney@cs.sfu.ca>
cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
Message-ID: <Pine.GSO.4.05.10002200807420.5046-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Sat, 19 Feb 2000, Brad McNeney wrote:

> 
> > If you compile with all warnings on, are you getting warnings on
> > pointer/integer comparisons or assignments?
> > 
> 
> Yes, all the ones in regex.c that Doug mentioned. Here's a sample
> of these and others (warnings related to graphics/X stuff have been
> omitted):

(Two suggestions which are in the current snapshot follow. Looks like
what is which header varies a bit.)

> uncmin.c: In function `lltslv':
> uncmin.c:281: warning: type mismatch in implicit declaration for built-in
> function `memcpy'

Add a line (third one here) to src/include/R_ext/RS.h:

#ifndef R_RS_H
#define R_RS_H

#include <string.h> /* for memcpy */
#include "Rconfig.h" /* for F77_SYMBOL */


> character.c: In function `stripchars':
> character.c:269: warning: subscript has type `char'
> character.c:281: warning: subscript has type `char'
> character.c:296: warning: subscript has type `char'
> character.c:296: warning: subscript has type `char'
> character.c:304: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:312: warning: subscript has type `char'
> character.c:320: warning: subscript has type `char'
> character.c:320: warning: subscript has type `char'
> character.c:330: warning: subscript has type `char'
> character.c:330: warning: subscript has type `char'
> character.c:341: warning: subscript has type `char'
> character.c: In function `do_makenames':
> character.c:384: warning: subscript has type `char'
> character.c:395: warning: subscript has type `char'
> /usr/share/misc/bison.simple: In function `Rf_yyparse':
> /usr/share/misc/bison.simple:254: warning: `yyval' might be used
> uninitialized in this function

Those are all normal.

> regex.c: In function `re_match_2':
> regex.c:3770: warning: cast from pointer to integer of different size
> regex.c:3770: warning: cast from pointer to integer of different size

That looks like a regex bug, with a why? comment in the code. Change
(int) to (long), twice.

> regex.c:3776: warning: cast to pointer from integer of different size
> regex.c:3776: warning: cast to pointer from integer of different size
> regex.c:3923: warning: cast to pointer from integer of different size
> regex.c:3923: warning: cast to pointer from integer of different size
> regex.c:3976: warning: cast to pointer from integer of different size
> regex.c:3976: warning: cast to pointer from integer of different size
> regex.c:4082: warning: cast from pointer to integer of different size
> regex.c:4083: warning: cast from pointer to integer of different size
> regex.c:4115: warning: cast to pointer from integer of different size
> regex.c:4115: warning: cast to pointer from integer of different size
> regex.c:4128: warning: cast to pointer from integer of different size
> regex.c:4128: warning: cast to pointer from integer of different size
> regex.c:4296: warning: cast from pointer to integer of different size
> regex.c:4297: warning: cast from pointer to integer of different size

I've never seen those, but try adding

#define STDC_HEADERS 1

at the top of regex.c.  (I am not convinced that is the cause here.)

> saveload.c:495: warning: `BinarySave' defined but not used
> saveload.c:1775: warning: `NewBinarySave' defined but not used

Normal, on a platform with xdr.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 452.reply.2 <==
From pd@biostat.ku.dk  Sun Feb 20 13:28:12 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA18510;
	Sun, 20 Feb 2000 13:28:12 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id NAA31926;
	Sun, 20 Feb 2000 13:30:08 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Brad McNeney <mcneney@cs.sfu.ca>
Cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <Pine.OSF.4.21.0002191945010.433325-100000@smahlt.math.sfu.ca>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 20 Feb 2000 13:30:07 +0100
In-Reply-To: Brad McNeney's message of "Sat, 19 Feb 2000 20:11:12 -0800 (PST)"
Message-ID: <x2snyogipc.fsf@blueberry.kubism.ku.dk>
Lines: 34
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Brad McNeney <mcneney@cs.sfu.ca> writes:

> I'll see what I can do about getting a more reproducible error. 
> 
> Any tips on what to look for if I'm running R within GDB? I don't have
> much experience with the debugger. I mostly just use it to see where my
> programs are dying. But R is not -- it just gives strange error messages.

One technique is to set a breakpoint at the line that displays the
error, then you can inspect the condition that caused it (you may have
to go "up" a couple of times to get into an interesting environment.)

Sometimes, it turns out that a variable contains something that it
shouldn't due to memory corruption and then you may have to set a
breakpoint earlier in the code and then maybe a watchpoint on the
memory location.

Another thing that is useful even without gdb is to investigate the
output of traceback() and maybe set 

options(error=quote(DUMP <<- sys.status()))

which allows you to subsequently investigate any active environment at
the time of the error, e.g. using ls(envir=DUMP$sys.frames[[3]]), and
get("x",envir=DUMP$sys.frames[[3]]).

(Newer snapshots have a more elaborate dump.frames function, but the
above should do). 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.audit <==
Sun Feb 20 21:27:15 2000	ripley	moved from incoming to System-specific
Mon Feb 28 17:30:41 2000	pd	changed notes

==> 452.followup.3 <==
From mcneney@cs.sfu.ca  Sat Mar  4 19:23:48 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA25981;
	Sat, 4 Mar 2000 19:23:42 +0100 (MET)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id KAA07172;
	Sat, 4 Mar 2000 10:23:52 -0800 (PST)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id KAA0000263254; Sat, 4 Mar 2000 10:23:52 -0800 (PST)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sat, 4 Mar 2000 10:23:52 -0800 (PST)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
In-Reply-To: <x2snyogipc.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0003041022320.263210-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

I looked into the glm problem some more. Seems to be a memory problem that
occurs just after garbage collection. The easiest way for me to
reproduce  the error is in lapply. I take a list and ask lapply to provide
the descriptive stat summary. I do this several times with the same list.
Most often it gives the correct summary, but just after allocSExp calls
R_gc, one of the summaries for a list element will be NULL. 

E.g for a data frame dat with five columns I get the following (having added
print statements in summary.default and in allocSExp just after the test
for whether gc is necessary):

> lapply(as.list(dat), summary, maxsum = maxsum)
[1] "exiting summary.default"
R_FreeSEXP == NULL  
[1] "exiting summary.default"
[1] "exiting summary.default"
[1] "exiting summary.default"
[1] "exiting summary.default"
$Delta
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    1.00    1.19    2.00    2.00 

$D
NULL

$R
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    1.00    1.00    0.86    1.00    1.00 

$V
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.004552 0.740700 1.575000 1.754000 3.205000 3.390000 

$X
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0     0.0     0.5     0.5     1.0     1.0 


I don't know if the following is relevant, but for some reason I've found 
I can avoid this particular problem if I make a small change in lapply in 
its main loop.  Around line 50 of apply.c:

    PROTECT(ans = allocVector(VECSXP, n));
    for(i = 0; i < n; i++) {
        INTEGER(ind)[0] = i + 1;
        VECTOR(ans)[i] = eval(R_fcall, rho);
    }

if I change it to make an assignment to a
temporary variable first everything seems to work fine:

    PROTECT(ans = allocVector(VECSXP, n));
    for(i = 0; i < n; i++) {
        INTEGER(ind)[0] = i + 1;
        tem = eval(R_fcall, rho);
        VECTOR(ans)[i] = tem;
    }

hasn't given me any NULLs yet. 



On 20 Feb 2000, Peter Dalgaard BSA wrote:

> Brad McNeney <mcneney@cs.sfu.ca> writes:
> 
> > I'll see what I can do about getting a more reproducible error. 
> > 


==> 452.reply.3 <==
From pd@biostat.ku.dk  Sun Mar  5 01:02:38 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id BAA26687;
	Sun, 5 Mar 2000 01:02:37 +0100 (MET)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id BAA17617;
	Sun, 5 Mar 2000 01:03:15 +0100
Sender: pd@blueberry.kubism.ku.dk
To: Brad McNeney <mcneney@cs.sfu.ca>
Cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] problem with glm (PR#452)
References: <Pine.OSF.4.21.0003041022320.263210-100000@smahlt.math.sfu.ca>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 05 Mar 2000 01:03:15 +0100
In-Reply-To: Brad McNeney's message of "Sat, 4 Mar 2000 10:23:52 -0800 (PST)"
Message-ID: <x2putauvuk.fsf@blueberry.kubism.ku.dk>
Lines: 47
X-Mailer: Gnus v5.7/Emacs 20.4
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Brad McNeney <mcneney@cs.sfu.ca> writes:

> I don't know if the following is relevant, but for some reason I've found 
> I can avoid this particular problem if I make a small change in lapply in 
> its main loop.  Around line 50 of apply.c:
> 
>     PROTECT(ans = allocVector(VECSXP, n));
>     for(i = 0; i < n; i++) {
>         INTEGER(ind)[0] = i + 1;
>         VECTOR(ans)[i] = eval(R_fcall, rho);
>     }
> 
> if I change it to make an assignment to a
> temporary variable first everything seems to work fine:
> 
>     PROTECT(ans = allocVector(VECSXP, n));
>     for(i = 0; i < n; i++) {
>         INTEGER(ind)[0] = i + 1;
>         tem = eval(R_fcall, rho);
>         VECTOR(ans)[i] = tem;
>     }
> 
> hasn't given me any NULLs yet. 

Now that is pretty darn odd... Looks quite a bit like a compiler bug.
Those two pieces of code should be equivalent as far as I can see.

One thing that you might do: objdump -dS apply.o allows you to see
what code the compiler generates for the two cases. Also, of course,
you can try reducing the level of optimization.


Alternatively, the mere addition of "tem" changes the local memory use
of that function so that something that got clobbered before doesn't
get clobbered now.

The effect doesn't seem to be present on Intels:

> dfr<-do.call("data.frame",lapply(1:100,function(i)rnorm(100)))
> any(sapply(lapply(dfr,summary),is.null))
[1] FALSE

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 452.followup.4 <==
From mcneney@cs.sfu.ca  Mon May 22 03:22:00 2000
Received: from cs.sfu.ca (cs.sfu.ca [142.58.111.1])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id DAA14134;
	Mon, 22 May 2000 03:21:55 +0200 (MET DST)
Received: from smahlt.math.sfu.ca (smahlt [199.60.17.25])
	by cs.sfu.ca (8.9.1/8.9.1) with ESMTP id SAA09685;
	Sun, 21 May 2000 18:22:13 -0700 (PDT)
Received: from localhost by smahlt.math.sfu.ca (8.8.8/1.1.20.8/23Nov99-0751PM)
	id SAA0000086979; Sun, 21 May 2000 18:22:12 -0700 (PDT)
X-Authentication-Warning: smahlt.math.sfu.ca: mcneney owned process doing -bs
Date: Sun, 21 May 2000 18:22:12 -0700 (PDT)
From: Brad McNeney <mcneney@cs.sfu.ca>
X-Sender: mcneney@smahlt.math.sfu.ca
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] memory problem with DEC C (was: problem with glm (PR#452))
In-Reply-To: <x2putauvuk.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.OSF.4.21.0005211817440.86959-100000@smahlt.math.sfu.ca>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Just to update: What I originally thought was a glm problem appears to be
a memory problem that occurs only when R is compiled with the DEC C
compiler. Some variables that are still in use get clobbered during
garbage collection. No problems if I compile with gcc though. I've made
some attempts to see if I can identify a specific compiler optimization
that is responsible, but so far no luck.

Brad

On 5 Mar 2000, Peter Dalgaard BSA wrote:

> Brad McNeney <mcneney@cs.sfu.ca> writes:
> 
> > I don't know if the following is relevant, but for some reason I've found 
> > I can avoid this particular problem if I make a small change in lapply in 
> > its main loop.  Around line 50 of apply.c:
> > 
> >     PROTECT(ans = allocVector(VECSXP, n));
> >     for(i = 0; i < n; i++) {
> >         INTEGER(ind)[0] = i + 1;
> >         VECTOR(ans)[i] = eval(R_fcall, rho);
> >     }
> > 
> > if I change it to make an assignment to a
> > temporary variable first everything seems to work fine:
> > 
> >     PROTECT(ans = allocVector(VECSXP, n));
> >     for(i = 0; i < n; i++) {
> >         INTEGER(ind)[0] = i + 1;
> >         tem = eval(R_fcall, rho);
> >         VECTOR(ans)[i] = tem;
> >     }
> > 
> > hasn't given me any NULLs yet. 
> 
> Now that is pretty darn odd... Looks quite a bit like a compiler bug.
> Those two pieces of code should be equivalent as far as I can see.
> 
> One thing that you might do: objdump -dS apply.o allows you to see
> what code the compiler generates for the two cases. Also, of course,
> you can try reducing the level of optimization.
> 
> 
> Alternatively, the mere addition of "tem" changes the local memory use
> of that function so that something that got clobbered before doesn't
> get clobbered now.
> 
> The effect doesn't seem to be present on Intels:
> 
> > dfr<-do.call("data.frame",lapply(1:100,function(i)rnorm(100)))
> > any(sapply(lapply(dfr,summary),is.null))
> [1] FALSE
> 
> -- 
>    O__  ---- Peter Dalgaard             Blegdamsvej 3  
>   c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
>  (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
> 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 533 *
Subject: acepack, akima and tripack will not load 
From: mallen@tntech.edu
Date: Thu, 4 May 2000 19:18:59 +0200 (MET DST)
--related to PR#521: probably compiler-specific
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 533 <==
From mallen@tntech.edu  Thu May  4 19:19:00 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11041
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:18:59 +0200 (MET DST)
Date: Thu, 4 May 2000 19:18:59 +0200 (MET DST)
From: mallen@tntech.edu
Message-Id: <200005041718.TAA11041@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: acepack, akima and tripack will not load 

Full_Name: Michael R. Allen
Version: 1.01
OS: linux redhat
Submission from: (NULL) (149.149.32.46)


Hello,

	Thought you might be interested.  I tried to load the package tripack
needed by the sgeostat package.  After some careful searching,  three packages
were 
found which had the same error.  Here is the output.

Mike
  
> library(acepack) Error in dyn.load(x, as.logical(local),
as.logical(now)) :
        unable to load shared library
"/usr/lib/R/library/acepack/libs/acepack.so":
  /usr/lib/R/library/acepack/libs/acepack.so: undefined symbol: e_wsfe 
>library(tripack) Error in dyn.load(x, as.logical(local), as.logical(now))
:
        unable to load shared library
"/usr/lib/R/library/tripack/libs/tripack.so":
  /usr/lib/R/library/tripack/libs/tripack.so: undefined symbol: e_wsfe 
>library(akima) Error in dyn.load(x, as.logical(local), as.logical(now)) :
        unable to load shared library
"/usr/lib/R/library/akima/libs/akima.so":
  /usr/lib/R/library/akima/libs/akima.so: undefined symbol: e_wsfe      

==> 533.followup.1 <==
From ripley@stats.ox.ac.uk  Thu May  4 19:41:38 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11202
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:41:35 +0200 (MET DST)
Received: from max126.public.ox.ac.uk (max126.public.ox.ac.uk [192.76.27.126])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id SAA09846;
	Thu, 4 May 2000 18:41:45 +0100 (BST)
Date: Thu, 4 May 2000 18:40:42 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: mallen@tntech.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] acepack, akima and tripack will not load (PR#533)
In-Reply-To: <200005041719.TAA11051@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10005041827230.26380-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 4 May 2000 mallen@tntech.edu wrote:

> Full_Name: Michael R. Allen
> Version: 1.01
> OS: linux redhat
> Submission from: (NULL) (149.149.32.46)
> 
> 
> Hello,
> 
> 	Thought you might be interested.  I tried to load the package tripack
> needed by the sgeostat package.  After some careful searching,  three packages
> were 
> found which had the same error.  Here is the output.

> Mike
>   
> > library(acepack) Error in dyn.load(x, as.logical(local),
> as.logical(now)) :
>         unable to load shared library
> "/usr/lib/R/library/acepack/libs/acepack.so":
>   /usr/lib/R/library/acepack/libs/acepack.so: undefined symbol: e_wsfe 
> >library(tripack) Error in dyn.load(x, as.logical(local), as.logical(now))
> :
>         unable to load shared library
> "/usr/lib/R/library/tripack/libs/tripack.so":
>   /usr/lib/R/library/tripack/libs/tripack.so: undefined symbol: e_wsfe 
> >library(akima) Error in dyn.load(x, as.logical(local), as.logical(now)) :
>         unable to load shared library
> "/usr/lib/R/library/akima/libs/akima.so":
>   /usr/lib/R/library/akima/libs/akima.so: undefined symbol: e_wsfe      

That's a symbol from the Fortran I/O code.  There is no problem on RH6.0
on R 1.0.1, where the symbol is resolved from libg2c.a.

(1) Does FLIBS in etc/Makeconf include -lg2c?

(2) If so, do those packages have Makefiles in src? If so delete them
and reinstall.  (The latest version of akima does not, but earlier versions
did.)

(3) Does lg2c include e_wsfe?  (nm -g on it).  Is it finding the right
libg2c.a?

(4) I get nm -g ..../akima.so  giving

00013c5c T e_wsfe

and so I think it should be resolved in the *.so.

Which version of RedHat?  I suspect a RedHat inconsistency here, and other
people have reported that upgrading to the gcc-2.95.2 compiler set
solved the problem.  But it might just be old package versions.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 533.reply.1 <==
From bates@franz.stat.wisc.edu  Thu May  4 19:44:14 2000
Received: from franz.stat.wisc.edu (root@franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11222
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:44:13 +0200 (MET DST)
Received: by franz.stat.wisc.edu
	via sendmail from stdin
	id <m12nPhM-000ZTOC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for R-bugs@biostat.ku.dk; Thu, 4 May 2000 12:46:04 -0500 (CDT) 
Sender: bates@franz.stat.wisc.edu
To: mallen@tntech.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] acepack, akima and tripack will not load (PR#533)
References: <200005041719.TAA11051@pubhealth.ku.dk>
From: Douglas Bates <bates@stat.wisc.edu>
Date: 04 May 2000 12:46:04 -0500
In-Reply-To: mallen@tntech.edu's message of "Thu, 4 May 2000 19:19:01 +0200 (MET DST)"
Message-ID: <6rog6m2opv.fsf@franz.stat.wisc.edu>
Lines: 12
X-Mailer: Gnus v5.7/Emacs 20.6

mallen@tntech.edu writes:

> > library(acepack) Error in dyn.load(x, as.logical(local),
> as.logical(now)) :
>         unable to load shared library
> "/usr/lib/R/library/acepack/libs/acepack.so":
>   /usr/lib/R/library/acepack/libs/acepack.so: undefined symbol: e_wsfe 

That name e_wsfe probably comes from Fortran input/output routines.
Check if some Fortran code is trying to use a WRITE statement.  I
think there was another message this morning about this.


==> 533.reply.2 <==
From pd@blueberry.kubism.ku.dk  Thu May  4 22:04:44 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA11927
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 22:04:44 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id WAA04273;
	Thu, 4 May 2000 22:10:21 +0200
Sender: pd@blueberry.kubism.ku.dk
To: mallen@tntech.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] wsfe bug report just made (PR#533)
References: <200005041720.TAA11084@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 May 2000 22:10:21 +0200
In-Reply-To: mallen@tntech.edu's message of "Thu, 4 May 2000 19:20:36 +0200 (MET DST)"
Message-ID: <x2bt2m13gy.fsf@blueberry.kubism.ku.dk>
Lines: 29
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

mallen@tntech.edu writes:

> Full_Name: Michael R. Allen
> Version: 1.01
> OS: linux redhat 6.2
> Submission from: (NULL) (149.149.32.46)
> 
> 
> Sorry, I forgot to tell you.  I am running version 6.2 of redhat.  Also, I have
> loaded the latest version of R as well.
> 
> Mike
> 

But did you build the packages yourself and if so, how? (using which
compilers).

BTW: when you follow up on an earlier report via the web interface,
please do it as a follow-up. If you do it by mail, say for PR#533,
please include (PR#533) in the Subject line. That way things get filed
together. (I've fixed the number on this mail)



-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 533.audit <==
Thu May 18 18:06:13 2000	ripley	changed notes
Thu May 18 18:06:13 2000	ripley	moved from incoming to Add-ons
Wed Jun 07 15:09:34 2000	pd	moved from Add-ons to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 521 *
Subject: akima core dumps on loading
From: santini@dsi.unimi.it
Date: Mon, 17 Apr 2000 11:30:41 +0200 (MET DST)
--Probably compiler-specific
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 521 <==
From santini@dsi.unimi.it  Mon Apr 17 11:30:42 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA01559
	for <R-bugs@biostat.ku.dk>; Mon, 17 Apr 2000 11:30:41 +0200 (MET DST)
Date: Mon, 17 Apr 2000 11:30:41 +0200 (MET DST)
From: santini@dsi.unimi.it
Message-Id: <200004170930.LAA01559@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: akima core dumps on loading

Full_Name: Massimo santini
Version: 1.0.1
OS: Linux
Submission from: (NULL) (159.149.147.89)


I've just dl the .rpm of R 1.0.1, installed it and then launched 

	insatll.packages("akima")

after re-launching R [--vanilla], the command

	library(akima)

has the only effect to coredump the program. Here is the output of gdb and
strace...

--- GDB (commands given can be seen from the except)

$ R -d gdb
GNU gdb 19991004
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...
(gdb) run --vanilla
Starting program: /usr/lib/R/bin/R.X11 --vanilla

R : Copyright 2000, The R Development Core Team
Version 1.0.1  (April 14, 2000)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type	"?license" or "?licence" for distribution details.

R is a collaborative project with many contributors.
Type	"?contributors" for a list.

Type	"demo()" for some demos, "help()" for on-line help, or
    	"help.start()" for a HTML browser interface to help.
Type	"q()" to quit R.

> library(akima)

Program received signal SIGSEGV, Segmentation fault.
_dl_lookup_symbol (undef_name=0x2d2e3b3 <Address 0x2d2e3b3 out of bounds>,
ref=0xbfffabb4, 
    symbol_scope=0x81ec65c, reference_name=0x81e8b20
"/usr/lib/R/library/akima/libs/akima.so", reloc_type=208)
    at ../sysdeps/generic/dl-hash.h:31
31	../sysdeps/generic/dl-hash.h: No such file or directory.
(gdb) 

--- STRACE (echo "library(akima)" | strace R --vanilla)

[...]
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
stat("/usr/lib/R/library/akima/libs/akima.so", {st_mode=S_IFREG|0755,
st_size=289367, ...}) = 0
stat("/usr/lib/R/library/base/libs/akima.so", 0xbfffdb60) = -1 ENOENT (No such
file or directory)
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
open("/usr/lib/R/library/akima/libs/akima.so", O_RDONLY) = 4
fstat(4, {st_mode=S_IFREG|0755, st_size=289367, ...}) = 0
read(4, "\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0000F\0\000"..., 4096) =
4096
old_mmap(NULL, 115364, PROT_READ|PROT_EXEC, MAP_PRIVATE, 4, 0) = 0x40f3d000
mprotect(0x40f55000, 17060, PROT_NONE)  = 0
old_mmap(0x40f55000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED, 4,
0x17000) = 0x40f55000
old_mmap(0x40f57000, 8868, PROT_READ|PROT_WRITE,
MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x40f57000
close(4)                                = 0
mprotect(0x40f3d000, 98304, PROT_READ|PROT_WRITE) = 0
--- SIGSEGV (Segmentation fault) ---
+++ killed by SIGSEGV +++

==> 521.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon Apr 17 12:00:35 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA01944
	for <R-bugs@biostat.ku.dk>; Mon, 17 Apr 2000 12:00:35 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id MAA31083;
	Mon, 17 Apr 2000 12:03:19 +0200
Sender: pd@blueberry.kubism.ku.dk
To: santini@dsi.unimi.it
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] akima core dumps on loading (PR#521)
References: <200004170930.LAA01569@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 17 Apr 2000 12:03:19 +0200
In-Reply-To: santini@dsi.unimi.it's message of "Mon, 17 Apr 2000 11:30:43 +0200 (MET DST)"
Message-ID: <x2zoqtkpso.fsf@blueberry.kubism.ku.dk>
Lines: 52
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

santini@dsi.unimi.it writes:

> Full_Name: Massimo santini
> Version: 1.0.1
> OS: Linux
> Submission from: (NULL) (159.149.147.89)
> 
> 
> I've just dl the .rpm of R 1.0.1, installed it and then launched 
> 
> 	insatll.packages("akima")
> 
> after re-launching R [--vanilla], the command
> 
> 	library(akima)
> 
> has the only effect to coredump the program. Here is the output of gdb and
> strace...

Hmm. Doesn't happen here. (BTW: Remember to include as much
information about your system as you can think of. It's not obvious
whether you're running RedHat or SuSE for instance and in what
version.) 

> Program received signal SIGSEGV, Segmentation fault.
> _dl_lookup_symbol (undef_name=0x2d2e3b3 <Address 0x2d2e3b3 out of bounds>,
> ref=0xbfffabb4, 
>     symbol_scope=0x81ec65c, reference_name=0x81e8b20
> "/usr/lib/R/library/akima/libs/akima.so", reloc_type=208)
>     at ../sysdeps/generic/dl-hash.h:31
> 31	../sysdeps/generic/dl-hash.h: No such file or directory.
> (gdb) 
> 
> --- STRACE (echo "library(akima)" | strace R --vanilla)
> 
> [...]
> rt_sigprocmask(SIG_BLOCK, NULL, [], 8)  = 0
> stat("/usr/lib/R/library/akima/libs/akima.so", {st_mode=S_IFREG|0755,
> st_size=289367, ...}) = 0
> stat("/usr/lib/R/library/base/libs/akima.so", 0xbfffdb60) = -1 ENOENT (No such
> file or directory)

This would seem to be the problem: the dynamic library isn't there.
Did you get any error messages while compiling the package? (Except
for "...might be used uninitialized..." of which there are quite a few
here too).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 521.reply.2 <==
From pd@blueberry.kubism.ku.dk  Mon Apr 17 15:47:37 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA05177
	for <r-bugs@biostat.ku.dk>; Mon, 17 Apr 2000 15:47:36 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id PAA31429;
	Mon, 17 Apr 2000 15:50:37 +0200
Sender: pd@blueberry.kubism.ku.dk
To: Massimo Santini <santini@dsi.unimi.it>
Subject: Re: [Rd] akima core dumps on loading (PR#521)
Cc: r-bugs@biostat.ku.dk
References: <Pine.LNX.4.21.0004171357340.30022-100000@zorn.usr.dsi.unimi.it>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 17 Apr 2000 15:50:36 +0200
In-Reply-To: Massimo Santini's message of "Mon, 17 Apr 2000 14:00:28 +0200 (CEST)"
Message-ID: <x2snwkalar.fsf@blueberry.kubism.ku.dk>
Lines: 80
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Massimo Santini <santini@dsi.unimi.it> writes:

> > Hmm. Doesn't happen here. (BTW: Remember to include as much
> > information about your system as you can think of. It's not obvious
> > whether you're running RedHat or SuSE for instance and in what
> > version.) 
> 
> You are perfectly right. My system is an updated RedHat 6.2.

Same here...

> > > stat("/usr/lib/R/library/akima/libs/akima.so", {st_mode=S_IFREG|0755,
> > > st_size=289367, ...}) = 0
> > > stat("/usr/lib/R/library/base/libs/akima.so", 0xbfffdb60) = -1 ENOENT (No such
> > > file or directory)
> > 
> > This would seem to be the problem: the dynamic library isn't there.
> > Did you get any error messages while compiling the package? (Except
> > for "...might be used uninitialized..." of which there are quite a few
> > here too).
> 
> Non errors during the installation phase. The akima.so library is in 
> 
> 	/usr/lib/R/library/akima/libs/akima.so
> 
> where it should be (with correct premissions), but is not in
> 
> 	/usr/lib/R/library/base/libs/akima.so
> 
> (the dir /usr/lib/R/library/base/libs is missing, to be precise).

Oh. Didn't see that. Then that part is OK. Sorry.

> Have you some hint about what to do now?

Hmmm. Interesting: I can provoke the crash on *my other* RedHat6.2
computer (the one still running the egcs compiler). My stack trace says

#0  _dl_lookup_symbol (
    undef_name=0xcbf203b4 <Address 0xcbf203b4 out of bounds>,
    ref=0xbfffb234, 
    symbol_scope=0x81d3cac, 
    reference_name=0x81d3a60
    "/usr/local/src/misc/r-release/BUILD/library/akima/libs/akima.so",
    reloc_type=64) at ../sysdeps/generic/dl-hash.h:31
#1  0x400096ad in _dl_relocate_object (l=0x81d3aa8, scope=0x81d3cac, lazy=0, 
    consider_profiling=0) at ../sysdeps/i386/dl-machine.h:326
#2  0x40255be4 in dl_open_worker (a=0xbfffb3a0) at dl-open.c:182
#3  0x4000ac3b in _dl_catch_error (errstring=0xbfffb39c, 
    operate=0x40255990 <dl_open_worker>, args=0xbfffb3a0) at dl-error.c:141
#4  0x40255d3d in _dl_open (
    file=0xbfffc51c 
"/usr/local/src/misc/r-release/BUILD/library/akima/libs/akima.so",
mode=2, caller=0xbfffb39c) at dl-open.c:232
#5  0x401323d3 in dlopen_doit (a=0xbfffb4b0) at dlopen.c:41
#6  0x4000ac3b in _dl_catch_error (errstring=0x40134080, 
    operate=0x401323a8 <dlopen_doit>, args=0xbfffb4b0) at
dl-error.c:141
#7  0x401328b9 in _dlerror_run (operate=0x401323a8 <dlopen_doit>, 
    args=0xbfffb4b0) at dlerror.c:125
#8  0x40132393 in __dlopen_check (
    file=0xbfffc51c
"/usr/local/src/misc/r-release/BUILD/library/akima/libs/akima.so",
mode=2) at dlopen.c:53
#9  0x80d9cc3 in AddDLL (
    path=0xbfffc51c
"/usr/local/src/misc/r-release/BUILD/library/akima/libs/akim
a.so", asLocal=1, now=1) at ../../../R/src/unix/dynload.c:207


Looks like it is happening during the dynamic linking itself. Doesn't
look nice. (But installing gcc 2.95.2 might fix your problem.)

[diverted back to r-bugs]

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 521.audit <==
Tue Apr 25 07:04:44 2000	ripley	changed notes
Tue Apr 25 07:04:44 2000	ripley	moved from incoming to Add-ons
Wed Jun 07 15:09:34 2000	pd	moved from Add-ons to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 547 *
Subject: system(.., ignore.stderr = TRUE)  problem on Solaris
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Fri, 19 May 2000 21:12:02 +0200 (CEST)
--redirection of stderr to /dev/null in system occurs before the command
--is tried on some systems and after on others.
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 547 <==
From maechler@stat.math.ethz.ch  Fri May 19 21:11:52 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id VAA02032
	for <R-bugs@biostat.ku.dk>; Fri, 19 May 2000 21:11:51 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id VAA08262
	for <R-bugs@stat.math.ethz.ch>; Fri, 19 May 2000 21:12:10 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa00214; Fri May 19 21:12:03 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id VAA02922; Fri, 19 May 2000 21:12:02 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14629.37378.591438.574955@lynne.ethz.ch>
Date: Fri, 19 May 2000 21:12:02 +0200 (CEST)
To: R-bugs@stat.math.ethz.ch
Subject: system(.., ignore.stderr = TRUE)  problem on Solaris
X-Mailer: VM 6.75 under Emacs 20.6.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

(i.e. my version Solaris, see below...)

Note that system() is not only implemented quite system-dependently
(which you'd very much expect!) but also Unix and Windows have quite
different arguments apart from the first two.

Hence all the following is ``Unix-only'' :


A user stumbled across this when using read.table.url(.) on a platform
where no "wget" is installed: 

The data is read ok, but an ugly message appears *before* the command is
completed :
	  -------------------
	  sh: wget: not found
	  -------------------
which made the user believe that the data wasn't read properly.

The problem is easily tracked to the system(..) call in download.file()
{which does not (yet) have the "ignore.stderr = TRUE" setting, btw}
and found that on our Solaris environment, 
the ignore.stderr argument does not seem to have any effect, i.e.

  > system("bla", ignore.stderr = TRUE)

gives the same as  system("bla"), namely
  
  sh: bla: not found
 
On my Linux environment,  ignore.stderr works as advertized.

Further note that  help(system)  should probably also say something about which
shell may or may not be used (I think we decided that we want it to be `sh'
on Unix).


--please do not edit the information below-- {did anyway ;=)}

Version:
 platform = sparc-sun-solaris2.5.1
 arch = sparc
 os = solaris2.5.1
 system = sparc, solaris2.5.1

 --- either R-devel of today, or also 1.0.1 ---

 year = 2000
 month = May
 day = 18
 language = R

Search Path:
 .GlobalEnv, package:SfS, Autoloads, package:base



==> 547.followup.1 <==
From ripley@stats.ox.ac.uk  Fri May 19 23:47:26 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA02579
	for <R-bugs@biostat.ku.dk>; Fri, 19 May 2000 23:47:25 +0200 (MET DST)
Received: from max163.public.ox.ac.uk (max163.public.ox.ac.uk [192.76.27.163])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id WAA06872;
	Fri, 19 May 2000 22:47:38 +0100 (BST)
Date: Fri, 19 May 2000 22:46:09 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: maechler@stat.math.ethz.ch
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] system(.., ignore.stderr = TRUE)  problem on Solaris (PR#547)
In-Reply-To: <200005191911.VAA02042@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10005192223470.4118-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 19 May 2000 maechler@stat.math.ethz.ch wrote:

> (i.e. my version Solaris, see below...)
> 
> Note that system() is not only implemented quite system-dependently
> (which you'd very much expect!) but also Unix and Windows have quite
> different arguments apart from the first two.
> 
> Hence all the following is ``Unix-only'' :
> 
> 
> A user stumbled across this when using read.table.url(.) on a platform
> where no "wget" is installed: 
> 
> The data is read ok, but an ugly message appears *before* the command is
> completed :
> 	  -------------------
> 	  sh: wget: not found
> 	  -------------------
> which made the user believe that the data wasn't read properly.
> 
> The problem is easily tracked to the system(..) call in download.file()
> {which does not (yet) have the "ignore.stderr = TRUE" setting, btw}
> and found that on our Solaris environment, 
> the ignore.stderr argument does not seem to have any effect, i.e.
> 
>   > system("bla", ignore.stderr = TRUE)
> 
> gives the same as  system("bla"), namely
>   
>   sh: bla: not found

Under sh you cannot redirect the output from a command until the command
is running.  That is, you are not redirecting the error messages from sh,
only from the command.  Unless the command runs, ignore.stderr has no
effect.

> On my Linux environment,  ignore.stderr works as advertized.

Depends how you read the advertising.

> Further note that  help(system)  should probably also say something about which
> shell may or may not be used (I think we decided that we want it to be `sh'
> on Unix).

Yes, and you almost certainly got bash *not* sh on your Linux, and that
behaves differently.  I think you will find that a closer sh clone (such as
ash) does show the error message.  That some Linux systems claim to have sh
and do not is a major compatibility problem in writing shell scripts and
Makefiles, as we keep finding.

BTW, Solaris will use ksh not sh for the shell if it needs to be POSIX
compatible. And ksh behaves like bash in this respect.


I believe that to define this portably we are going to have to do something
a lot more complicated than accept what the system() call gives us. Are you
volunteering, Martin?


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 547.audit <==
Sun May 21 07:18:08 2000	ripley	changed notes
Sun May 21 07:18:08 2000	ripley	moved from incoming to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 537 *
Subject: eigen broken on AIX with R-devel?
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 08 May 2000 12:01:04 -0400
--AIX, probably compiler-specific
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 537 <==
From tov@ece.cmu.edu  Mon May  8 18:00:51 2000
Received: from ece.cmu.edu (ECE.CMU.EDU [128.2.236.200])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA10501
	for <r-bugs@biostat.ku.dk>; Mon, 8 May 2000 18:00:51 +0200 (MET DST)
Received: from bavaria.ece.cmu.edu (root@BAVARIA.ECE.CMU.EDU [128.2.216.38])
	by ece.cmu.edu (8.9.2/8.8.8) with ESMTP id MAA09223;
	Mon, 8 May 2000 12:01:04 -0400 (EDT)
Received: (from tov@localhost)
	by bavaria.ece.cmu.edu (8.9.3/8.9.3/Debian 8.9.3-21) id MAA00641;
	Mon, 8 May 2000 12:01:04 -0400
Sender: tov@bavaria.ece.cmu.edu
To: r-bugs@biostat.ku.dk
Cc: Thomas Vogels <tov@ece.cmu.edu>
Subject: eigen broken on AIX with R-devel?
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 08 May 2000 12:01:04 -0400
Message-ID: <87ln1ldoan.fsf@bavaria.ece.cmu.edu>
Lines: 61
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.5
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.

Here are the results:

R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
R> m
     [,1] [,2]
[1,]  6.8  2.4
[2,]  2.4  8.2
R> eigen(m)
$values
[1] 19.281403  6.337993

$vectors
          [,1]       [,2]
[1,] 0.1918866  0.9967987
[2,] 0.9967987 -0.1918866


And for comparison, here is what I get on a Sun (with r-stable):

R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
R> eigen (m)
$values
[1] 10  5

$vectors
     [,1] [,2]
[1,]  0.6  0.8
[2,]  0.8 -0.6


I found this by running "make check" which also stumbles over svd.
Please let me know how I can help to investigate this.

  -tom


--please do not edit the information below--

Version:
 platform = powerpc-ibm-aix4.3.2.0
 arch = powerpc
 os = aix4.3.2.0
 system = powerpc, aix4.3.2.0
 status = Under development (unstable)
 major = 1
 minor = 1.0
 year = 2000
 month = May
 day = 3
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base


-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204


==> 537.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon May  8 20:41:00 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA11280
	for <R-bugs@biostat.ku.dk>; Mon, 8 May 2000 20:40:59 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id UAA29246;
	Mon, 8 May 2000 20:47:12 +0200
Sender: pd@blueberry.kubism.ku.dk
To: tov@ece.cmu.edu
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] eigen broken on AIX with R-devel? (PR#537)
References: <200005081600.SAA10511@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 May 2000 20:47:12 +0200
In-Reply-To: tov@ece.cmu.edu's message of "Mon, 8 May 2000 18:00:52 +0200 (MET DST)"
Message-ID: <x2hfc86frj.fsf@blueberry.kubism.ku.dk>
Lines: 25
X-Mailer: Gnus v5.7/Emacs 20.5
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

tov@ece.cmu.edu writes:

> Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.

Hmm. We had a similar report a while back and it turned out to be
system specific. I believe the report was from Chong Gu.

> Version:
>  platform = powerpc-ibm-aix4.3.2.0
>  arch = powerpc
>  os = aix4.3.2.0
>  system = powerpc, aix4.3.2.0
>  status = Under development (unstable)
>  major = 1
>  minor = 1.0
>  year = 2000
>  month = May
>  day = 3
>  language = R

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 537.reply.2 <==
From thomas@biostat.washington.edu  Tue May  9 17:38:55 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA21900
	for <R-bugs@biostat.ku.dk>; Tue, 9 May 2000 17:38:54 +0200 (MET DST)
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-99-05-16b) with ESMTP id IAA05789;
	Tue, 9 May 2000 08:39:05 -0700 (PDT)
Date: Tue, 9 May 2000 08:39:05 -0700 (PDT)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: tov@ece.cmu.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] eigen broken on AIX with R-devel? (PR#537)
In-Reply-To: <200005081600.SAA10511@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0005090837420.4639-100000@mail.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Mon, 8 May 2000 tov@ece.cmu.edu wrote:

> 
> Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.
> 

When we last saw this bug it was compiler-specific.  gcc/g77 worked but
cc/f77 didn't (and I think gcc/f77 wouldn't even configure). 

I don't think we understand the bug, though.

	-thomas


==> 537.audit <==
Thu May 18 18:07:40 2000	ripley	changed notes
Thu May 18 18:07:40 2000	ripley	moved from incoming to System-specific

==> 537.followup.1 <==
From tov@ece.cmu.edu  Thu Jun 15 19:57:37 2000
Received: from ece.cmu.edu (ECE.CMU.EDU [128.2.236.200])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA25634
	for <R-bugs@biostat.ku.dk>; Thu, 15 Jun 2000 19:57:36 +0200 (MET DST)
Received: from bavaria.ece.cmu.edu (root@BAVARIA.ECE.CMU.EDU [128.2.216.38])
	by ece.cmu.edu (8.9.2/8.8.8) with ESMTP id NAA24895;
	Thu, 15 Jun 2000 13:57:55 -0400 (EDT)
Received: (from tov@localhost)
	by bavaria.ece.cmu.edu (8.9.3/8.9.3/Debian 8.9.3-21) id NAA03271;
	Thu, 15 Jun 2000 13:57:55 -0400
Sender: tov@bavaria.ece.cmu.edu
To: r-devel@stat.math.ethz.ch
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] eigen broken on AIX with R-devel? (PR#537)
References: <200005081600.SAA10511@pubhealth.ku.dk>
Reply-To: Thomas Vogels <tov@ece.cmu.edu>
X-URI: http://www.ece.cmu.edu/~tov
From: Thomas J Vogels <tov@ece.cmu.edu>
Date: 15 Jun 2000 13:57:55 -0400
In-Reply-To: tov@ece.cmu.edu's message of "Mon, 8 May 2000 18:00:52 +0200 (MET DST)"
Message-ID: <87vgzax1wc.fsf@bavaria.ece.cmu.edu>
Lines: 50
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.6
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii


Hi, I ran the test again with the newly released version of R (1.1) and I
now get the correct eigen values.  ("make check" succeeds.)

The scary part is that I think that I also used gcc+f77 last time and
the libs weren't changed.  Maybe the scary part is that I think...

So the comments that this is compiler specific probably hold.

Thanks,
  -tom


tov@ece.cmu.edu writes:

> Hi,  I get the wrong eigen values on an AIX machine with R-devel of 5/3/00.
> 
> Here are the results:
> 
> R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
> R> m
>      [,1] [,2]
> [1,]  6.8  2.4
> [2,]  2.4  8.2
> R> eigen(m)
> $values
> [1] 19.281403  6.337993
> 
> $vectors
>           [,1]       [,2]
> [1,] 0.1918866  0.9967987
> [2,] 0.9967987 -0.1918866
> 
> 
> And for comparison, here is what I get on a Sun (with r-stable):

(same results now on AIX 4.3 with R 1.1.0 

> R> m <- matrix (c(6.8, 2.4, 2.4, 8.2), nrow=2)
> R> eigen (m)
> $values
> [1] 10  5
> 
> $vectors
>      [,1] [,2]
> [1,]  0.6  0.8
> [2,]  0.8 -0.6

-- 
mailto:tov@ece.cmu.edu (Tom Vogels)   Tel: (412) 268-6638   FAX: -3204
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 534 *
Subject: wsfe bug report just made
From: mallen@tntech.edu
Date: Thu, 4 May 2000 19:20:35 +0200 (MET DST)
--follow up to PR#533
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 534 <==
From mallen@tntech.edu  Thu May  4 19:20:35 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA11074
	for <R-bugs@biostat.ku.dk>; Thu, 4 May 2000 19:20:35 +0200 (MET DST)
Date: Thu, 4 May 2000 19:20:35 +0200 (MET DST)
From: mallen@tntech.edu
Message-Id: <200005041720.TAA11074@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: wsfe bug report just made

Full_Name: Michael R. Allen
Version: 1.01
OS: linux redhat 6.2
Submission from: (NULL) (149.149.32.46)


Sorry, I forgot to tell you.  I am running version 6.2 of redhat.  Also, I have
loaded the latest version of R as well.

Mike

==> 534.audit <==
Thu May 18 18:06:31 2000	ripley	changed notes
Thu May 18 18:06:31 2000	ripley	moved from incoming to Add-ons
Wed Jun 07 15:09:34 2000	pd	moved from Add-ons to System-specific
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Directory:  TooMuchAtOnce

none

Directory:  Windows

none

Directory:  incoming

* PR# 695 *
Subject:  Cautionary tale about c 
From: J.C.Rougier@durham.ac.uk
Date: Fri, 13 Oct 2000 15:57:27 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 695 <==
From J.C.Rougier@durham.ac.uk  Fri Oct 13 16:57:08 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA18489
	for <r-bugs@biostat.ku.dk>; Fri, 13 Oct 2000 16:57:08 +0200 (MET DST)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e9DEvRd05773
	for <r-bugs@biostat.ku.dk>; Fri, 13 Oct 2000 15:57:27 +0100 (BST)
Received: from laplace by euclid id <PAA01883@euclid>; Fri, 13 Oct 2000 15:57:26 +0100 (BST)
Date: Fri, 13 Oct 2000 15:57:27 +0100 (BST)
Message-Id: <2436.200010131457@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  Cautionary tale about c 

This situation arose in a computer practical this morning.  A
student overwrote "c" with a function.  This messes up lots of
things, but it is difficult to remove the function "c" from the
global environment because it is used as a function in both "rm"
and "remove".  [The solution was to reassign "c" as a number, and
then remove it.]  Would it be reasonable in "rm" and "remove" to
insist that the "c" function is got from the base?  The same
might apply to ".Internal" and "as.character", which are also
used.

Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 695.reply.1 <==
From pd@biostat.ku.dk  Fri Oct 13 17:24:58 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA18760;
	Fri, 13 Oct 2000 17:24:57 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id RAA27027;
	Fri, 13 Oct 2000 17:34:08 +0200
Sender: pd@blueberry.kubism.ku.dk
To: J.C.Rougier@durham.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Cautionary tale about c (PR#695)
References: <200010131457.QAA18499@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 13 Oct 2000 17:34:07 +0200
In-Reply-To: J.C.Rougier@durham.ac.uk's message of "Fri, 13 Oct 2000 16:57:09 +0200 (MET DST)"
Message-ID: <x2r95k7o28.fsf@blueberry.kubism.ku.dk>
Lines: 28
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

J.C.Rougier@durham.ac.uk writes:

> This situation arose in a computer practical this morning.  A
> student overwrote "c" with a function.  This messes up lots of
> things, but it is difficult to remove the function "c" from the
> global environment because it is used as a function in both "rm"
> and "remove".  [The solution was to reassign "c" as a number, and
> then remove it.]  Would it be reasonable in "rm" and "remove" to
> insist that the "c" function is got from the base?  The same
> might apply to ".Internal" and "as.character", which are also
> used.

Hmm. This would seem to be doable by having line 2 of rm() as

get("c","package:base")(list, names)

You do have to be circumspect: there are calls to match(),
as.character(), and pos.to.env() in that construction, but neither
uses c().
 
Currently, get("c", envir=NULL) also works, but (for other reasons)
I'm on the warpath against using NULL for the base environment.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 695.reply.2 <==
From thomas@biostat.washington.edu  Fri Oct 13 17:32:32 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA18840;
	Fri, 13 Oct 2000 17:32:31 +0200 (MET DST)
Received: from atlas (atlas [128.95.21.66])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-2000-05-16a) with ESMTP id IAA18054;
	Fri, 13 Oct 2000 08:32:36 -0700 (PDT)
Date: Fri, 13 Oct 2000 08:32:36 -0700 (PDT)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
cc: J.C.Rougier@durham.ac.uk, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Cautionary tale about c (PR#695)
In-Reply-To: <x2r95k7o28.fsf@blueberry.kubism.ku.dk>
Message-ID: <Pine.GSO.4.21.0010130831010.20300-100000@atlas.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On 13 Oct 2000, Peter Dalgaard BSA wrote:

> J.C.Rougier@durham.ac.uk writes:
> 
> > This situation arose in a computer practical this morning.  A
> > student overwrote "c" with a function.  This messes up lots of
> > things, but it is difficult to remove the function "c" from the
> > global environment because it is used as a function in both "rm"
> > and "remove".  [The solution was to reassign "c" as a number, and
> > then remove it.]  Would it be reasonable in "rm" and "remove" to
> > insist that the "c" function is got from the base?  The same
> > might apply to ".Internal" and "as.character", which are also
> > used.
> 
> Hmm. This would seem to be doable by having line 2 of rm() as
> 
> get("c","package:base")(list, names)
> 
> You do have to be circumspect: there are calls to match(),
> as.character(), and pos.to.env() in that construction, but neither
> uses c().
>  
> Currently, get("c", envir=NULL) also works, but (for other reasons)
> I'm on the warpath against using NULL for the base environment.

You can use .Primitive("c")(list, names) in this case, which doesn't rely
on any other functions.

Trying to do something similar for, say, as.character, assumes that
as.character is more likely to be redefined than `get', which I don't
believe

	-thomas



==> 695.followup.1 <==
From luke@goose.stat.umn.edu  Fri Oct 13 17:41:36 2000
Received: from mhub0.tc.umn.edu (IDENT:0@mhub0.tc.umn.edu [128.101.131.40])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA18951
	for <R-bugs@biostat.ku.dk>; Fri, 13 Oct 2000 17:41:35 +0200 (MET DST)
Received: from goose.stat.umn.edu by mhub0.tc.umn.edu with ESMTP; Fri, 13 Oct 2000 10:41:47 -0500
Received: (from luke@localhost)
	by goose.stat.umn.edu (8.9.1/8.9.1) id KAA25280;
	Fri, 13 Oct 2000 10:42:44 -0500 (CDT)
Message-Id: <200010131542.KAA25280@goose.stat.umn.edu>
Subject: Re: [Rd] Cautionary tale about c (PR#695)
In-Reply-To: <200010131457.QAA18499@pubhealth.ku.dk> from "J.C.Rougier@durham.ac.uk" at "Oct 13, 2000 04:57:09 pm"
To: J.C.Rougier@durham.ac.uk
Date: Fri, 13 Oct 2000 10:42:44 -0500 (CDT)
From: Luke Tierney <luke@goose.stat.umn.edu>
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
X-Mailer: ELM [version 2.4ME+ PL54 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

J.C.Rougier@durham.ac.uk wrote:
> This situation arose in a computer practical this morning.  A
> student overwrote "c" with a function.  This messes up lots of
> things, but it is difficult to remove the function "c" from the
> global environment because it is used as a function in both "rm"
> and "remove".  [The solution was to reassign "c" as a number, and
> then remove it.]  Would it be reasonable in "rm" and "remove" to
> insist that the "c" function is got from the base?  The same
> might apply to ".Internal" and "as.character", which are also
> used.
> 

One thing we've been talking about a bit is adding some form of name
space management.  This would insure the the c referred to in rm would
be the c in base.

luke

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
313 Ford Hall, 224 Church St. S.E.           email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 652 *
Subject: R INSTALL *.tgz fails (minor docs/feature bug)
From: RPO <bobbyo@speakeasy.org>
Date: Sat, 2 Sep 2000 13:34:22 -0700 (PDT)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 652 <==
From bobbyo@speakeasy.org  Sat Sep  2 22:58:50 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA19058
	for <R-bugs@biostat.ku.dk>; Sat, 2 Sep 2000 22:58:19 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id WAA28855
	for <R-bugs@hypatia.math.ethz.ch>; Sat, 2 Sep 2000 22:58:36 +0200 (MET DST)
Received: from gonzo.speakeasy.net(216.254.0.5)
 via SMTP by hypatia, id smtpdAAAa0072o; Sat Sep  2 22:58:34 2000
Received: (qmail 11785 invoked from network); 2 Sep 2000 20:58:31 -0000
Received: from unknown (HELO karmata) (64.81.53.232)
  by gonzo.speakeasy.net with SMTP; 2 Sep 2000 20:58:31 -0000
Received: from localhost (bobbyo@localhost)
	by karmata (8.9.3/8.8.7) with ESMTP id NAA17102
	for <R-bugs@lists.r-project.org>; Sat, 2 Sep 2000 13:35:23 -0700
X-Authentication-Warning: karmata: bobbyo owned process doing -bs
Date: Sat, 2 Sep 2000 13:34:22 -0700 (PDT)
From: RPO <bobbyo@speakeasy.org>
X-Sender: bobbyo@karmata
To: R-bugs@stat.math.ethz.ch
Subject: R INSTALL *.tgz fails (minor docs/feature bug)
Message-ID: <Pine.LNX.4.10.10009021313490.15970-100000@karmata>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

R Team,

	I was attempting to install Lindsey's rmutil.tgz and other
non-CRAN packages using 'R INSTALL', for example 'R INSTALL rmutil.tgz'
after downloading 'rmutil.tgz' from Lindsey's page (as linked from
r-project.org page).

	Directly using the compressed file as 'R INSTALL rmutil.tgz'
failed, though the shell help from 'R INSTALL --help' implied this would
work.

	However, when I simply renamed using 'mv rmutil.tgz rmutil' and
then ran 'R INSTALL rmutil', that worked.

	Adding a note to rename the .tgz files without the .tgz
extension, or changing R INSTALL to allow filename extensions when
installing would be a nice ease-of-use feature.

	(by the way, I was able to use R INSTALL rmutil if I unpacked
rmutil using 'cat rmutil.tgz | tar xvz' and then ran 'R INSTALL rmutil'.)

Keep up the Excellent Work,
	RPO

p.s. Thanks for a wonderful piece of software. R is a real boon to my
research.
	

------ Robert Otillar		| UCSF Graduate Group in Biophysics	------
------ 833 Ashbury #2		| mailto:BobbyO@itsa.ucsf.edu		------
------ San Francisco, CA  94117	| http://bioinformatics.ucsf.edu/bobbyo	------
------ Tel. <send email>	| Fax (415)759-6579			------


==> 652.reply.1 <==
From thomas@biostat.washington.edu  Mon Sep  4 19:16:31 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA01825
	for <R-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 19:16:29 +0200 (MET DST)
Received: from atlas (atlas [128.95.21.66])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-2000-05-16a) with ESMTP id KAA01646;
	Mon, 4 Sep 2000 10:16:44 -0700 (PDT)
Date: Mon, 4 Sep 2000 10:16:43 -0700 (PDT)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: bobbyo@speakeasy.org
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] R INSTALL *.tgz fails (minor docs/feature bug) (PR#652)
In-Reply-To: <200009022058.WAA19068@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0009041012110.6541-100000@atlas.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Sat, 2 Sep 2000 bobbyo@speakeasy.org wrote:

> R Team,
> 
> 	I was attempting to install Lindsey's rmutil.tgz and other
> non-CRAN packages using 'R INSTALL', for example 'R INSTALL rmutil.tgz'
> after downloading 'rmutil.tgz' from Lindsey's page (as linked from
> r-project.org page).
> 
> 	Directly using the compressed file as 'R INSTALL rmutil.tgz'
> failed, though the shell help from 'R INSTALL --help' implied this would
> work.
> 
> 	However, when I simply renamed using 'mv rmutil.tgz rmutil' and
> then ran 'R INSTALL rmutil', that worked.
> 
> 	Adding a note to rename the .tgz files without the .tgz
> extension, or changing R INSTALL to allow filename extensions when
> installing would be a nice ease-of-use feature.
> 
> 	(by the way, I was able to use R INSTALL rmutil if I unpacked
> rmutil using 'cat rmutil.tgz | tar xvz' and then ran 'R INSTALL rmutil'.)


R INSTALL is somewhat fussy about package format when used on compressed
files. I don't think Jim Lindsey's packages have ever installed without
uncompressing first. I have had the same thing happen with local packages
of functions I've created for convenience.

Fortunately it's fairly painless to uncompress them.

	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle


==> 652.followup.1 <==
From duncan@jessie.research.bell-labs.com  Mon Sep  4 19:43:43 2000
Received: from dirty.research.bell-labs.com (dirty.research.bell-labs.com [204.178.16.6])
	by pubhealth.ku.dk (8.9.3/8.9.1) with SMTP id TAA01927
	for <R-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 19:43:42 +0200 (MET DST)
Received: from grubby.research.bell-labs.com ([135.104.2.9]) by dirty; Mon Sep  4 13:43:55 EDT 2000
Received: from jessie.research.bell-labs.com ([135.104.13.5]) by grubby; Mon Sep  4 13:43:54 EDT 2000
Received: (from duncan@localhost)
	by jessie.research.bell-labs.com (8.9.1/8.9.1) id NAA07492;
	Mon, 4 Sep 2000 13:43:53 -0400 (EDT)
Date: Mon, 4 Sep 2000 13:43:53 -0400 (EDT)
Message-Id: <200009041743.NAA07492@jessie.research.bell-labs.com>
From: Duncan Temple Lang <duncan@research.bell-labs.com>
To: thomas@biostat.washington.edu
CC: bobbyo@speakeasy.org, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
In-reply-to: 
	<Pine.GSO.4.21.0009041012110.6541-100000@atlas.biostat.washington.edu>
	(message from Thomas Lumley on Mon, 4 Sep 2000 10:16:43 -0700 (PDT))
Subject: Re: [Rd] R INSTALL *.tgz fails (minor docs/feature bug) (PR#652)
X-Face: "-B@gD<H#d,U_A1#@;%<MCz$zrbe^[kJIL.@hiUSl)_=]>k&8,m^c1aAuJ/?XfZsGV0y4;<
 P#:ZFk9)]6:TdNS*U,9Xzi6*Z3R'rOl6=jIE9|L$$.]gj/d,WvWT5>c#B=`J&K`l\1;uxte!P]HYJ!
 aY)lqH}eGawrs\hosVr=|msz,=5s$?&i#nuD/l3M%.o,f#txg"@G\p@q.p$VtokBpE9



I believe the problem with this is that the R INSTALL expects version
information in the name of the .tar.gz or .tgz file.
So something like
   rmutil_1.0.tgz 
and 
   R CMD INSTALL rmutil_1.0.tgz
avoids that particular problem.
(Specifically, it computes the package name by removing everything
after the first _ in the name of the file.)

It took me a while to find out what was happening some months ago so I
thought I'd save others that hassle.


  D.

> Date: Mon, 4 Sep 2000 10:16:43 -0700 (PDT)
> From: Thomas Lumley <thomas@biostat.washington.edu>
> cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
> Sender: owner-r-devel@stat.math.ethz.ch
> Precedence: bulk
> 
> On Sat, 2 Sep 2000 bobbyo@speakeasy.org wrote:
> 
> > R Team,
> > 
> > 	I was attempting to install Lindsey's rmutil.tgz and other
> > non-CRAN packages using 'R INSTALL', for example 'R INSTALL rmutil.tgz'
> > after downloading 'rmutil.tgz' from Lindsey's page (as linked from
> > r-project.org page).
> > 
> > 	Directly using the compressed file as 'R INSTALL rmutil.tgz'
> > failed, though the shell help from 'R INSTALL --help' implied this would
> > work.
> > 
> > 	However, when I simply renamed using 'mv rmutil.tgz rmutil' and
> > then ran 'R INSTALL rmutil', that worked.
> > 
> > 	Adding a note to rename the .tgz files without the .tgz
> > extension, or changing R INSTALL to allow filename extensions when
> > installing would be a nice ease-of-use feature.
> > 
> > 	(by the way, I was able to use R INSTALL rmutil if I unpacked
> > rmutil using 'cat rmutil.tgz | tar xvz' and then ran 'R INSTALL rmutil'.)
> 
> 
> R INSTALL is somewhat fussy about package format when used on compressed
> files. I don't think Jim Lindsey's packages have ever installed without
> uncompressing first. I have had the same thing happen with local packages
> of functions I've created for convenience.
> 
> Fortunately it's fairly painless to uncompress them.
> 
> 	-thomas
> 
> Thomas Lumley
> Assistant Professor, Biostatistics
> University of Washington, Seattle
> 
> -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
> r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
> Send "info", "help", or "[un]subscribe"
> (in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
> _._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._
> 


-- 
_______________________________________________________________

Duncan Temple Lang                duncan@research.bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-3217
700 Mountain Avenue, Room 2C-259  fax:    (908)582-3340
Murray Hill, NJ  07974-2070       
         http://cm.bell-labs.com/stat/duncan

      "Languages shape the way we think, and determine what 
       we can think about."        
                                      Benjamin Whorf
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 640 *
Subject: diff.default / diff.ts in wrong package bug
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 21 Aug 2000 18:28:36 +0200 (CEST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 640 <==
From maechler@stat.math.ethz.ch  Mon Aug 21 18:28:21 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA21501
	for <R-bugs@biostat.ku.dk>; Mon, 21 Aug 2000 18:28:20 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA17927
	for <R-bugs@stat.math.ethz.ch>; Mon, 21 Aug 2000 18:28:39 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa004O5; Mon Aug 21 18:28:37 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id SAA02067; Mon, 21 Aug 2000 18:28:36 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14753.22708.573649.200248@gargle.gargle.HOWL>
Date: Mon, 21 Aug 2000 18:28:36 +0200 (CEST)
To: R-bugs@stat.math.ethz.ch
Subject: diff.default / diff.ts in wrong package bug
X-Mailer: VM 6.75 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

{all recent versions of R}

Problem / design bug :

  diff.default() doesn't deal with "ts" objects properly,
  diff.ts() does, but that is only available from package "ts"
  where as the constructor function ts() is in base.

It's not sufficient to just move diff.ts() to package base,
since it relies itself on lag & lag.default which are also only in package 
ts.

----------------------------------------------------

A simple example :

> diff(ts(1:50, start= 1980, frequency = 12))
Error in tsp<-(*tmp*, value = c(xtsp[1] + lag * differences * xtsp[3],  : 
	invalid time series parameters specified

> library(ts)

> diff(ts(1:50, start= 1980, frequency = 12))
     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1980       1   1   1   1   1   1   1   1   1   1   1
1981   1   1   1   1   1   1   1   1   1   1   1   1
1982   1   1   1   1   1   1   1   1   1   1   1   1
1983   1   1   1   1   1   1   1   1   1   1   1   1
1984   1   1                                        

------
Martin

==> 640.reply.1 <==
From maechler@stat.math.ethz.ch  Tue Aug 22 18:36:15 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA03675
	for <R-bugs@biostat.ku.dk>; Tue, 22 Aug 2000 18:36:14 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id SAA08439
	for <R-bugs@biostat.ku.dk>; Tue, 22 Aug 2000 18:36:31 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa0023o; Tue Aug 22 18:36:21 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id SAA03976; Tue, 22 Aug 2000 18:36:21 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14754.44037.181539.245494@gargle.gargle.HOWL>
Date: Tue, 22 Aug 2000 18:36:21 +0200 (CEST)
To: R-bugs@biostat.ku.dk
Subject: Re: [Rd] diff.default / diff.ts in wrong package bug (PR#640)
In-Reply-To: <200008211628.SAA21511@pubhealth.ku.dk>
References: <200008211628.SAA21511@pubhealth.ku.dk>
X-Mailer: VM 6.75 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:

    MM> {all recent versions of R} Problem / design bug :

    MM>   diff.default() doesn't deal with "ts" objects properly, diff.ts()
    MM> does, but that is only available from package "ts" where as the
    MM> constructor function ts() is in base.

    MM> It's not sufficient to just move diff.ts() to package base, since
    MM> it relies itself on lag & lag.default which are also only in
    MM> package ts.

    MM> ----------------------------------------------------

    MM> A simple example :

    >> diff(ts(1:50, start= 1980, frequency = 12))
    MM> Error in tsp<-(*tmp*, value = c(xtsp[1] + lag * differences *
    MM> xtsp[3], : invalid time series parameters specified

    >> library(ts)

    >> diff(ts(1:50, start= 1980, frequency = 12))
    MM>      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec 1980 1 1 1 1 1
    MM> 1 1 1 1 1 1 1981 1 1 1 1 1 1 1 1 1 1 1 1 1982 1 1 1 1 1 1 1 1 1 1 1
    MM> 1 1983 1 1 1 1 1 1 1 1 1 1 1 1 1984 1 1

---
answering myself :

One easy and "clean" fix is to put the following at the very beginning of
diff.default :

    if(is.ts(x)) {
        require(ts)
        UseMethod("diff")
    }

{and then remove the "tsp" stuff at the end of diff.default()}.

Now
	diff(ts(1:20))
gives a one line message
-------------------------------------
Loading required package: ts 
-------------------------------------
but I think this is really okay and desired to some extent.

As Prof Ripley pointed out in a private e-mail to me,
package ts  should really be used for everything "ts"ish,
but then we want to have very basic "ts" functionality in package base...

The above passes "make check" (and more).

Anybody against this?

Martin

==> 640.reply.2 <==
From pd@blueberry.kubism.ku.dk  Tue Aug 22 18:54:23 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA03768
	for <R-bugs@biostat.ku.dk>; Tue, 22 Aug 2000 18:54:23 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id SAA13690;
	Tue, 22 Aug 2000 18:58:40 +0200
Sender: pd@blueberry.kubism.ku.dk
To: maechler@stat.math.ethz.ch
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] diff.default / diff.ts in wrong package bug (PR#640)
References: <200008221636.SAA03685@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 22 Aug 2000 18:58:39 +0200
In-Reply-To: maechler@stat.math.ethz.ch's message of "Tue, 22 Aug 2000 18:36:18 +0200 (MET DST)"
Message-ID: <x2bsylfd1c.fsf@blueberry.kubism.ku.dk>
Lines: 21
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

maechler@stat.math.ethz.ch writes:

> One easy and "clean" fix is to put the following at the very beginning of
> diff.default :
> 
>     if(is.ts(x)) {
>         require(ts)
>         UseMethod("diff")
>     }
...
> The above passes "make check" (and more).
> 
> Anybody against this?

I'm not really pro or con, but what is wrong with autoloading diff.ts?? 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 640.reply.3 <==
From maechler@stat.math.ethz.ch  Wed Aug 23 09:40:06 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA06530;
	Wed, 23 Aug 2000 09:40:02 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id JAA26499;
	Wed, 23 Aug 2000 09:39:57 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa006U1; Wed Aug 23 09:39:47 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id JAA05155; Wed, 23 Aug 2000 09:39:47 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14755.32707.497714.333996@gargle.gargle.HOWL>
Date: Wed, 23 Aug 2000 09:39:47 +0200 (CEST)
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Cc: maechler@stat.math.ethz.ch, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] diff.default / diff.ts in wrong package bug (PR#640)
In-Reply-To: <x2bsylfd1c.fsf@blueberry.kubism.ku.dk>
References: <200008221636.SAA03685@pubhealth.ku.dk>
	<x2bsylfd1c.fsf@blueberry.kubism.ku.dk>
X-Mailer: VM 6.75 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> maechler@stat.math.ethz.ch writes:
    >> One easy and "clean" fix is to put the following at the very
    >> beginning of diff.default :
    >> 
    >> if(is.ts(x)) { require(ts)
    >>                UseMethod("diff") }
    PD> ...
    >> The above passes "make check" (and more).
    >> 
    >> Anybody against this?

    PD> I'm not really pro or con, but what is wrong with autoloading
    PD> diff.ts??

it does not work, i.e.

   autload("diff.ts", "ts")
   diff(ts(1:10))

does not load package ts.
It's not so clear if this is a bug in method dispatching ...
but assuming ``standard semantic'' (diff.ts is in search() i.e. diff()
				    should dispatch to it),
it is one..

Shall I 
 1) commit my proposed change to "R-release-patches" (since it fixes a bug
						     in R 1.1.1)
 2) submit a new bug report  about the non-dispatching to "Autoloads"
    objects
?

==> 640.reply.4 <==
From pd@blueberry.kubism.ku.dk  Wed Aug 23 10:49:13 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA07562;
	Wed, 23 Aug 2000 10:49:12 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id KAA15738;
	Wed, 23 Aug 2000 10:53:35 +0200
Sender: pd@blueberry.kubism.ku.dk
To: Martin Maechler <maechler@stat.math.ethz.ch>
Cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, r-devel@stat.math.ethz.ch,
        R-bugs@biostat.ku.dk
Subject: Re: [Rd] diff.default / diff.ts in wrong package bug (PR#640)
References: <200008221636.SAA03685@pubhealth.ku.dk> <x2bsylfd1c.fsf@blueberry.kubism.ku.dk> <14755.32707.497714.333996@gargle.gargle.HOWL>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 23 Aug 2000 10:53:34 +0200
In-Reply-To: Martin Maechler's message of "Wed, 23 Aug 2000 09:39:47 +0200 (CEST)"
Message-ID: <x23djwcq9d.fsf@blueberry.kubism.ku.dk>
Lines: 21
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Martin Maechler <maechler@stat.math.ethz.ch> writes:

> Shall I 
>  1) commit my proposed change to "R-release-patches" (since it fixes a bug
> 						     in R 1.1.1)
>  2) submit a new bug report  about the non-dispatching to "Autoloads"
>     objects

I'm inclined to say 2). 

1) would be wrong in any case (it's hardly a critical bug since you
can just preload ts and the fix is somewhat questionable when you
consider the full consequences). If anything, the fix would be for the
development version -- not that that really matters at this point,
since there's a very good chance that the next release will be 1.2.0.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 640.reply.5 <==
From maechler@stat.math.ethz.ch  Fri Sep 15 17:24:43 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA19050
	for <R-bugs@biostat.ku.dk>; Fri, 15 Sep 2000 17:24:41 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id RAA10302
	for <R-bugs@biostat.ku.dk>; Fri, 15 Sep 2000 17:24:59 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa002Wp; Fri Sep 15 17:24:54 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id RAA03330; Fri, 15 Sep 2000 17:24:53 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14786.16196.612750.242692@gargle.gargle.HOWL>
Date: Fri, 15 Sep 2000 17:24:52 +0200
To: R-bugs@biostat.ku.dk
Subject: Re: [Rd] diff.default / diff.ts in wrong package bug (PR#640)
In-Reply-To: <14755.32707.497714.333996@gargle.gargle.HOWL>
References: <200008221636.SAA03685@pubhealth.ku.dk>
	<x2bsylfd1c.fsf@blueberry.kubism.ku.dk>
	<14755.32707.497714.333996@gargle.gargle.HOWL>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>


>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:
    PD> maechler@stat.math.ethz.ch writes:
    >> One easy and "clean" fix is to put the following at the very
    >> beginning of diff.default :
    >> 
    >> if(is.ts(x)) { require(ts)
    >>                UseMethod("diff") }
    PD> ...
    >> The above passes "make check" (and more).
    >> 
    >> Anybody against this?

    PD> I'm not really pro or con, but what is wrong with autoloading
    PD> diff.ts??

    MM> it does not work, i.e.

    MM>    autload("diff.ts", "ts") diff(ts(1:10))

    MM> does not load package ts.  It's not so clear if this is a bug in
    MM> method dispatching ...  but assuming ``standard semantic'' (diff.ts
    MM> is in search() i.e. diff() should dispatch to it), it is one..

    MM> Shall I 1) commit my proposed change to "R-release-patches" (since
    MM> it fixes a bug in R 1.1.1) 2) submit a new bug report about the
    MM> non-dispatching to "Autoloads" objects ?

Just a report to the non-core audience and for the bug-archive:

Both of these have been resolved now for "R-devel" [R 1.2 unstable]

 i.  autoload("diff.ts", "ts")  now *does* work (thanks to Thomas Lumley)

 ii. the above autoload is now in the system profile and fixes the diff(.) bug.

--
Martin
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 655 *
Subject: Installing R from source 
From: jniesch@gwdg.de
Date: Fri, 8 Sep 2000 11:40:00 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 655 <==
From jniesch@gwdg.de  Fri Sep  8 11:40:00 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA09181
	for <R-bugs@biostat.ku.dk>; Fri, 8 Sep 2000 11:40:00 +0200 (MET DST)
Date: Fri, 8 Sep 2000 11:40:00 +0200 (MET DST)
From: jniesch@gwdg.de
Message-Id: <200009080940.LAA09181@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Installing R from source 

Full_Name: Jens Nieschulze
Version: R-1.1.1
OS: sparc sun solaris 2.7
Submission from: (NULL) (134.76.192.150)


I tried to install R today and got the following at the first try

rbitmap.c:239: parse error before `jmp_buf'
rbitmap.c:239: warning: no semicolon at end of struct or union
rbitmap.c: In function `my_error_exit':
rbitmap.c:257: dereferencing pointer to incomplete type
rbitmap.c: In function `R_SaveAsJpeg':
rbitmap.c:279: storage size of `jerr' isn't known

after changing the source code (replacing the ';' with a ',' and adding some
','
of rbitmap.c in lines 239 and 240 it installed correctly.

cheers
	J.N.

==> 655.reply.1 <==
From pd@biostat.ku.dk  Fri Sep  8 12:18:46 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA09768;
	Fri, 8 Sep 2000 12:18:45 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id MAA25772;
	Fri, 8 Sep 2000 12:22:45 +0200
Sender: pd@blueberry.kubism.ku.dk
To: jniesch@gwdg.de
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Installing R from source ? (PR#655)
References: <200009080940.LAA09191@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 Sep 2000 12:22:44 +0200
In-Reply-To: jniesch@gwdg.de's message of "Fri, 8 Sep 2000 11:40:01 +0200 (MET DST)"
Message-ID: <x2g0nb18uj.fsf@blueberry.kubism.ku.dk>
Lines: 38
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

jniesch@gwdg.de writes:

> Full_Name: Jens Nieschulze
> Version: R-1.1.1
> OS: sparc sun solaris 2.7
> Submission from: (NULL) (134.76.192.150)
> 
> 
> I tried to install R today and got the following at the first try
> 
> rbitmap.c:239: parse error before `jmp_buf'
> rbitmap.c:239: warning: no semicolon at end of struct or union
> rbitmap.c: In function `my_error_exit':
> rbitmap.c:257: dereferencing pointer to incomplete type
> rbitmap.c: In function `R_SaveAsJpeg':
> rbitmap.c:279: storage size of `jerr' isn't known
> 
> after changing the source code (replacing the ';' with a ',' and adding some
> ','
> of rbitmap.c in lines 239 and 240 it installed correctly.
> 
> cheers
> 	J.N.

This would seem to happen if "struct jpeg_error_mgr" in l.238 is not
defined by jpeglib.h. I strongly doubt that fiddling with the code in
rbitmap.c is going to make it actually work (as opposed to compile and
install), so a cleaner approach would be to remove the

#define HAVE_JPEG 1

in src/include/config.h. Or update your jpeg library of course.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 655.followup.1 <==
From ripley@stats.ox.ac.uk  Fri Sep  8 13:14:37 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA10782
	for <R-bugs@biostat.ku.dk>; Fri, 8 Sep 2000 13:14:33 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id MAA02160;
	Fri, 8 Sep 2000 12:14:47 +0100 (BST)
Message-Id: <200009081114.MAA02160@toucan.stats.ox.ac.uk>
Date: Fri, 8 Sep 2000 12:14:47 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] Installing R from source ? (PR#655)
To: jniesch@gwdg.de
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: hhj4A7aWqW2yOcyBnyV1uQ==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 


> From: jniesch@gwdg.de
> Date: Fri, 8 Sep 2000 11:40:01 +0200 (MET DST)
> To: r-devel@stat.math.ethz.ch
> Subject: [Rd] Installing R from source ? (PR#655)
> CC: R-bugs@biostat.ku.dk
> X-Loop: R-bugs@biostat.ku.dk
> 
> Full_Name: Jens Nieschulze
> Version: R-1.1.1
> OS: sparc sun solaris 2.7
> Submission from: (NULL) (134.76.192.150)
> 
> 
> I tried to install R today and got the following at the first try
> 
> rbitmap.c:239: parse error before `jmp_buf'
> rbitmap.c:239: warning: no semicolon at end of struct or union
> rbitmap.c: In function `my_error_exit':
> rbitmap.c:257: dereferencing pointer to incomplete type
> rbitmap.c: In function `R_SaveAsJpeg':
> rbitmap.c:279: storage size of `jerr' isn't known
> 
> after changing the source code (replacing the ';' with a ',' and adding some
> ','
> of rbitmap.c in lines 239 and 240 it installed correctly.

Ah, but it was correct before you altered its meaning.  What
the error message appears to say is that `jmp_buf' is not defined on
your system.  jmp_buf is defined on Solaris 2.7 in
/usr/include/setjmp.h, which should be included.

Do you have png installed?  I've run this assuming not and got similar
error messages. Solve them by adding

#include <setjmp.h>

at line 234 of rbitmap.c.  The png stuff includes setjmp.h.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 655.reply.2 <==
From pd@biostat.ku.dk  Fri Sep  8 13:33:55 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA11269;
	Fri, 8 Sep 2000 13:33:55 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id NAA25818;
	Fri, 8 Sep 2000 13:37:55 +0200
Sender: pd@blueberry.kubism.ku.dk
To: ripley@stats.ox.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Installing R from source ? (PR#655)
References: <200009081114.NAA10794@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 08 Sep 2000 13:37:55 +0200
In-Reply-To: ripley@stats.ox.ac.uk's message of "Fri, 8 Sep 2000 13:14:41 +0200 (MET DST)"
Message-ID: <x2bsxz15d8.fsf@blueberry.kubism.ku.dk>
Lines: 36
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

ripley@stats.ox.ac.uk writes:

> > I tried to install R today and got the following at the first try
> > 
> > rbitmap.c:239: parse error before `jmp_buf'
> > rbitmap.c:239: warning: no semicolon at end of struct or union
> > rbitmap.c: In function `my_error_exit':
> > rbitmap.c:257: dereferencing pointer to incomplete type
> > rbitmap.c: In function `R_SaveAsJpeg':
> > rbitmap.c:279: storage size of `jerr' isn't known
> > 
> > after changing the source code (replacing the ';' with a ',' and adding some
> > ','
> > of rbitmap.c in lines 239 and 240 it installed correctly.
> 
> Ah, but it was correct before you altered its meaning.  What
> the error message appears to say is that `jmp_buf' is not defined on
> your system.  jmp_buf is defined on Solaris 2.7 in
> /usr/include/setjmp.h, which should be included.
> 
> Do you have png installed?  I've run this assuming not and got similar
> error messages. Solve them by adding
> 
> #include <setjmp.h>
> 
> at line 234 of rbitmap.c.  The png stuff includes setjmp.h.

Could well be a better diagnosis than what I suggested. Compiler
errors are often a word or two off relative to the actual location of
the problem. Easy thing to try, certainly. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 653 *
Subject: bug in spline()?
From: Ian White <imsw@holyrood.ed.ac.uk>
Date: Mon, 4 Sep 2000 12:29:26 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 653 <==
From imsw@holyrood.ed.ac.uk  Mon Sep  4 13:29:07 2000
Received: from holyrood.ed.ac.uk (holyrood.ed.ac.uk [129.215.16.14])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA28104
	for <r-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 13:29:07 +0200 (MET DST)
Received: (from imsw@localhost)
	by holyrood.ed.ac.uk (8.8.7/8.8.7) id MAA07844
	for r-bugs@biostat.ku.dk; Mon, 4 Sep 2000 12:29:26 +0100 (BST)
Date: Mon, 4 Sep 2000 12:29:26 +0100 (BST)
From: Ian White <imsw@holyrood.ed.ac.uk>
Message-Id: <200009041129.MAA07844@holyrood.ed.ac.uk>
To: r-bugs@biostat.ku.dk
Subject: bug in spline()?

BUG IN SPLINE()?

Version R-1.0.1, system i486,linux

If the spline(x,y,method="natural") function is given values outside the
range of the data, it does not give a warning. Moreover, the extrapolated
value reported is not the ordinate of the natural spline defined by (x,y).

Example.  Let x <- c(2,5,8,10) and y <- c(1.2266,-1.7606,-0.5051,1.0390).
Then interpolate/extrapolate with a natural cubic spline at 1:10 using
either

spline(x,y,n=10,method="natural",xmin=1,xmax=10)

or

fn <- splinefun(x,y,method="natural")
fn(1:10)

This gives c(2.5366,1.2266,-0.0834,...,1.0390). I agree with all values
except that at x=1. The interpolation formula in Green and Silverman's
book on splines gives the derivative of a natural spline at the first
knot as f'(x1)=(f2-f1)/(x2-x1) -(1/6)(x2-x1)d, where d=second derivative
at the second knot. For the above example, d=0.7071, f'(x1)=-1.3493,
and the natural spline interpolant has value 1.2266-(-1.3493)=2.5759
at x=1, not 2.5366.

PS There are different e-mail addresses for bug reports given in the
FAQ file and in the help information for bug.report.

************************************************
*    I.White                                   *
*    ICAPB, University of Edinburgh            *
*    Ashworth Laboratories, West Mains Road    *
*    Edinburgh EH9 3JT                         *
*    Fax: 0131 667 3210   Tel: 0131 650 5490   *
*    E-mail: i.m.s.white@ed.ac.uk              *
************************************************

==> 653.reply.1 <==
From pd@blueberry.kubism.ku.dk  Mon Sep  4 14:25:15 2000
Received: from blueberry.kubism.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA29112
	for <R-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 14:25:15 +0200 (MET DST)
Received: (from pd@localhost)
	by blueberry.kubism.ku.dk (8.9.3/8.9.3) id OAA02525;
	Mon, 4 Sep 2000 14:28:38 +0200
Sender: pd@blueberry.kubism.ku.dk
To: imsw@holyrood.ed.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] bug in spline()? (PR#653)
References: <200009041129.NAA28115@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 04 Sep 2000 14:28:37 +0200
In-Reply-To: imsw@holyrood.ed.ac.uk's message of "Mon, 4 Sep 2000 13:29:08 +0200 (MET DST)"
Message-ID: <x2n1homjd6.fsf@blueberry.kubism.ku.dk>
Lines: 48
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

imsw@holyrood.ed.ac.uk writes:

> This gives c(2.5366,1.2266,-0.0834,...,1.0390). I agree with all values
> except that at x=1. The interpolation formula in Green and Silverman's
> book on splines gives the derivative of a natural spline at the first
> knot as f'(x1)=(f2-f1)/(x2-x1) -(1/6)(x2-x1)d, where d=second derivative
> at the second knot. For the above example, d=0.7071, f'(x1)=-1.3493,
> and the natural spline interpolant has value 1.2266-(-1.3493)=2.5759
> at x=1, not 2.5366.

Also, 

plot(diff(fn(seq(1,3,.01))))

reveals that something is wrong

At the other end, 

 plot(diff(fn(seq(8,11,.01))))

looks even weirder, especially if one modifies 
to y <- c(1.2266,-1.7606,-0.5051,1.01)


> PS There are different e-mail addresses for bug reports given in the
> FAQ file and in the help information for bug.report.

Hmm, and neither looks quite right! One would probably want the
address to be in the r-project.org domain (in case we move it away
from Copenhagen). "r-bugs@list.r-project.org", however, is none too
logical and assumes that there's an r-bugs user or an alias in Zurich
which forwards to biostat.dk (there is, it seems). Same thing with
r-bugs@r-project.org, since the Wisconsin machine aliases r-bugs to
r-bugs@lists.r-project.org. 

More logical would be to use r-bugs@r-project.org and have the
forwarding there go to biostat.dk.

Alternatively, it ought to work as r-bugs@bugs.r-project.org, but that
doesn't work whenever a RedHat upgrade blows away the resending rules
in my sendmail.cf... (the program in r-bugs' .forward needs to execute
on a machine that matches the architecture of the binary!)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 653.reply.2 <==
From bates@stat.wisc.edu  Mon Sep  4 23:50:57 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA02696
	for <R-bugs@biostat.ku.dk>; Mon, 4 Sep 2000 23:50:57 +0200 (MET DST)
Received: by franz.stat.wisc.edu
	via sendmail from stdin
	id <m13W4B0-000IYXC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for R-bugs@biostat.ku.dk; Mon, 4 Sep 2000 16:53:14 -0500 (CDT) 
Sender: bates@franz.stat.wisc.edu
To: imsw@holyrood.ed.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] bug in spline()? (PR#653)
References: <200009041129.NAA28115@pubhealth.ku.dk>
From: Douglas Bates <bates@stat.wisc.edu>
Date: 04 Sep 2000 16:53:14 -0500
In-Reply-To: imsw@holyrood.ed.ac.uk's message of "Mon, 4 Sep 2000 13:29:08 +0200 (MET DST)"
Message-ID: <6ritsb7rjp.fsf@franz.stat.wisc.edu>
Lines: 49
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

imsw@holyrood.ed.ac.uk writes:

> BUG IN SPLINE()?
> 
> Version R-1.0.1, system i486,linux
> 
> If the spline(x,y,method="natural") function is given values outside the
> range of the data, it does not give a warning. Moreover, the extrapolated
> value reported is not the ordinate of the natural spline defined by (x,y).
> 
> Example.  Let x <- c(2,5,8,10) and y <- c(1.2266,-1.7606,-0.5051,1.0390).
> Then interpolate/extrapolate with a natural cubic spline at 1:10 using
> either
> 
> spline(x,y,n=10,method="natural",xmin=1,xmax=10)
> 
> or
> 
> fn <- splinefun(x,y,method="natural")
> fn(1:10)
> 
> This gives c(2.5366,1.2266,-0.0834,...,1.0390). I agree with all values
> except that at x=1. The interpolation formula in Green and Silverman's
> book on splines gives the derivative of a natural spline at the first
> knot as f'(x1)=(f2-f1)/(x2-x1) -(1/6)(x2-x1)d, where d=second derivative
> at the second knot. For the above example, d=0.7071, f'(x1)=-1.3493,
> and the natural spline interpolant has value 1.2266-(-1.3493)=2.5759
> at x=1, not 2.5366.

I think the `interpSpline' function in the splines package gives the
desired natural interpolation spline.  Perhaps we should change the
underlying code for the spline function.

 > library(splines)
 > x <- c(2,5,8,10)
 > y <- c(1.2266,-1.7606,-0.5051,1.0390)
 > ns1 <- interpSpline(y ~ x)
 > plot(ns1)   # gives a plot that looks reasonable
 > points(x,y)
 > predict(ns1, 1:10)
 $x
  [1]  1  2  3  4  5  6  7  8  9 10

 $y
  [1]  2.5758923  1.2266000 -0.0834080 -1.1577100 -1.7606000 -1.7349409
  [7] -1.2378717 -0.5051000  0.2669514  1.0390000

 attr(,"class")
 [1] "xyVector"
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 660 *
Subject: identify.default ignores any setting of cex.
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Date: Fri, 15 Sep 2000 10:23:39 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 660 <==
From postmaster@franz.stat.wisc.edu  Fri Sep 15 11:23:32 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA13327
	for <R-bugs@biostat.ku.dk>; Fri, 15 Sep 2000 11:23:32 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA17846
	for <r-bugs@hypatia.math.ethz.ch>; Fri, 15 Sep 2000 11:23:49 +0200 (MET DST)
Received: from franz.stat.wisc.edu(128.105.174.95)
 via SMTP by hypatia, id smtpdAAAa004Mn; Fri Sep 15 11:23:42 2000
Received: from toucan.stats.ox.ac.uk (really [163.1.20.20]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m13Zrkl-000IW0C@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <R-bugs@r-project.org>; Fri, 15 Sep 2000 04:25:51 -0500 (CDT) 
Received: from localhost (ripley@localhost)
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id KAA14892
	for <R-bugs@r-project.org>; Fri, 15 Sep 2000 10:23:39 +0100 (BST)
X-Authentication-Warning: toucan.stats: ripley owned process doing -bs
Date: Fri, 15 Sep 2000 10:23:39 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
X-Sender: ripley@toucan.stats
To: R-bugs@r-project.org
Subject: identify.default ignores any setting of cex.
Message-ID: <Pine.GSO.4.05.10009151011510.14885-100000@toucan.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

R 1.1.1 on Windows, but I think this is widespread.

Using either

par(cex=0.5)
plot(1:10)
identify(1:10)

or

plot(1:10)
identify(1:10, cex=0.5)

ignores the cex setting.  The root cause is that par(cex=0.5)
alters cexbase for the device but sets cex=1.0, and the internal
text plotting routines use cex and not cexbase.

The obvious fix is to set cex to cexbase in do_identify. However,
if this is fixed, there is another problem, The offset of the label
is related to the cex in use for the label, and not for the symbol.
So

plot(1:10, type="n")
points(1:10, cex=5)
identify(1:10)

is not sensible in placing the labels.  That may be hard to anticipate,
but 

plot(1:10)
identify(1:10, cex=0.5)

needs to use cex=1 not cex=0.5 for the adjustment.  Perhaps identify is
trying too hard, and should give the user more control over the precise
position of the label (as S-PLUS does).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 658 *
Subject: PR 640 (diff.default computes an incorrect starting time)
From: Laimonis Kavalieris <lkavalieris@maths.otago.ac.nz>
Date: Wed, 13 Sep 2000 13:44:38 +0000
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 658 <==
From lkavalieris@maths.otago.ac.nz  Wed Sep 13 03:40:44 2000
Received: from mailhub1.otago.ac.nz (mailhub1.otago.ac.nz [139.80.64.218])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id DAA15897
	for <r-bugs@biostat.ku.dk>; Wed, 13 Sep 2000 03:40:40 +0200 (MET DST)
Received: (from root@localhost)
	by mailhub1.otago.ac.nz (8.10.1/8.10.1) id e8D1eto32279
	for r-bugs@biostat.ku.dk; Wed, 13 Sep 2000 13:40:55 +1200
Received: from arwen.otago.ac.nz (arwen.otago.ac.nz [139.80.64.160])
	by mailhub1.otago.ac.nz (8.10.1/8.10.1) with ESMTP id e8D1etR32238
	for <r-bugs@biostat.ku.dk>; Wed, 13 Sep 2000 13:40:55 +1200
Received: from maths.otago.ac.nz (IDENT:laimonis@shrike.otago.ac.nz [139.80.48.34])
	by arwen.otago.ac.nz (8.9.3/8.9.3) with ESMTP id NAA16959
	for <r-bugs@biostat.ku.dk>; Wed, 13 Sep 2000 13:40:54 +1200 (NZST)
Sender: laimonis@stonebow.otago.ac.nz
Message-ID: <39BF84C6.DA5FAAD7@maths.otago.ac.nz>
Date: Wed, 13 Sep 2000 13:44:38 +0000
From: Laimonis Kavalieris <lkavalieris@maths.otago.ac.nz>
X-Mailer: Mozilla 4.75 [en] (X11; U; Linux 2.2.14-6.1.1 i686)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@biostat.ku.dk
Subject: PR 640 (diff.default computes an incorrect starting time)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-scanner: scanned by Inflex 0.1.5 - (http://www.inflex.co.za/)

diff.default computes an incorrect starting time for time series.

An error occurs in the arima0 procedure:

library(ts)
y <- ts(rnorm(24),freq=12)
x <- ts(rnorm(24),freq=12)
arima0(y,xreg=x,seasonal=list(order=c(0,1,0)))
Error in tsp<-(*tmp*, value = c(xtsp[1] + lag * differences * xtsp[3],
:
 invalid time series parameters specified

This can be traced to the following lines in arima0

class(x) <- NULL
diff(x,12,1)

The computation of the starting value of the differenced series in
diff.default is incorrect - replacing
             xtsp[1] + lag * differences * xtsp[3]
by

xtsp[1] + lag * differences / xtsp[3]

gives the correct starting time and the problem vanished in arima0.

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status =
 major = 1
 minor = 1.0
 year = 2000
 month = June
 day = 15
 language = R

_____________________________________

Laimonis Kavalieris
Maths and Stats
University of Otago
Dunedin
New Zealand





==> 658.reply.1 <==
From maechler@stat.math.ethz.ch  Fri Sep 15 17:19:42 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA18985
	for <R-bugs@biostat.ku.dk>; Fri, 15 Sep 2000 17:19:42 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id RAA09959;
	Fri, 15 Sep 2000 17:19:58 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa002RZ; Fri Sep 15 17:19:49 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id RAA03325; Fri, 15 Sep 2000 17:19:49 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14786.15893.226994.838512@gargle.gargle.HOWL>
Date: Fri, 15 Sep 2000 17:19:49 +0200
To: lkavalieris@maths.otago.ac.nz
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] PR 640 (diff.default computes an incorrect starting time) (PR#658)
In-Reply-To: <200009130140.DAA15907@pubhealth.ku.dk>
References: <200009130140.DAA15907@pubhealth.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

The reported bug in  diff.default()
has already been corrected for R 1.1.1

thank you anyway, ;-)

Martin Maechler

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 656 *
Subject: .Random.seed resetting
From: lej25@statslab.cam.ac.uk
Date: Mon, 11 Sep 2000 13:13:27 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 656 <==
From lej25@statslab.cam.ac.uk  Mon Sep 11 13:13:28 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA27119
	for <R-bugs@biostat.ku.dk>; Mon, 11 Sep 2000 13:13:27 +0200 (MET DST)
Date: Mon, 11 Sep 2000 13:13:27 +0200 (MET DST)
From: lej25@statslab.cam.ac.uk
Message-Id: <200009111113.NAA27119@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: .Random.seed resetting

Full_Name: Lara Jamieson
Version: 1.1.1
OS: Linux
Submission from: (NULL) (131.111.20.203)


I've checked for other reports on this and can't find anything.  It seems that 
the .Random.seed isn't updated properly after using rm(.Random.seed).  Mu 
understanding from the help file indicates that a new 'random' seed will be
generated.
It appears that sometimes the old one is just reinstated.

I removed my .RData file and the problem remains.  It seems to happen when calls
are 
made in succession to the same 'random generation type' function; but appears to

work when different calls are made in succession.
An example is given below.  I was using the sample command when I found the
problem 
but it happens with runif as well...

> runif(1)
[1] 0.5551602
> runif(1)
[1] 0.2575637
> rm(.Random.seed)
> runif(1)
[1] 0.5551602
> rm(.Random.seed)
> rm(.Random.seed)
Warning message: 
remove: variable ".Random.seed" was not found 
> runif(1)
[1] 0.2575637

Thanks,
Lara

==> 656.reply.1 <==
From maechler@stat.math.ethz.ch  Mon Sep 11 15:10:20 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA29670
	for <R-bugs@biostat.ku.dk>; Mon, 11 Sep 2000 15:10:19 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id PAA18478;
	Mon, 11 Sep 2000 15:10:37 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa004Wg; Mon Sep 11 15:10:27 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id PAA02103; Mon, 11 Sep 2000 15:10:27 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14780.55747.400188.85896@gargle.gargle.HOWL>
Date: Mon, 11 Sep 2000 15:10:27 +0200
To: lej25@statslab.cam.ac.uk
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] .Random.seed resetting (PR#656)
In-Reply-To: <200009111113.NAA27130@pubhealth.ku.dk>
References: <200009111113.NAA27130@pubhealth.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "lej25" == lej25  <lej25@statslab.cam.ac.uk> writes:

    lej25> Full_Name: Lara Jamieson Version: 1.1.1 OS: Linux Submission
    lej25> from: (NULL) (131.111.20.203)

    lej25> I've checked for other reports on this and can't find anything.
    lej25> It seems that the .Random.seed isn't updated properly after
    lej25> using rm(.Random.seed).  Mu understanding from the help file
    lej25> indicates that a new 'random' seed will be generated.  It
    lej25> appears that sometimes the old one is just reinstated.

    lej25> I removed my .RData file and the problem remains.  It seems to
    lej25> happen when calls are made in succession to the same 'random
    lej25> generation type' function; but appears to

    lej25> work when different calls are made in succession.  An example is
    lej25> given below.  I was using the sample command when I found the
    lej25> problem but it happens with runif as well...

    >> runif(1)
    lej25> [1] 0.5551602
    >> runif(1)
    lej25> [1] 0.2575637
    >> rm(.Random.seed) runif(1)
    lej25> [1] 0.5551602
    >> rm(.Random.seed) rm(.Random.seed)
    lej25> Warning message: remove: variable ".Random.seed" was not found
    >> runif(1)
    lej25> [1] 0.2575637


[I don't get your behavior]
Could it be that you have a .Random.seed further up in your search() path?
This would explain everything.

Try
    find(.Random.seed, where = TRUE)

which would show you the place where you had another copy if that was the
solution ...

-- 
Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 656.reply.2 <==
From maechler@stat.math.ethz.ch  Fri Sep 15 20:44:16 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA19849
	for <R-bugs@biostat.ku.dk>; Fri, 15 Sep 2000 20:44:16 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id UAA27841;
	Fri, 15 Sep 2000 20:44:33 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa006mw; Fri Sep 15 20:44:25 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id UAA03714; Fri, 15 Sep 2000 20:44:25 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14786.28169.452250.648668@gargle.gargle.HOWL>
Date: Fri, 15 Sep 2000 20:44:25 +0200
To: Lara Jamieson <L.E.Jamieson@statslab.cam.ac.uk>
CC: R-bugs@biostat.ku.dk
Subject: Re: [Rd] .Random.seed resetting (PR#656)
In-Reply-To: <200009111310.PAA29682@pubhealth.ku.dk>
References: <200009111310.PAA29682@pubhealth.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:

>>>>> "lej25" == lej25  <lej25@statslab.cam.ac.uk> writes:
    lej25> Full_Name: Lara Jamieson Version: 1.1.1 OS: Linux Submission
    lej25> from: (NULL) (131.111.20.203)

    lej25> I've checked for other reports on this and can't find anything.
    lej25> It seems that the .Random.seed isn't updated properly after
    lej25> using rm(.Random.seed).  Mu understanding from the help file
    lej25> indicates that a new 'random' seed will be generated.  It
    lej25> appears that sometimes the old one is just reinstated.

    lej25> I removed my .RData file and the problem remains.  It seems to
    lej25> happen when calls are made in succession to the same 'random
    lej25> generation type' function; but appears to

    lej25> work when different calls are made in succession.  An example is
    lej25> given below.  I was using the sample command when I found the
    lej25> problem but it happens with runif as well...

    >>> runif(1)
    lej25> [1] 0.5551602
    >>> runif(1)
    lej25> [1] 0.2575637
    >>> rm(.Random.seed) runif(1)
    lej25> [1] 0.5551602
    >>> rm(.Random.seed) rm(.Random.seed)
    lej25> Warning message: remove: variable ".Random.seed" was not found
    >>> runif(1)
    lej25> [1] 0.2575637


    MM> [I don't get your behavior] Could it be that you have a
    MM> .Random.seed further up in your search() path?  This would explain
    MM> everything.

Well I *could* reproduce the bogous behavior in R 1.1.1, after all.

The problem is that .Random.seed is not only in .GlobalEnv, but also 
"Autoloads" :

R --vanilla

  > runif(1)
  [1] 0.4659391
  > find(".Random.seed")
  [1] ".GlobalEnv" "Autoloads" 
  > all.equal(.Random.seed, get(".Random.seed", envir = .AutoloadEnv))
  [1] TRUE

and hence, after rm(.Random.seed), runif(*) still gets the one from the
autoloads... 

This bug has just been fixed in R-devel
(by an expert, not me!), together with the even more peculiar

    > library(stepfun)
    > AbC <<- "Z"
    > find("AbC")
    [1] ".GlobalEnv"      "package:stepfun" "Autoloads"      

 {but you were told never to use "<<-"  ;-) }
     
--
Martin
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 663 *
Subject: bug.report("unused argument(s) crash R when options(error=quote
From: zivan.karaman@limagrain.com
Date: Tue, 19 Sep 2000 13:51:33 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 663 <==
From zivan.karaman@limagrain.com  Tue Sep 19 13:53:20 2000
Received: from relais-int6.globalintranet.net (mailgate.globalintranet.net [194.206.181.244])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA14976
	for <r-bugs@biostat.ku.dk>; Tue, 19 Sep 2000 13:52:50 +0200 (MET DST)
From: zivan.karaman@limagrain.com
Received: from limagrain.ftgin.com ([194.51.14.227])
          by relais-int6.globalintranet.net
          (Netscape Messaging Server 3.61.2)  with SMTP id AAA1D5;
          Tue, 19 Sep 2000 13:51:00 +0200
Received: by limagrain.ftgin.com(Lotus SMTP MTA v4.6.4  (830.2 3-23-1999))  id C125695F.0040A208 ; Tue, 19 Sep 2000 13:45:57 +0200
X-Lotus-FromDomain: LIMAGRAIN
To: r-bugs@biostat.ku.dk
cc: Guido Masarotto <guido@sirio.stat.unipd.it>
Message-ID: <C125695F.0040A1AA.00@limagrain.ftgin.com>
Date: Tue, 19 Sep 2000 13:51:33 +0200
Subject: bug.report("unused argument(s) crash R when options(error=quote
	(dump.frames()))")
Mime-Version: 1.0
Content-type: text/plain; charset=us-ascii
Content-Disposition: inline


# Your mailer is set to "none" (default on Windows),
# hence we cannot send the bug report directly from R.
# Please copy the bug report (after finishing it) to
# your favorite email program and send it to
#
#       r-bugs@biostat.ku.dk
#
######################################################

Hello!

I have observed a curious problem with the Windows version of R.
> version
         _
platform Windows
arch     x86
os       Win32
system   x86, Win32
status
major    1
minor    1.1
year     2000
month    August
day      15
language R
> win.version()
[1] "Windows NT 4.0 (build 1381) Service Pack 5"

When I mistype an argument in a function call (like in the example below), Rgui
crashes with the message:
The instruction at "0x025571b8" uses the memory address "0x00000008". The memory
 can't be "read". (This is my translation from French, but I guess it's
something like that in English.)

Example:
> ls(poq=3)
Normally, one should get a message saying:
Error in ls(poq = 3) : unused argument(s) (poq ...)

In my etc/Rprofile file I have added the following line:
options(error=quote(dump.frames()))

When I comment this line out, Rgui works OK (i.e. I get the message "Error in
ls(poq = 3) : unused argument(s) (poq ...)").

This happens for any other typo that should normally cause the message "unused
argument(s)", like "matrix(1:15, nrow=5, byrox=TRUE)", or anything else.

The same happens with Rterm, except that you see the error message before Rterm
dies, and the message is little bit different:
The instruction at "0x02556678" uses the memory address "0xec83e591". The memory
 can't be "read".

It happens on both my desktop and my laptop, but since both are running the same
 OS version (NT4 SP5), it's not so surprising.

Also, I have the same behaviour with the previous version of R
> version
         _
platform Windows
arch     x86
os       Win32
system   x86, Win32
status
major    1
minor    1.0
year     2000
month    June
day      15
language R


Did I do anything wrong, or is it a problem with R.dll?

It is not a big problem, but I just wanted let you know about it.

Best regards

Zivan



--please do not edit the information below--

Version:
 platform = Windows
 arch = x86
 os = Win32
 system = x86, Win32
 status =
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Windows NT 4.0 (build 1381) Service Pack 5

Search Path:
 .GlobalEnv, Autoloads, package:base



==> 663.reply.1 <==
From pd@biostat.ku.dk  Tue Sep 19 14:34:59 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA15771;
	Tue, 19 Sep 2000 14:34:58 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id OAA23190;
	Tue, 19 Sep 2000 14:40:35 +0200
Sender: pd@blueberry.kubism.ku.dk
To: zivan.karaman@limagrain.com
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] bug.report("unused argument(s) crash R when options(error=quote (PR#663)
References: <200009191153.NAA14999@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 19 Sep 2000 14:40:31 +0200
In-Reply-To: zivan.karaman@limagrain.com's message of "Tue, 19 Sep 2000 13:53:21 +0200 (MET DST)"
Message-ID: <x2u2bctv0f.fsf@blueberry.kubism.ku.dk>
Lines: 41
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

zivan.karaman@limagrain.com writes:

> The instruction at "0x025571b8" uses the memory address "0x00000008". The memory
>  can't be "read". (This is my translation from French, but I guess it's
> something like that in English.)
> 
> Example:
> > ls(poq=3)
> Normally, one should get a message saying:
> Error in ls(poq = 3) : unused argument(s) (poq ...)
> 
> In my etc/Rprofile file I have added the following line:
> options(error=quote(dump.frames()))

Whoops. This also crashes on Linux (good - then we can debug it more
conveniently...) In the development version too:


> ls(poq=3)
Error in ls(poq = 3) : unused argument(s) (poq ...)

Program received signal SIGSEGV, Segmentation fault.
0x807e1c7 in Rf_findVarInFrame (rho=0xbffff4cc, symbol=0x83c7354)
    at ../../../R/src/main/envir.c:677
677             hashcode = HASHVALUE(c) % HASHSIZE(HASHTAB(rho));
(gdb) l
672             c = PRINTNAME(symbol);
673             if( !HASHASH(c) ) {
674                 SET_HASHVALUE(c, R_Newhashpjw(CHAR(c)));
675                 SET_HASHASH(c, 1);
676             }
677             hashcode = HASHVALUE(c) % HASHSIZE(HASHTAB(rho));

(I don't really have time to debug this further just now, the symbol is
"dump.frames" in case anyone wants to dig deeper)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 662 *
Subject: phantom(0) doesn't do what I expect it to [plotmath]
From: M.B.Gillies@pharm.uu.nl
Date: Mon, 18 Sep 2000 14:20:37 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 662 <==
From M.B.Gillies@pharm.uu.nl  Mon Sep 18 14:20:38 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA03596
	for <R-bugs@biostat.ku.dk>; Mon, 18 Sep 2000 14:20:37 +0200 (MET DST)
Date: Mon, 18 Sep 2000 14:20:37 +0200 (MET DST)
From: M.B.Gillies@pharm.uu.nl
Message-Id: <200009181220.OAA03596@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: phantom(0) doesn't do what I expect it to [plotmath]

Full_Name: Malcolm Gillies
Version: 1.1.1
OS: Debian GNU/Linux 2.2
Submission from: (NULL) (131.211.56.47)


I'm trying to make a legend with a justified list of numbers, so I
thought I would use phantom(0) to align the 3-digit numbers properly
with the 4-digit ones:

    plot(1); legend(1, 1, xjust=1, yjust=1, lty=c(1,2,3,4,5), adj=c(0,0.5),
           legend=expression(phantom(0)*300*plain(K),
                             phantom(0)*550*plain(K),
                             phantom(0)*830*plain(K),
                                       1440*plain(K),
                                       2500*plain(K)))

Unfortunately, phantom(0) doesn't seem to be adding any space, whether
I use the X11 or the postscript device.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 667 *
Subject: (sem assunto)
From: rangearo@ufu.br (Paulo Roberto Rangearo Peres)
Date: Thu, 21 Sep 2000 15:27:53 -0300
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 667 <==
From rangearo@ufu.br  Thu Sep 21 20:26:53 2000
Received: from murici.ufu.br ([200.238.217.2])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id UAA13365
	for <R-bugs@biostat.ku.dk>; Thu, 21 Sep 2000 20:26:50 +0200 (MET DST)
Received: from ufu.br ([200.131.200.91]) by murici.ufu.br
          (Post.Office MTA v3.5.4 release 224 ID# 124-61694U2500L250S0V35)
          with ESMTP id br for <R-bugs@biostat.ku.dk>;
          Thu, 21 Sep 2000 15:23:34 -0200
Message-ID: <39CA5329.29BC9A71@ufu.br>
Date: Thu, 21 Sep 2000 15:27:53 -0300
From: rangearo@ufu.br (Paulo Roberto Rangearo Peres)
X-Mailer: Mozilla 4.51 [pt] (WinNT; I)
X-Accept-Language: pt-BR
MIME-Version: 1.0
To: R-bugs@biostat.ku.dk
Subject: (sem assunto)
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

unsubscrible rangearo@ufu.br
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 666 *
Subject: width in options()
From: aprasad@fs.fed.us
Date: Thu, 21 Sep 2000 17:46:25 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 666 <==
From aprasad@fs.fed.us  Thu Sep 21 17:46:41 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA12777
	for <R-bugs@biostat.ku.dk>; Thu, 21 Sep 2000 17:46:25 +0200 (MET DST)
Date: Thu, 21 Sep 2000 17:46:25 +0200 (MET DST)
From: aprasad@fs.fed.us
Message-Id: <200009211546.RAA12777@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: width in options()

Full_Name: Anantha Prasad
Version: 1.1.1
OS: Linux
Submission from: (NULL) (199.131.134.57)


When I try to use 
> options(width=201)
Error in options(...) : invalid width parameter
It looks like 200 is the max. limit. THis is a huge limitation...for if I am
trying
to sink() an R object that has 50 variables with a width of say 1000 characters
and
a length of say 1000 lines, the output I get gets split at 200 characters so
that it
has 5000 lines!
Eg.,
Say an R object x with 1000 lines and 50 variables (1000 characters of width)
> sink("tst.dat")
> x
> sink()
Now, tst.dat has the output split at 200 characters making it very difficult to
use
this dataset. So, scripts that depend on the entire file structure to come
intact
will produce errors.

This limitation is not there in S-PLUS where you can set the width to any
number.
Hope this is fixed soon as many scripts I use depend on me setting width to
atleast
2000!

Thanks



==> 666.reply.1 <==
From thomas@biostat.washington.edu  Thu Sep 21 17:49:21 2000
Received: from mail.biostat.washington.edu (mail.biostat.washington.edu [128.95.113.21])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA12818
	for <R-bugs@biostat.ku.dk>; Thu, 21 Sep 2000 17:49:20 +0200 (MET DST)
Received: from atlas (atlas [128.95.21.66])
	by mail.biostat.washington.edu (8.9.3+Sun/8.9.1-fetrow-2000-05-16a) with ESMTP id IAA09711;
	Thu, 21 Sep 2000 08:49:30 -0700 (PDT)
Date: Thu, 21 Sep 2000 08:49:31 -0700 (PDT)
From: Thomas Lumley <thomas@biostat.washington.edu>
To: aprasad@fs.fed.us
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] width in options() (PR#666)
In-Reply-To: <200009211546.RAA12787@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.21.0009210848220.27694-100000@atlas.biostat.washington.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 21 Sep 2000 aprasad@fs.fed.us wrote:

> Full_Name: Anantha Prasad
> Version: 1.1.1
> OS: Linux
> Submission from: (NULL) (199.131.134.57)
> 
> 
> When I try to use 
> > options(width=201)
> Error in options(...) : invalid width parameter
> It looks like 200 is the max. limit. THis is a huge limitation...for if I am
> trying
> to sink() an R object that has 50 variables with a width of say 1000 characters
> and
> a length of say 1000 lines, the output I get gets split at 200 characters so
> that it
> has 5000 lines!
> Eg.,
> Say an R object x with 1000 lines and 50 variables (1000 characters of width)
> > sink("tst.dat")
> > x
> > sink()
> Now, tst.dat has the output split at 200 characters making it very difficult to
> use
> this dataset. So, scripts that depend on the entire file structure to come
> intact
> will produce errors.
> 
> This limitation is not there in S-PLUS where you can set the width to any
> number.
> Hope this is fixed soon as many scripts I use depend on me setting width to
> atleast
> 2000!


While this may well be a useful feature to add, note that the preferred
way of writing a rectangular dataset to a file is with write.table(),
which does not have width restrictions

	-thomas

Thomas Lumley
Assistant Professor, Biostatistics
University of Washington, Seattle

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 665 *
Subject: "[.data.frame" forgets about "AsIs"
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Thu, 21 Sep 2000 10:18:46 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 665 <==
From maechler@stat.math.ethz.ch  Thu Sep 21 10:18:32 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA05514
	for <R-bugs@biostat.ku.dk>; Thu, 21 Sep 2000 10:18:31 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA02107
	for <R-bugs@stat.math.ethz.ch>; Thu, 21 Sep 2000 10:18:50 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa000Wt; Thu Sep 21 10:18:47 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA06903; Thu, 21 Sep 2000 10:18:46 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14793.50278.565692.270322@gargle.gargle.HOWL>
Date: Thu, 21 Sep 2000 10:18:46 +0200
To: R-bugs@stat.math.ethz.ch
Subject: "[.data.frame" forgets about "AsIs"
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

Short example:

 > str(d <- data.frame(a = I(letters[1:5])))
 `data.frame':	5 obs. of  1 variable:
  $ a:Class 'AsIs'  chr [1:5] "a" "b" "c" "d" ...
 > str(d[TRUE,,drop = FALSE])
 `data.frame':	5 obs. of  1 variable:
  $ a: chr  "a" "b" "c" "d" ...

The real problem about this is, that as soon as the data.frame is further
"transformed", the character component is coerced to a factor, e.g.

   > str(rbind(d[TRUE,,drop = FALSE], "E"))
   `data.frame':	6 obs. of  1 variable:
    $ a: Factor w/ 6 levels "a","b","c","d",..: 1 2 3 4 6 5

--- 

I'm looking at a fix myself.

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 665.reply.1 <==
From maechler@stat.math.ethz.ch  Thu Sep 21 17:56:28 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA12841
	for <R-bugs@biostat.ku.dk>; Thu, 21 Sep 2000 17:56:27 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id RAA00060
	for <R-bugs@biostat.ku.dk>; Thu, 21 Sep 2000 17:56:46 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa0000u; Thu Sep 21 17:56:39 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id RAA07522; Thu, 21 Sep 2000 17:56:39 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14794.12214.816608.496695@gargle.gargle.HOWL>
Date: Thu, 21 Sep 2000 17:56:38 +0200
To: R-bugs@biostat.ku.dk
Subject: Re: [Rd] "[.data.frame" forgets about "AsIs" (PR#665)
In-Reply-To: <200009210818.KAA05524@pubhealth.ku.dk>
References: <200009210818.KAA05524@pubhealth.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:

    MM> Short example:
    >> str(d <- data.frame(a = I(letters[1:5])))
    MM> `data.frame':	5 obs. of  1 variable:
    MM> $ a:Class 'AsIs'  chr [1:5] "a" "b" "c" "d" ...
    >> str(d[TRUE,,drop = FALSE])
    MM> `data.frame':	5 obs. of  1 variable:
    MM> $ a: chr  "a" "b" "c" "d" ...

    MM> The real problem about this is, that as soon as the data.frame is
    MM> further "transformed", the character component is coerced to a
    MM> factor, e.g.

    >> str(rbind(d[TRUE,,drop = FALSE], "E"))
    MM> `data.frame':	6 obs. of  1 variable:
    MM> $ a: Factor w/ 6 levels "a","b","c","d",..: 1 2 3 4 6 5


Probably the cleanest fix is the addition of 

  "[.AsIs" <- function(x, i) structure(NextMethod("["), class = class(x))

--
Will go into R-devel unless someone has a better idea.

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 669 *
Subject: Bug(s) w/ rbind.data.frame(); fix also read.table(*, as.is = TRUE) ?
From: Martin Maechler <maechler@stat.math.ethz.ch>
Date: Mon, 25 Sep 2000 10:17:15 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 669 <==
From maechler@stat.math.ethz.ch  Mon Sep 25 10:17:01 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id KAA01907
	for <R-bugs@biostat.ku.dk>; Mon, 25 Sep 2000 10:17:01 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id KAA07627
	for <R-bugs@stat.math.ethz.ch>; Mon, 25 Sep 2000 10:17:19 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa001r9; Mon Sep 25 10:17:15 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id KAA01475; Mon, 25 Sep 2000 10:17:15 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14799.2571.494467.836722@gargle.gargle.HOWL>
Date: Mon, 25 Sep 2000 10:17:15 +0200
To: R-bugs@stat.math.ethz.ch
Subject: Bug(s) w/ rbind.data.frame(); fix also read.table(*, as.is = TRUE) ?
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

This is not only bug report, but also a RFC (request for comments):

The basic problem is that there are (at least) two ways of easily getting
non-factor character columns in data.frames.
The first is  
    read.table(*, as.is = TRUE) 
and the second is
    data.frame(.., I(...), ..)	      

which differ in their result. Whereas the first produces `pure' character
columns in the data.frame, the second approach gives `AsIs' classed
columns (character, or, e.g. logical).

Now, as the following shows,  rbind.data.frame()  *is* buggy anyway,
I wonder if we shouldn't change read.table(*, as.is = TRUE)
such that the non-numeric columns of its result become "AsIs" classed as
well:

-----------

str(d1 <- data.frame(a=1:3, b = I(letters[1:3])))
## d1 is `alright'
## d0: The same but a `character' *not* protected by AsIs:
d0 <- d1
d0$b <- unclass(d0$b)
str(d0)
## Note that this is *really* the same as a what you get from
##  read.table(*, as.is = TRUE)
##  ----------
##  R's read.table() is S+ compatible; however I wonder if
##  we shouldn't add  "AsIs" classes to all non-numeric components...
##  the classes, shouldn't harm, but ensure consistency of treatment..

str(d11 <- rbind(d1, new = c(7, "N"))) ## alright
str(d01 <- rbind(d0, new = c(7, "N"))) ## all wrong :
## Both columns were coerced to factors !!
##-- S-PLUS 5 coerces both to "character" -- which is better,
##  since the new row *is* all character

## R makes nonsense with 'b' [factor w/ 1 level "N": NA NA NA 1]
## S+ 5.1 does exactly the right thing [both a & b still look like in d0,d1 :
str(d12 <- rbind(d1, new = data.frame(a= 7, b="N")))##
str(d02 <- rbind(d0, new = data.frame(a= 7, b="N")))##

---------

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 668 *
Subject: eval functions...
From: aprasad@fs.fed.us
Date: Fri, 22 Sep 2000 22:30:58 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 668 <==
From aprasad@fs.fed.us  Fri Sep 22 22:31:07 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA23882
	for <R-bugs@biostat.ku.dk>; Fri, 22 Sep 2000 22:30:58 +0200 (MET DST)
Date: Fri, 22 Sep 2000 22:30:58 +0200 (MET DST)
From: aprasad@fs.fed.us
Message-Id: <200009222030.WAA23882@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: eval functions...

Full_Name: Anantha Prasad
Version: 1.1.1
OS: Linux
Submission from: (NULL) (199.131.134.30)


I am trying to convert some S-PLUS code to R (a tcl/tk application that uses
R)...
here is the error I got in R (but not in S-PLUS)...so I am wondering if it is a
bug.

Eg., the foll. extract from a function runs fine in S-PLUS but gives the error:
Error in x[[j]] : subscript out of bounds
in R

code snippet .....

 attach(xd)
	 resp <- "iv802"
	pickedlist <- "BD + CEC + CLAY + ERODFAC + INCEPTSL"
	lmexp <- paste(resp, " ~ ", pickedlist,sep="")
        tmpzx <- eval(lm(lmexp,data=xd))

Essentially, I want to do:
 lm(iv802 ~ BD + CEC + CLAY + ERODFAC + INCEPTSL, data=xd)
thru a function that has the parameters passed thru TclTk and Perl......

Thanks much.


==> 668.reply.1 <==
From pd@biostat.ku.dk  Fri Sep 22 23:09:29 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA24016;
	Fri, 22 Sep 2000 23:09:28 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id XAA09791;
	Fri, 22 Sep 2000 23:15:36 +0200
Sender: pd@blueberry.kubism.ku.dk
To: aprasad@fs.fed.us
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] eval functions... (PR#668)
References: <200009222031.WAA23892@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 22 Sep 2000 23:15:36 +0200
In-Reply-To: aprasad@fs.fed.us's message of "Fri, 22 Sep 2000 22:31:08 +0200 (MET DST)"
Message-ID: <x2u2b8ruvb.fsf@blueberry.kubism.ku.dk>
Lines: 39
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

aprasad@fs.fed.us writes:

> Eg., the foll. extract from a function runs fine in S-PLUS but gives the error:
> Error in x[[j]] : subscript out of bounds
> in R
> 
> code snippet .....
> 
>  attach(xd)
> 	 resp <- "iv802"
> 	pickedlist <- "BD + CEC + CLAY + ERODFAC + INCEPTSL"
> 	lmexp <- paste(resp, " ~ ", pickedlist,sep="")
>         tmpzx <- eval(lm(lmexp,data=xd))
> 
> Essentially, I want to do:
>  lm(iv802 ~ BD + CEC + CLAY + ERODFAC + INCEPTSL, data=xd)
> thru a function that has the parameters passed thru TclTk and Perl......

Um, I'm somewhat surprised that this gives sensible results in
Splus... It does, since Splus accepts a text string for a formula
which R does not. 

[The use of eval is also unnecessary, and the sep="" is peculiar in
view of the spaces around the ~...]

In R you need to jump through an extra hoop to create a formula object
from the string representation:

lmexp <- formula(paste(resp, "~", pickedlist))
tmpzx <- lm(lmexp,data=xd)

The Splus docs explicitly say that the first argument to lm should be
a formula object, and R's behaviour is consistent with that.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 668.reply.2 <==
From bates@stat.wisc.edu  Fri Sep 22 23:27:14 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA24061
	for <R-bugs@biostat.ku.dk>; Fri, 22 Sep 2000 23:27:14 +0200 (MET DST)
Received: by franz.stat.wisc.edu
	via sendmail from stdin
	id <m13caOG-000IW0C@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for R-bugs@biostat.ku.dk; Fri, 22 Sep 2000 16:29:52 -0500 (CDT) 
Sender: bates@franz.stat.wisc.edu
To: aprasad@fs.fed.us
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] eval functions... (PR#668)
References: <200009222031.WAA23892@pubhealth.ku.dk>
From: Douglas Bates <bates@stat.wisc.edu>
Date: 22 Sep 2000 16:29:52 -0500
In-Reply-To: aprasad@fs.fed.us's message of "Fri, 22 Sep 2000 22:31:08 +0200 (MET DST)"
Message-ID: <6rya0kdsj3.fsf@franz.stat.wisc.edu>
Lines: 36
User-Agent: Gnus/5.0803 (Gnus v5.8.3) Emacs/20.7
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

aprasad@fs.fed.us writes:

> I am trying to convert some S-PLUS code to R (a tcl/tk application that uses
> R)...
> here is the error I got in R (but not in S-PLUS)...so I am wondering if it is a
> bug.
> 
> Eg., the foll. extract from a function runs fine in S-PLUS but gives the error:
> Error in x[[j]] : subscript out of bounds
> in R
> 
> code snippet .....
> 
>  attach(xd)
> 	 resp <- "iv802"
> 	pickedlist <- "BD + CEC + CLAY + ERODFAC + INCEPTSL"
> 	lmexp <- paste(resp, " ~ ", pickedlist,sep="")
>         tmpzx <- eval(lm(lmexp,data=xd))
> 
> Essentially, I want to do:
>  lm(iv802 ~ BD + CEC + CLAY + ERODFAC + INCEPTSL, data=xd)
> thru a function that has the parameters passed thru TclTk and Perl......

I think in both R and S-PLUS you would be better off using as.formula.

> as.formula("iv802 ~ BD + CEC + CLAY + ERODFAC + INCEPTSL")
iv802 ~ BD + CEC + CLAY + ERODFAC + INCEPTSL

You may want to use Bill Venables' favorite function do.call as well.  Try

resp <- "iv802"
pickedlist <- "BD + CEC + CLAY + ERODFAC + INCEPTSL"
tmpzx <- do.call("lm", 
          list(formula = as.formula(paste(resp, "~", pickedlist)),
               data = xd))


==> 668.followup.1 <==
From ripley@stats.ox.ac.uk  Sat Sep 23 08:44:09 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA25087
	for <R-bugs@biostat.ku.dk>; Sat, 23 Sep 2000 08:44:08 +0200 (MET DST)
Received: from max91.public.ox.ac.uk (max91.public.ox.ac.uk [192.76.27.91])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id HAA29749;
	Sat, 23 Sep 2000 07:44:18 +0100 (BST)
Date: Sat, 23 Sep 2000 07:42:49 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: aprasad@fs.fed.us
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] eval functions... (PR#668)
In-Reply-To: <200009222031.WAA23892@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10009230726310.15421-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 22 Sep 2000 aprasad@fs.fed.us wrote:

> Full_Name: Anantha Prasad
> Version: 1.1.1
> OS: Linux
> Submission from: (NULL) (199.131.134.30)
> 
> 
> I am trying to convert some S-PLUS code to R (a tcl/tk application that uses
> R)...
> here is the error I got in R (but not in S-PLUS)...so I am wondering if it is a
> bug.
> 
> Eg., the foll. extract from a function runs fine in S-PLUS but gives the error:
> Error in x[[j]] : subscript out of bounds
> in R

A tracback helps ...

> 
> code snippet .....
> 
>  attach(xd)
> 	 resp <- "iv802"
> 	pickedlist <- "BD + CEC + CLAY + ERODFAC + INCEPTSL"
> 	lmexp <- paste(resp, " ~ ", pickedlist,sep="")
>         tmpzx <- eval(lm(lmexp,data=xd))
> 
> Essentially, I want to do:
>  lm(iv802 ~ BD + CEC + CLAY + ERODFAC + INCEPTSL, data=xd)
> thru a function that has the parameters passed thru TclTk and Perl......

I don't understand why that would work in S-PLUS!  You apply eval to
expressions or calls, but lm(mexp,data=xd) is not a call. Probably S-PLUS
has an implicit as.formula in its version.

The essence can be seen in

> lm(formula="y ~ x")
Error in x[[j]] : subscript out of bounds
> traceback()
[1] "eval(expr, envir, enclos)"                                        
[2] "eval(attr(formula, \"variables\"), data, sys.frame(sys.parent()))"
[3] "model.frame.default(formula = y ~ x, drop.unused.levels = TRUE)"  
[4] "model.frame(formula = y ~ x, drop.unused.levels = TRUE)"          
[5] "eval(expr, envir, enclos)"                                        
[6] "eval(mf, sys.frame(sys.parent()))"                                
[7] "lm(formula = y ~ x)"                                              

The point is that the formula argument should be a formula, not a 
character string, so this is not a bug per se.

There are lots of correct ways to do this.  Perhaps the simplest is

lm(as.formula(lmexp), data=xd)

but that will record the call as 

lm(formula = as.formula(lmexp), data = xd)

To avoid that, if you need to, use something like

do.call("lm", list(formula = as.formula(lmexp), data=xd))

(There are lots more ways too, including using parse or substitute.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 672 *
Subject: R 1.1.0: scan
From: Peter Kleiweg <kleiweg@let.rug.nl>
Date: Wed, 27 Sep 2000 11:45:34 +0200 (CEST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 672 <==
From kleiweg@let.rug.nl  Wed Sep 27 11:46:05 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA00611
	for <R-bugs@biostat.ku.dk>; Wed, 27 Sep 2000 11:46:04 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA28502
	for <R-bugs@hypatia.math.ethz.ch>; Wed, 27 Sep 2000 11:46:18 +0200 (MET DST)
Received: from lmb1-25.let.rug.nl(129.125.8.125), claiming to be "kleigh.nl"
 via SMTP by hypatia, id smtpdAAAa006xJ; Wed Sep 27 11:46:08 2000
Received: from localhost (peter@localhost)
	by kleigh.nl (8.8.7/8.8.7) with ESMTP id LAA01032
	for <R-bugs@lists.r-project.org>; Wed, 27 Sep 2000 11:45:34 +0200
X-Authentication-Warning: kleigh.nl: peter owned process doing -bs
Date: Wed, 27 Sep 2000 11:45:34 +0200 (CEST)
From: Peter Kleiweg <kleiweg@let.rug.nl>
X-Sender: peter@kleigh.nl
To: R-bugs@stat.math.ethz.ch
Subject: R 1.1.0: scan
Message-ID: <Pine.LNX.4.21.0009271141200.587-100000@kleigh.nl>
Organization: Alfa-Informatica, Rijksuniversiteit Groningen
X-Face: "K~X:~!ydgSdjNy;]_+BCb\OM^pqyg_q*Le84$l46M\-mL=.^,L4B}bDK>`o#r4_>O*
X-Mailer: Pine 4.21, Linux 2.0.36, i586
X-No-Archive: Yes
X-Reason: http://www.infidels.org/
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


I'm using R 1.1.0 on Linux and HP-UX 10.20. I encountered a bug
in the HP-UX version.

When I do this:

lines <- scan(file="filename", what="", sep="\n", strip.white=c(TRUE), quiet=TRUE) 

.. it works OK on Linux. On HP-UX, the last line is read in
twice, giving 'lines' an extra element that is identical to the 
previous element.

-- 
Peter Kleiweg
http://www.let.rug.nl/~kleiweg/

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 671 *
Subject:  bounds violations, infinite loops in optim/L-BFGS-B 
From: bolker@zoo.ufl.edu
Date: Tue, 26 Sep 2000 10:17:27 -0400
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 671 <==
From ben@bolker.zoo.ufl.edu  Tue Sep 26 16:14:12 2000
Received: from triarch.zoo.ufl.edu (triarch.zoo.ufl.edu [128.227.60.248])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA22295
	for <r-bugs@biostat.ku.dk>; Tue, 26 Sep 2000 16:14:11 +0200 (MET DST)
Received: from bolker.zoo.ufl.edu ([10.227.60.45]) by triarch.zoo.ufl.edu
          (Netscape Messaging Server 3.5)  with ESMTP id 546;
          Tue, 26 Sep 2000 10:14:26 -0400
Received: (from ben@localhost)
	by bolker.zoo.ufl.edu (8.11.0/8.11.0) id e8QEHRP15287;
	Tue, 26 Sep 2000 10:17:27 -0400
Date: Tue, 26 Sep 2000 10:17:27 -0400
From: bolker@zoo.ufl.edu
Message-Id: <200009261417.e8QEHRP15287@bolker.zoo.ufl.edu>
To: r-bugs@biostat.ku.dk
Subject:  bounds violations, infinite loops in optim/L-BFGS-B 
Cc: ben@bolker.zoo.ufl.edu


  I'm having some trouble with optim(method="L-BFGS-B"),
and I'm not sure I have the ability to track down and fix
what seem to be bugs within optim().
  I'm bootstrapping an original data set and fitting a model
to each bootstrapped data set.  For some bootstrapped samples,
optim() sets negative parameter values (despite the fact that
I have explicitly set non-zero lower bounds on the parameters)
and chokes.  For other samples, it appears to get into an infinite
loop (ignoring the finite value of maxit).
 
  Functions and samples that provoke the problem are below: I
was able to reproduce the problems running this with --vanilla.

  Not exactly a bug but: there is no tracing information built
into L-BFGS-B (setting trace=TRUE has no effect).

  Also, a general question: are both nlm() and optim() going to
be around indefinitely?  Should I be using one or the other?

  For the moment I've managed to (sort of) get around the problem
with try(), but the infinite loops are a real nuisance ...

cfunc2_function(input,N1,N2,G=1.0){
  pmin(1,1/((1+((input - N1)/N2))^G))
}

nllfun2g.boot_function(q,debug=FALSE){
#  if (i==93) debug <- TRUE
  N1_q[1]
  N2_q[2]
  G_q[3]
  L_cfunc2(boot.total,N1,N2,G)
  if (debug) cat(c(N1,N2,G,range(L)),"\n")
  r <- -sum(dbinom(boot.pred, boot.total, L, log=TRUE))
  if (!is.finite(r)) {
    cat(c(N1,N2,G,range(L)),"\n")
    cat(boot.pred,"\n")
    cat(boot.total,"\n")
    cat(L,"\n")
    cat(dbinom(boot.pred, boot.total, L, log=TRUE),"\n")
  }
  r
}

fuzz <- 0.001

boot.pred <- c(91,22,44,31,47,83,31,56,22,83,53,73)
boot.total <- c(900,150,900,200,150,100,200,300,150,300,200,500)
n <- try(optim(c(min(boot.total)-1,100,1),nllfun2g.boot,
        lower=rep(fuzz,3),upper=c(min(boot.total)-fuzz,Inf,Inf),
           method="L-BFGS-B",control=list(trace=TRUE),debug=TRUE))

boot.pred <- c(31,73,56,22,22,56,83,22,83,91,30,44)
boot.total <- c(200,100,300,150,150,300,100,150,300,900,500,900)
n <- optim(c(min(boot.total)-1,100,1),nllfun2g.boot,
        lower=rep(fuzz,3),upper=c(min(boot.total)-fuzz,Inf,Inf),
           method="L-BFGS-B",control=list(trace=TRUE),debug=TRUE)


--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 671.followup.1 <==
From ripley@stats.ox.ac.uk  Thu Sep 28 19:12:40 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA20415
	for <R-bugs@biostat.ku.dk>; Thu, 28 Sep 2000 19:12:40 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id SAA14662;
	Thu, 28 Sep 2000 18:12:56 +0100 (BST)
Message-Id: <200009281712.SAA14662@toucan.stats.ox.ac.uk>
Date: Thu, 28 Sep 2000 18:12:56 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] bounds violations, infinite loops in optim/L-BFGS-B (PR#671)
To: bolker@zoo.ufl.edu
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: YCLppr5jNvpqa/5vgeKMqA==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 


> From: bolker@zoo.ufl.edu
> Date: Tue, 26 Sep 2000 16:14:13 +0200 (MET DST)
> 
>   I'm having some trouble with optim(method="L-BFGS-B"),
> and I'm not sure I have the ability to track down and fix
> what seem to be bugs within optim().
>   I'm bootstrapping an original data set and fitting a model
> to each bootstrapped data set.  For some bootstrapped samples,
> optim() sets negative parameter values (despite the fact that
> I have explicitly set non-zero lower bounds on the parameters)
> and chokes.  For other samples, it appears to get into an infinite
> loop (ignoring the finite value of maxit).
>  
>   Functions and samples that provoke the problem are below: I
> was able to reproduce the problems running this with --vanilla.
> 
>   Not exactly a bug but: there is no tracing information built
> into L-BFGS-B (setting trace=TRUE has no effect).

It's a feature, on the TODO list to be added one day.

>   Also, a general question: are both nlm() and optim() going to
> be around indefinitely?  Should I be using one or the other?

There are no plans to remove either.  `indefinitely' is not part
of the non-warranty.
 
>   For the moment I've managed to (sort of) get around the problem
> with try(), but the infinite loops are a real nuisance ...

On Solaris, I get neither negative values nor an infinite loop
on your examples. 

On Linux RH6.2/gcc 2.95.2 I get

NA 1 NA 1 1 1 1 0.6831783 1 0.6831783 1 NA 
NA -Inf NA -Inf -Inf -Inf -Inf -160.2173 -Inf -107.0805 -Inf NA 
Error in optim(c(min(boot.total) - 1, 100, 1), nllfun2g.boot, lower = rep(fuzz,  
: 
        L-BFGS-B needs finite values of fn

for the first, and probably a loop for the second.  I think this is
the usual problem with inconsistent internal precision on Linux
compilers, so try compiling optim.c with -ffloat-store to make gcc
IEEE-compliant.  (At least, that's what the Linux gcc man page says.)

Can you provide some evidence for negative parameter values?  That's
not supposed to happen, but as I rarely fail to supply derivatives,
I have not tested it much.

Finally, I think you have omitted to supply scaling consts for your problem,
and optim will work a lot better if you do, as it will also do if
you can supply analytical derivatives.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 671.followup.2 <==
From ben@zoo.ufl.edu  Fri Sep 29 22:45:49 2000
Received: from smtp.ufl.edu (sp28fe.nerdc.ufl.edu [128.227.128.108])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA02711
	for <R-bugs@biostat.ku.dk>; Fri, 29 Sep 2000 22:45:48 +0200 (MET DST)
From: ben@zoo.ufl.edu
Received: from bolker.zoo.ufl.edu (bolker.zoo.ufl.edu [10.227.60.45])
	by smtp.ufl.edu (8.9.3/8.9.3/2.2.1) with ESMTP id QAA41504;
	Fri, 29 Sep 2000 16:45:59 -0400
Date: Fri, 29 Sep 2000 16:49:08 -0400 (EDT)
Reply-To: bolker@zoo.ufl.edu
To: ripley@stats.ox.ac.uk
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] bounds violations, infinite loops in optim/L-BFGS-B (PR#671)
In-Reply-To: <200009281712.TAA20426@pubhealth.ku.dk>
Message-ID: <Pine.LNX.4.10.10009291633590.22920-100000@bolker.zoo.ufl.edu>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Thu, 28 Sep 2000 ripley@stats.ox.ac.uk wrote:

> It's a feature, on the TODO list to be added one day.

  A quick hack (if anyone wants to do it) is to change line 975 from

/*	Rprintf("in lbfgsb - %s\n", task);*/

 to

	if (trace) Rprintf("in lbfgsb - %s\n", task);

however, the debugging output that you get is pretty ugly.

> >   Also, a general question: are both nlm() and optim() going to
> > be around indefinitely?  Should I be using one or the other?

  Well, my question was more whether one was preferred or not ... I did
see a comment in some NEWS file at some point that a built-in function had
been switched to optim() and so should converge more often.

  At your suggestion I compiled optim.c (and ../appl/lbfgsb.c for good
measure) with -ffloat-store.  The negative parameter jumps went away, but
I can still provoke optim() to hang with the right (not uncommon) choice
of bootstrap values.  Adding what I thought were reasonable parscale
values makes my code hang in different places [i.e. the particular values
that I give below are no longer a problem], but doesn't stop it hanging or
even reduce the frequency with which it hangs.  Perhaps now that I have
ffloat-store enabled the values below will hang under Solaris as well.

  Should ffloat-store be enabled in general for compilation on Linux
boxes?

  Just for the record, the apparent internal behavior (which I extracted
by uncommenting/modifying line 975 of optim.c as above) is that the
routine does task FG_START, followed by 20 FG_LNSRCH, followed by
ABNORMAL_TERMINATION_IN_LNSRCH, then repeats this indefinitely.  I
wouldn't mind so much if optim/lbfgsb looped until a maximum number of
iterations and then stopped with an error code, but as it stands these
particular cycles never make it to an iteration check and so the loop
never stops -- in order to do the bootstrap run I have to sit and hit
Ctrl-C to restart every time it looks like it's hanging.

  I agree that supplying derivatives would probably fix the problem
(parscale doesn't seem to help enough to fix the problem), but I'm in part
trying to provide this as a tool for non-analytically-inclined students
and I don't want to have to hold their hands while they take the
derivatives of their functions ...

 I greatly appreciate the time that you, and the rest of the core team,
have put into R.

  Ben Bolker

======================
cfunc2_function(input,N1,N2,G=1.0){
  pmin(1,1/((1+((input - N1)/N2))^G))
}

nllfun2g.boot_function(q,debug=FALSE){
  N1_q[1]
  N2_q[2]
  G_q[3]
  maxval <- 1e8
  L_cfunc2(boot.total,N1,N2,G)
  if (debug) cat(c(N1,N2,G,range(L)),"\n")
  r <- -sum(dbinom(boot.pred, boot.total, L, log=TRUE))
  r[!is.finite(r)] <- maxval*sign(r[!is.finite(r)])
  r
}
  
debug <- FALSE
trace <- TRUE
fuzz <- 0.001

## hangs

boot.pred <- c(53,73,73,44,22,31,73,22,53,53,91,73)
boot.total <- c(200,500,100,900,150,200,500,150,200,200,900,100)

n <- try(optim(c(min(boot.total)-1,100,1),nllfun2g.boot,
        lower=rep(fuzz,3),upper=c(min(boot.total)-fuzz,Inf,Inf),
           method="L-BFGS-B",control=list(trace=trace),debug=debug))


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 670 *
Subject: Returned mail: User unknown
Subject: Notification: incoming/664
Subject: Returned mail: User unknown
Subject: Notification: incoming/661
Subject:  bug with line widths in postscript output
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
From: "White, Paul" <Paul.White@dsto.defence.gov.au>
Date: Mon, 25 Sep 2000 12:28:32 +0200
Date: Mon, 25 Sep 2000 12:28:31 +0200
Date: Thu, 21 Sep 2000 04:45:10 +0200
Date: Thu, 21 Sep 2000 04:45:09 +0200
Date: Mon, 18 Sep 2000 14:33:36 +1100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 670 <==
From MAILER-DAEMON  Mon Sep 25 12:22:01 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA04123
	for <r-bugs@mail.kubism.ku.dk>; Mon, 25 Sep 2000 12:22:01 +0200 (MET DST)
Received: from localhost (localhost)
	by biostat.ku.dk (8.9.3/8.9.3) with internal id MAA19490;
	Mon, 25 Sep 2000 12:28:32 +0200
Date: Mon, 25 Sep 2000 12:28:32 +0200
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
Message-Id: <200009251028.MAA19490@biostat.ku.dk>
To: <R-bugs@biostat.ku.dk>
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
	boundary="MAA19490.969877712/biostat.ku.dk"
Subject: Returned mail: User unknown
Auto-Submitted: auto-generated (failure)

This is a MIME-encapsulated message

--MAA19490.969877712/biostat.ku.dk

The original message was received at Mon, 25 Sep 2000 12:28:31 +0200
from blueberry.kubism.ku.dk [130.225.108.193]

   ----- The following addresses had permanent fatal errors -----
<Misunderstanding>
    (expanded from: <Misunderstanding>)
<by>
    (expanded from: <by>)
<user>
    (expanded from: <user>)

   ----- Transcript of session follows -----
... while talking to mail.kubism.ku.dk:
>>> RCPT To:<user@mail.kubism.ku.dk>
<<< 550 <user@mail.kubism.ku.dk>... User unknown
550 <user>... User unknown
>>> RCPT To:<by@mail.kubism.ku.dk>
<<< 550 <by@mail.kubism.ku.dk>... User unknown
550 <by>... User unknown
>>> RCPT To:<misunderstanding@mail.kubism.ku.dk>
<<< 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
550 <Misunderstanding>... User unknown

--MAA19490.969877712/biostat.ku.dk
Content-Type: message/delivery-status

Reporting-MTA: dns; biostat.ku.dk
Received-From-MTA: DNS; blueberry.kubism.ku.dk
Arrival-Date: Mon, 25 Sep 2000 12:28:31 +0200

Final-Recipient: RFC822; misunderstanding@biostat.ku.dk
X-Actual-Recipient: RFC822; misunderstanding@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Mon, 25 Sep 2000 12:28:32 +0200

Final-Recipient: RFC822; by@biostat.ku.dk
X-Actual-Recipient: RFC822; by@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <by@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Mon, 25 Sep 2000 12:28:32 +0200

Final-Recipient: RFC822; user@biostat.ku.dk
X-Actual-Recipient: RFC822; user@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <user@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Mon, 25 Sep 2000 12:28:32 +0200

--MAA19490.969877712/biostat.ku.dk
Content-Type: message/rfc822

Return-Path: <R-bugs@biostat.ku.dk>
Received: from localhost (blueberry.kubism.ku.dk [130.225.108.193])
	by biostat.ku.dk (8.9.3/8.9.3) with ESMTP id MAA19488;
	Mon, 25 Sep 2000 12:28:31 +0200
Date: Mon, 25 Sep 2000 12:28:31 +0200
Message-Id: <200009251028.MAA19488@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
To: Misunderstanding, by, user
Subject: Notification: incoming/664

R Bug Tracking System notification

maechler moved PR#664 from incoming to trashcan
Message summary for PR#664
	From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
	Subject: Returned mail: User unknown
	Date: Thu, 21 Sep 2000 04:45:10  0200
	0 replies 	0 followups

====> ORIGINAL MESSAGE FOLLOWS <====

>From MAILER-DAEMON  Thu Sep 21 04:39:18 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id EAA03046
	for <r-bugs@mail.kubism.ku.dk>; Thu, 21 Sep 2000 04:39:18 +0200 (MET DST)
Received: from localhost (localhost)
	by biostat.ku.dk (8.9.3/8.9.3) with internal id EAA28808;
	Thu, 21 Sep 2000 04:45:10 +0200
Date: Thu, 21 Sep 2000 04:45:10 +0200
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
Message-Id: <200009210245.EAA28808@biostat.ku.dk>
To: <R-bugs@biostat.ku.dk>
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
	boundary="EAA28808.969504310/biostat.ku.dk"
Subject: Returned mail: User unknown
Auto-Submitted: auto-generated (failure)

This is a MIME-encapsulated message

--EAA28808.969504310/biostat.ku.dk

The original message was received at Thu, 21 Sep 2000 04:45:09 +0200
from blueberry.kubism.ku.dk [130.225.108.193]

   ----- The following addresses had permanent fatal errors -----
<Misunderstanding>
    (expanded from: <Misunderstanding>)
<by>
    (expanded from: <by>)
<user>
    (expanded from: <user>)

   ----- Transcript of session follows -----
... while talking to mail.kubism.ku.dk:
>>> RCPT To:<user@mail.kubism.ku.dk>
<<< 550 <user@mail.kubism.ku.dk>... User unknown
550 <user>... User unknown
>>> RCPT To:<by@mail.kubism.ku.dk>
<<< 550 <by@mail.kubism.ku.dk>... User unknown
550 <by>... User unknown
>>> RCPT To:<misunderstanding@mail.kubism.ku.dk>
<<< 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
550 <Misunderstanding>... User unknown

--EAA28808.969504310/biostat.ku.dk
Content-Type: message/delivery-status

Reporting-MTA: dns; biostat.ku.dk
Received-From-MTA: DNS; blueberry.kubism.ku.dk
Arrival-Date: Thu, 21 Sep 2000 04:45:09 +0200

Final-Recipient: RFC822; misunderstanding@biostat.ku.dk
X-Actual-Recipient: RFC822; misunderstanding@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Thu, 21 Sep 2000 04:45:10 +0200

Final-Recipient: RFC822; by@biostat.ku.dk
X-Actual-Recipient: RFC822; by@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <by@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Thu, 21 Sep 2000 04:45:10 +0200

Final-Recipient: RFC822; user@biostat.ku.dk
X-Actual-Recipient: RFC822; user@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <user@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Thu, 21 Sep 2000 04:45:10 +0200

--EAA28808.969504310/biostat.ku.dk
Content-Type: message/rfc822

Return-Path: <R-bugs@biostat.ku.dk>
Received: from localhost (blueberry.kubism.ku.dk [130.225.108.193])
	by biostat.ku.dk (8.9.3/8.9.3) with ESMTP id EAA28806;
	Thu, 21 Sep 2000 04:45:09 +0200
Date: Thu, 21 Sep 2000 04:45:09 +0200
Message-Id: <200009210245.EAA28806@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
To: Misunderstanding, by, user
Subject: Notification: incoming/661

R Bug Tracking System notification

bates moved PR#661 from incoming to Graphics-fixed
Message summary for PR#661
	From: "White, Paul" <Paul.White@dsto.defence.gov.au>
	Subject: bug with line widths in postscript output
	Date: Mon, 18 Sep 2000 14:33:36  1100
	0 replies 	0 followups

====> ORIGINAL MESSAGE FOLLOWS <====

>From Paul.White@dsto.defence.gov.au  Mon Sep 18 05:39:33 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id FAA25860
	for <R-bugs@biostat.ku.dk>; Mon, 18 Sep 2000 05:39:28 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id FAA23055
	for <r-bugs@hypatia.math.ethz.ch>; Mon, 18 Sep 2000 05:39:46 +0200 (MET DST)
Received: from digger1.defence.gov.au(203.5.217.4)
 via SMTP by hypatia, id smtpdAAAa005cB; Mon Sep 18 05:39:36 2000
Received: from dsto-ms2.dsto.defence.gov.au (dsto-ms2.dsto.defence.gov.au [131.185.2.150])
	by digger1.defence.gov.au (8.10.1/8.10.1) with ESMTP id e8I3eGU14910
	for <r-bugs@hypatia.math.ethz.ch>; Mon, 18 Sep 2000 13:10:16 +0930 (CST)
Received: from muttley.dsto.defence.gov.au (unverified) by dsto-ms2.dsto.defence.gov.au
 (Content Technologies SMTPRS 4.1.5) with ESMTP id <T83b902964eba27bcbe@dsto-ms2.dsto.defence.gov.au> for <r-bugs@hypatia.math.ethz.ch>;
 Mon, 18 Sep 2000 13:10:15 +0930
Received: from fang.dsto.defence.gov.au (fang.dsto.defence.gov.au [131.185.2.5])
	by muttley.dsto.defence.gov.au (8.9.3/8.9.3/8.9.3.LMD.990513) with ESMTP id NAA30199
	for <r-bugs@hypatia.math.ethz.ch>; Mon, 18 Sep 2000 13:03:27 +0930 (CST)
Received: from fmbex001.dsto.defence.gov.au (fmbex001.dsto.defence.gov.au [146.221.39.73])
	by fang.dsto.defence.gov.au (8.9.3/8.9.3/8.9.3.LMD.990513) with ESMTP id NAA17346
	for <r-bugs@lists.r-project.org>; Mon, 18 Sep 2000 13:03:25 +0930 (CST)
Received: by fmbex001.dsto.defence.gov.au with Internet Mail Service (5.5.2650.21)
	id <SPQ0TWHG>; Mon, 18 Sep 2000 14:33:32 +1100
Message-ID: <751E281AA9DED31194FA0090274DFFBC0836E9@FMBEX003>
From: "White, Paul" <Paul.White@dsto.defence.gov.au>
To: "'r-bugs@lists.r-project.org'" <r-bugs@stat.math.ethz.ch>
Subject:  bug with line widths in postscript output
Date: Mon, 18 Sep 2000 14:33:36 +1100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2650.21)
Content-Type: text/plain

Hello R-people,

When I set the line width using par(lwd=2) this correctly changes the line
size on the screen output however it does not change the linewidth when the
output is sent to a postscript file. I think this is a bug.

Here is the version info

platform i686-pc-linux-gnu
arch     i686             
os       linux-gnu        
system   i686, linux-gnu  
status                    
major    1                
minor    1.1              
year     2000             
month    August           
day      15               
language R                


Thanks

Paul White
Aeronautical and Maritime Research Laboratory
Melbourne, Australia.


--EAA28808.969504310/biostat.ku.dk--



--MAA19490.969877712/biostat.ku.dk--

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 674 *
Subject: all.equal.list() sometimes fails with unnamed and named components
From: "Charles C. Berry" <cberry@tajo.ucsd.edu>
Date: Fri, 29 Sep 2000 14:20:47 -0700 (PDT)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 674 <==
From cberry@tajo.ucsd.edu  Fri Sep 29 23:18:09 2000
Received: from smtp.ucsd.edu (smtp.ucsd.edu [132.239.1.49])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id XAA02882
	for <r-bugs@biostat.ku.dk>; Fri, 29 Sep 2000 23:18:07 +0200 (MET DST)
Received: from tajo.ucsd.edu (tajo.ucsd.edu [132.239.99.2])
	by smtp.ucsd.edu (8.9.3/8.9.3) with ESMTP id OAA15578
	for <r-bugs@biostat.ku.dk>; Fri, 29 Sep 2000 14:18:25 -0700 (PDT)
Received: by tajo.ucsd.edu (8.9.3+Sun/SMI-SVR4-UCSD.1)
	id OAA13106; Fri, 29 Sep 2000 14:20:47 -0700 (PDT)
Date: Fri, 29 Sep 2000 14:20:47 -0700 (PDT)
Message-Id: <200009292120.OAA13106@tajo.ucsd.edu>
From: "Charles C. Berry" <cberry@tajo.ucsd.edu>
To: r-bugs@biostat.ku.dk
Subject: all.equal.list() sometimes fails with unnamed and named components


examples:

1) Fails to report that components 2 and 3 differ

all.equal(list(1,2,3,zap=1),list(1,3,4,zap=2))
[1] "Component zap: Mean relative  difference: 1


2) Incorrectly asserts all are equal when components 2 and 3 differ

> all.equal(list(1,2,3,zap=1),list(1,3,4,zap=1))
[1] TRUE

3) Removing named component reveals differences:

> all.equal(list(1,2,3,1),list(1,3,4,1))
[1] "Component 2: Mean relative  difference: 0.5"      
[2] "Component 3: Mean relative  difference: 0.3333333"

4) Unequal first component reveals differences

> all.equal(list(2,2,3,zap=1),list(1,3,4,zap=1))
[1] "Component : Mean relative  difference: 0.5"
[2] "Component : Mean relative  difference: 0.5"
[3] "Component : Mean relative  difference: 0.5"
> all.equal(list(2,2,3,zap=1),list(1,3,4,zap=2))
[1] "Component : Mean relative  difference: 0.5" 
[2] "Component : Mean relative  difference: 0.5" 
[3] "Component : Mean relative  difference: 0.5" 
[4] "Component zap: Mean relative  difference: 1"
> 

5) Second component IS equal, but:

> all.equal(list(2,2,3,zap=1),list(1,2,4,zap=2))
[1] "Component : Mean relative  difference: 0.5" 
[2] "Component : Mean relative  difference: 0.5" 
[3] "Component : Mean relative  difference: 0.5" 
[4] "Component zap: Mean relative  difference: 1"

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.0
 year = 2000
 month = June
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

Chuck Berry

-- 
Charles C. Berry                        (858) 534-2098 
                                         Dept of Family/Preventive Medicine
E mailto:cberry@tajo.ucsd.edu	         UC San Diego
http://hacuna.ucsd.edu/members/ccb.html  La Jolla, San Diego 92093-0645

 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 673 *
Subject:  pretty not covering the range properly 
From: David Paul McLaughlin <david@orion-10.cs.byu.edu>
Date: Fri, 25 Aug 2000 14:16:42 -0400
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 673 <==
From david@orion-10.cs.byu.edu  Fri Sep 29 22:57:57 2000
Received: from orion-10.cs.byu.edu (IDENT:root@orion-10.cs.byu.edu [128.187.172.74])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA02784
	for <r-bugs@biostat.ku.dk>; Fri, 29 Sep 2000 22:57:56 +0200 (MET DST)
Received: (from david@localhost)
	by orion-10.cs.byu.edu (8.9.3/8.9.3) id OAA03890;
	Fri, 25 Aug 2000 14:16:42 -0400
Date: Fri, 25 Aug 2000 14:16:42 -0400
From: David Paul McLaughlin <david@orion-10.cs.byu.edu>
Message-Id: <200008251816.OAA03890@orion-10.cs.byu.edu>
To: r-bugs@biostat.ku.dk
Subject:  pretty not covering the range properly 
Cc: david@orion-10.cs.byu.edu

When I issue the command:

if ( c(2.8,3)[1] < pretty (c(2.8,3))[1]) print ("problem")

the result is "problem" prints.
I have traced it to bits and the 2.8 of the returned vector from pretty is slightly larger.
This seems to be due to the conversion to base 10 with the ns and unit variables in src/appl/pretty.c.

Anyway if I do something like:
hist(c(2.8,3))
it fails as well because it uses pretty.

Thanks for you attention,
DavidMcLaughlin@byu.edu




--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Patched
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 23
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 673.reply.1 <==
From maechler@stat.math.ethz.ch  Mon Oct  2 15:05:09 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA17583
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 15:05:08 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id PAA16493;
	Mon, 2 Oct 2000 15:05:24 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa0041H; Mon Oct  2 15:05:19 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id PAA02197; Mon, 2 Oct 2000 15:05:18 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14808.34830.417418.896999@gargle.gargle.HOWL>
Date: Mon, 2 Oct 2000 15:05:18 +0200
To: david@orion-10.cs.byu.edu
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] pretty not covering the range properly (PR#673)
In-Reply-To: <200009292057.WAA02794@pubhealth.ku.dk>
References: <200009292057.WAA02794@pubhealth.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "david" == david  <david@orion-10.cs.byu.edu> writes:

    david> When I issue the command: if ( c(2.8,3)[1] < pretty
    david> (c(2.8,3))[1]) print ("problem")

    david> the result is "problem" prints.  I have traced it to bits and
    david> the 2.8 of the returned vector from pretty is slightly larger.
    david> This seems to be due to the conversion to base 10 with the ns
    david> and unit variables in src/appl/pretty.c.

    david> Anyway if I do something like: hist(c(2.8,3)) it fails as well
    david> because it uses pretty.

    david> Thanks for you attention, DavidMcLaughlin@byu.edu

Thank you for the bug report.
This bug is ``new'' (a bit more than a year!) and was introduced when
someone fixed another problem in pretty.c 
by adding "1e-5" fuzz a bit too generously
hmm,....... 
I'll have a look.

    david> Version: .... R 1.1.1 ...


Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 673.reply.2 <==
From maechler@stat.math.ethz.ch  Tue Oct  3 11:16:55 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA25128
	for <R-bugs@biostat.ku.dk>; Tue, 3 Oct 2000 11:16:54 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA11152
	for <R-bugs@biostat.ku.dk>; Tue, 3 Oct 2000 11:17:12 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa002iE; Tue Oct  3 11:17:04 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id LAA03406; Tue, 3 Oct 2000 11:17:01 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14809.41997.51315.800507@gargle.gargle.HOWL>
Date: Tue, 3 Oct 2000 11:17:01 +0200
To: R-bugs@biostat.ku.dk
Subject: Re: [Rd] pretty not covering the range properly (PR#673)
In-Reply-To: <200010021305.PAA17599@pubhealth.ku.dk>
References: <200010021305.PAA17599@pubhealth.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:

>>>>> "david" == david  <david@orion-10.cs.byu.edu> writes:
    david> When I issue the command: if ( c(2.8,3)[1] < pretty
    david> (c(2.8,3))[1]) print ("problem")

    david> the result is "problem" prints.  I have traced it to bits and
    david> the 2.8 of the returned vector from pretty is slightly larger.
    david> This seems to be due to the conversion to base 10 with the ns
    david> and unit variables in src/appl/pretty.c.

    david> Anyway if I do something like: hist(c(2.8,3)) it fails as well
    david> because it uses pretty.

    david> Thanks for you attention, DavidMcLaughlin@byu.edu

    MM> Thank you for the bug report.  This bug is ``new'' (a bit more than
    MM> a year!) and was introduced when someone fixed another problem in
    MM> pretty.c by adding "1e-5" fuzz a bit too generously hmm,.......
    MM> I'll have a look.

    david> Version: .... R 1.1.1 ...

Ok, I've fixed pretty() for the development version
such that
     p <- pretty(x)
     all(p[1] <= x & x <= p[2])

should be guaranteed (again).

Note however, that this really also changes some "results",
that may be unexpected,
e.g.

    R 1.1.1 :
    ---------

    > data(women); (hT <- hist(women$weight, nc= 7, plot = FALSE))[2]

    $counts
     [1] 3 1 2 2 1 1 2 1 1 1

    --------------

    R-devel [to be 1.2.0]:
    ---------------------

    > data(women); (hT <- hist(women$weight, nc= 7, plot = FALSE))[2]

    $counts
     [1] 2 2 2 1 2 1 2 1 1 1

    > 

------

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

==> 673.reply.3 <==
From pd@biostat.ku.dk  Tue Oct  3 11:49:52 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA25674;
	Tue, 3 Oct 2000 11:49:52 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id LAA20863;
	Tue, 3 Oct 2000 11:57:33 +0200
Sender: pd@blueberry.kubism.ku.dk
To: maechler@stat.math.ethz.ch
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] pretty not covering the range properly (PR#673)
References: <200010030916.LAA25138@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 03 Oct 2000 11:57:32 +0200
In-Reply-To: maechler@stat.math.ethz.ch's message of "Tue, 3 Oct 2000 11:16:59 +0200 (MET DST)"
Message-ID: <x21yxyw8kz.fsf@blueberry.kubism.ku.dk>
Lines: 22
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

maechler@stat.math.ethz.ch writes:

> Ok, I've fixed pretty() for the development version
> such that
>      p <- pretty(x)
>      all(p[1] <= x & x <= p[2])
> 
> should be guaranteed (again).

Gulp. I'm pretty(!) sure there was a reason for changing it in the
other direction... [I have a vague recollection of pretty(pretty(x))
!= pretty(x) or something like that] Are we quite sure that it is not
the caller that needs to be a little more lenient in the bounds
checking?

OTOH, it's in code you wrote yourself...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 673.reply.4 <==
From maechler@stat.math.ethz.ch  Tue Oct  3 12:40:17 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA26582;
	Tue, 3 Oct 2000 12:40:16 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id MAA15966;
	Tue, 3 Oct 2000 12:40:34 +0200 (MET DST)
Received: from lynne(129.132.58.30), claiming to be "lynne.ethz.ch"
 via SMTP by hypatia, id smtpdAAAa003tS; Tue Oct  3 12:40:29 2000
Received: (maechler@localhost) by lynne.ethz.ch (8.9.3/D-MATH-client) id MAA03476; Tue, 3 Oct 2000 12:40:28 +0200
X-Authentication-Warning: lynne.ethz.ch: maechler set sender to maechler@stat.math.ethz.ch using -f
From: Martin Maechler <maechler@stat.math.ethz.ch>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <14809.47004.859408.775007@gargle.gargle.HOWL>
Date: Tue, 3 Oct 2000 12:40:28 +0200
To: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Cc: R-bugs@biostat.ku.dk
Subject: Re: [Rd] pretty not covering the range properly (PR#673)
In-Reply-To: <x21yxyw8kz.fsf@blueberry.kubism.ku.dk>
References: <200010030916.LAA25138@pubhealth.ku.dk>
	<x21yxyw8kz.fsf@blueberry.kubism.ku.dk>
X-Mailer: VM 6.76 under Emacs 20.7.1
Reply-To: Martin Maechler <maechler@stat.math.ethz.ch>

>>>>> "PD" == Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk> writes:

    PD> maechler@stat.math.ethz.ch writes:

      MM> Ok, I've fixed pretty() for the development version such that 
      MM>    p <- pretty(x)
      MM>    all(p[1] <= x & x <= p[length(p)])
      MM> should be guaranteed (again).

    PD> Gulp. I'm pretty(!) sure there was a reason for changing it in the
    PD> other direction...
yes, the change last year (between 0.64 and 0.65) *was* for a good reason,
and I have not reverted that!
    PD> [I have a vague recollection of
    PD> pretty(pretty(x)) != pretty(x) or something like that]

    PD> Are we quite sure that it is not the caller that needs to be a
    PD> little more lenient in the bounds checking?

I've thought of that, too.
But no, I think we want to guarantuee the above 
    {which I had wrong in the last e-mail, it's "[length(p)]" !}
which we have had always in the documentation and which *is* S compatible.

    PD> OTOH, it's in code you wrote yourself...


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 677 *
Subject: R build on i86pc Solaris 2.7
From: albrecht.gebhardt@uni-klu.ac.at
Date: Mon, 2 Oct 2000 17:52:46 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 677 <==
From albrecht.gebhardt@uni-klu.ac.at  Mon Oct  2 17:52:46 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA19790
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 17:52:46 +0200 (MET DST)
Date: Mon, 2 Oct 2000 17:52:46 +0200 (MET DST)
From: albrecht.gebhardt@uni-klu.ac.at
Message-Id: <200010021552.RAA19790@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: R build on i86pc Solaris 2.7

Full_Name: Albrecht Gebhardt
Version: 1.1.1
OS: i86pc Solaris 2.7
Submission from: (NULL) (143.205.61.82)


jmp_buf type undeclared, may be related to the installed version of libjpeg
(this is v6b), compiler is gcc/g77 2.95.2:

root@pc05-stat[X11]# make
creating src/unix/X11/Makefile
making rbitmap.d from rbitmap.c
make[1]: Entering directory `/usr/share/src/R-1.1.1/src/unix/X11'
gcc -I. -I../../../src/include -I../../../src/include
-I../../../src/include/R_ext -I/usr/openwin/include -I/usr/local/include
-DHAVE_CONFIG_H -mieee-fp -fPIC  -g -O2 -c rbitmap.c -o rbitmap.o
rbitmap.c:239: parse error before `jmp_buf'
rbitmap.c:239: warning: no semicolon at end of struct or union
rbitmap.c: In function `my_error_exit':
rbitmap.c:257: dereferencing pointer to incomplete type
rbitmap.c: In function `R_SaveAsJpeg':
rbitmap.c:279: storage size of `jerr' isn't known
make[1]: *** [rbitmap.o] Error 1
make[1]: Leaving directory `/usr/share/src/R-1.1.1/src/unix/X11'
make: *** [R] Error 2


Solution:
*************************************************
--- src/unix/X11/rbitmap.c.jpeg-patch   Mon Oct  2 16:18:16 2000
+++ src/unix/X11/rbitmap.c      Mon Oct  2 16:40:36 2000
@@ -231,6 +231,9 @@
 #ifdef HAVE_JPEG
 
 #include <jpeglib.h>
+#if __sun__ & __i386
+#include <setjmp.h>
+#endif
 
 /* Here's the extended error handler struct */> version
         _                 
************************************************

with this patch R compiles and passes "make test", the 
full version is:

> version
         _                 
platform i386-pc-solaris2.7
arch     i386              
os       solaris2.7        
system   i386, solaris2.7  
status                     
major    1                 
minor    1.1               
year     2000              
month    August            
day      15                
language R                 


Albrecht

==> 677.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Oct  2 17:59:32 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA19904
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 17:59:31 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id QAA07972;
	Mon, 2 Oct 2000 16:59:43 +0100 (BST)
Message-Id: <200010021559.QAA07972@toucan.stats.ox.ac.uk>
Date: Mon, 2 Oct 2000 16:59:43 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] R build on i86pc Solaris 2.7 (PR#677)
To: albrecht.gebhardt@uni-klu.ac.at
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: QqAdbUHcAbdFHsgB7mL1eQ==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 

It's related to having jpeg and not png, and it is already fixed in the
R-devel tree. An unconditional <setjmp.h> is fine.


> From: albrecht.gebhardt@uni-klu.ac.at
> Date: Mon, 2 Oct 2000 17:52:47 +0200 (MET DST)
> 
> Full_Name: Albrecht Gebhardt
> Version: 1.1.1
> OS: i86pc Solaris 2.7
> Submission from: (NULL) (143.205.61.82)
> 
> 
> jmp_buf type undeclared, may be related to the installed version of libjpeg
> (this is v6b), compiler is gcc/g77 2.95.2:
> 
> root@pc05-stat[X11]# make
> creating src/unix/X11/Makefile
> making rbitmap.d from rbitmap.c
> make[1]: Entering directory `/usr/share/src/R-1.1.1/src/unix/X11'
> gcc -I. -I../../../src/include -I../../../src/include
> -I../../../src/include/R_ext -I/usr/openwin/include -I/usr/local/include
> -DHAVE_CONFIG_H -mieee-fp -fPIC  -g -O2 -c rbitmap.c -o rbitmap.o
> rbitmap.c:239: parse error before `jmp_buf'
> rbitmap.c:239: warning: no semicolon at end of struct or union
> rbitmap.c: In function `my_error_exit':
> rbitmap.c:257: dereferencing pointer to incomplete type
> rbitmap.c: In function `R_SaveAsJpeg':
> rbitmap.c:279: storage size of `jerr' isn't known
> make[1]: *** [rbitmap.o] Error 1
> make[1]: Leaving directory `/usr/share/src/R-1.1.1/src/unix/X11'
> make: *** [R] Error 2
> 
> 
> Solution:
> *************************************************
> --- src/unix/X11/rbitmap.c.jpeg-patch   Mon Oct  2 16:18:16 2000
> +++ src/unix/X11/rbitmap.c      Mon Oct  2 16:40:36 2000
> @@ -231,6 +231,9 @@
>  #ifdef HAVE_JPEG
>  
>  #include <jpeglib.h>
> +#if __sun__ & __i386
> +#include <setjmp.h>
> +#endif
> 

R-devel has

#ifdef HAVE_JPEG

#include <jpeglib.h>
#include <setjmp.h>

....


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 676 *
Subject: documentation error for deriv; MASS scripts ch8;
From: kjetil halvorsen <kjetilh@umsanet.edu.bo>
Date: Mon, 02 Oct 2000 11:23:19 -0400
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 676 <==
From kjetilh@umsanet.edu.bo  Mon Oct  2 17:27:36 2000
Received: from jupiter.umsanet.edu.bo (jupiter.umsanet.edu.bo [166.114.17.4])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA19477
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 17:26:25 +0200 (MET DST)
Received: from umsanet.edu.bo (pc69.umsanet.edu.bo [166.114.17.69])
	by jupiter.umsanet.edu.bo (8.9.3/8.9.3) with ESMTP id KAA24365
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 10:57:10 -0400
Message-ID: <39D8A867.D1E504C3@umsanet.edu.bo>
Date: Mon, 02 Oct 2000 11:23:19 -0400
From: kjetil halvorsen <kjetilh@umsanet.edu.bo>
Reply-To: kjetilh@umsanet.edu.bo
Organization: UMSA
X-Mailer: Mozilla 4.7 [en] (Win98; I)
X-Accept-Language: en
MIME-Version: 1.0
To: R-bugs@biostat.ku.dk
Subject: documentation error for deriv; MASS scripts ch8;
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

Hola!

There is a bug in the documentation file for deriv, which says that
the third argument is unimplemented. It seems only to be implemented
differently than in s-plus. I show whith the MASS R-script
ch8 file as example:

> expn1 <- deriv(y ~ b0 + b1 * 2^(-x/th), c("b0", "b1", "th"),
+                function(b0, b1, th, x) {})
> expn1
function(b0, b1, th, x) {}

which cannnot be used whith nls! But changing to:

> expn1 <- deriv(y ~ b0 + b1 * 2^(-x/th), c("b0", "b1", "th"),
+                c("b0", "b1", "th", "x") )
> expn1
function (b0, b1, th, x) 
{
    .expr3 <- 2^(-x/th)
    .value <- b0 + b1 * .expr3
    .grad <- array(0, c(length(.value), 3), list(NULL, c("b0", 
        "b1", "th")))
    .grad[, "b0"] <- 1
    .grad[, "b1"] <- .expr3
    .grad[, "th"] <- b1 * (.expr3 * (log(2) * (x/th^2)))
    attr(.value, "gradient") <- .grad
    .value
}

gives the desired result. 

Kjetil Halvorsen
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 675 *
Subject: several documentation problems
From: sws96srb@met.rdg.ac.uk
Date: Mon, 2 Oct 2000 14:24:37 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 675 <==
From sws96srb@met.rdg.ac.uk  Mon Oct  2 14:24:38 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA16603
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 14:24:37 +0200 (MET DST)
Date: Mon, 2 Oct 2000 14:24:37 +0200 (MET DST)
From: sws96srb@met.rdg.ac.uk
Message-Id: <200010021224.OAA16603@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: several documentation problems

Full_Name: Sheila Bryant
Version: 1.1.1
OS: Solaris 2.6
Submission from: (NULL) (134.225.16.2)


During the 'make' process I get the following:

String found where operator expected at
/export/bors/bors-01/sws96srb/R-1.1.1/etc/Rdconvlib.pl line 781, near
"("</TABLE>\n""
        (Missing operator before "</TABLE>\n"?)
Bare word found where operator expected at
/export/bors/bors-01/sws96srb/R-1.1.1/etc/Rdconvlib.pl line 1234, near "
mywrap"
        (Missing operator before mywrap?)
Bare word found where operator expected at
/export/bors/bors-01/sws96srb/R-1.1.1/etc/Rdconvlib.pl line 1249, near "
txt_header"
        (Missing operator before txt_header?)
Bare word found where operator expected at
/export/bors/bors-01/sws96srb/R-1.1.1/etc/Rdconvlib.pl line 1264, near "
txt_header"
        (Missing operator before txt_header?)
Bare word found where operator expected at
/export/bors/bors-01/sws96srb/R-1.1.1/etc/Rdconvlib.pl line 1292, near "
txt_header"
        (Missing operator before txt_header?)
Bare word found where operator expected at
/export/bors/bors-01/sws96srb/R-1.1.1/etc/Rdconvlib.pl line 1335, near "
txt_header"
        (Missing operator before txt_header?)

In all sorts of places - wherever Rdconvlib.pl is used I guess. I have perl
5.002, 
gcc 2.95.2 Solaris 2.6, teTeX 0.4.

I've done a make html as well, to be on the safe side! Got the same dose of
warnings.
R istself starts up OK, but help.start() just gives me the information about
using 
existing browsers, but I never get any pages come up. I tried exiting netscape &

tried again, but no new browser was forthcoming. I've tried the FAQ and bug
reports, 
but maybe haven't asked the right question there!

I've probably missed something obvious, but just can't see it



==> 675.reply.1 <==
From pd@biostat.ku.dk  Mon Oct  2 14:51:26 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA17183;
	Mon, 2 Oct 2000 14:51:25 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id OAA12242;
	Mon, 2 Oct 2000 14:58:58 +0200
Sender: pd@blueberry.kubism.ku.dk
To: sws96srb@met.rdg.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] several documentation problems (PR#675)
References: <200010021224.OAA16613@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 02 Oct 2000 14:58:58 +0200
In-Reply-To: sws96srb@met.rdg.ac.uk's message of "Mon, 2 Oct 2000 14:24:39 +0200 (MET DST)"
Message-ID: <x2em1zo0vh.fsf@blueberry.kubism.ku.dk>
Lines: 37
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

sws96srb@met.rdg.ac.uk writes:

> In all sorts of places - wherever Rdconvlib.pl is used I guess. I have perl
> 5.002, 
> gcc 2.95.2 Solaris 2.6, teTeX 0.4.

Your perl version seems to be a bit old. Although we formally only
require Perl 5, 5.002 may have gone untested. The problems definitely
look Perl related.

There seems to be two types of problem:

The first one is

 780              print $htmlout
 781                  ("</TABLE>\n", "<P>\n", text2html($text, 1), "</P>\n");
  
and the rest are like

1234                  print $txtout mywrap($indent1, $indent2, $text), "\n";
  
I the 1st case, we have nearly the same construction without the line
break in line 784, and that seems to work. You might try joining up
the lines.

In the other case, perhaps add parentheses around  mywrap..."\n"

Otherwise we'll need to bring in the real Perl experts. 

[Even if it would be easier for you to upgrade Perl, I think it would
be nice to get to the root of this problem.]

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 675.followup.1 <==
From ripley@stats.ox.ac.uk  Mon Oct  2 15:04:38 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA17558;
	Mon, 2 Oct 2000 15:04:37 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id OAA01697;
	Mon, 2 Oct 2000 14:04:54 +0100 (BST)
Message-Id: <200010021304.OAA01697@toucan.stats.ox.ac.uk>
Date: Mon, 2 Oct 2000 14:04:54 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] several documentation problems (PR#675)
To: sws96srb@met.rdg.ac.uk, p.dalgaard@biostat.ku.dk
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: PncQF5s/E9BJCFOYVdgo6w==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 

> From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
> Date: 02 Oct 2000 14:58:58 +0200
> 
> sws96srb@met.rdg.ac.uk writes:
> 
> > In all sorts of places - wherever Rdconvlib.pl is used I guess. I have perl
> > 5.002, 
> > gcc 2.95.2 Solaris 2.6, teTeX 0.4.
> 
> Your perl version seems to be a bit old. Although we formally only
> require Perl 5, 5.002 may have gone untested. The problems definitely
> look Perl related.

As far as I recall 5.002 was buggy and we rapidly went to 5.004.
(Something similar happened in RedHat Linux 5.2's Perl.)   We would
recommend upgrading to Perl 5.6.0.

> There seems to be two types of problem:
> 
> The first one is
> 
>  780              print $htmlout
>  781                  ("</TABLE>\n", "<P>\n", text2html($text, 1), "</P>\n");
>   
> and the rest are like
> 
> 1234                  print $txtout mywrap($indent1, $indent2, $text), "\n";
>   
> I the 1st case, we have nearly the same construction without the line
> break in line 784, and that seems to work. You might try joining up
> the lines.
> 
> In the other case, perhaps add parentheses around  mywrap..."\n"

Another guess is that it might require &mywrap there.

> Otherwise we'll need to bring in the real Perl experts. 

I'm pretty sure that what we have is valid Perl, and that some versions
of Perl have choked on valid Perl.  Upgrading is the best answer.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


==> 675.followup.2 <==
From sws96srb@met.reading.ac.uk  Tue Oct  3 15:44:50 2000
Received: from mailhost.rdg.ac.uk (sumh2.rdg.ac.uk [134.225.16.24])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA00396;
	Tue, 3 Oct 2000 15:44:42 +0200 (MET DST)
Received: from maelstrom ([134.225.100.92])
	by mailhost.rdg.ac.uk with esmtp (University of Reading Email Service)
	id {13gSNQ-0001Sg-00} ; Tue, 03 Oct 2000 14:45:00 +0100
Received: from bors ([134.225.100.194] helo=met.rdg.ac.uk)
	by maelstrom with esmtp (Dept of Meteorology Email Service)
	id {13gSNJ-0001XL-00} ; Tue, 03 Oct 2000 14:44:53 +0100
Sender: sws96srb
Message-ID: <39D9E2D8.E1037103@met.rdg.ac.uk>
Date: Tue, 03 Oct 2000 14:44:56 +0100
From: "Sheila R. Bryant" <sws96srb@met.reading.ac.uk>
Organization: University of Reading, Department of Meteorology
X-Mailer: Mozilla 4.61 [en] (X11; I; SunOS 5.7 sun4u)
X-Accept-Language: en
MIME-Version: 1.0
To: Prof Brian Ripley <ripley@stats.ox.ac.uk>, p.dalgaard@biostat.ku.dk
CC: R-bugs@biostat.ku.dk
Subject: Re: [Rd] several documentation problems (PR#675)
References: <200010021304.OAA01697@toucan.stats.ox.ac.uk>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit



Prof Brian Ripley wrote:
> 
> > From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
> > Date: 02 Oct 2000 14:58:58 +0200
> >
> > sws96srb@met.rdg.ac.uk writes:
> >
> > > In all sorts of places - wherever Rdconvlib.pl is used I guess. I have perl
> > > 5.002,
> > > gcc 2.95.2 Solaris 2.6, teTeX 0.4.
> >
> > Your perl version seems to be a bit old. Although we formally only
> > require Perl 5, 5.002 may have gone untested. The problems definitely
> > look Perl related.
> 
> As far as I recall 5.002 was buggy and we rapidly went to 5.004.
> (Something similar happened in RedHat Linux 5.2's Perl.)   We would
> recommend upgrading to Perl 5.6.0.
> 

<snip>

Many thanks to everyone for the help. I've upgraded to Perl 5.6.0 and
all makes now flow through with no errors. 

-- 

Sheila


-----------------------------------------------------------------------------

Dr. Sheila Bryant                           Dept. of Meteorology,
Email: S.R.Bryant@reading.ac.uk             University of Reading,
Phone: 0118 931 6395                        Earley Gate, Whiteknights,
                                            PO Box 243
                                            Reading. RG6 6BB.   UK

-----------------------------------------------------------------------------
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 680 *
Subject: Returned mail: User unknown
Subject: Notification: incoming/678
Subject: typo in documentation for read.table
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
From: htang@hpl.hp.com
Date: Tue, 3 Oct 2000 08:34:25 +0200
Date: Tue, 3 Oct 2000 08:34:25 +0200
Date: Mon, 2 Oct 2000 19:58:55 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 680 <==
From MAILER-DAEMON  Tue Oct  3 08:26:46 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA22891
	for <r-bugs@mail.kubism.ku.dk>; Tue, 3 Oct 2000 08:26:45 +0200 (MET DST)
Received: from localhost (localhost)
	by biostat.ku.dk (8.9.3/8.9.3) with internal id IAA20546;
	Tue, 3 Oct 2000 08:34:25 +0200
Date: Tue, 3 Oct 2000 08:34:25 +0200
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
Message-Id: <200010030634.IAA20546@biostat.ku.dk>
To: <R-bugs@biostat.ku.dk>
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
	boundary="IAA20546.970554865/biostat.ku.dk"
Subject: Returned mail: User unknown
Auto-Submitted: auto-generated (failure)

This is a MIME-encapsulated message

--IAA20546.970554865/biostat.ku.dk

The original message was received at Tue, 3 Oct 2000 08:34:25 +0200
from blueberry.kubism.ku.dk [130.225.108.193]

   ----- The following addresses had permanent fatal errors -----
<Misunderstanding>
    (expanded from: <Misunderstanding>)
<by>
    (expanded from: <by>)
<user>
    (expanded from: <user>)

   ----- Transcript of session follows -----
... while talking to mail.kubism.ku.dk:
>>> RCPT To:<user@mail.kubism.ku.dk>
<<< 550 <user@mail.kubism.ku.dk>... User unknown
550 <user>... User unknown
>>> RCPT To:<by@mail.kubism.ku.dk>
<<< 550 <by@mail.kubism.ku.dk>... User unknown
550 <by>... User unknown
>>> RCPT To:<misunderstanding@mail.kubism.ku.dk>
<<< 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
550 <Misunderstanding>... User unknown

--IAA20546.970554865/biostat.ku.dk
Content-Type: message/delivery-status

Reporting-MTA: dns; biostat.ku.dk
Received-From-MTA: DNS; blueberry.kubism.ku.dk
Arrival-Date: Tue, 3 Oct 2000 08:34:25 +0200

Final-Recipient: RFC822; misunderstanding@biostat.ku.dk
X-Actual-Recipient: RFC822; misunderstanding@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Tue, 3 Oct 2000 08:34:25 +0200

Final-Recipient: RFC822; by@biostat.ku.dk
X-Actual-Recipient: RFC822; by@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <by@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Tue, 3 Oct 2000 08:34:25 +0200

Final-Recipient: RFC822; user@biostat.ku.dk
X-Actual-Recipient: RFC822; user@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <user@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Tue, 3 Oct 2000 08:34:25 +0200

--IAA20546.970554865/biostat.ku.dk
Content-Type: message/rfc822

Return-Path: <R-bugs@biostat.ku.dk>
Received: from localhost (blueberry.kubism.ku.dk [130.225.108.193])
	by biostat.ku.dk (8.9.3/8.9.3) with ESMTP id IAA20544;
	Tue, 3 Oct 2000 08:34:25 +0200
Date: Tue, 3 Oct 2000 08:34:25 +0200
Message-Id: <200010030634.IAA20544@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
To: Misunderstanding, by, user
Subject: Notification: incoming/678

R Bug Tracking System notification

hornik moved PR#678 from incoming to Documentation-fixed
Message summary for PR#678
	From: htang@hpl.hp.com
	Subject: typo in documentation for read.table
	Date: Mon, 2 Oct 2000 19:58:55  0200 (MET DST)
	0 replies 	0 followups
	Notes: Fixed.


====> ORIGINAL MESSAGE FOLLOWS <====

>From htang@hpl.hp.com  Mon Oct  2 19:58:55 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA20486
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 19:58:55 +0200 (MET DST)
Date: Mon, 2 Oct 2000 19:58:55 +0200 (MET DST)
From: htang@hpl.hp.com
Message-Id: <200010021758.TAA20486@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: typo in documentation for read.table

Full_Name: Hsiu-Khuern Tang
Version: 1.1.0
OS: Linux 2.2.14 i686
Submission from: (NULL) (15.255.176.47)



In the documentation for read.table, the description of the argument
`strip.white'
uses `skip.white' instead.

> ?read.table
...
Usage:

     read.table(file, header = FALSE, sep = "", quote = "\"'", dec = ".",
                row.names, col.names, as.is = FALSE, na.strings = "NA",
                skip = 0, check.names = TRUE, strip.white = FALSE)
                                              ^^^^^^^^^^^
...
skip.white: logical. Used only when `sep' has been specified, and
^^^^^^^^^^allows the stripping of leading and trailing white space from
          `character' fields (`numeric' fields are always stripped). 
          See `scan' for further details, remembering that the columns
          may include the row names.
...



--IAA20546.970554865/biostat.ku.dk--

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 679 *
Subject: Returned mail: User unknown
Subject: Notification: incoming/678
Subject: typo in documentation for read.table
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
From: htang@hpl.hp.com
Date: Tue, 3 Oct 2000 08:34:25 +0200
Date: Tue, 3 Oct 2000 08:34:24 +0200
Date: Mon, 2 Oct 2000 19:58:55 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 679 <==
From MAILER-DAEMON  Tue Oct  3 08:26:45 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id IAA22890
	for <r-bugs@mail.kubism.ku.dk>; Tue, 3 Oct 2000 08:26:45 +0200 (MET DST)
Received: from localhost (localhost)
	by biostat.ku.dk (8.9.3/8.9.3) with internal id IAA20542;
	Tue, 3 Oct 2000 08:34:25 +0200
Date: Tue, 3 Oct 2000 08:34:25 +0200
From: Mail Delivery Subsystem <MAILER-DAEMON@biostat.ku.dk>
Message-Id: <200010030634.IAA20542@biostat.ku.dk>
To: <R-bugs@biostat.ku.dk>
MIME-Version: 1.0
Content-Type: multipart/report; report-type=delivery-status;
	boundary="IAA20542.970554865/biostat.ku.dk"
Subject: Returned mail: User unknown
Auto-Submitted: auto-generated (failure)

This is a MIME-encapsulated message

--IAA20542.970554865/biostat.ku.dk

The original message was received at Tue, 3 Oct 2000 08:34:24 +0200
from blueberry.kubism.ku.dk [130.225.108.193]

   ----- The following addresses had permanent fatal errors -----
<Misunderstanding>
    (expanded from: <Misunderstanding>)
<by>
    (expanded from: <by>)
<user>
    (expanded from: <user>)

   ----- Transcript of session follows -----
... while talking to mail.kubism.ku.dk:
>>> RCPT To:<user@mail.kubism.ku.dk>
<<< 550 <user@mail.kubism.ku.dk>... User unknown
550 <user>... User unknown
>>> RCPT To:<by@mail.kubism.ku.dk>
<<< 550 <by@mail.kubism.ku.dk>... User unknown
550 <by>... User unknown
>>> RCPT To:<misunderstanding@mail.kubism.ku.dk>
<<< 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
550 <Misunderstanding>... User unknown

--IAA20542.970554865/biostat.ku.dk
Content-Type: message/delivery-status

Reporting-MTA: dns; biostat.ku.dk
Received-From-MTA: DNS; blueberry.kubism.ku.dk
Arrival-Date: Tue, 3 Oct 2000 08:34:24 +0200

Final-Recipient: RFC822; misunderstanding@biostat.ku.dk
X-Actual-Recipient: RFC822; misunderstanding@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <misunderstanding@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Tue, 3 Oct 2000 08:34:25 +0200

Final-Recipient: RFC822; by@biostat.ku.dk
X-Actual-Recipient: RFC822; by@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <by@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Tue, 3 Oct 2000 08:34:25 +0200

Final-Recipient: RFC822; user@biostat.ku.dk
X-Actual-Recipient: RFC822; user@mail.kubism.ku.dk
Action: failed
Status: 5.1.1
Remote-MTA: DNS; mail.kubism.ku.dk
Diagnostic-Code: SMTP; 550 <user@mail.kubism.ku.dk>... User unknown
Last-Attempt-Date: Tue, 3 Oct 2000 08:34:25 +0200

--IAA20542.970554865/biostat.ku.dk
Content-Type: message/rfc822

Return-Path: <R-bugs@biostat.ku.dk>
Received: from localhost (blueberry.kubism.ku.dk [130.225.108.193])
	by biostat.ku.dk (8.9.3/8.9.3) with ESMTP id IAA20540;
	Tue, 3 Oct 2000 08:34:24 +0200
Date: Tue, 3 Oct 2000 08:34:24 +0200
Message-Id: <200010030634.IAA20540@biostat.ku.dk>
From: R-bugs@biostat.ku.dk
To: Misunderstanding, by, user
Subject: Notification: incoming/678

R Bug Tracking System notification

hornik changed notes

Message summary for PR#678
	From: htang@hpl.hp.com
	Subject: typo in documentation for read.table
	Date: Mon, 2 Oct 2000 19:58:55  0200 (MET DST)
	0 replies 	0 followups
	Notes: Fixed.


====> ORIGINAL MESSAGE FOLLOWS <====

>From htang@hpl.hp.com  Mon Oct  2 19:58:55 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA20486
	for <R-bugs@biostat.ku.dk>; Mon, 2 Oct 2000 19:58:55 +0200 (MET DST)
Date: Mon, 2 Oct 2000 19:58:55 +0200 (MET DST)
From: htang@hpl.hp.com
Message-Id: <200010021758.TAA20486@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: typo in documentation for read.table

Full_Name: Hsiu-Khuern Tang
Version: 1.1.0
OS: Linux 2.2.14 i686
Submission from: (NULL) (15.255.176.47)



In the documentation for read.table, the description of the argument
`strip.white'
uses `skip.white' instead.

> ?read.table
...
Usage:

     read.table(file, header = FALSE, sep = "", quote = "\"'", dec = ".",
                row.names, col.names, as.is = FALSE, na.strings = "NA",
                skip = 0, check.names = TRUE, strip.white = FALSE)
                                              ^^^^^^^^^^^
...
skip.white: logical. Used only when `sep' has been specified, and
^^^^^^^^^^allows the stripping of leading and trailing white space from
          `character' fields (`numeric' fields are always stripped). 
          See `scan' for further details, remembering that the columns
          may include the row names.
...



--IAA20542.970554865/biostat.ku.dk--

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 682 *
Subject: This mail was found after problem with mailserver Oct 3rd - postmaster@hh.umu.se
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 03 Oct 2000 11:57:32 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 682 <==
From Bols@hakan.hh.umu.se  Tue Oct  3 19:09:57 2000
Received: from goesta.hh.umu.se (Goesta.hh.umu.se [130.239.26.143])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA02510
	for <R-bugs@biostat.ku.dk>; Tue, 3 Oct 2000 19:09:57 +0200 (MET DST)
Received: from SMTP (navieg.hh.umu.se [130.239.39.10]) by goesta.hh.umu.se
          (Netscape Messaging Server 3.6)  with SMTP id 379
          for <R-bugs@biostat.ku.dk>; Tue, 3 Oct 2000 18:31:24 +0200
Received: from Goesta.hh.umu.se ([130.239.26.143]) by 130.239.39.10
  (Norton AntiVirus for Internet Email Gateways 1.0) ;
  Tue, 03 Oct 2000 16:30:31 0000 (GMT)
Received: from Hakan.hh.umu.se (unverified [130.239.26.158]) by mail.hh.umu.se
 (EMWAC SMTPRS 0.83) with SMTP id <B0000252896@mail.hh.umu.se>;
 Tue, 03 Oct 2000 18:07:42 +0200
X-FROM: <owner-r-devel@stat.math.ethz.ch>
X-RECV: <gb@stat.umu.se>
X-RECV: X-DATA:
Received: from Goesta.hh.umu.se ([130.239.26.143]) by 130.239.39.10
  (Norton AntiVirus for Internet Email Gateways 1.0) ;
  Tue, 03 Oct 2000 09:53:42 0000 (GMT)
Received: from stat.math.ethz.ch (unverified [129.132.58.23]) by mail.hh.umu.se
 (EMWAC SMTPRS 0.83) with SMTP id <B0000251921@mail.hh.umu.se>;
 Tue, 03 Oct 2000 11:53:12 +0200
Received: by stat.math.ethz.ch (8.9.1/8.9.1) id LAA12968
	for r-devel-gang-use; Tue, 3 Oct 2000 11:50:26 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA12961;
	Tue, 3 Oct 2000 11:50:23 +0200 (MET DST)
Received: from kubism.kubism.ku.dk(130.225.108.10), claiming to be "pubhealth.ku.dk"
 via SMTP by hypatia, id smtpdAAAa003AV; Tue Oct  3 11:50:12 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA25674;
	Tue, 3 Oct 2000 11:49:52 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id LAA20863;
	Tue, 3 Oct 2000 11:57:33 +0200
To: maechler@stat.math.ethz.ch
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: This mail was found after problem with mailserver Oct 3rd - postmaster@hh.umu.se
References: <200010030916.LAA25138@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 03 Oct 2000 11:57:32 +0200
In-Reply-To: maechler@stat.math.ethz.ch's message of "Tue, 3 Oct 2000 11:16:59 +0200 (MET DST)"
Message-ID: <x21yxyw8kz.fsf@blueberry.kubism.ku.dk>
Lines: 22
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Sender: <Bols@hakan.hh.umu.se>
Precedence: bulk

maechler@stat.math.ethz.ch writes:

> Ok, I've fixed pretty() for the development version
> such that
>      p <- pretty(x)
>      all(p[1] <= x & x <= p[2])
> 
> should be guaranteed (again).

Gulp. I'm pretty(!) sure there was a reason for changing it in the
other direction... [I have a vague recollection of pretty(pretty(x))
!= pretty(x) or something like that] Are we quite sure that it is not
the caller that needs to be a little more lenient in the bounds
checking?

OTOH, it's in code you wrote yourself...

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 681 *
Subject: This mail was found after problem with mailserver Oct 3rd - postmaster@hh.umu.se
From: maechler@stat.math.ethz.ch
Date: Tue, 3 Oct 2000 11:16:59 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 681 <==
From Bols@hakan.hh.umu.se  Tue Oct  3 19:09:32 2000
Received: from goesta.hh.umu.se (Goesta.hh.umu.se [130.239.26.143])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA02494
	for <R-bugs@biostat.ku.dk>; Tue, 3 Oct 2000 19:09:32 +0200 (MET DST)
Received: from SMTP (navieg.hh.umu.se [130.239.39.10]) by goesta.hh.umu.se
          (Netscape Messaging Server 3.6)  with SMTP id 357
          for <R-bugs@biostat.ku.dk>; Tue, 3 Oct 2000 18:27:59 +0200
Received: from Goesta.hh.umu.se ([130.239.26.143]) by 130.239.39.10
  (Norton AntiVirus for Internet Email Gateways 1.0) ;
  Tue, 03 Oct 2000 16:27:41 0000 (GMT)
Received: from Hakan.hh.umu.se (unverified [130.239.26.158]) by mail.hh.umu.se
 (EMWAC SMTPRS 0.83) with SMTP id <B0000252852@mail.hh.umu.se>;
 Tue, 03 Oct 2000 18:06:02 +0200
X-FROM: <owner-r-devel@stat.math.ethz.ch>
X-RECV: <gb@stat.umu.se>
X-RECV: X-DATA:
Received: from Goesta.hh.umu.se ([130.239.26.143]) by 130.239.39.10
  (Norton AntiVirus for Internet Email Gateways 1.0) ;
  Tue, 03 Oct 2000 09:21:07 0000 (GMT)
Received: from stat.math.ethz.ch (unverified [129.132.58.23]) by mail.hh.umu.se
 (EMWAC SMTPRS 0.83) with SMTP id <B0000251881@mail.hh.umu.se>;
 Tue, 03 Oct 2000 11:20:29 +0200
Received: by stat.math.ethz.ch (8.9.1/8.9.1) id LAA11164
	for r-devel-gang-use; Tue, 3 Oct 2000 11:17:26 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id LAA11158
	for <r-devel@stat.math.ethz.ch>; Tue, 3 Oct 2000 11:17:22 +0200 (MET DST)
Received: from kubism.kubism.ku.dk(130.225.108.10), claiming to be "pubhealth.ku.dk"
 via SMTP by hypatia, id smtpdAAAa002iK; Tue Oct  3 11:17:19 2000
Received: from localhost (kubism [130.225.108.10])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA25138
	for <r-devel@stat.math.ethz.ch>; Tue, 3 Oct 2000 11:16:59 +0200 (MET DST)
Date: Tue, 3 Oct 2000 11:16:59 +0200 (MET DST)
From: maechler@stat.math.ethz.ch
Message-Id: <200010030916.LAA25138@pubhealth.ku.dk>
To: r-devel@stat.math.ethz.ch
Subject: This mail was found after problem with mailserver Oct 3rd - postmaster@hh.umu.se
CC: R-bugs@biostat.ku.dk
X-Loop: R-bugs@biostat.ku.dk
Sender: <Bols@hakan.hh.umu.se>
Precedence: bulk

>>>>> "MM" == Martin Maechler <maechler@stat.math.ethz.ch> writes:

>>>>> "david" == david  <david@orion-10.cs.byu.edu> writes:
    david> When I issue the command: if ( c(2.8,3)[1] < pretty
    david> (c(2.8,3))[1]) print ("problem")

    david> the result is "problem" prints.  I have traced it to bits and
    david> the 2.8 of the returned vector from pretty is slightly larger.
    david> This seems to be due to the conversion to base 10 with the ns
    david> and unit variables in src/appl/pretty.c.

    david> Anyway if I do something like: hist(c(2.8,3)) it fails as well
    david> because it uses pretty.

    david> Thanks for you attention, DavidMcLaughlin@byu.edu

    MM> Thank you for the bug report.  This bug is ``new'' (a bit more than
    MM> a year!) and was introduced when someone fixed another problem in
    MM> pretty.c by adding "1e-5" fuzz a bit too generously hmm,.......
    MM> I'll have a look.

    david> Version: .... R 1.1.1 ...

Ok, I've fixed pretty() for the development version
such that
     p <- pretty(x)
     all(p[1] <= x & x <= p[2])

should be guaranteed (again).

Note however, that this really also changes some "results",
that may be unexpected,
e.g.

    R 1.1.1 :
    ---------

    > data(women); (hT <- hist(women$weight, nc= 7, plot = FALSE))[2]

    $counts
     [1] 3 1 2 2 1 1 2 1 1 1

    --------------

    R-devel [to be 1.2.0]:
    ---------------------

    > data(women); (hT <- hist(women$weight, nc= 7, plot = FALSE))[2]

    $counts
     [1] 2 2 2 1 2 1 2 1 1 1

    > 

------

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO D10	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
r-devel mailing list -- Read http://www.ci.tuwien.ac.at/~hornik/R/R-FAQ.html
Send "info", "help", or "[un]subscribe"
(in the "body", not the subject !)  To: r-devel-request@stat.math.ethz.ch
_._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._._

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 685 *
Subject: documentation bug in readline()
From: Peter Perkins <pperkins@ucsd.edu>
Date: Fri, 06 Oct 2000 19:09:31 -0700
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 685 <==
From postmaster@franz.stat.wisc.edu  Sat Oct  7 04:08:59 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id EAA12969
	for <r-bugs@biostat.ku.dk>; Sat, 7 Oct 2000 04:08:59 +0200 (MET DST)
Received: from femail1.sdc1.sfba.home.com (really [24.0.95.81]) by franz.stat.wisc.edu
	via in.smtpd with esmtp
	id <m13hjSr-000IZdC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Fri, 6 Oct 2000 21:11:53 -0500 (CDT) 
Received: from ucsd.edu ([24.4.89.36]) by femail1.sdc1.sfba.home.com
          (InterMail vM.4.01.03.00 201-229-121) with ESMTP
          id <20001007020857.MJST6495.femail1.sdc1.sfba.home.com@ucsd.edu>
          for <r-bugs@r-project.org>; Fri, 6 Oct 2000 19:08:57 -0700
Sender: peter
Message-ID: <39DE85D9.A529AB23@ucsd.edu>
Date: Fri, 06 Oct 2000 19:09:31 -0700
From: Peter Perkins <pperkins@ucsd.edu>
X-Mailer: Mozilla 4.7 [en] (X11; I; Linux 2.2.15pre3 ppc)
X-Accept-Language: en
MIME-Version: 1.0
To: r-bugs@r-project.org
Subject: documentation bug in readline()
Content-Type: multipart/mixed;
 boundary="------------FBFC021C053198B1E0FE0848"

This is a multi-part message in MIME format.
--------------FBFC021C053198B1E0FE0848
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

hi -

the documentation for readline() should reflect the fact that the
prompt= arg is truncated to CONSOLE_PROMPT_SIZE chars, currently defined 
as 32 in src/main/scan.c.  assuming this is the correct behavior, an
updated copy of readline.Rd is attached.

--please do not edit the information below--

Version:
 platform = powerpc-unknown-linux-gnu
 arch = powerpc
 os = linux-gnu
 system = powerpc, linux-gnu
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, file:/home/peter/R/Home.RData, package:local,
package:distns, Autoloads, package:base
--------------FBFC021C053198B1E0FE0848
Content-Type: text/plain; charset=us-ascii;
 name="readline.Rd"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="readline.Rd"

\name{readline}
\title{Read a Line from the Terminal}
\usage{
readline(prompt="")
}
\alias{readline}
\arguments{
  \item{prompt}{the string printed when prompting the user for input.
  This will be truncated to a maximum allowed length, currently 32 chars.
  Should usually end with a space \code{" "}.}
}
\description{
  \code{readline} reads a line from the terminal, returning it as a
  character string.
}
\examples{
fun <- function() {
  ANSWER <- readline("Are you a satisfied R user? ")
  if (substr(ANSWER, 1, 1) == "n")
    cat("This is impossible.  YOU LIED!\n")
  else
    cat("I knew it.\n")
}
fun()
}
\keyword{utilities}

--------------FBFC021C053198B1E0FE0848--

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 684 *
Subject: gamma and lgamma functions
From: Jim Lindsey <james.lindsey@luc.ac.be>
Date: Wed, 4 Oct 2000 13:59:21 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 684 <==
From james.lindsey@luc.ac.be  Wed Oct  4 13:59:11 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA13202
	for <R-bugs@biostat.ku.dk>; Wed, 4 Oct 2000 13:59:10 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id NAA14396
	for <r-bugs@stat.math.ethz.ch>; Wed, 4 Oct 2000 13:59:27 +0200 (MET DST)
Received: from alpha.luc.ac.be(193.190.2.30)
 via SMTP by hypatia, id smtpdAAAa003Wu; Wed Oct  4 13:59:23 2000
Received: (from jlindsey@localhost)
	by alpha.luc.ac.be (8.9.3/8.9.3) id NAA23776
	for r-bugs@stat.math.ethz.ch; Wed, 4 Oct 2000 13:59:22 +0200 (MET DST)
From: Jim Lindsey <james.lindsey@luc.ac.be>
Message-Id: <200010041159.NAA23776@alpha.luc.ac.be>
Subject: gamma and lgamma functions
To: r-bugs@stat.math.ethz.ch (rbugs)
Date: Wed, 4 Oct 2000 13:59:21 +0200 (MET DST)
X-Mailer: ELM [version 2.5 PL1]
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit

The following seems very strange:
> lgamma(-0.04)
[1] 3.243307
> gamma(-0.04)
[1] -25.61830
  Jim

==> 684.followup.1 <==
From ripley@stats.ox.ac.uk  Wed Oct  4 14:12:08 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA14231
	for <R-bugs@biostat.ku.dk>; Wed, 4 Oct 2000 14:12:07 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id NAA01732;
	Wed, 4 Oct 2000 13:12:25 +0100 (BST)
Message-Id: <200010041212.NAA01732@toucan.stats.ox.ac.uk>
Date: Wed, 4 Oct 2000 13:12:25 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] gamma and lgamma functions (PR#684)
To: james.lindsey@luc.ac.be
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: 5Jnwtmmk/N26aWuwlBFpNQ==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 

> From: james.lindsey@luc.ac.be
> Date: Wed, 4 Oct 2000 13:59:14 +0200 (MET DST)
> 
> The following seems very strange:
> > lgamma(-0.04)
> [1] 3.243307
> > gamma(-0.04)
> [1] -25.61830
>   Jim

It is as documented, though: ?lgamma gives

     The functions `gamma' and `lgamma' return the gamma function
     Gamma(x) and the natural logarithm of the absolute value of the
                                               ^^^^^^^^^^^^^^^^^
     gamma function.

and log(25.61830) = 3.243307.

It's not S-compatible, I grant.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 688 *
Subject:  Unreliable example in ?layout 
From: J.C.Rougier@durham.ac.uk
Date: Tue, 10 Oct 2000 08:48:10 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 688 <==
From J.C.Rougier@durham.ac.uk  Tue Oct 10 09:47:54 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA03954
	for <r-bugs@biostat.ku.dk>; Tue, 10 Oct 2000 09:47:53 +0200 (MET DST)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e9A7mAd00636
	for <r-bugs@biostat.ku.dk>; Tue, 10 Oct 2000 08:48:10 +0100 (BST)
Received: from laplace by euclid id <IAA09324@euclid>; Tue, 10 Oct 2000 08:48:03 +0100 (BST)
Date: Tue, 10 Oct 2000 08:48:10 +0100 (BST)
Message-Id: <29855.200010100748@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  Unreliable example in ?layout 

In ?layout values of x and y from the standard gaussian that lie
outside (-3, 3) will occasionally cause an error in hist with
breaks=seq(-3, 3, 0.5).  One reliable solution (not quite as
pretty) would be to use runif instead of rnorm, ie

      x <- runif(50, -1, 1)
      y <- runif(50, -1, 1)
      xhist <- hist(x, breaks=seq(-1,1,0.25), plot=FALSE)
      yhist <- hist(y, breaks=seq(-1,1,0.25), plot=FALSE)
      top <- max(c(xhist$counts, yhist$counts))
      xrange <- c(-1,1)
      yrange <- c(-1,1)

      # and then as before.

Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 687 *
Subject:  cmdscale documentation 
From: J.C.Rougier@durham.ac.uk
Date: Mon, 9 Oct 2000 10:23:20 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 687 <==
From J.C.Rougier@durham.ac.uk  Mon Oct  9 11:23:32 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA22341
	for <r-bugs@biostat.ku.dk>; Mon, 9 Oct 2000 11:23:31 +0200 (MET DST)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e999NLd17884
	for <r-bugs@biostat.ku.dk>; Mon, 9 Oct 2000 10:23:21 +0100 (BST)
Received: from laplace by euclid id <KAA29085@euclid>; Mon, 9 Oct 2000 10:23:15 +0100 (BST)
Date: Mon, 9 Oct 2000 10:23:20 +0100 (BST)
Message-Id: <28380.200010090923@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  cmdscale documentation 

In the value section of "?cmdscale" in the mva library the
returned object is a *matrix* if eig=FALSE, and a list with
components "points" and "eig" if eig=TRUE, rather than always a
list as described.

Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, package:mva, Autoloads, package:base
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 686 *
Subject: inquiry
From: <bench1@onenetnow.com>
Date: Mon, 9 Oct 2000 00:23:53
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 686 <==
From postmaster@franz.stat.wisc.edu  Mon Oct  9 09:58:03 2000
Received: from franz.stat.wisc.edu (franz.stat.wisc.edu [128.105.174.95])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id JAA20398
	for <r-bugs@biostat.ku.dk>; Mon, 9 Oct 2000 09:58:03 +0200 (MET DST)
Received: from unknown (really [209.44.114.215]) by franz.stat.wisc.edu
	via in.smtpd with smtp
	id <m13iXro-000IZdC@franz.stat.wisc.edu> (Debian Smail3.2.0.102)
	for <r-bugs@r-project.org>; Mon, 9 Oct 2000 03:01:00 -0500 (CDT) 
Apparently-To: <brian.ripley@r-project.org>, <guido.masarotto@r-project.org>,
        <kurt.hornik@r-project.org>, <martin.maechler@r-project.org>,
        <r-bugs@r-project.org>, <robert.gentleman@r-project.org>,
        <ross.ihaka@r-project.org>
From: <bench1@onenetnow.com>
Subject: inquiry
Date: Mon, 9 Oct 2000 00:23:53
Message-Id: <477.436180.272457@>



The following link will take you to a web site that contains 
commercial and/or  promotional
information related to laser printer toner cartridges. 

By clicking on the link and going to the corresponding web site 
you agree that::

1) you are interested in learning more about 
    discounted prices on laser printer cartridges

2) you allow express permission to introduce you to our site,  
our
     laser printer products, discounts and specials.

Following is the link:

            https://www.eproducts.com/staticsystems/index.html

If you opt  to continue receiving e-mail updates on our products 
in the future please confirm by replying
to mailto:bench1@onenetnow.com or calling us at 770-399-0953.

Thank you





 
 
 
 
 
 
 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 690 *
Subject: Bug?
From: "Armando Mateus Ferreira" <td2mafea@uco.es>
Date: Wed, 11 Oct 2000 11:21:19 +0200
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 690 <==
From td2mafea@uco.es  Wed Oct 11 11:27:58 2000
Received: from lucano.uco.es (postfix@lucano.uco.es [150.214.110.200] (may be forged))
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA18559
	for <r-bugs@biostat.ku.dk>; Wed, 11 Oct 2000 11:27:57 +0200 (MET DST)
Received: from AgrestXX (agrest02 [150.214.115.191])
	by lucano.uco.es (Postfix) with SMTP id 6EF4B6588A
	for <r-bugs@biostat.ku.dk>; Wed, 11 Oct 2000 11:28:13 +0200 (MET DST)
Message-ID: <000d01c03364$9d427ba0$bf73d696@uco.es>
From: "Armando Mateus Ferreira" <td2mafea@uco.es>
To: <r-bugs@biostat.ku.dk>
Subject: Bug?
Date: Wed, 11 Oct 2000 11:21:19 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.00.2314.1300
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2314.1300

I don´t know if it is a bug, but what's wrong in the folloing (R version
1.1.1, August 15, 2000, under windows 98):
> x<-matrix(nrow=10, ncol=2)
> for (i in 1:10)
+ {
+ x[i][1]<-i
+ x[i][2]<-i^2
+ }
Warning messages:
1: number of items to replace is not a multiple of replacement length
2: number of items to replace is not a multiple of replacement length
3: number of items to replace is not a multiple of replacement length
4: number of items to replace is not a multiple of replacement length
5: number of items to replace is not a multiple of replacement length
6: number of items to replace is not a multiple of replacement length
7: number of items to replace is not a multiple of replacement length
8: number of items to replace is not a multiple of replacement length
9: number of items to replace is not a multiple of replacement length
10: number of items to replace is not a multiple of replacement length

Thanks

Armando Ferreira


----------------------------------------------------------------------------
-------------
Armando Mateus Ferreira
Escuela Técnica Superior de Inginieros Agrónomos y Montes
Universidad de Córdoba-España
Avda. Menendez Pidal, 14080 Córdoba
td2mafea@uco.es

Escola Superior Agrária
6000 Castelo Branco-Portugal
armando@esa.ipcb.pt


==> 690.reply.1 <==
From pd@biostat.ku.dk  Wed Oct 11 11:36:23 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id LAA18692;
	Wed, 11 Oct 2000 11:36:22 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id LAA24013;
	Wed, 11 Oct 2000 11:45:13 +0200
Sender: pd@blueberry.kubism.ku.dk
To: td2mafea@uco.es
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] Bug? (PR#690)
References: <200010110927.LAA18569@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 11 Oct 2000 11:45:12 +0200
In-Reply-To: td2mafea@uco.es's message of "Wed, 11 Oct 2000 11:27:59 +0200 (MET DST)"
Message-ID: <x2pul790ev.fsf@blueberry.kubism.ku.dk>
Lines: 29
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit

td2mafea@uco.es writes:

> I don´t know if it is a bug, but what's wrong in the folloing (R version
> 1.1.1, August 15, 2000, under windows 98):
> > x<-matrix(nrow=10, ncol=2)
> > for (i in 1:10)
> + {
> + x[i][1]<-i
> + x[i][2]<-i^2
> + }
> Warning messages:
> 1: number of items to replace is not a multiple of replacement length
> 2: number of items to replace is not a multiple of replacement length

Not a bug. You mean x[i,1] etc. Notice that single-indexing a matrix
ignores dimensions:

> x<-matrix(1:20,nrow=10, ncol=2)
> x[1]
[1] 1
> x[12]
[1] 12


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 690.followup.1 <==
From td2mafea@uco.es  Wed Oct 11 12:47:18 2000
Received: from lucano.uco.es (postfix@lucano.uco.es [150.214.110.200] (may be forged))
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id MAA20116;
	Wed, 11 Oct 2000 12:47:17 +0200 (MET DST)
Received: from AgrestXX (agrest02 [150.214.115.191])
	by lucano.uco.es (Postfix) with SMTP
	id 13145658B3; Wed, 11 Oct 2000 12:47:35 +0200 (MET DST)
Message-ID: <002501c0336f$b3a81f20$bf73d696@uco.es>
From: "Armando Mateus Ferreira" <td2mafea@uco.es>
To: "Peter Dalgaard BSA" <p.dalgaard@biostat.ku.dk>
Cc: <r-devel@stat.math.ethz.ch>, <R-bugs@biostat.ku.dk>
References: <200010110927.LAA18569@pubhealth.ku.dk> <x2pul790ev.fsf@blueberry.kubism.ku.dk>
Subject: RE: [Rd] Bug? (PR#690)
Date: Wed, 11 Oct 2000 12:40:41 +0200
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 5.00.2314.1300
X-MimeOLE: Produced By Microsoft MimeOLE V5.00.2314.1300

It's exactly what i want. Thanks.
Armando Ferreira


----- Original Message -----
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
To: <td2mafea@uco.es>
Cc: <r-devel@stat.math.ethz.ch>; <R-bugs@biostat.ku.dk>
Sent: Wednesday, October 11, 2000 11:45 AM
Subject: Re: [Rd] Bug? (PR#690)


> td2mafea@uco.es writes:
>
> > I don´t know if it is a bug, but what's wrong in the folloing (R version
> > 1.1.1, August 15, 2000, under windows 98):
> > > x<-matrix(nrow=10, ncol=2)
> > > for (i in 1:10)
> > + {
> > + x[i][1]<-i
> > + x[i][2]<-i^2
> > + }
> > Warning messages:
> > 1: number of items to replace is not a multiple of replacement length
> > 2: number of items to replace is not a multiple of replacement length
>
> Not a bug. You mean x[i,1] etc. Notice that single-indexing a matrix
> ignores dimensions:
>
> > x<-matrix(1:20,nrow=10, ncol=2)
> > x[1]
> [1] 1
> > x[12]
> [1] 12
>
>
> --
>    O__  ---- Peter Dalgaard             Blegdamsvej 3
>   c/ /'_ --- Dept. of Biostatistics     2200 Cph. N
>  (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 689 *
Subject: Documentation problem for ecdf
From: Kurt.Hornik@ci.tuwien.ac.at
Date: Tue, 10 Oct 2000 18:32:46 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 689 <==
From Kurt.Hornik@ci.tuwien.ac.at  Tue Oct 10 18:32:47 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id SAA12510
	for <R-bugs@biostat.ku.dk>; Tue, 10 Oct 2000 18:32:46 +0200 (MET DST)
Date: Tue, 10 Oct 2000 18:32:46 +0200 (MET DST)
From: Kurt.Hornik@ci.tuwien.ac.at
Message-Id: <200010101632.SAA12510@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: Documentation problem for ecdf

Full_Name: Kurt Hornik
Version: 1.2.0
OS: Linux
Submission from: (NULL) (137.208.57.56)


File `ecdf.Rd' contains

\usage{
ecdf(x)
plot(x, verticals = FALSE, col.01line = "gray70", \dots)
}
\arguments{
  \item{x}{numeric vector with the ``observations''.}

This is wrong, because in the plot usage `x' should be an object of class
"stepfun", and in fact the code says

  plot.ecdf <- function(..., verticals = FALSE, col.01line = "gray70") { ... }


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 692 *
Subject: documentation bug in grep
From: pperkins@ucsd.edu
Date: Wed, 11 Oct 2000 19:25:03 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 692 <==
From pperkins@ucsd.edu  Wed Oct 11 19:25:03 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id TAA24646
	for <R-bugs@biostat.ku.dk>; Wed, 11 Oct 2000 19:25:03 +0200 (MET DST)
Date: Wed, 11 Oct 2000 19:25:03 +0200 (MET DST)
From: pperkins@ucsd.edu
Message-Id: <200010111725.TAA24646@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: documentation bug in grep

Full_Name: Peter Perkins
Version: 1.1.1
OS: LinuxPPC
Submission from: (NULL) (24.4.89.36)


the man page for grep mistakenly says "gsub" whn it should say "grep"
in the Details section of grep.Rd.  a diff -u with a corrected version
follows:

diff -u R-1.1.1/src/library/base/man/grep.Rd grep.Rd-new
--- R-1.1.1/src/library/base/man/grep.Rd	Wed Apr 19 08:51:19 2000
+++ grep.Rd-new	Wed Oct 11 10:16:43 2000
@@ -46,7 +46,7 @@
   \code{extended} argument.
 }
 \value{
-    For \code{gsub} a vector giving either the indices of the elements
+    For \code{grep} a vector giving either the indices of the elements
     of \code{x} that yielded a match or, if \code{value} is \code{TRUE},
     the matched elements.
 


==> 692.followup.1 <==
From ripley@stats.ox.ac.uk  Wed Oct 11 22:16:39 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id WAA25363
	for <R-bugs@biostat.ku.dk>; Wed, 11 Oct 2000 22:16:38 +0200 (MET DST)
Received: from max151.public.ox.ac.uk (max151.public.ox.ac.uk [192.76.27.151])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with ESMTP id VAA15546;
	Wed, 11 Oct 2000 21:16:35 +0100 (BST)
Date: Wed, 11 Oct 2000 21:14:39 +0100 (BST)
From: Prof Brian D Ripley <ripley@stats.ox.ac.uk>
Sender: ripley@auk.stats
To: pperkins@ucsd.edu
cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] documentation bug in grep (PR#692)
In-Reply-To: <200010111725.TAA24663@pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.05.10010112112450.18380-100000@auk.stats>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 11 Oct 2000 pperkins@ucsd.edu wrote:

> Full_Name: Peter Perkins
> Version: 1.1.1
> OS: LinuxPPC
> Submission from: (NULL) (24.4.89.36)
> 
> 
> the man page for grep mistakenly says "gsub" whn it should say "grep"
> in the Details section of grep.Rd.  a diff -u with a corrected version

It's in the Value section!  Thank you, fixed now.

> follows:
> 
> diff -u R-1.1.1/src/library/base/man/grep.Rd grep.Rd-new
> --- R-1.1.1/src/library/base/man/grep.Rd	Wed Apr 19 08:51:19 2000
> +++ grep.Rd-new	Wed Oct 11 10:16:43 2000
> @@ -46,7 +46,7 @@
>    \code{extended} argument.
>  }
>  \value{
> -    For \code{gsub} a vector giving either the indices of the elements
> +    For \code{grep} a vector giving either the indices of the elements
>      of \code{x} that yielded a match or, if \code{value} is \code{TRUE},
>      the matched elements.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 691 *
Subject: invalid regular expression after many grep's
From: jutans@utans.u-net.com
Date: Wed, 11 Oct 2000 17:10:29 +0200 (MET DST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 691 <==
From jutans@utans.u-net.com  Wed Oct 11 17:10:30 2000
Received: from localhost (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA23957
	for <R-bugs@biostat.ku.dk>; Wed, 11 Oct 2000 17:10:29 +0200 (MET DST)
Date: Wed, 11 Oct 2000 17:10:29 +0200 (MET DST)
From: jutans@utans.u-net.com
Message-Id: <200010111510.RAA23957@pubhealth.ku.dk>
To: R-bugs@biostat.ku.dk
Subject: invalid regular expression after many grep's

Full_Name: J Utans
Version: 1.1.1
OS: NT4 (SP6)
Submission from: (NULL) (155.140.123.250)


After grep is called many times (> 250k), with constant strings as patterns,
it complains with "invalid regular expression" on calls that worked before
(with same pattern and x). At the same time copying to the clipboard
does no longer work with "out of memory" error (i.e. when trying to
copy the error message from grep to this msg.)
Also breaks other functions (regexpr, strsplit) that seems to use
the regex functions internally. Things work again after restarting R.




==> 691.followup.1 <==
From ripley@stats.ox.ac.uk  Wed Oct 11 17:32:11 2000
Received: from toucan.stats.ox.ac.uk (toucan.stats.ox.ac.uk [163.1.20.20])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id RAA24070
	for <R-bugs@biostat.ku.dk>; Wed, 11 Oct 2000 17:32:11 +0200 (MET DST)
Received: from toucan.stats (toucan.stats [163.1.20.20])
	by toucan.stats.ox.ac.uk (8.9.0/8.9.0) with SMTP id QAA15175;
	Wed, 11 Oct 2000 16:32:27 +0100 (BST)
Message-Id: <200010111532.QAA15175@toucan.stats.ox.ac.uk>
Date: Wed, 11 Oct 2000 16:32:27 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Reply-To: Prof Brian Ripley <ripley@stats.ox.ac.uk>
Subject: Re: [Rd] invalid regular expression after many grep's (PR#691)
To: jutans@utans.u-net.com
Cc: R-bugs@biostat.ku.dk
MIME-Version: 1.0
Content-Type: TEXT/plain; charset=us-ascii
Content-MD5: 2R9gs+dDnU+u06rZ89hvzQ==
X-Mailer: dtmail 1.3.0 @(#)CDE Version 1.3.5 SunOS 5.7 sun4m sparc 


> From: jutans@utans.u-net.com
> Date: Wed, 11 Oct 2000 17:10:31 +0200 (MET DST)
> To: r-devel@stat.math.ethz.ch
> Subject: [Rd] invalid regular expression after many grep's (PR#691)
> CC: R-bugs@biostat.ku.dk
> X-Loop: R-bugs@biostat.ku.dk
> 
> Full_Name: J Utans
> Version: 1.1.1
> OS: NT4 (SP6)
> Submission from: (NULL) (155.140.123.250)
> 
> 
> After grep is called many times (> 250k), with constant strings as patterns,
> it complains with "invalid regular expression" on calls that worked before
> (with same pattern and x). At the same time copying to the clipboard
> does no longer work with "out of memory" error (i.e. when trying to
> copy the error message from grep to this msg.)
> Also breaks other functions (regexpr, strsplit) that seems to use
> the regex functions internally. Things work again after restarting R.

Looks like a memory/resource leak.  Can you send us an actual
failing example on your machine, starting from a clean session,
together with details of the machine (amount of RAM etc)?  That will
help us greatly to reproduce this.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 694 *
Subject:  syntax confusion with function/non-function objects 
From: J.C.Rougier@durham.ac.uk
Date: Fri, 13 Oct 2000 12:07:41 +0100 (BST)
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 694 <==
From J.C.Rougier@durham.ac.uk  Fri Oct 13 13:07:25 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id NAA15315
	for <r-bugs@biostat.ku.dk>; Fri, 13 Oct 2000 13:07:23 +0200 (MET DST)
From: J.C.Rougier@durham.ac.uk
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e9DB7fd26702
	for <r-bugs@biostat.ku.dk>; Fri, 13 Oct 2000 12:07:41 +0100 (BST)
Received: from laplace by euclid id <MAA02824@euclid>; Fri, 13 Oct 2000 12:07:40 +0100 (BST)
Date: Fri, 13 Oct 2000 12:07:41 +0100 (BST)
Message-Id: <2406.200010131107@laplace>
To: r-bugs@biostat.ku.dk
Cc: dma0jcr@laplace.dur.ac.uk
Subject:  syntax confusion with function/non-function objects 

I'm just back from a computer practical where we ran into

> "f" <- function(x) 2(x^2) # for 2 * x^2

This definition was taken as legitimate, although using the
function generated the error message

> f(3)
Error in f(3) : attempt to apply non-function

Am I right in thinking that in prevous versions of R this
definition would have been declared as a syntax error?  Surely a
number before an opening parenthesis is always a syntax error?
The other mistake does this:

> "f" <- function(x) 2x^2 # another attempt at 2 * x^2
Error: syntax error

Cheers, Jonathan.

--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.7
 arch = sparc
 os = solaris2.7
 system = sparc, solaris2.7
 status = 
 major = 1
 minor = 1.1
 year = 2000
 month = August
 day = 15
 language = R

Search Path:
 .GlobalEnv, Autoloads, package:base

==> 694.reply.1 <==
From pd@biostat.ku.dk  Fri Oct 13 14:59:09 2000
Received: from biostat.ku.dk (blueberry [130.225.108.193])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id OAA17125;
	Fri, 13 Oct 2000 14:59:09 +0200 (MET DST)
Received: (from pd@localhost)
	by biostat.ku.dk (8.9.3/8.9.3) id PAA25930;
	Fri, 13 Oct 2000 15:08:20 +0200
Sender: pd@blueberry.kubism.ku.dk
To: J.C.Rougier@durham.ac.uk
Cc: r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] syntax confusion with function/non-function objects (PR#694)
References: <200010131107.NAA15331@pubhealth.ku.dk>
From: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>
Date: 13 Oct 2000 15:08:19 +0200
In-Reply-To: J.C.Rougier@durham.ac.uk's message of "Fri, 13 Oct 2000 13:07:26 +0200 (MET DST)"
Message-ID: <x2u2ag7ut8.fsf@blueberry.kubism.ku.dk>
Lines: 62
X-Mailer: Gnus v5.7/Emacs 20.7
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

J.C.Rougier@durham.ac.uk writes:

> I'm just back from a computer practical where we ran into
> 
> > "f" <- function(x) 2(x^2) # for 2 * x^2
> 
> This definition was taken as legitimate, although using the
> function generated the error message
> 
> > f(3)
> Error in f(3) : attempt to apply non-function
> 
> Am I right in thinking that in prevous versions of R this
> definition would have been declared as a syntax error? 

I don't think so... Splus 3.4 does likewise:

> 2(3)
Error: "2" is not a function
>  "f" <- function(x) 2(x^2)
> f(3)                    
Error in f(3): "2" is not a function
Dumped


> Surely a
> number before an opening parenthesis is always a syntax error?

Sounds like it might be so (although sometimes there are surprises).
However, it may not be all that easy or worth it to fix the parser to
recognise this case.

In general you can have any expression evaluating to the function
to be called. If you do f(x)(3), f(x) may or may not be a function
and you can only detect whether it is one at runtime.

From the parsers point of view there are only a few cases where it is
manifestly obvious that an expression cannot lead to a valid function.
Consider for instance the following silly stunt:

> g<-function(x){"+"<-function(x,y)log;(2+2)(x)}
> g(3)
[1] 1.098612

The operative bit is in src/main/gram.y

expr	: 
      ...

        |       expr '(' sublist ')'            { $$ = xxfuncall($1,$3); }

in which the expr is unrestricted and can be any R expression. One
could, I suppose, define a (say) "funexpr" syntactic entity which is just
like an "expr", except that if it is non-complex, then it has to be an
identifier or a character string. I think it would get quite kludgy,
though. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

==> 694.followup.1 <==
From luke@goose.stat.umn.edu  Fri Oct 13 15:32:46 2000
Received: from mhub0.tc.umn.edu (IDENT:0@mhub0.tc.umn.edu [128.101.131.40])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id PAA17583;
	Fri, 13 Oct 2000 15:32:45 +0200 (MET DST)
Received: from goose.stat.umn.edu by mhub0.tc.umn.edu with ESMTP; Fri, 13 Oct 2000 08:33:01 -0500
Received: (from luke@localhost)
	by goose.stat.umn.edu (8.9.1/8.9.1) id IAA23307;
	Fri, 13 Oct 2000 08:33:58 -0500 (CDT)
Message-Id: <200010131333.IAA23307@goose.stat.umn.edu>
Subject: Re: [Rd] syntax confusion with function/non-function objects (PR#694)
In-Reply-To: <x2u2ag7ut8.fsf@blueberry.kubism.ku.dk> from Peter Dalgaard BSA at "Oct 13, 2000 03:08:19 pm"
To: p.dalgaard@biostat.ku.dk (Peter Dalgaard BSA)
Date: Fri, 13 Oct 2000 08:33:57 -0500 (CDT)
From: Luke Tierney <luke@goose.stat.umn.edu>
Cc: J.C.Rougier@durham.ac.uk, r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
X-Mailer: ELM [version 2.4ME+ PL54 (25)]
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Peter Dalgaard BSA wrote:
> J.C.Rougier@durham.ac.uk writes:
> 
> > I'm just back from a computer practical where we ran into
> > 
> > > "f" <- function(x) 2(x^2) # for 2 * x^2
> > 
> > This definition was taken as legitimate, although using the
> > function generated the error message
> > 
> > > f(3)
> > Error in f(3) : attempt to apply non-function
> > 
> > Am I right in thinking that in prevous versions of R this
> > definition would have been declared as a syntax error? 
> 
> I don't think so... Splus 3.4 does likewise:
> 
> > 2(3)
> Error: "2" is not a function
> >  "f" <- function(x) 2(x^2)
> > f(3)                    
> Error in f(3): "2" is not a function
> Dumped
> 
> 
> > Surely a
> > number before an opening parenthesis is always a syntax error?
> 
> Sounds like it might be so (although sometimes there are surprises).
> However, it may not be all that easy or worth it to fix the parser to
> recognise this case.
> 
> In general you can have any expression evaluating to the function
> to be called. If you do f(x)(3), f(x) may or may not be a function
> and you can only detect whether it is one at runtime.
> 
> >From the parsers point of view there are only a few cases where it is
> manifestly obvious that an expression cannot lead to a valid function.
> Consider for instance the following silly stunt:
> 
> > g<-function(x){"+"<-function(x,y)log;(2+2)(x)}
> > g(3)
> [1] 1.098612
> 

I agree--I'd call this a type error in evaluation, not a syntax error.

One thing to keep in mind is that R expressions can be used for things
other that evaluation, for example in representing aspects of models.
Someone might want at some point to attach meaning to something like

	y ~ 2(x)+z

That would be impossible (or at least very dificult) if the expression
were made syntactically invalid.

It would be possible to have a semantic checking tool for R that walks
over the code and warns when it sees such an expression, but it should
not be considered an error since it could be legitimate.

luke

-- 
Luke Tierney
University of Minnesota                      Phone:           612-625-7843
School of Statistics                         Fax:             612-624-8868
313 Ford Hall, 224 Church St. S.E.           email:      luke@stat.umn.edu
Minneapolis, MN 55455 USA                    WWW:  http://www.stat.umn.edu

==> 694.followup.2 <==
From J.C.Rougier@durham.ac.uk  Fri Oct 13 16:50:29 2000
Received: from hermes.dur.ac.uk (hermes.dur.ac.uk [129.234.4.9])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id QAA18369;
	Fri, 13 Oct 2000 16:50:28 +0200 (MET DST)
Received: from euclid (euclid.dur.ac.uk [129.234.21.53])
	by hermes.dur.ac.uk (8.11.0/8.11.0) with ESMTP id e9DEoed05344;
	Fri, 13 Oct 2000 15:50:41 +0100 (BST)
Received: from laplace by euclid id <PAA00093@euclid>; Fri, 13 Oct 2000 15:50:40 +0100 (BST)
Date: Fri, 13 Oct 2000 15:50:40 +0100 (BST)
From: Jonathan Rougier <J.C.Rougier@durham.ac.uk>
X-Sender: dma0jcr@laplace
To: Luke Tierney <luke@goose.stat.umn.edu>
cc: Peter Dalgaard BSA <p.dalgaard@biostat.ku.dk>, J.C.Rougier@durham.ac.uk,
        r-devel@stat.math.ethz.ch, R-bugs@biostat.ku.dk
Subject: Re: [Rd] syntax confusion with function/non-function objects (PR#694)
In-Reply-To: <200010131333.IAA23307@goose.stat.umn.edu>
Message-ID: <Pine.GSO.4.20.0010131543551.28177-100000@laplace>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Fri, 13 Oct 2000, Luke Tierney wrote:

> > In general you can have any expression evaluating to the function
> > to be called. If you do f(x)(3), f(x) may or may not be a function
> > and you can only detect whether it is one at runtime.

> I agree--I'd call this a type error in evaluation, not a syntax error.
> 
> One thing to keep in mind is that R expressions can be used for things
> other that evaluation, for example in representing aspects of models.
> Someone might want at some point to attach meaning to something like
> 
> 	y ~ 2(x)+z
> 
> That would be impossible (or at least very dificult) if the expression
> were made syntactically invalid.
> 
> It would be possible to have a semantic checking tool for R that walks
> over the code and warns when it sees such an expression, but it should
> not be considered an error since it could be legitimate.

I see the point.  It might be helpful to change the R error message in
line with Splus so that the source of the error is easy to identify.

Jonathan.

Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE
http://www.maths.dur.ac.uk/stats/people/jcr/jcr.html

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* PR# 693 *
Subject:  Bug report
From: "Amaratunga, Rohith" <Rohith.Amaratunga@dsto.defence.gov.au>
Date: Thu, 12 Oct 2000 14:08:31 +1100
-- no notes --
~~~~~~~~~~ original reports follow ~~~~~~~~~~
==> 693 <==
From Rohith.Amaratunga@dsto.defence.gov.au  Thu Oct 12 05:11:35 2000
Received: from stat.math.ethz.ch (daemon@hypatia.ethz.ch [129.132.58.23])
	by pubhealth.ku.dk (8.9.3/8.9.1) with ESMTP id FAA26284
	for <R-bugs@biostat.ku.dk>; Thu, 12 Oct 2000 05:11:30 +0200 (MET DST)
Received: (from daemon@localhost)
	by stat.math.ethz.ch (8.9.1/8.9.1) id FAA16167
	for <r-bugs@hypatia.math.ethz.ch>; Thu, 12 Oct 2000 05:11:47 +0200 (MET DST)
Received: from digger1.defence.gov.au(203.5.217.4)
 via SMTP by hypatia, id smtpdAAAa003w.; Thu Oct 12 05:11:42 2000
Received: from dsto-ms2.dsto.defence.gov.au (dsto-ms2.dsto.defence.gov.au [131.185.2.150])
	by digger1.defence.gov.au (8.10.1/8.10.1) with ESMTP id e9C3CE813598
	for <r-bugs@hypatia.math.ethz.ch>; Thu, 12 Oct 2000 12:42:14 +0930 (CST)
Received: from muttley.dsto.defence.gov.au (unverified) by dsto-ms2.dsto.defence.gov.au
 (Content Technologies SMTPRS 4.1.5) with ESMTP id <T83b902964f35a6c607@dsto-ms2.dsto.defence.gov.au> for <r-bugs@hypatia.math.ethz.ch>;
 Thu, 12 Oct 2000 12:42:18 +0930
Received: from fmbex001.dsto.defence.gov.au (fmbex001.dsto.defence.gov.au [146.221.39.73])
	by muttley.dsto.defence.gov.au (8.9.3/8.9.3/8.9.3.LMD.990513) with ESMTP id MAA09164
	for <r-bugs@lists.r-project.org>; Thu, 12 Oct 2000 12:38:31 +0930 (CST)
Received: by fmbex001.dsto.defence.gov.au with Internet Mail Service (5.5.2650.21)
	id <4HDLKHHB>; Thu, 12 Oct 2000 14:08:35 +1100
Message-ID: <751E281AA9DED31194FA0090274DFFBC51414D@FMBEX003>
From: "Amaratunga, Rohith" <Rohith.Amaratunga@dsto.defence.gov.au>
To: "'r-bugs@lists.r-project.org'" <r-bugs@stat.math.ethz.ch>
Subject:  Bug report
Date: Thu, 12 Oct 2000 14:08:31 +1100
MIME-Version: 1.0
X-Mailer: Internet Mail Service (5.5.2650.21)
Content-Type: text/plain

I am operating R on a linux platform and the version info is given below

platform 	i686-unknown-linux
arch	i686
os	linux
system	i686, linux
status
major	0
minor	90.1
year	1999
month	December
day	15
languag  R

I cannot get the correct grid lines when I use the command grid() on a log
scale.  I have also tried using grid(1) and a variety of numbers but with no
luck

Thanks

Rohith


Rohith Amaratunga
Aeronautical and Maritime Research Laboratory
506 Lorimer Street,
Fishermans Bend, Victoria 3207.
Tel: (03) 9626 7154 (B), 0417 317 445, (03) 9818 5776 (H)
E-mail: rohith.amaratunga@dsto.defence.gov.au

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
